typeof JSON!="object"&&(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();function createDragMask(){var e;try{var t='<div id="screenshield" ></div>';e=document.createElement(t)}catch(n){e=document.createElement("div"),e.setAttribute("id","screenshield")}e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.width=getWinWidth()-50+"px",e.style.height=getWinHeight()-50+"px",e.style.background="transparent",e.style.display="none",e.style.zIndex=highestZIndex++,document.body.appendChild(e),dragMask=e}function divResize(e,t,n,r){var i=!1,s=document.getElementById(e);s.style.display="block",s.firstChild.style.display="none";var o="+";r!=null&&(o=r),o=="+"?(parseInt(s.style.width)<t&&(s.style.width=parseInt(s.style.width)+4+"px",i=!0),parseInt(s.style.height)<n&&(s.style.height=parseInt(s.style.height)+4+"px",i=!0)):(parseInt(s.style.width)>t&&(s.style.width=parseInt(s.style.width)-4+"px",i=!0),parseInt(s.style.height)>n&&(s.style.height=parseInt(s.style.height)-4+"px",i=!0)),i==1?setTimeout('divResize("'+e+'", '+t+", "+n+', "'+o+'")',1):s.firstChild.style.display="block"}function divMoveAnim(divid,toX,toY,finaldisplaystate,callback){finaldisplaystate==null&&(finaldisplaystate="block");var carryon=!1,div;typeof divid=="string"?div=document.getElementById(divid):div=divid,div.style.display="block",parseInt(div.style.left)<toX?parseInt(div.style.left)+4<toX?(div.style.left=parseInt(div.style.left)+4+"px",carryon=!0):div.style.left=toX+"px":parseInt(div.style.left)>toX&&(parseInt(div.style.left)-4>toX?(div.style.left=parseInt(div.style.left)-4+"px",carryon=!0):div.style.left=toX+"px"),parseInt(div.style.top)<toY?parseInt(div.style.top)+4<toY?(div.style.top=parseInt(div.style.top)+4+"px",carryon=!0):div.style.top=toY+"px":parseInt(div.style.top)>toY&&(parseInt(div.style.top)-4>toY?(div.style.top=parseInt(div.style.top)-4+"px",carryon=!0):div.style.top=toY+"px");if(carryon==1)animating=!0,window.requestAnimationFrame(function(){divMoveAnim(divid,toX,toY,finaldisplaystate,callback)});else{animating=!1,finaldisplaystate!=""&&(div.style.display=finaldisplaystate);try{callback()}catch(err){eval(callback)}}}function divResizeAnim(divid,toW,toH,finaldisplaystate,callback,iW,iH,w,h){finaldisplaystate==null&&(finaldisplaystate="block");var div;typeof divid=="string"?(div=document.getElementById(divid),div.style.display="block",w=parseInt(div.style.width),h=parseInt(div.style.height),w>toW?iW=-2:iW=2,h>toH?iH=-2:iH=2):div=divid,iW>0&&w<toW?(w+=iW,w>=toW&&(w=toW)):iW<0&&w>toW&&(w+=iW,w<=toW&&(w=toW)),iH>0&&h<toH?(h+=iH,h>=toH&&(h=toH)):iH<0&&h>toH&&(h+=iH,h<=toH&&(h=toH)),div.style.width=w+"px",div.style.height=h+"px",w==toW&&h==toH?(animating=!1,finaldisplaystate!=""&&(div.style.display=finaldisplaystate),eval(callback)):(animating=!0,divResizeAnimTimeout=setTimeout(function(){divResizeAnim(divid,toW,toH,finaldisplaystate,callback,iW,iH,w,h)},1))}function createPublPopupDiv(e,t,n,r,i,s,o,u,a){a||(a="");var f="absolute";u!=null&&(f=u);var l=document.createElement("div");l.className=s,l.id=i+"_container",l.style.position=f,l.style.top=e+"px",l.style.left=t+"px",l.style.width=n+"px",l.style.height=r+"px",l.style.display="none",l.style.background="#ffffff",l.innerHTML='<div style="height:24px;" onmouseover="this.style.cursor=\'move\';" id="'+i+'_handle" class="pop_titlebar" ><span class="pop_closebutton" onclick="document.getElementById(\''+i+'_container\').style.display=\'none\';return false;" >&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="pop_title_label" id="'+i+'_title">'+a+'</span></div><div id="'+i+'" style="height:'+(r-60)+"px;width:"+n+'px;overflow:auto" >'+o+'</div><div id="'+i+'_resize" style="height:30px;cursor:se-resize" ></div>',document.body.appendChild(l);var c=null,h=null;return f!="relative"&&(c=0,h=0),Drag.init(document.getElementById(i+"_handle"),l,c,null,h),DragResize.init(document.getElementById(i+"_resize"),l),l.onDragResizeEnd=function(e,t){var n=document.getElementById(i);n.style.width=e+"px",n.style.height=t-60+"px",n.style.display="block",typeof this.onDragResizeEndCallback=="function"&&this.onDragResizeEndCallback(e,t)},l.onDragResizeStart=function(e,t){document.getElementById(i).style.display="none"},l.move=function(e,t){document.getElementById(i+"_handle").move(parseInt(e),parseInt(t))},l}function findPos(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function getWinWidth(){var e=0;return self.innerHeight?e=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientWidth:document.body&&(e=document.body.clientWidth),e}function getWinHeight(){var e=0;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function showMoveCursor(e,t,n){var r=e||window.event;if(r&&t){var i=r.target||r.srcElement;if(i&&i!=t){if(i.nodeName=="SELECT"||i.nodeName=="INPUT"||i.nodeName=="TEXTAREA"||i.nodeName=="select"||i.nodeName=="input"||i.nodeName=="textarea")return;!i.onmouseover&&!i.onmouseup&&!i.onmousedown&&!i.onclick&&!i.onchange&&!i.onChange&&(n?t.style.cursor="move":t.style.cursor="auto")}}}function getScreenScrollXY(){var e=0,t=0;return typeof window.pageYOffset=="number"?(t=window.pageYOffset,e=window.pageXOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(t=document.body.scrollTop,e=document.body.scrollLeft):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft),[e,t]}var highestZIndex=1e3,animating=!1,dragMask,Drag={obj:null,init:function(e,t,n,r,i,s,o,u,a,f){e.onmousedown=Drag.start,e.ontouchstart=Drag.start,e.hmode=o?!1:!0,u?e.vmode=u?!1:!0:e.vmode=!0,e.root=t&&t!=null?t:e,e.hmode&&isNaN(parseInt(e.root.style.left))&&(e.root.style.left="0px"),e.vmode&&isNaN(parseInt(e.root.style.top))&&(e.root.style.top="0px"),!e.hmode&&isNaN(parseInt(e.root.style.right))&&(e.root.style.right="0px"),!e.vmode&&isNaN(parseInt(e.root.style.bottom))&&(e.root.style.bottom="0px"),e.minX=typeof n!="undefined"?n:null,e.minY=typeof i!="undefined"?i:null,e.maxX=typeof r!="undefined"?r:null,e.maxY=typeof s!="undefined"?s:null,e.xMapper=a?a:null,e.yMapper=f?f:null,e.root.onDragStart=new Function,e.root.onDragEnd=new Function,e.root.onDrag=new Function,dragMask||createDragMask(),e.mask=dragMask,e.move=Drag.move,e.clickmove=Drag.clickmove,e.root.handle=e},start:function(e){e=Drag.fixE(e);var t=Drag.obj=this,n=e||window.event;if(!n)return;var r=n.target||n.srcElement;if(typeof r!="undefined"&&r!=null&&r!=t){if(r.onmouseup||r.onmousedown||r.onclick)return;if(r.nodeName!="undefined")if(r.nodeName=="SELECT"||r.nodeName=="INPUT"||r.nodeName=="TEXTAREA"||r.nodeName=="select"||r.nodeName=="input"||r.nodeName=="textarea")return}e.type=="touchstart"&&(e.preventDefault?e.preventDefault():e.returnValue=!1,t.touch=!0,t.onmousedown=null),t.mask.style.width=getWinWidth()-50+"px",t.mask.style.height=getWinHeight()-50+"px",t.root.style.zIndex=highestZIndex++;var i=e;t.touch&&(i=e.touches[0]);var s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right);return t.root.onDragStart(o,s),t.lastMouseX=i.clientX,t.lastMouseY=i.clientY,t.hmode?(t.minX!=null&&(t.minMouseX=i.clientX-o+t.minX),t.maxX!=null&&(t.maxMouseX=t.minMouseX+t.maxX-t.minX)):(t.minX!=null&&(t.maxMouseX=-t.minX+i.clientX+o),t.maxX!=null&&(t.minMouseX=-t.maxX+i.clientX+o)),t.vmode?(t.minY!=null&&(t.minMouseY=i.clientY-s+t.minY),t.maxY!=null&&(t.maxMouseY=t.minMouseY+t.maxY-t.minY)):(t.minY!=null&&(t.maxMouseY=-t.minY+i.clientY+s),t.maxY!=null&&(t.minMouseY=-t.maxY+i.clientY+s)),t.docmouseup=document.onmouseup,t.docmousemove=document.onmousemove,document.onmousemove=Drag.drag,document.onmouseup=Drag.end,document.ontouchmove=Drag.drag,document.ontouchend=Drag.end,e&&e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},drag:function(e){var t=Drag.obj;t.touch==1&&(e.preventDefault?e.preventDefault():e.returnValue=!1),e=Drag.fixE(e);var n=e;t.touch==1&&(n=e.touches[0]);var r=n.clientY,i=n.clientX,s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right),u,a;return t.minX!=null&&(i=t.hmode?Math.max(i,t.minMouseX):Math.min(i,t.maxMouseX)),t.maxX!=null&&(i=t.hmode?Math.min(i,t.maxMouseX):Math.max(i,t.minMouseX)),t.minY!=null&&(r=t.vmode?Math.max(r,t.minMouseY):Math.min(r,t.maxMouseY)),t.maxY!=null&&(r=t.vmode?Math.min(r,t.maxMouseY):Math.max(r,t.minMouseY)),u=o+(i-t.lastMouseX)*(t.hmode?1:-1),a=s+(r-t.lastMouseY)*(t.vmode?1:-1),t.xMapper?u=t.xMapper(s):t.yMapper&&(a=t.yMapper(o)),Drag.obj.root.style[t.hmode?"left":"right"]=u+"px",Drag.obj.root.style[t.vmode?"top":"bottom"]=a+"px",Drag.obj.lastMouseX=i,Drag.obj.lastMouseY=r,Drag.obj.root.onDrag(u,a),!1},move:function(e,t){var n=Drag.obj=this,r=t,i=e;return Drag.obj.root.style[n.hmode?"left":"right"]=i+"px",Drag.obj.root.style[n.vmode?"top":"bottom"]=r+"px",Drag.obj.lastMouseX=i,Drag.obj.lastMouseY=r,!1},clickmove:function(e){e=Drag.fixE(e);var t=Drag.obj=this,n=e.target||e.srcElement;if(n!=null&&n==t)return;var r=e.clientY,i=e.clientX,s=parseInt(t.vmode?t.root.style.top:t.root.style.bottom),o=parseInt(t.hmode?t.root.style.left:t.root.style.right),u=findPos(t);t.lastMouseX=u[0],t.lastMouseY=u[1],Drag.obj.root.onDragStart(o,s),t.hmode?(t.minX!=null&&(t.minMouseX=u[0]-o+t.minX),t.maxX!=null&&(t.maxMouseX=t.minMouseX+t.maxX-t.minX)):(t.minX!=null&&(t.maxMouseX=-t.minX+u[0]+o),t.maxX!=null&&(t.minMouseX=-t.maxX+u[0]+o)),t.vmode?(t.minY!=null&&(t.minMouseY=u[1]-s+t.minY),t.maxY!=null&&(t.maxMouseY=t.minMouseY+t.maxY-t.minY)):(t.minY!=null&&(t.maxMouseY=-t.minY+u[1]+s),t.maxY!=null&&(t.minMouseY=-t.maxY+u[1]+s));var a,f;return t.minX!=null&&(i=t.hmode?Math.max(i,t.minMouseX):Math.min(i,t.maxMouseX)),t.maxX!=null&&(i=t.hmode?Math.min(i,t.maxMouseX):Math.max(i,t.minMouseX)),t.minY!=null&&(r=t.vmode?Math.max(r,t.minMouseY):Math.min(r,t.maxMouseY)),t.maxY!=null&&(r=t.vmode?Math.min(r,t.maxMouseY):Math.max(r,t.minMouseY)),a=o+(i-t.lastMouseX)*(t.hmode?1:-1),f=s+(r-t.lastMouseY)*(t.vmode?1:-1),t.xMapper?a=t.xMapper(s):t.yMapper&&(f=t.yMapper(o)),Drag.obj.root.style[t.hmode?"left":"right"]=a+"px",Drag.obj.root.style[t.vmode?"top":"bottom"]=f+"px",Drag.obj.root.onDragEnd(a,f),Drag.obj=null,!1},end:function(e){e=Drag.fixE(e),document.onmouseup=Drag.obj.docmouseup,document.onmousemove=Drag.obj.docmousemove,document.ontouchmove=null;var t=Drag.obj;t.touch==1&&(e.preventDefault?e.preventDefault():e.returnValue=!1),document.ontouchend=null,Drag.obj.root.onDragEnd(parseInt(Drag.obj.root.style[Drag.obj.hmode?"left":"right"]),parseInt(Drag.obj.root.style[Drag.obj.vmode?"top":"bottom"])),Drag.obj.mask.style.width="0px",Drag.obj.mask.style.height="0px",Drag.obj.mask.style.display="none",Drag.obj=null},fixE:function(e){return typeof e=="undefined"&&(e=window.event),typeof e.layerX=="undefined"&&(e.layerX=e.offsetX),typeof e.layerY=="undefined"&&(e.layerY=e.offsetY),e}},DragResize={obj:null,init:function(e,t,n,r,i,s){e.onmousedown=DragResize.start,e.ontouchstart=DragResize.start,e.root=t&&t!=null?t:e,typeof n!="undefined"&&n==-1&&(e.vmode=!0),typeof i!="undefined"&&i==-1&&(e.hmode=!0),e.minW=typeof n!="undefined"?n:50,e.minH=typeof i!="undefined"?i:50,e.maxW=typeof r!="undefined"?r:null,e.maxH=typeof s!="undefined"?s:null,e.root.onDragResizeStart=new Function,e.root.onDragResizeEnd=new Function,e.root.onDragResize=new Function,dragMask||createDragMask(),e.mask=dragMask},start:function(e){var t=DragResize.obj=this,n=e||window.event;if(!n)return;var r=n.target||n.srcElement;if(typeof r!="undefined"&&r!=null&&r!=t)if(r.onmouseup||r.onmousedown||r.onclick)return;e=DragResize.fixE(e);var t=DragResize.obj=this;e.type=="touchstart"&&(t.touch=!0),t.mask.style.width=getWinWidth()-50+"px",t.mask.style.height=getWinHeight()-50+"px",t.mask.style.display="block",t.mask.style.zIndex=highestZIndex++,t.rLeft=parseInt(t.root.style.width)-parseInt(t.style.left),t.rTop=parseInt(t.root.style.height)-parseInt(t.style.top),t.style.display="none",t.root.style.zIndex=highestZIndex++;var i=parseInt(t.root.style.height),s=parseInt(t.root.style.width);t.root.onDragResizeStart(s,i);var o=e;return t.touch&&(o=e.touches[0]),t.lastMouseX=o.clientX,t.lastMouseY=o.clientY,t.docmouseup=document.onmouseup,t.docmousemove=document.onmousemove,document.onmousemove=DragResize.resize,document.onmouseup=DragResize.end,document.ontouchmove=DragResize.resize,document.ontouchend=DragResize.end,!1},resize:function(e){e=DragResize.fixE(e);var t=DragResize.obj,n=e;t.touch==1&&(e.preventDefault(),n=e.touches[0]);var r=n.clientY,i=n.clientX;r>t.lastMouseY+20;var s=parseInt(t.root.style.height),o=parseInt(t.root.style.width),u,a;return u=o+(i-t.lastMouseX),a=s+(r-t.lastMouseY),u<t.minW&&(u=t.minW),t.maxW!=null&&u>t.maxW&&(u=t.maxW),a<t.minH&&(a=t.minH),t.maxH!=null&&a>t.maxH&&(a=t.maxH),t.vmode?(DragResize.obj.root.style.height=a+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r):t.hmode?(DragResize.obj.root.style.width=u+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r):(DragResize.obj.root.style.width=u+"px",DragResize.obj.root.style.height=a+"px",DragResize.obj.lastMouseX=i,DragResize.obj.lastMouseY=r),DragResize.obj.root.onDragResize(u,a),!1},end:function(){document.onmouseup=DragResize.obj.docmouseup,document.onmousemove=DragResize.obj.docmousemove,DragResize.obj.root.onDragResizeEnd(parseInt(DragResize.obj.root.style.width),parseInt(DragResize.obj.root.style.height)),DragResize.obj.style.display="block",DragResize.obj.mask.style.width="0px",DragResize.obj.mask.style.height="0px",DragResize.obj.mask.style.display="none",DragResize.obj=null},fixE:function(e){return typeof e=="undefined"&&(e=window.event),typeof e.layerX=="undefined"&&(e.layerX=e.offsetX),typeof e.layerY=="undefined"&&(e.layerY=e.offsetY),e}},divMoveAnimTimeout,divResizeAnimTimeout;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=t);for(;n<t;n++)if(n in this&&this[n]===e)return n;return-1});var bestFit=function(){function globalEval(x){eval.call(null,x)}function abort(e){throw Module.print(e+":\n"+(new Error).stack),ABORT=!0,"Assertion: "+e}function assert(e,t){e||abort("Assertion failed: "+t)}function ccall(e,t,n,r){return ccallFunc(getCFunc(e),t,n,r)}function getCFunc(ident){try{var func=globalScope.Module["_"+ident];func||(func=eval("_"+ident))}catch(e){}return assert(func,"Cannot call unknown function "+ident+" (perhaps LLVM optimizations or closure removed it?)"),func}function ccallFunc(e,t,n,r){function s(e,t){if(t=="string"){if(e===null||e===undefined||e===0)return 0;i||(i=Runtime.stackSave());var n=Runtime.stackAlloc(e.length+1);return writeStringToMemory(e,n),n}if(t=="array"){i||(i=Runtime.stackSave());var n=Runtime.stackAlloc(e.length);return writeArrayToMemory(e,n),n}return e}function o(e,t){return t=="string"?Pointer_stringify(e):(assert(t!="array"),e)}var i=0,u=0,a=r?r.map(function(e){return s(e,n[u++])}):[],f=o(e.apply(null,a),t);return i&&Runtime.stackRestore(i),f}function cwrap(e,t,n){var r=getCFunc(e);return function(){return ccallFunc(r,t,n,Array.prototype.slice.call(arguments))}}function setValue(e,t,n,r){n=n||"i8",n.charAt(n.length-1)==="*"&&(n="i32");switch(n){case"i1":HEAP8[e]=t;break;case"i8":HEAP8[e]=t;break;case"i16":HEAP16[e>>1]=t;break;case"i32":HEAP32[e>>2]=t;break;case"i64":tempI64=[t>>>0,Math.min(Math.floor(t/4294967296),4294967295)>>>0],HEAP32[e>>2]=tempI64[0],HEAP32[e+4>>2]=tempI64[1];break;case"float":HEAPF32[e>>2]=t;break;case"double":HEAPF64[e>>3]=t;break;default:abort("invalid type for setValue: "+n)}}function getValue(e,t,n){t=t||"i8",t.charAt(t.length-1)==="*"&&(t="i32");switch(t){case"i1":return HEAP8[e];case"i8":return HEAP8[e];case"i16":return HEAP16[e>>1];case"i32":return HEAP32[e>>2];case"i64":return HEAP32[e>>2];case"float":return HEAPF32[e>>2];case"double":return HEAPF64[e>>3];default:abort("invalid type for setValue: "+t)}return null}function allocate(e,t,n,r){var i,s;typeof e=="number"?(i=!0,s=e):(i=!1,s=e.length);var o=typeof t=="string"?t:null,u;n==ALLOC_NONE?u=r:u=[_malloc,Runtime.stackAlloc,Runtime.staticAlloc,Runtime.dynamicAlloc][n===undefined?ALLOC_STATIC:n](Math.max(s,o?1:t.length));if(i){var r=u,a;assert((u&3)==0),a=u+(s&-4);for(;r<a;r+=4)HEAP32[r>>2]=0;a=u+s;while(r<a)HEAP8[r++|0]=0;return u}if(o==="i8")return HEAPU8.set(new Uint8Array(e),u),u;var f=0,l,c,h;while(f<s){var p=e[f];typeof p=="function"&&(p=Runtime.getFunctionIndex(p)),l=o||t[f];if(l===0){f++;continue}assert(l,"Must know what type to store in allocate!"),l=="i64"&&(l="i32"),setValue(u+f,p,l),h!==l&&(c=Runtime.getNativeTypeSize(l),h=l),f+=c}return u}function Pointer_stringify(e,t){var n=!1,r,i=0;for(;;){r=HEAPU8[e+i|0];if(r>=128)n=!0;else if(r==0&&!t)break;i++;if(t&&i==t)break}t||(t=i);var s="";if(!n){var o=1024,u;while(t>0)u=String.fromCharCode.apply(String,HEAPU8.subarray(e,e+Math.min(t,o))),s=s?s+u:u,e+=o,t-=o;return s}var a=new Runtime.UTF8Processor;for(i=0;i<t;i++)assert(e+i<TOTAL_MEMORY),r=HEAPU8[e+i|0],s+=a.processCChar(r);return s}function alignMemoryPage(e){return e+4095>>12<<12}function enlargeMemory(){abort("Cannot enlarge memory arrays. Either (1) compile with -s TOTAL_MEMORY=X with X higher than the current value, (2) compile with ALLOW_MEMORY_GROWTH which adjusts the size at runtime but prevents some optimizations, or (3) set Module.TOTAL_MEMORY before the program runs.")}function callRuntimeCallbacks(e){while(e.length>0){var t=e.shift();if(typeof t=="function"){t();continue}var n=t.func;typeof n=="number"?t.arg===undefined?Runtime.dynCall("v",n):Runtime.dynCall("vi",n,[t.arg]):n(t.arg===undefined?null:t.arg)}}function ensureInitRuntime(){if(runtimeInitialized)return;runtimeInitialized=!0,callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){callRuntimeCallbacks(__ATEXIT__)}function intArrayFromString(e,t,n){var r=(new Runtime.UTF8Processor).processJSString(e);return n&&(r.length=n),t||r.push(0),r}function intArrayToString(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];r>255&&(assert(!1,"Character code "+r+" ("+String.fromCharCode(r)+")  at offset "+n+" not in 0x00-0xFF."),r&=255),t.push(String.fromCharCode(r))}return t.join("")}function writeStringToMemory(e,t,n){var r=intArrayFromString(e,n),i=0;while(i<r.length){var s=r[i];HEAP8[t+i|0]=s,i+=1}}function writeArrayToMemory(e,t){for(var n=0;n<e.length;n++)HEAP8[t+n|0]=e[n]}function unSign(e,t,n,r){return e>=0?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function reSign(e,t,n,r){if(e<=0)return e;var i=t<=32?Math.abs(1<<t-1):Math.pow(2,t-1);return e>=i&&(t<=32||e>i)&&(e=-2*i+e),e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),e?(assert(!runDependencyTracking[e]),runDependencyTracking[e]=1,runDependencyWatcher===null&&typeof setInterval!="undefined"&&(runDependencyWatcher=setInterval(function(){var e=!1;for(var t in runDependencyTracking)e||(e=!0,Module.printErr("still waiting on run dependencies:")),Module.printErr("dependency: "+t);e&&Module.printErr("(end of list)")},6e3))):Module.printErr("warning: run dependency added without ID")}function removeRunDependency(e){runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),e?(assert(runDependencyTracking[e]),delete runDependencyTracking[e]):Module.printErr("warning: run dependency removed without ID"),runDependencies==0&&(runDependencyWatcher!==null&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),!calledRun&&shouldRunNow&&run())}function addPreRun(e){Module.preRun?typeof Module["preRun"]=="function"&&(Module.preRun=[Module.preRun]):Module.preRun=[],Module.preRun.push(e)}function loadMemoryInitializer(e){function t(e){HEAPU8.set(e,STATIC_BASE),runPostSets()}addPreRun(function(){ENVIRONMENT_IS_NODE||ENVIRONMENT_IS_SHELL?t(Module.readBinary(e)):Browser.asyncLoad(e,function(e){t(e)},function(t){throw"could not load memory initializer "+e})}),awaitingMemoryInitializer=!1}function runPostSets(){}function copyTempFloat(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3]}function copyTempDouble(e){HEAP8[tempDoublePtr]=HEAP8[e],HEAP8[tempDoublePtr+1]=HEAP8[e+1],HEAP8[tempDoublePtr+2]=HEAP8[e+2],HEAP8[tempDoublePtr+3]=HEAP8[e+3],HEAP8[tempDoublePtr+4]=HEAP8[e+4],HEAP8[tempDoublePtr+5]=HEAP8[e+5],HEAP8[tempDoublePtr+6]=HEAP8[e+6],HEAP8[tempDoublePtr+7]=HEAP8[e+7]}function _memcpy(e,t,n){e|=0,t|=0,n|=0;var r=0;r=e|0;if((e&3)==(t&3)){while(e&3){if((n|0)==0)return r|0;HEAP8[e]=HEAP8[t],e=e+1|0,t=t+1|0,n=n-1|0}while((n|0)>=4)HEAP32[e>>2]=HEAP32[t>>2],e=e+4|0,t=t+4|0,n=n-4|0}while((n|0)>0)HEAP8[e]=HEAP8[t],e=e+1|0,t=t+1|0,n=n-1|0;return r|0}function _memset(e,t,n){e|=0,t|=0,n|=0;var r=0,i=0,s=0,o=0;r=e+n|0;if((n|0)>=20){t&=255,o=e&3,i=t|t<<8|t<<16|t<<24,s=r&-4;if(o){o=e+4-o|0;while((e|0)<(o|0))HEAP8[e]=t,e=e+1|0}while((e|0)<(s|0))HEAP32[e>>2]=i,e=e+4|0}while((e|0)<(r|0))HEAP8[e]=t,e=e+1|0}function _strlen(e){e|=0;var t=0;t=e;while(HEAP8[t])t=t+1|0;return t-e|0}function __reallyNegative(e){return e<0||e===0&&1/e===-Infinity}function __formatString(e,t){function i(e){var n;return e==="double"?n=HEAPF64[t+r>>3]:e=="i64"?(n=[HEAP32[t+r>>2],HEAP32[t+(r+8)>>2]],r+=8):(e="i32",n=HEAP32[t+r>>2]),r+=Math.max(Runtime.getNativeFieldSize(e),Runtime.getAlignSize(e,null,!0)),n}var n=e,r=0,s=[],o,u,a;for(;;){var f=n;o=HEAP8[n];if(o===0)break;u=HEAP8[n+1|0];if(o==37){var l=!1,c=!1,h=!1,p=!1;e:for(;;){switch(u){case 43:l=!0;break;case 45:c=!0;break;case 35:h=!0;break;case 48:if(p)break e;p=!0;break;default:break e}n++,u=HEAP8[n+1|0]}var d=0;if(u==42)d=i("i32"),n++,u=HEAP8[n+1|0];else while(u>=48&&u<=57)d=d*10+(u-48),n++,u=HEAP8[n+1|0];var v=!1;if(u==46){var m=0;v=!0,n++,u=HEAP8[n+1|0];if(u==42)m=i("i32"),n++;else for(;;){var g=HEAP8[n+1|0];if(g<48||g>57)break;m=m*10+(g-48),n++}u=HEAP8[n+1|0]}else var m=6;var y;switch(String.fromCharCode(u)){case"h":var b=HEAP8[n+2|0];b==104?(n++,y=1):y=2;break;case"l":var b=HEAP8[n+2|0];b==108?(n++,y=8):y=4;break;case"L":case"q":case"j":y=8;break;case"z":case"t":case"I":y=4;break;default:y=null}y&&n++,u=HEAP8[n+1|0];switch(String.fromCharCode(u)){case"d":case"i":case"u":case"o":case"x":case"X":case"p":var w=u==100||u==105;y=y||4;var a=i("i"+y*8),E=a,S;y==8&&(a=Runtime.makeBigInt(a[0],a[1],u==117));if(y<=4){var x=Math.pow(256,y)-1;a=(w?reSign:unSign)(a&x,y*8)}var T=Math.abs(a),N="";if(u==100||u==105)y==8&&i64Math?S=i64Math.stringify(E[0],E[1],null):S=reSign(a,8*y,1).toString(10);else if(u==117)y==8&&i64Math?S=i64Math.stringify(E[0],E[1],!0):S=unSign(a,8*y,1).toString(10),a=Math.abs(a);else if(u==111)S=(h?"0":"")+T.toString(8);else if(u==120||u==88){N=h&&a!=0?"0x":"";if(y==8&&i64Math)if(E[1]){S=(E[1]>>>0).toString(16);var C=(E[0]>>>0).toString(16);while(C.length<8)C="0"+C;S+=C}else S=(E[0]>>>0).toString(16);else if(a<0){a=-a,S=(T-1).toString(16);var k=[];for(var L=0;L<S.length;L++)k.push((15-parseInt(S[L],16)).toString(16));S=k.join("");while(S.length<y*2)S="f"+S}else S=T.toString(16);u==88&&(N=N.toUpperCase(),S=S.toUpperCase())}else u==112&&(T===0?S="(nil)":(N="0x",S=T.toString(16)));if(v)while(S.length<m)S="0"+S;l&&(a<0?N="-"+N:N="+"+N);while(N.length+S.length<d)c?S+=" ":p?S="0"+S:N=" "+N;S=N+S,S.split("").forEach(function(e){s.push(e.charCodeAt(0))});break;case"f":case"F":case"e":case"E":case"g":case"G":var a=i("double"),S;if(isNaN(a))S="nan",p=!1;else if(!isFinite(a))S=(a<0?"-":"")+"inf",p=!1;else{var A=!1,O=Math.min(m,20);if(u==103||u==71){A=!0,m=m||1;var M=parseInt(a.toExponential(O).split("e")[1],10);m>M&&M>=-4?(u=(u==103?"f":"F").charCodeAt(0),m-=M+1):(u=(u==103?"e":"E").charCodeAt(0),m--),O=Math.min(m,20)}if(u==101||u==69)S=a.toExponential(O),/[eE][-+]\d$/.test(S)&&(S=S.slice(0,-1)+"0"+S.slice(-1));else if(u==102||u==70)S=a.toFixed(O),a===0&&__reallyNegative(a)&&(S="-"+S);var _=S.split("e");if(A&&!h)while(_[0].length>1&&_[0].indexOf(".")!=-1&&(_[0].slice(-1)=="0"||_[0].slice(-1)=="."))_[0]=_[0].slice(0,-1);else{h&&S.indexOf(".")==-1&&(_[0]+=".");while(m>O++)_[0]+="0"}S=_[0]+(_.length>1?"e"+_[1]:""),u==69&&(S=S.toUpperCase()),l&&a>=0&&(S="+"+S)}while(S.length<d)c?S+=" ":!p||S[0]!="-"&&S[0]!="+"?S=(p?"0":" ")+S:S=S[0]+"0"+S.slice(1);u<97&&(S=S.toUpperCase()),S.split("").forEach(function(e){s.push(e.charCodeAt(0))});break;case"s":var D=i("i8*"),P=D?_strlen(D):"(null)".length;v&&(P=Math.min(P,m));if(!c)while(P<d--)s.push(32);if(D)for(var L=0;L<P;L++)s.push(HEAPU8[D++|0]);else s=s.concat(intArrayFromString("(null)".substr(0,P),!0));if(c)while(P<d--)s.push(32);break;case"c":c&&s.push(i("i8"));while(--d>0)s.push(32);c||s.push(i("i8"));break;case"n":var H=i("i32*");HEAP32[H>>2]=s.length;break;case"%":s.push(o);break;default:for(var L=f;L<n+2;L++)s.push(HEAP8[L])}n+=2}else s.push(o),n+=1}return s}function _snprintf(e,t,n,r){var i=__formatString(n,r),s=t===undefined?i.length:Math.min(i.length,Math.max(t-1,0));if(e<0){e=-e;var o=_malloc(s+1);HEAP32[e>>2]=o,e=o}for(var u=0;u<s;u++)HEAP8[e+u|0]=i[u];if(s<t||t===undefined)HEAP8[e+u|0]=0;return i.length}function _sprintf(e,t,n){return _snprintf(e,undefined,t,n)}function _malloc(e){Runtime.warnOnce("using stub malloc (reference it from C to have the real one included)");var t=Runtime.dynamicAlloc(e+8);return t+8&4294967288}function _free(){Runtime.warnOnce("using stub free (reference it from C to have the real one included)")}function __ZN8BEST_FIT11fm_identityEPf(e){var t=0,n;n=e;var r=n,i=r|0;HEAPF32[i>>2]=1;var s=n,o=s+20|0;HEAPF32[o>>2]=1;var u=n,a=u+40|0;HEAPF32[a>>2]=1;var f=n,l=f+60|0;HEAPF32[l>>2]=1;var c=n,h=c+16|0;HEAPF32[h>>2]=0;var p=n,d=p+32|0;HEAPF32[d>>2]=0;var v=n,m=v+48|0;HEAPF32[m>>2]=0;var g=n,y=g+4|0;HEAPF32[y>>2]=0;var b=n,w=b+36|0;HEAPF32[w>>2]=0;var E=n,S=E+52|0;HEAPF32[S>>2]=0;var x=n,T=x+8|0;HEAPF32[T>>2]=0;var N=n,C=N+24|0;HEAPF32[C>>2]=0;var k=n,L=k+56|0;HEAPF32[L>>2]=0;var A=n,O=A+12|0;HEAPF32[O>>2]=0;var M=n,_=M+28|0;HEAPF32[_>>2]=0;var D=n,P=D+44|0;HEAPF32[P>>2]=0;return}function __ZN8BEST_FIT17fm_matrixMultiplyEPKfS1_Pf(e,t,n){var r=0,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;i=e,s=t,o=n;var x=i,T=x|0,N=HEAPF32[T>>2],C=s,k=C|0,L=HEAPF32[k>>2],A=N*L,O=i,M=O+4|0,_=HEAPF32[M>>2],D=s,P=D+16|0,H=HEAPF32[P>>2],B=_*H,j=A+B,F=i,I=F+8|0,q=HEAPF32[I>>2],R=s,U=R+32|0,z=HEAPF32[U>>2],W=q*z,X=j+W,V=i,$=V+12|0,J=HEAPF32[$>>2],K=s,Q=K+48|0,G=HEAPF32[Q>>2],Y=J*G,Z=X+Y;u=Z;var et=i,tt=et|0,nt=HEAPF32[tt>>2],rt=s,it=rt+4|0,st=HEAPF32[it>>2],ot=nt*st,ut=i,at=ut+4|0,ft=HEAPF32[at>>2],lt=s,ct=lt+20|0,ht=HEAPF32[ct>>2],pt=ft*ht,dt=ot+pt,vt=i,mt=vt+8|0,gt=HEAPF32[mt>>2],yt=s,bt=yt+36|0,wt=HEAPF32[bt>>2],Et=gt*wt,St=dt+Et,xt=i,Tt=xt+12|0,Nt=HEAPF32[Tt>>2],Ct=s,kt=Ct+52|0,Lt=HEAPF32[kt>>2],At=Nt*Lt,Ot=St+At;a=Ot;var Mt=i,_t=Mt|0,Dt=HEAPF32[_t>>2],Pt=s,Ht=Pt+8|0,Bt=HEAPF32[Ht>>2],jt=Dt*Bt,Ft=i,It=Ft+4|0,qt=HEAPF32[It>>2],Rt=s,Ut=Rt+24|0,zt=HEAPF32[Ut>>2],Wt=qt*zt,Xt=jt+Wt,Vt=i,$t=Vt+8|0,Jt=HEAPF32[$t>>2],Kt=s,Qt=Kt+40|0,Gt=HEAPF32[Qt>>2],Yt=Jt*Gt,Zt=Xt+Yt,en=i,tn=en+12|0,nn=HEAPF32[tn>>2],rn=s,sn=rn+56|0,on=HEAPF32[sn>>2],un=nn*on,an=Zt+un;f=an;var fn=i,ln=fn|0,cn=HEAPF32[ln>>2],hn=s,pn=hn+12|0,dn=HEAPF32[pn>>2],vn=cn*dn,mn=i,gn=mn+4|0,yn=HEAPF32[gn>>2],bn=s,wn=bn+28|0,En=HEAPF32[wn>>2],Sn=yn*En,xn=vn+Sn,Tn=i,Nn=Tn+8|0,Cn=HEAPF32[Nn>>2],kn=s,Ln=kn+44|0,An=HEAPF32[Ln>>2],On=Cn*An,Mn=xn+On,_n=i,Dn=_n+12|0,Pn=HEAPF32[Dn>>2],Hn=s,Bn=Hn+60|0,jn=HEAPF32[Bn>>2],Fn=Pn*jn,In=Mn+Fn;l=In;var qn=i,Rn=qn+16|0,Un=HEAPF32[Rn>>2],zn=s,Wn=zn|0,Xn=HEAPF32[Wn>>2],Vn=Un*Xn,$n=i,Jn=$n+20|0,Kn=HEAPF32[Jn>>2],Qn=s,Gn=Qn+16|0,Yn=HEAPF32[Gn>>2],Zn=Kn*Yn,er=Vn+Zn,tr=i,nr=tr+24|0,rr=HEAPF32[nr>>2],ir=s,sr=ir+32|0,or=HEAPF32[sr>>2],ur=rr*or,ar=er+ur,fr=i,lr=fr+28|0,cr=HEAPF32[lr>>2],hr=s,pr=hr+48|0,dr=HEAPF32[pr>>2],vr=cr*dr,mr=ar+vr;c=mr;var gr=i,yr=gr+16|0,br=HEAPF32[yr>>2],wr=s,Er=wr+4|0,Sr=HEAPF32[Er>>2],xr=br*Sr,Tr=i,Nr=Tr+20|0,Cr=HEAPF32[Nr>>2],kr=s,Lr=kr+20|0,Ar=HEAPF32[Lr>>2],Or=Cr*Ar,Mr=xr+Or,_r=i,Dr=_r+24|0,Pr=HEAPF32[Dr>>2],Hr=s,Br=Hr+36|0,jr=HEAPF32[Br>>2],Fr=Pr*jr,Ir=Mr+Fr,qr=i,Rr=qr+28|0,Ur=HEAPF32[Rr>>2],zr=s,Wr=zr+52|0,Xr=HEAPF32[Wr>>2],Vr=Ur*Xr,$r=Ir+Vr;h=$r;var Jr=i,Kr=Jr+16|0,Qr=HEAPF32[Kr>>2],Gr=s,Yr=Gr+8|0,Zr=HEAPF32[Yr>>2],ei=Qr*Zr,ti=i,ni=ti+20|0,ri=HEAPF32[ni>>2],ii=s,si=ii+24|0,oi=HEAPF32[si>>2],ui=ri*oi,ai=ei+ui,fi=i,li=fi+24|0,ci=HEAPF32[li>>2],hi=s,pi=hi+40|0,di=HEAPF32[pi>>2],vi=ci*di,mi=ai+vi,gi=i,yi=gi+28|0,bi=HEAPF32[yi>>2],wi=s,Ei=wi+56|0,Si=HEAPF32[Ei>>2],xi=bi*Si,Ti=mi+xi;p=Ti;var Ni=i,Ci=Ni+16|0,ki=HEAPF32[Ci>>2],Li=s,Ai=Li+12|0,Oi=HEAPF32[Ai>>2],Mi=ki*Oi,_i=i,Di=_i+20|0,Pi=HEAPF32[Di>>2],Hi=s,Bi=Hi+28|0,ji=HEAPF32[Bi>>2],Fi=Pi*ji,Ii=Mi+Fi,qi=i,Ri=qi+24|0,Ui=HEAPF32[Ri>>2],zi=s,Wi=zi+44|0,Xi=HEAPF32[Wi>>2],Vi=Ui*Xi,$i=Ii+Vi,Ji=i,Ki=Ji+28|0,Qi=HEAPF32[Ki>>2],Gi=s,Yi=Gi+60|0,Zi=HEAPF32[Yi>>2],es=Qi*Zi,ts=$i+es;d=ts;var ns=i,rs=ns+32|0,is=HEAPF32[rs>>2],ss=s,os=ss|0,us=HEAPF32[os>>2],as=is*us,fs=i,ls=fs+36|0,cs=HEAPF32[ls>>2],hs=s,ps=hs+16|0,ds=HEAPF32[ps>>2],vs=cs*ds,ms=as+vs,gs=i,ys=gs+40|0,bs=HEAPF32[ys>>2],ws=s,Es=ws+32|0,Ss=HEAPF32[Es>>2],xs=bs*Ss,Ts=ms+xs,Ns=i,Cs=Ns+44|0,ks=HEAPF32[Cs>>2],Ls=s,As=Ls+48|0,Os=HEAPF32[As>>2],Ms=ks*Os,_s=Ts+Ms;v=_s;var Ds=i,Ps=Ds+32|0,Hs=HEAPF32[Ps>>2],Bs=s,js=Bs+4|0,Fs=HEAPF32[js>>2],Is=Hs*Fs,qs=i,Rs=qs+36|0,Us=HEAPF32[Rs>>2],zs=s,Ws=zs+20|0,Xs=HEAPF32[Ws>>2],Vs=Us*Xs,$s=Is+Vs,Js=i,Ks=Js+40|0,Qs=HEAPF32[Ks>>2],Gs=s,Ys=Gs+36|0,Zs=HEAPF32[Ys>>2],eo=Qs*Zs,to=$s+eo,no=i,ro=no+44|0,io=HEAPF32[ro>>2],so=s,oo=so+52|0,uo=HEAPF32[oo>>2],ao=io*uo,fo=to+ao;m=fo;var lo=i,co=lo+32|0,ho=HEAPF32[co>>2],po=s,vo=po+8|0,mo=HEAPF32[vo>>2],go=ho*mo,yo=i,bo=yo+36|0,wo=HEAPF32[bo>>2],Eo=s,So=Eo+24|0,xo=HEAPF32[So>>2],To=wo*xo,No=go+To,Co=i,ko=Co+40|0,Lo=HEAPF32[ko>>2],Ao=s,Oo=Ao+40|0,Mo=HEAPF32[Oo>>2],_o=Lo*Mo,Do=No+_o,Po=i,Ho=Po+44|0,Bo=HEAPF32[Ho>>2],jo=s,Fo=jo+56|0,Io=HEAPF32[Fo>>2],qo=Bo*Io,Ro=Do+qo;g=Ro;var Uo=i,zo=Uo+32|0,Wo=HEAPF32[zo>>2],Xo=s,Vo=Xo+12|0,$o=HEAPF32[Vo>>2],Jo=Wo*$o,Ko=i,Qo=Ko+36|0,Go=HEAPF32[Qo>>2],Yo=s,Zo=Yo+28|0,eu=HEAPF32[Zo>>2],tu=Go*eu,nu=Jo+tu,ru=i,iu=ru+40|0,su=HEAPF32[iu>>2],ou=s,uu=ou+44|0,au=HEAPF32[uu>>2],fu=su*au,lu=nu+fu,cu=i,hu=cu+44|0,pu=HEAPF32[hu>>2],du=s,vu=du+60|0,mu=HEAPF32[vu>>2],gu=pu*mu,yu=lu+gu;y=yu;var bu=i,wu=bu+48|0,Eu=HEAPF32[wu>>2],Su=s,xu=Su|0,Tu=HEAPF32[xu>>2],Nu=Eu*Tu,Cu=i,ku=Cu+52|0,Lu=HEAPF32[ku>>2],Au=s,Ou=Au+16|0,Mu=HEAPF32[Ou>>2],_u=Lu*Mu,Du=Nu+_u,Pu=i,Hu=Pu+56|0,Bu=HEAPF32[Hu>>2],ju=s,Fu=ju+32|0,Iu=HEAPF32[Fu>>2],qu=Bu*Iu,Ru=Du+qu,Uu=i,zu=Uu+60|0,Wu=HEAPF32[zu>>2],Xu=s,Vu=Xu+48|0,$u=HEAPF32[Vu>>2],Ju=Wu*$u,Ku=Ru+Ju;b=Ku;var Qu=i,Gu=Qu+48|0,Yu=HEAPF32[Gu>>2],Zu=s,ea=Zu+4|0,ta=HEAPF32[ea>>2],na=Yu*ta,ra=i,ia=ra+52|0,sa=HEAPF32[ia>>2],oa=s,ua=oa+20|0,aa=HEAPF32[ua>>2],fa=sa*aa,la=na+fa,ca=i,ha=ca+56|0,pa=HEAPF32[ha>>2],da=s,va=da+36|0,ma=HEAPF32[va>>2],ga=pa*ma,ya=la+ga,ba=i,wa=ba+60|0,Ea=HEAPF32[wa>>2],Sa=s,xa=Sa+52|0,Ta=HEAPF32[xa>>2],Na=Ea*Ta,Ca=ya+Na;w=Ca;var ka=i,La=ka+48|0,Aa=HEAPF32[La>>2],Oa=s,Ma=Oa+8|0,_a=HEAPF32[Ma>>2],Da=Aa*_a,Pa=i,Ha=Pa+52|0,Ba=HEAPF32[Ha>>2],ja=s,Fa=ja+24|0,Ia=HEAPF32[Fa>>2],qa=Ba*Ia,Ra=Da+qa,Ua=i,za=Ua+56|0,Wa=HEAPF32[za>>2],Xa=s,Va=Xa+40|0,$a=HEAPF32[Va>>2],Ja=Wa*$a,Ka=Ra+Ja,Qa=i,Ga=Qa+60|0,Ya=HEAPF32[Ga>>2],Za=s,ef=Za+56|0,tf=HEAPF32[ef>>2],nf=Ya*tf,rf=Ka+nf;E=rf;var sf=i,of=sf+48|0,uf=HEAPF32[of>>2],af=s,ff=af+12|0,lf=HEAPF32[ff>>2],cf=uf*lf,hf=i,pf=hf+52|0,df=HEAPF32[pf>>2],vf=s,mf=vf+28|0,gf=HEAPF32[mf>>2],yf=df*gf,bf=cf+yf,wf=i,Ef=wf+56|0,Sf=HEAPF32[Ef>>2],xf=s,Tf=xf+44|0,Nf=HEAPF32[Tf>>2],Cf=Sf*Nf,kf=bf+Cf,Lf=i,Af=Lf+60|0,Of=HEAPF32[Af>>2],Mf=s,_f=Mf+60|0,Df=HEAPF32[_f>>2],Pf=Of*Df,Hf=kf+Pf;S=Hf;var Bf=u,jf=o,Ff=jf|0;HEAPF32[Ff>>2]=Bf;var If=a,qf=o,Rf=qf+4|0;HEAPF32[Rf>>2]=If;var Uf=f,zf=o,Wf=zf+8|0;HEAPF32[Wf>>2]=Uf;var Xf=l,Vf=o,$f=Vf+12|0;HEAPF32[$f>>2]=Xf;var Jf=c,Kf=o,Qf=Kf+16|0;HEAPF32[Qf>>2]=Jf;var Gf=h,Yf=o,Zf=Yf+20|0;HEAPF32[Zf>>2]=Gf;var el=p,tl=o,nl=tl+24|0;HEAPF32[nl>>2]=el;var rl=d,il=o,sl=il+28|0;HEAPF32[sl>>2]=rl;var ol=v,ul=o,al=ul+32|0;HEAPF32[al>>2]=ol;var fl=m,ll=o,cl=ll+36|0;HEAPF32[cl>>2]=fl;var hl=g,pl=o,dl=pl+40|0;HEAPF32[dl>>2]=hl;var vl=y,ml=o,gl=ml+44|0;HEAPF32[gl>>2]=vl;var yl=b,bl=o,wl=bl+48|0;HEAPF32[wl>>2]=yl;var El=w,Sl=o,xl=Sl+52|0;HEAPF32[xl>>2]=El;var Tl=E,Nl=o,Cl=Nl+56|0;HEAPF32[Cl>>2]=Tl;var kl=S,Ll=o,Al=Ll+60|0;HEAPF32[Al>>2]=kl;return}function __ZN8BEST_FIT15fm_matrixToQuatEPKfPf(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+32|0,assert((STACKTOP|0)<(STACK_MAX|0)),n=2;for(;;)switch(n){case 2:var i,s,o,u,a=r,f=r+16,l,c,h,p;i=e,s=t;var d=i,v=d|0,m=HEAPF32[v>>2],g=i,y=g+20|0,b=HEAPF32[y>>2],w=m+b,E=i,S=E+40|0,x=HEAPF32[S>>2],T=w+x;o=T;var N=o,C=N>0;if(C){n=3;break}n=4;break;case 3:var k=o,L=k+1,A=L,O=Math.sqrt(A),M=O;u=M;var _=u,D=_*.5,P=s,H=P+12|0;HEAPF32[H>>2]=D;var B=u,j=.5/B;u=j;var F=i,I=F+24|0,q=HEAPF32[I>>2],R=i,U=R+36|0,z=HEAPF32[U>>2],W=q-z,X=u,V=W*X,$=s,J=$|0;HEAPF32[J>>2]=V;var K=i,Q=K+32|0,G=HEAPF32[Q>>2],Y=i,Z=Y+8|0,et=HEAPF32[Z>>2],tt=G-et,nt=u,rt=tt*nt,it=s,st=it+4|0;HEAPF32[st>>2]=rt;var ot=i,ut=ot+4|0,at=HEAPF32[ut>>2],ft=i,lt=ft+16|0,ct=HEAPF32[lt>>2],ht=at-ct,pt=u,dt=ht*pt,vt=s,mt=vt+8|0;HEAPF32[mt>>2]=dt,n=11;break;case 4:var gt=a;assert(!0),HEAP32[gt>>2]=HEAP32[12],HEAP32[gt+4>>2]=HEAP32[13],HEAP32[gt+8>>2]=HEAP32[14],l=0;var yt=i,bt=yt+20|0,wt=HEAPF32[bt>>2],Et=i,St=Et|0,xt=HEAPF32[St>>2],Tt=wt>xt;if(Tt){n=5;break}n=6;break;case 5:l=1,n=6;break;case 6:var Nt=i,Ct=Nt+40|0,kt=HEAPF32[Ct>>2],Lt=l,At=Lt<<2,Ot=l,Mt=At+Ot|0,_t=i,Dt=_t+(Mt<<2)|0,Pt=HEAPF32[Dt>>2],Ht=kt>Pt;if(Ht){n=7;break}n=8;break;case 7:l=2,n=8;break;case 8:var Bt=l,jt=a+(Bt<<2)|0,Ft=HEAP32[jt>>2];c=Ft;var It=c,qt=a+(It<<2)|0,Rt=HEAP32[qt>>2];h=Rt;var Ut=l,zt=Ut<<2,Wt=l,Xt=zt+Wt|0,Vt=i,$t=Vt+(Xt<<2)|0,Jt=HEAPF32[$t>>2],Kt=c,Qt=Kt<<2,Gt=c,Yt=Qt+Gt|0,Zt=i,en=Zt+(Yt<<2)|0,tn=HEAPF32[en>>2],nn=h,rn=nn<<2,sn=h,on=rn+sn|0,un=i,an=un+(on<<2)|0,fn=HEAPF32[an>>2],ln=tn+fn,cn=Jt-ln,hn=cn+1,pn=hn,dn=Math.sqrt(pn),vn=dn;p=vn;var mn=p,gn=mn*.5,yn=l,bn=f+(yn<<2)|0;HEAPF32[bn>>2]=gn;var wn=p,En=wn!=0;if(En){n=9;break}n=10;break;case 9:var Sn=p,xn=.5/Sn;p=xn,n=10;break;case 10:var Tn=c,Nn=Tn<<2,Cn=h,kn=Nn+Cn|0,Ln=i,An=Ln+(kn<<2)|0,On=HEAPF32[An>>2],Mn=h,_n=Mn<<2,Dn=c,Pn=_n+Dn|0,Hn=i,Bn=Hn+(Pn<<2)|0,jn=HEAPF32[Bn>>2],Fn=On-jn,In=p,qn=Fn*In,Rn=f+12|0;HEAPF32[Rn>>2]=qn;var Un=l,zn=Un<<2,Wn=c,Xn=zn+Wn|0,Vn=i,$n=Vn+(Xn<<2)|0,Jn=HEAPF32[$n>>2],Kn=c,Qn=Kn<<2,Gn=l,Yn=Qn+Gn|0,Zn=i,er=Zn+(Yn<<2)|0,tr=HEAPF32[er>>2],nr=Jn+tr,rr=p,ir=nr*rr,sr=c,or=f+(sr<<2)|0;HEAPF32[or>>2]=ir;var ur=l,ar=ur<<2,fr=h,lr=ar+fr|0,cr=i,hr=cr+(lr<<2)|0,pr=HEAPF32[hr>>2],dr=h,vr=dr<<2,mr=l,gr=vr+mr|0,yr=i,br=yr+(gr<<2)|0,wr=HEAPF32[br>>2],Er=pr+wr,Sr=p,xr=Er*Sr,Tr=h,Nr=f+(Tr<<2)|0;HEAPF32[Nr>>2]=xr;var Cr=f|0,kr=HEAPF32[Cr>>2],Lr=s,Ar=Lr|0;HEAPF32[Ar>>2]=kr;var Or=f+4|0,Mr=HEAPF32[Or>>2],_r=s,Dr=_r+4|0;HEAPF32[Dr>>2]=Mr;var Pr=f+8|0,Hr=HEAPF32[Pr>>2],Br=s,jr=Br+8|0;HEAPF32[jr>>2]=Hr;var Fr=f+12|0,Ir=HEAPF32[Fr>>2],qr=s,Rr=qr+12|0;HEAPF32[Rr>>2]=Ir,n=11;break;case 11:STACKTOP=r;return;default:assert(0,"bad label: "+n)}}function __ZN8BEST_FIT9fm_rotateEPKfS1_Pf(e,t,n){var r=0;r=2;for(;;)switch(r){case 2:var i,s,o,u,a,f;i=e,s=t,o=n;var l=i,c=(l|0)!=0;if(c){r=3;break}r=4;break;case 3:var h=i,p=h|0,d=HEAPF32[p>>2],v=s,m=v|0,g=HEAPF32[m>>2],y=d*g,b=i,w=b+16|0,E=HEAPF32[w>>2],S=s,x=S+4|0,T=HEAPF32[x>>2],N=E*T,C=y+N,k=i,L=k+32|0,A=HEAPF32[L>>2],O=s,M=O+8|0,_=HEAPF32[M>>2],D=A*_,P=C+D;u=P;var H=i,B=H+4|0,j=HEAPF32[B>>2],F=s,I=F|0,q=HEAPF32[I>>2],R=j*q,U=i,z=U+20|0,W=HEAPF32[z>>2],X=s,V=X+4|0,$=HEAPF32[V>>2],J=W*$,K=R+J,Q=i,G=Q+36|0,Y=HEAPF32[G>>2],Z=s,et=Z+8|0,tt=HEAPF32[et>>2],nt=Y*tt,rt=K+nt;a=rt;var it=i,st=it+8|0,ot=HEAPF32[st>>2],ut=s,at=ut|0,ft=HEAPF32[at>>2],lt=ot*ft,ct=i,ht=ct+24|0,pt=HEAPF32[ht>>2],dt=s,vt=dt+4|0,mt=HEAPF32[vt>>2],gt=pt*mt,yt=lt+gt,bt=i,wt=bt+40|0,Et=HEAPF32[wt>>2],St=s,xt=St+8|0,Tt=HEAPF32[xt>>2],Nt=Et*Tt,Ct=yt+Nt;f=Ct;var kt=u,Lt=o,At=Lt|0;HEAPF32[At>>2]=kt;var Ot=a,Mt=o,_t=Mt+4|0;HEAPF32[_t>>2]=Ot;var Dt=f,Pt=o,Ht=Pt+8|0;HEAPF32[Ht>>2]=Dt,r=5;break;case 4:var Bt=s,jt=Bt|0,Ft=HEAPF32[jt>>2],It=o,qt=It|0;HEAPF32[qt>>2]=Ft;var Rt=s,Ut=Rt+4|0,zt=HEAPF32[Ut>>2],Wt=o,Xt=Wt+4|0;HEAPF32[Xt>>2]=zt;var Vt=s,$t=Vt+8|0,Jt=HEAPF32[$t>>2],Kt=o,Qt=Kt+8|0;HEAPF32[Qt>>2]=Jt,r=5;break;case 5:return;default:assert(0,"bad label: "+r)}}function __ZN8BEST_FIT12fm_inverseRTEPKfS1_Pf(e,t,n){var r=0,i,s,o,u,a,f;i=e,s=t,o=n;var l=s,c=l|0,h=HEAPF32[c>>2],p=i,d=p+48|0,v=HEAPF32[d>>2],m=h-v;u=m;var g=s,y=g+4|0,b=HEAPF32[y>>2],w=i,E=w+52|0,S=HEAPF32[E>>2],x=b-S;a=x;var T=s,N=T+8|0,C=HEAPF32[N>>2],k=i,L=k+56|0,A=HEAPF32[L>>2],O=C-A;f=O;var M=i,_=M|0,D=HEAPF32[_>>2],P=u,H=D*P,B=i,j=B+4|0,F=HEAPF32[j>>2],I=a,q=F*I,R=H+q,U=i,z=U+8|0,W=HEAPF32[z>>2],X=f,V=W*X,$=R+V,J=o,K=J|0;HEAPF32[K>>2]=$;var Q=i,G=Q+16|0,Y=HEAPF32[G>>2],Z=u,et=Y*Z,tt=i,nt=tt+20|0,rt=HEAPF32[nt>>2],it=a,st=rt*it,ot=et+st,ut=i,at=ut+24|0,ft=HEAPF32[at>>2],lt=f,ct=ft*lt,ht=ot+ct,pt=o,dt=pt+4|0;HEAPF32[dt>>2]=ht;var vt=i,mt=vt+32|0,gt=HEAPF32[mt>>2],yt=u,bt=gt*yt,wt=i,Et=wt+36|0,St=HEAPF32[Et>>2],xt=a,Tt=St*xt,Nt=bt+Tt,Ct=i,kt=Ct+40|0,Lt=HEAPF32[kt>>2],At=f,Ot=Lt*At,Mt=Nt+Ot,_t=o,Dt=_t+8|0;HEAPF32[Dt>>2]=Mt;return}function __ZN8BEST_FIT17fm_setTranslationEPKfPf(e,t){var n=0,r,i;r=e,i=t;var s=r,o=s|0,u=HEAPF32[o>>2],a=i,f=a+48|0;HEAPF32[f>>2]=u;var l=r,c=l+4|0,h=HEAPF32[c>>2],p=i,d=p+52|0;HEAPF32[d>>2]=h;var v=r,m=v+8|0,g=HEAPF32[m>>2],y=i,b=y+56|0;HEAPF32[b>>2]=g;return}function __ZN8BEST_FIT12fm_transformEPKfS1_Pf(e,t,n){var r=0;r=2;for(;;)switch(r){case 2:var i,s,o,u,a,f;i=e,s=t,o=n;var l=i,c=(l|0)!=0;if(c){r=3;break}r=4;break;case 3:var h=i,p=h|0,d=HEAPF32[p>>2],v=s,m=v|0,g=HEAPF32[m>>2],y=d*g,b=i,w=b+16|0,E=HEAPF32[w>>2],S=s,x=S+4|0,T=HEAPF32[x>>2],N=E*T,C=y+N,k=i,L=k+32|0,A=HEAPF32[L>>2],O=s,M=O+8|0,_=HEAPF32[M>>2],D=A*_,P=C+D,H=i,B=H+48|0,j=HEAPF32[B>>2],F=P+j;u=F;var I=i,q=I+4|0,R=HEAPF32[q>>2],U=s,z=U|0,W=HEAPF32[z>>2],X=R*W,V=i,$=V+20|0,J=HEAPF32[$>>2],K=s,Q=K+4|0,G=HEAPF32[Q>>2],Y=J*G,Z=X+Y,et=i,tt=et+36|0,nt=HEAPF32[tt>>2],rt=s,it=rt+8|0,st=HEAPF32[it>>2],ot=nt*st,ut=Z+ot,at=i,ft=at+52|0,lt=HEAPF32[ft>>2],ct=ut+lt;a=ct;var ht=i,pt=ht+8|0,dt=HEAPF32[pt>>2],vt=s,mt=vt|0,gt=HEAPF32[mt>>2],yt=dt*gt,bt=i,wt=bt+24|0,Et=HEAPF32[wt>>2],St=s,xt=St+4|0,Tt=HEAPF32[xt>>2],Nt=Et*Tt,Ct=yt+Nt,kt=i,Lt=kt+40|0,At=HEAPF32[Lt>>2],Ot=s,Mt=Ot+8|0,_t=HEAPF32[Mt>>2],Dt=At*_t,Pt=Ct+Dt,Ht=i,Bt=Ht+56|0,jt=HEAPF32[Bt>>2],Ft=Pt+jt;f=Ft;var It=u,qt=o,Rt=qt|0;HEAPF32[Rt>>2]=It;var Ut=a,zt=o,Wt=zt+4|0;HEAPF32[Wt>>2]=Ut;var Xt=f,Vt=o,$t=Vt+8|0;HEAPF32[$t>>2]=Xt,r=5;break;case 4:var Jt=s,Kt=Jt|0,Qt=HEAPF32[Kt>>2],Gt=o,Yt=Gt|0;HEAPF32[Yt>>2]=Qt;var Zt=s,en=Zt+4|0,tn=HEAPF32[en>>2],nn=o,rn=nn+4|0;HEAPF32[rn>>2]=tn;var sn=s,on=sn+8|0,un=HEAPF32[on>>2],an=o,fn=an+8|0;HEAPF32[fn>>2]=un,r=5;break;case 5:return;default:assert(0,"bad label: "+r)}}function __ZN8BEST_FIT15fm_quatToMatrixEPKfPf(e,t){var n=0,r,i,s,o,u,a,f,l,c,h,p;r=e,i=t;var d=r,v=d|0,m=HEAPF32[v>>2],g=r,y=g|0,b=HEAPF32[y>>2],w=m*b;s=w;var E=r,S=E+4|0,x=HEAPF32[S>>2],T=r,N=T+4|0,C=HEAPF32[N>>2],k=x*C;o=k;var L=r,A=L+8|0,O=HEAPF32[A>>2],M=r,_=M+8|0,D=HEAPF32[_>>2],P=O*D;u=P;var H=r,B=H|0,j=HEAPF32[B>>2],F=r,I=F+4|0,q=HEAPF32[I>>2],R=j*q;a=R;var U=r,z=U|0,W=HEAPF32[z>>2],X=r,V=X+8|0,$=HEAPF32[V>>2],J=W*$;f=J;var K=r,Q=K+4|0,G=HEAPF32[Q>>2],Y=r,Z=Y+8|0,et=HEAPF32[Z>>2],tt=G*et;l=tt;var nt=r,rt=nt+12|0,it=HEAPF32[rt>>2],st=r,ot=st|0,ut=HEAPF32[ot>>2],at=it*ut;c=at;var ft=r,lt=ft+12|0,ct=HEAPF32[lt>>2],ht=r,pt=ht+4|0,dt=HEAPF32[pt>>2],vt=ct*dt;h=vt;var mt=r,gt=mt+12|0,yt=HEAPF32[gt>>2],bt=r,wt=bt+8|0,Et=HEAPF32[wt>>2],St=yt*Et;p=St;var xt=o,Tt=u,Nt=xt+Tt,Ct=Nt*2,kt=1-Ct,Lt=i,At=Lt|0;HEAPF32[At>>2]=kt;var Ot=a,Mt=p,_t=Ot-Mt,Dt=_t*2,Pt=i,Ht=Pt+16|0;HEAPF32[Ht>>2]=Dt;var Bt=f,jt=h,Ft=Bt+jt,It=Ft*2,qt=i,Rt=qt+32|0;HEAPF32[Rt>>2]=It;var Ut=a,zt=p,Wt=Ut+zt,Xt=Wt*2,Vt=i,$t=Vt+4|0;HEAPF32[$t>>2]=Xt;var Jt=s,Kt=u,Qt=Jt+Kt,Gt=Qt*2,Yt=1-Gt,Zt=i,en=Zt+20|0;HEAPF32[en>>2]=Yt;var tn=l,nn=c,rn=tn-nn,sn=rn*2,on=i,un=on+36|0;HEAPF32[un>>2]=sn;var an=f,fn=h,ln=an-fn,cn=ln*2,hn=i,pn=hn+8|0;HEAPF32[pn>>2]=cn;var dn=l,vn=c,mn=dn+vn,gn=mn*2,yn=i,bn=yn+24|0;HEAPF32[bn>>2]=gn;var wn=s,En=o,Sn=wn+En,xn=Sn*2,Tn=1-xn,Nn=i,Cn=Nn+40|0;HEAPF32[Cn>>2]=Tn;var kn=i,Ln=kn+56|0;HEAPF32[Ln>>2]=0;var An=i,On=An+52|0;HEAPF32[On>>2]=0;var Mn=i,_n=Mn+48|0;HEAPF32[_n>>2]=0;var Dn=i,Pn=Dn+44|0;HEAPF32[Pn>>2]=0;var Hn=i,Bn=Hn+28|0;HEAPF32[Bn>>2]=0;var jn=i,Fn=jn+12|0;HEAPF32[Fn>>2]=0;var In=i,qn=In+60|0;HEAPF32[qn>>2]=1;return}function __ZN8BEST_FIT8fm_crossEPfPKfS2_(e,t,n){var r=0,i,s,o;i=e,s=t,o=n;var u=s,a=u+4|0,f=HEAPF32[a>>2],l=o,c=l+8|0,h=HEAPF32[c>>2],p=f*h,d=s,v=d+8|0,m=HEAPF32[v>>2],g=o,y=g+4|0,b=HEAPF32[y>>2],w=m*b,E=p-w,S=i,x=S|0;HEAPF32[x>>2]=E;var T=s,N=T+8|0,C=HEAPF32[N>>2],k=o,L=k|0,A=HEAPF32[L>>2],O=C*A,M=s,_=M|0,D=HEAPF32[_>>2],P=o,H=P+8|0,B=HEAPF32[H>>2],j=D*B,F=O-j,I=i,q=I+4|0;HEAPF32[q>>2]=F;var R=s,U=R|0,z=HEAPF32[U>>2],W=o,X=W+4|0,V=HEAPF32[X>>2],$=z*V,J=s,K=J+4|0,Q=HEAPF32[K>>2],G=o,Y=G|0,Z=HEAPF32[Y>>2],et=Q*Z,tt=$-et,nt=i,rt=nt+8|0;HEAPF32[rt>>2]=tt;return}function __ZN8BEST_FIT6fm_dotEPKfS1_(e,t){var n=0,r,i;r=e,i=t;var s=r,o=s|0,u=HEAPF32[o>>2],a=i,f=a|0,l=HEAPF32[f>>2],c=u*l,h=r,p=h+4|0,d=HEAPF32[p>>2],v=i,m=v+4|0,g=HEAPF32[m>>2],y=d*g,b=c+y,w=r,E=w+8|0,S=HEAPF32[E>>2],x=i,T=x+8|0,N=HEAPF32[T>>2],C=S*N,k=b+C;return k}function __ZN8BEST_FIT14fm_rotationArcEPKfS1_Pf(e,t,n){var r=0,i=STACKTOP;STACKTOP=STACKTOP+16|0,assert((STACKTOP|0)<(STACK_MAX|0));var s,o,u,a=i,f,l,c;s=e,o=t,u=n;var h=a|0,p=s,d=o;__ZN8BEST_FIT8fm_crossEPfPKfS2_(h,p,d);var v=s,m=o,g=__ZN8BEST_FIT6fm_dotEPKfS1_(v,m);f=g;var y=f,b=y+1,w=b*2,E=w,S=Math.sqrt(E),x=S;l=x;var T=l,N=1/T;c=N;var C=a|0,k=HEAPF32[C>>2],L=c,A=k*L,O=u,M=O|0;HEAPF32[M>>2]=A;var _=a+4|0,D=HEAPF32[_>>2],P=c,H=D*P,B=u,j=B+4|0;HEAPF32[j>>2]=H;var F=a+8|0,I=HEAPF32[F>>2],q=c,R=I*q,U=u,z=U+8|0;HEAPF32[z>>2]=R;var W=l,X=W*.5,V=u,$=V+12|0;HEAPF32[$>>2]=X,STACKTOP=i;return}function __ZN8BEST_FIT16fm_planeToMatrixEPKfPf(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+64|0,assert((STACKTOP|0)<(STACK_MAX|0));var i,s,o=r,u=r+16,a=r+32,f=r+48;i=e,s=t;var l=o;assert(!0),HEAP32[l>>2]=HEAP32[8],HEAP32[l+4>>2]=HEAP32[9],HEAP32[l+8>>2]=HEAP32[10];var c=o|0,h=i,p=u|0;__ZN8BEST_FIT14fm_rotationArcEPKfS1_Pf(c,h,p);var d=u|0,v=s;__ZN8BEST_FIT15fm_quatToMatrixEPKfPf(d,v);var m=a|0;HEAPF32[m>>2]=0;var g=m+4|0,y=i,b=y+12|0,w=HEAPF32[b>>2],E=-w;HEAPF32[g>>2]=E;var S=g+4|0;HEAPF32[S>>2]=0;var x=s,T=a|0,N=f|0;__ZN8BEST_FIT12fm_transformEPKfS1_Pf(x,T,N);var C=f|0,k=s;__ZN8BEST_FIT17fm_setTranslationEPKfPf(C,k),STACKTOP=r;return}function __ZN8BEST_FIT14fm_eulerToQuatEfffPf(e,t,n,r){var i=0,s,o,u,a,f,l,c,h,p,d,v,m,g,y;s=e,o=t,u=n,a=r;var b=s,w=b*.5;s=w;var E=o,S=E*.5;o=S;var x=u,T=x*.5;u=T;var N=s,C=N,k=Math.cos(C),L=k;f=L;var A=o,O=A,M=Math.cos(O),_=M;l=_;var D=u,P=D,H=Math.cos(P),B=H;c=B;var j=s,F=j,I=Math.sin(F),q=I;h=q;var R=o,U=R,z=Math.sin(U),W=z;p=W;var X=u,V=X,$=Math.sin(V),J=$;d=J;var K=l,Q=c,G=K*Q;v=G;var Y=p,Z=d,et=Y*Z;m=et;var tt=p,nt=c,rt=tt*nt;g=rt;var it=l,st=d,ot=it*st;y=ot;var ut=h,at=v,ft=ut*at,lt=f,ct=m,ht=lt*ct,pt=ft-ht,dt=a,vt=dt|0;HEAPF32[vt>>2]=pt;var mt=f,gt=g,yt=mt*gt,bt=h,wt=y,Et=bt*wt,St=yt+Et,xt=a,Tt=xt+4|0;HEAPF32[Tt>>2]=St;var Nt=f,Ct=y,kt=Nt*Ct,Lt=h,At=g,Ot=Lt*At,Mt=kt-Ot,_t=a,Dt=_t+8|0;HEAPF32[Dt>>2]=Mt;var Pt=f,Ht=v,Bt=Pt*Ht,jt=h,Ft=m,It=jt*Ft,qt=Bt+It,Rt=a,Ut=Rt+12|0;HEAPF32[Ut>>2]=qt;return}function __ZN8BEST_FIT19computeBestFitPlaneEjPKfjS1_jPfS2_(e,t,n,r,i,s,o){var u=0,a=STACKTOP;STACKTOP=STACKTOP+176|0,assert((STACKTOP|0)<(STACK_MAX|0)),u=2;for(;;)switch(u){case 2:var f,l,c,h,p,d,v,m,g=a,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=a+16,I=a+32,q=a+96,R=a+112;f=e,l=t,c=n,h=r,p=i,d=s,v=o,m=0;var U=g;HEAP32[U>>2]=0,HEAP32[U+4>>2]=0,HEAP32[U+8>>2]=0,y=0;var z=l,W=z;b=W;var X=h,V=X;w=V,E=0,u=3;break;case 3:var $=E,J=f,K=$>>>0<J>>>0;if(K){u=4;break}u=8;break;case 4:var Q=b,G=Q;S=G,x=1;var Y=w,Z=(Y|0)!=0;if(Z){u=5;break}u=6;break;case 5:var et=w,tt=et;T=tt;var nt=T,rt=HEAPF32[nt>>2];x=rt;var it=p,st=w,ot=st+it|0;w=ot,u=6;break;case 6:var ut=S,at=ut|0,ft=HEAPF32[at>>2],lt=x,ct=ft*lt,ht=g|0,pt=HEAPF32[ht>>2],dt=pt+ct;HEAPF32[ht>>2]=dt;var vt=S,mt=vt+4|0,gt=HEAPF32[mt>>2],yt=x,bt=gt*yt,wt=g+4|0,Et=HEAPF32[wt>>2],St=Et+bt;HEAPF32[wt>>2]=St;var xt=S,Tt=xt+8|0,Nt=HEAPF32[Tt>>2],Ct=x,kt=Nt*Ct,Lt=g+8|0,At=HEAPF32[Lt>>2],Ot=At+kt;HEAPF32[Lt>>2]=Ot;var Mt=x,_t=y,Dt=_t+Mt;y=Dt;var Pt=c,Ht=b,Bt=Ht+Pt|0;b=Bt,u=7;break;case 7:var jt=E,Ft=jt+1|0;E=Ft,u=3;break;case 8:var It=y,qt=1/It;N=qt;var Rt=N,Ut=g|0,zt=HEAPF32[Ut>>2],Wt=zt*Rt;HEAPF32[Ut>>2]=Wt;var Xt=N,Vt=g+4|0,$t=HEAPF32[Vt>>2],Jt=$t*Xt;HEAPF32[Vt>>2]=Jt;var Kt=N,Qt=g+8|0,Gt=HEAPF32[Qt>>2],Yt=Gt*Kt;HEAPF32[Qt>>2]=Yt,C=0,k=0,L=0,A=0,O=0,M=0;var Zt=l,en=Zt;_=en;var tn=h,nn=tn;D=nn,P=0,u=9;break;case 9:var rn=P,sn=f,on=rn>>>0<sn>>>0;if(on){u=10;break}u=14;break;case 10:var un=_,an=un;H=an,B=1;var fn=D,ln=(fn|0)!=0;if(ln){u=11;break}u=12;break;case 11:var cn=D,hn=cn;j=hn;var pn=j,dn=HEAPF32[pn>>2];B=dn;var vn=p,mn=D,gn=mn+vn|0;D=gn,u=12;break;case 12:var yn=B,bn=H,wn=bn|0,En=HEAPF32[wn>>2],Sn=g|0,xn=HEAPF32[Sn>>2],Tn=En-xn,Nn=yn*Tn,Cn=F|0;HEAPF32[Cn>>2]=Nn;var kn=B,Ln=H,An=Ln+4|0,On=HEAPF32[An>>2],Mn=g+4|0,_n=HEAPF32[Mn>>2],Dn=On-_n,Pn=kn*Dn,Hn=F+4|0;HEAPF32[Hn>>2]=Pn;var Bn=B,jn=H,Fn=jn+8|0,In=HEAPF32[Fn>>2],qn=g+8|0,Rn=HEAPF32[qn>>2],Un=In-Rn,zn=Bn*Un,Wn=F+8|0;HEAPF32[Wn>>2]=zn;var Xn=F|0,Vn=HEAPF32[Xn>>2],$n=F|0,Jn=HEAPF32[$n>>2],Kn=Vn*Jn,Qn=C,Gn=Qn+Kn;C=Gn;var Yn=F|0,Zn=HEAPF32[Yn>>2],er=F+4|0,tr=HEAPF32[er>>2],nr=Zn*tr,rr=k,ir=rr+nr;k=ir;var sr=F|0,or=HEAPF32[sr>>2],ur=F+8|0,ar=HEAPF32[ur>>2],fr=or*ar,lr=L,cr=lr+fr;L=cr;var hr=F+4|0,pr=HEAPF32[hr>>2],dr=F+4|0,vr=HEAPF32[dr>>2],mr=pr*vr,gr=A,yr=gr+mr;A=yr;var br=F+4|0,wr=HEAPF32[br>>2],Er=F+8|0,Sr=HEAPF32[Er>>2],xr=wr*Sr,Tr=O,Nr=Tr+xr;O=Nr;var Cr=F+8|0,kr=HEAPF32[Cr>>2],Lr=F+8|0,Ar=HEAPF32[Lr>>2],Or=kr*Ar,Mr=M,_r=Mr+Or;M=_r;var Dr=c,Pr=_,Hr=Pr+Dr|0;_=Hr,u=13;break;case 13:var Br=P,jr=Br+1|0;P=jr,u=9;break;case 14:var Fr=N,Ir=C,qr=Ir*Fr;C=qr;var Rr=N,Ur=k,zr=Ur*Rr;k=zr;var Wr=N,Xr=L,Vr=Xr*Wr;L=Vr;var $r=N,Jr=A,Kr=Jr*$r;A=Kr;var Qr=N,Gr=O,Yr=Gr*Qr;O=Yr;var Zr=N,ei=M,ti=ei*Zr;M=ti;var ni=C,ri=I|0,ii=ri|0,si=ii|0;HEAPF32[si>>2]=ni;var oi=k,ui=I|0,ai=ui|0,fi=ai+4|0;HEAPF32[fi>>2]=oi;var li=L,ci=I|0,hi=ci|0,pi=hi+8|0;HEAPF32[pi>>2]=li;var di=k,vi=I|0,mi=vi+12|0,gi=mi|0;HEAPF32[gi>>2]=di;var yi=A,bi=I|0,wi=bi+12|0,Ei=wi+4|0;HEAPF32[Ei>>2]=yi;var Si=O,xi=I|0,Ti=xi+12|0,Ni=Ti+8|0;HEAPF32[Ni>>2]=Si;var Ci=L,ki=I|0,Li=ki+24|0,Ai=Li|0;HEAPF32[Ai>>2]=Ci;var Oi=O,Mi=I|0,_i=Mi+24|0,Di=_i+4|0;HEAPF32[Di>>2]=Oi;var Pi=M,Hi=I|0,Bi=Hi+24|0,ji=Bi+8|0;HEAPF32[ji>>2]=Pi,__ZN8BEST_FIT5EigenIfE18DecrSortEigenStuffEv(I);var Fi=I|0,Ii=Fi|0,qi=Ii+8|0,Ri=HEAPF32[qi>>2],Ui=q|0;HEAPF32[Ui>>2]=Ri;var zi=I|0,Wi=zi+12|0,Xi=Wi+8|0,Vi=HEAPF32[Xi>>2],$i=q+4|0;HEAPF32[$i>>2]=Vi;var Ji=I|0,Ki=Ji+24|0,Qi=Ki+8|0,Gi=HEAPF32[Qi>>2],Yi=q+8|0;HEAPF32[Yi>>2]=Gi;var Zi=q|0,es=HEAPF32[Zi>>2],ts=d,ns=ts|0;HEAPF32[ns>>2]=es;var rs=q+4|0,is=HEAPF32[rs>>2],ss=d,os=ss+4|0;HEAPF32[os>>2]=is;var us=q+8|0,as=HEAPF32[us>>2],fs=d,ls=fs+8|0;HEAPF32[ls>>2]=as;var cs=q|0,hs=g|0
,ps=__ZN8BEST_FIT6fm_dotEPKfS1_(cs,hs),ds=-ps,vs=d,ms=vs+12|0;HEAPF32[ms>>2]=ds;var gs=R|0;__ZN8BEST_FIT11fm_identityEPf(gs);var ys=d,bs=R|0;__ZN8BEST_FIT16fm_planeToMatrixEPKfPf(ys,bs);var ws=R|0,Es=v;__ZN8BEST_FIT15fm_matrixToQuatEPKfPf(ws,Es),m=1;var Ss=m,xs=Ss&1;return STACKTOP=a,xs;default:assert(0,"bad label: "+u)}}function __ZN8BEST_FIT5EigenIfE18DecrSortEigenStuffEv(e){var t=0,n;n=e;var r=n;__ZN8BEST_FIT5EigenIfE11TridiagonalEv(r);var i=__ZN8BEST_FIT5EigenIfE11QLAlgorithmEv(r);__ZN8BEST_FIT5EigenIfE14DecreasingSortEv(r),__ZN8BEST_FIT5EigenIfE17GuaranteeRotationEv(r);return}function __ZN8BEST_FIT10computeOBBEjPKfjPfS2_(e,t,n,r,i){var s=0,o=STACKTOP;STACKTOP=STACKTOP+80|0,assert((STACKTOP|0)<(STACK_MAX|0)),s=2;for(;;)switch(s){case 2:var u,a,f,l,c,h,p=o,d=o+16,v,m,g=o+32,y=o+48,b=o+64;u=e,a=t,f=n,l=r,c=i;var w=a,E=w;h=E;var S=p;assert(!0),HEAP32[S>>2]=HEAP32[16],HEAP32[S+4>>2]=HEAP32[17],HEAP32[S+8>>2]=HEAP32[18];var x=d;assert(!0),HEAP32[x>>2]=HEAP32[20],HEAP32[x+4>>2]=HEAP32[21],HEAP32[x+8>>2]=HEAP32[22],v=0,s=3;break;case 3:var T=v,N=u,C=T>>>0<N>>>0;if(C){s=4;break}s=18;break;case 4:var k=h,L=k;m=L;var A=c,O=m,M=g|0;__ZN8BEST_FIT12fm_inverseRTEPKfS1_Pf(A,O,M);var _=g|0,D=HEAPF32[_>>2],P=p|0,H=HEAPF32[P>>2],B=D<H;if(B){s=5;break}s=6;break;case 5:var j=g|0,F=HEAPF32[j>>2],I=p|0;HEAPF32[I>>2]=F,s=6;break;case 6:var q=g+4|0,R=HEAPF32[q>>2],U=p+4|0,z=HEAPF32[U>>2],W=R<z;if(W){s=7;break}s=8;break;case 7:var X=g+4|0,V=HEAPF32[X>>2],$=p+4|0;HEAPF32[$>>2]=V,s=8;break;case 8:var J=g+8|0,K=HEAPF32[J>>2],Q=p+8|0,G=HEAPF32[Q>>2],Y=K<G;if(Y){s=9;break}s=10;break;case 9:var Z=g+8|0,et=HEAPF32[Z>>2],tt=p+8|0;HEAPF32[tt>>2]=et,s=10;break;case 10:var nt=g|0,rt=HEAPF32[nt>>2],it=d|0,st=HEAPF32[it>>2],ot=rt>st;if(ot){s=11;break}s=12;break;case 11:var ut=g|0,at=HEAPF32[ut>>2],ft=d|0;HEAPF32[ft>>2]=at,s=12;break;case 12:var lt=g+4|0,ct=HEAPF32[lt>>2],ht=d+4|0,pt=HEAPF32[ht>>2],dt=ct>pt;if(dt){s=13;break}s=14;break;case 13:var vt=g+4|0,mt=HEAPF32[vt>>2],gt=d+4|0;HEAPF32[gt>>2]=mt,s=14;break;case 14:var yt=g+8|0,bt=HEAPF32[yt>>2],wt=d+8|0,Et=HEAPF32[wt>>2],St=bt>Et;if(St){s=15;break}s=16;break;case 15:var xt=g+8|0,Tt=HEAPF32[xt>>2],Nt=d+8|0;HEAPF32[Nt>>2]=Tt,s=16;break;case 16:var Ct=f,kt=h,Lt=kt+Ct|0;h=Lt,s=17;break;case 17:var At=v,Ot=At+1|0;v=Ot,s=3;break;case 18:var Mt=d|0,_t=HEAPF32[Mt>>2],Dt=p|0,Pt=HEAPF32[Dt>>2],Ht=_t-Pt,Bt=l,jt=Bt|0;HEAPF32[jt>>2]=Ht;var Ft=d+4|0,It=HEAPF32[Ft>>2],qt=p+4|0,Rt=HEAPF32[qt>>2],Ut=It-Rt,zt=l,Wt=zt+4|0;HEAPF32[Wt>>2]=Ut;var Xt=d+8|0,Vt=HEAPF32[Xt>>2],$t=p+8|0,Jt=HEAPF32[$t>>2],Kt=Vt-Jt,Qt=l,Gt=Qt+8|0;HEAPF32[Gt>>2]=Kt;var Yt=l,Zt=Yt|0,en=HEAPF32[Zt>>2],tn=en*.5,nn=p|0,rn=HEAPF32[nn>>2],sn=tn+rn,on=y|0;HEAPF32[on>>2]=sn;var un=l,an=un+4|0,fn=HEAPF32[an>>2],ln=fn*.5,cn=p+4|0,hn=HEAPF32[cn>>2],pn=ln+hn,dn=y+4|0;HEAPF32[dn>>2]=pn;var vn=l,mn=vn+8|0,gn=HEAPF32[mn>>2],yn=gn*.5,bn=p+8|0,wn=HEAPF32[bn>>2],En=yn+wn,Sn=y+8|0;HEAPF32[Sn>>2]=En;var xn=c,Tn=y|0,Nn=b|0;__ZN8BEST_FIT9fm_rotateEPKfS1_Pf(xn,Tn,Nn);var Cn=b|0,kn=HEAPF32[Cn>>2],Ln=c,An=Ln+48|0,On=HEAPF32[An>>2],Mn=On+kn;HEAPF32[An>>2]=Mn;var _n=b+4|0,Dn=HEAPF32[_n>>2],Pn=c,Hn=Pn+52|0,Bn=HEAPF32[Hn>>2],jn=Bn+Dn;HEAPF32[Hn>>2]=jn;var Fn=b+8|0,In=HEAPF32[Fn>>2],qn=c,Rn=qn+56|0,Un=HEAPF32[Rn>>2],zn=Un+In;HEAPF32[Rn>>2]=zn,STACKTOP=o;return;default:assert(0,"bad label: "+s)}}function __ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_NS_11FitStrategyE(e,t,n,r,i,s){var o=0,u=STACKTOP;STACKTOP=STACKTOP+288|0,assert((STACKTOP|0)<(STACK_MAX|0)),o=2;for(;;)switch(o){case 2:var a,f,l,c,h,p,d=u,v=u+16,m,g=u+32,y=u+48,b,w,E,S=u+64,x,T,N,C=u+128,k=u+144,L=u+208,A=u+272;a=e,f=t,l=n,c=r,h=i,p=s;var O=h;__ZN8BEST_FIT11fm_identityEPf(O);var M=a,_=f,D=l,P=d|0,H=v|0,B=__ZN8BEST_FIT18computeBestFitAABBEjPKfjPfS2_(M,_,D,P,H),j=v|0,F=HEAPF32[j>>2],I=d|0,q=HEAPF32[I>>2],R=F-q,U=v+4|0,z=HEAPF32[U>>2],W=d+4|0,X=HEAPF32[W>>2],V=z-X,$=R*V,J=v+8|0,K=HEAPF32[J>>2],Q=d+8|0,G=HEAPF32[Q>>2],Y=K-G,Z=$*Y;m=Z;var et=a,tt=f,nt=l,rt=y|0,it=g|0,st=__ZN8BEST_FIT19computeBestFitPlaneEjPKfjS1_jPfS2_(et,tt,nt,0,0,rt,it),ot=y|0,ut=h;__ZN8BEST_FIT16fm_planeToMatrixEPKfPf(ot,ut);var at=a,ft=f,lt=l,ct=c,ht=h;__ZN8BEST_FIT10computeOBBEjPKfjPfS2_(at,ft,lt,ct,ht);var pt=v|0,dt=HEAPF32[pt>>2],vt=d|0,mt=HEAPF32[vt>>2],gt=dt-mt;b=gt;var yt=v+8|0,bt=HEAPF32[yt>>2],wt=d+8|0,Et=HEAPF32[wt>>2],St=bt-Et;w=St;var xt=b,Tt=w,Nt=xt/Tt;E=Nt;var Ct=S,kt=h,Lt=kt;assert(!0),_memcpy(Ct,Lt,64);var At=c,Ot=At|0,Mt=HEAPF32[Ot>>2],_t=c,Dt=_t+4|0,Pt=HEAPF32[Dt>>2],Ht=Mt*Pt,Bt=c,jt=Bt+8|0,Ft=HEAPF32[jt>>2],It=Ht*Ft;x=It,T=5;var qt=p;if((qt|0)==0){o=3;break}if((qt|0)==1){o=4;break}if((qt|0)==2){o=5;break}o=6;break;case 3:T=13,o=6;break;case 4:T=7,o=6;break;case 5:T=3,o=6;break;case 6:N=0,o=7;break;case 7:var Rt=N,Ut=Rt<180;if(Ut){o=8;break}o=12;break;case 8:var zt=N,Wt=zt*.01745329238474369,Xt=N,Vt=Xt*.01745329238474369,$t=C|0;__ZN8BEST_FIT14fm_eulerToQuatEfffPf(Wt,Vt,0,$t);var Jt=C|0,Kt=k|0;__ZN8BEST_FIT15fm_quatToMatrixEPKfPf(Jt,Kt);var Qt=k|0,Gt=S|0,Yt=L|0;__ZN8BEST_FIT17fm_matrixMultiplyEPKfS1_Pf(Qt,Gt,Yt);var Zt=a,en=f,tn=l,nn=A|0,rn=L|0;__ZN8BEST_FIT10computeOBBEjPKfjPfS2_(Zt,en,tn,nn,rn);var sn=A|0,on=HEAPF32[sn>>2],un=A+8|0,an=HEAPF32[un>>2],fn=on/an,ln=E,cn=fn>ln;if(cn){o=9;break}o=10;break;case 9:var hn=A|0,pn=HEAPF32[hn>>2];b=pn;var dn=A+8|0,vn=HEAPF32[dn>>2];w=vn;var mn=A|0,gn=HEAPF32[mn>>2],yn=A+8|0,bn=HEAPF32[yn>>2],wn=gn/bn;E=wn;var En=h,Sn=En,xn=L;assert(!0),_memcpy(Sn,xn,64),o=10;break;case 10:o=11;break;case 11:var Tn=N,Nn=Tn+3;N=Nn,o=7;break;case 12:var Cn=E,kn=v|0,Ln=HEAPF32[kn>>2],An=d|0,On=HEAPF32[An>>2],Mn=Ln-On,_n=v+8|0,Dn=HEAPF32[_n>>2],Pn=d+8|0,Hn=HEAPF32[Pn>>2],Bn=Dn-Hn,jn=Mn/Bn,Fn=Cn<jn;if(Fn){o=13;break}o=14;break;case 13:var In=h;__ZN8BEST_FIT11fm_identityEPf(In);var qn=d|0,Rn=HEAPF32[qn>>2],Un=v|0,zn=HEAPF32[Un>>2],Wn=Rn+zn,Xn=Wn*.5,Vn=h,$n=Vn+48|0;HEAPF32[$n>>2]=Xn;var Jn=d+4|0,Kn=HEAPF32[Jn>>2],Qn=v+4|0,Gn=HEAPF32[Qn>>2],Yn=Kn+Gn,Zn=Yn*.5,er=h,tr=er+52|0;HEAPF32[tr>>2]=Zn;var nr=d+8|0,rr=HEAPF32[nr>>2],ir=v+8|0,sr=HEAPF32[ir>>2],or=rr+sr,ur=or*.5,ar=h,fr=ar+56|0;HEAPF32[fr>>2]=ur;var lr=v|0,cr=HEAPF32[lr>>2],hr=d|0,pr=HEAPF32[hr>>2],dr=cr-pr,vr=c,mr=vr|0;HEAPF32[mr>>2]=dr;var gr=v+4|0,yr=HEAPF32[gr>>2],br=d+4|0,wr=HEAPF32[br>>2],Er=yr-wr,Sr=c,xr=Sr+4|0;HEAPF32[xr>>2]=Er;var Tr=v+8|0,Nr=HEAPF32[Tr>>2],Cr=d+8|0,kr=HEAPF32[Cr>>2],Lr=Nr-kr,Ar=c,Or=Ar+8|0;HEAPF32[Or>>2]=Lr,o=14;break;case 14:STACKTOP=u;return;default:assert(0,"bad label: "+o)}}function __ZN8BEST_FIT18computeBestFitAABBEjPKfjPfS2_(e,t,n,r,i){var s=0;s=2;for(;;)switch(s){case 2:var o,u,a,f,l,c,h,p,d,v,m;o=e,u=t,a=n,f=r,l=i;var g=u,y=g;c=y;var b=u,w=b|0,E=HEAPF32[w>>2],S=f,x=S|0;HEAPF32[x>>2]=E;var T=u,N=T+4|0,C=HEAPF32[N>>2],k=f,L=k+4|0;HEAPF32[L>>2]=C;var A=u,O=A+8|0,M=HEAPF32[O>>2],_=f,D=_+8|0;HEAPF32[D>>2]=M;var P=u,H=P|0,B=HEAPF32[H>>2],j=l,F=j|0;HEAPF32[F>>2]=B;var I=u,q=I+4|0,R=HEAPF32[q>>2],U=l,z=U+4|0;HEAPF32[z>>2]=R;var W=u,X=W+8|0,V=HEAPF32[X>>2],$=l,J=$+8|0;HEAPF32[J>>2]=V,h=1,s=3;break;case 3:var K=h,Q=o,G=K>>>0<Q>>>0;if(G){s=4;break}s=18;break;case 4:var Y=a,Z=c,et=Z+Y|0;c=et;var tt=c,nt=tt;p=nt;var rt=p,it=rt|0,st=HEAPF32[it>>2],ot=f,ut=ot|0,at=HEAPF32[ut>>2],ft=st<at;if(ft){s=5;break}s=6;break;case 5:var lt=p,ct=lt|0,ht=HEAPF32[ct>>2],pt=f,dt=pt|0;HEAPF32[dt>>2]=ht,s=6;break;case 6:var vt=p,mt=vt+4|0,gt=HEAPF32[mt>>2],yt=f,bt=yt+4|0,wt=HEAPF32[bt>>2],Et=gt<wt;if(Et){s=7;break}s=8;break;case 7:var St=p,xt=St+4|0,Tt=HEAPF32[xt>>2],Nt=f,Ct=Nt+4|0;HEAPF32[Ct>>2]=Tt,s=8;break;case 8:var kt=p,Lt=kt+8|0,At=HEAPF32[Lt>>2],Ot=f,Mt=Ot+8|0,_t=HEAPF32[Mt>>2],Dt=At<_t;if(Dt){s=9;break}s=10;break;case 9:var Pt=p,Ht=Pt+8|0,Bt=HEAPF32[Ht>>2],jt=f,Ft=jt+8|0;HEAPF32[Ft>>2]=Bt,s=10;break;case 10:var It=p,qt=It|0,Rt=HEAPF32[qt>>2],Ut=l,zt=Ut|0,Wt=HEAPF32[zt>>2],Xt=Rt>Wt;if(Xt){s=11;break}s=12;break;case 11:var Vt=p,$t=Vt|0,Jt=HEAPF32[$t>>2],Kt=l,Qt=Kt|0;HEAPF32[Qt>>2]=Jt,s=12;break;case 12:var Gt=p,Yt=Gt+4|0,Zt=HEAPF32[Yt>>2],en=l,tn=en+4|0,nn=HEAPF32[tn>>2],rn=Zt>nn;if(rn){s=13;break}s=14;break;case 13:var sn=p,on=sn+4|0,un=HEAPF32[on>>2],an=l,fn=an+4|0;HEAPF32[fn>>2]=un,s=14;break;case 14:var ln=p,cn=ln+8|0,hn=HEAPF32[cn>>2],pn=l,dn=pn+8|0,vn=HEAPF32[dn>>2],mn=hn>vn;if(mn){s=15;break}s=16;break;case 15:var gn=p,yn=gn+8|0,bn=HEAPF32[yn>>2],wn=l,En=wn+8|0;HEAPF32[En>>2]=bn,s=16;break;case 16:s=17;break;case 17:var Sn=h,xn=Sn+1|0;h=xn,s=3;break;case 18:var Tn=l,Nn=Tn|0,Cn=HEAPF32[Nn>>2],kn=f,Ln=kn|0,An=HEAPF32[Ln>>2],On=Cn-An;d=On;var Mn=l,_n=Mn+4|0,Dn=HEAPF32[_n>>2],Pn=f,Hn=Pn+4|0,Bn=HEAPF32[Hn>>2],jn=Dn-Bn;v=jn;var Fn=l,In=Fn+8|0,qn=HEAPF32[In>>2],Rn=f,Un=Rn+8|0,zn=HEAPF32[Un>>2],Wn=qn-zn;m=Wn;var Xn=d,Vn=d,$n=Xn*Vn,Jn=v,Kn=v,Qn=Jn*Kn,Gn=$n+Qn,Yn=m,Zn=m,er=Yn*Zn,tr=Gn+er,nr=tr,rr=Math.sqrt(nr),ir=rr;return ir;default:assert(0,"bad label: "+s)}}function __ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_S2_NS_11FitStrategyE(e,t,n,r,i,s,o){var u=0,a=STACKTOP;STACKTOP=STACKTOP+64|0,assert((STACKTOP|0)<(STACK_MAX|0));var f,l,c,h,p,d,v,m=a;f=e,l=t,c=n,h=r,p=i,d=s,v=o;var g=f,y=l,b=c,w=h,E=m|0,S=v;__ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_NS_11FitStrategyE(g,y,b,w,E,S);var x=m|0,T=d;__ZN8BEST_FIT15fm_matrixToQuatEPKfPf(x,T),STACKTOP=a;return}function _getBestFitPlane(e,t){var n=0,r=STACKTOP;STACKTOP=STACKTOP+120|0,assert((STACKTOP|0)<(STACK_MAX|0));var i,s,o=r,u=r+16,a=r+32,f=r+40;i=e,s=t;var l=i,c=s,h=u|0,p=o|0;__ZN8BEST_FIT17computeBestFitOBBEjPKfjPfS2_S2_NS_11FitStrategyE(l,c,12,a,h,p,2);var d=f|0,v=o|0,m=HEAPF32[v>>2],g=m,y=o+4|0,b=HEAPF32[y>>2],w=b,E=o+8|0,S=HEAPF32[E>>2],x=S,T=o+12|0,N=HEAPF32[T>>2],C=N,k=_sprintf(d,8,(tempInt=STACKTOP,STACKTOP=STACKTOP+32|0,assert((STACKTOP|0)<(STACK_MAX|0)),HEAPF64[tempInt>>3]=g,HEAPF64[tempInt+8>>3]=w,HEAPF64[tempInt+16>>3]=x,HEAPF64[tempInt+24>>3]=C,tempInt)),L=f|0;return STACKTOP=r,L}function __ZN8BEST_FIT5EigenIfE11TridiagonalEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u,a,f,l,c;n=e;var h=n,p=h|0,d=p|0,v=d|0,m=HEAPF32[v>>2];r=m;var g=h|0,y=g|0,b=y+4|0,w=HEAPF32[b>>2];i=w;var E=h|0,S=E|0,x=S+8|0,T=HEAPF32[x>>2];s=T;var N=h|0,C=N+12|0,k=C+4|0,L=HEAPF32[k>>2];o=L;var A=h|0,O=A+12|0,M=O+8|0,_=HEAPF32[M>>2];u=_;var D=h|0,P=D+24|0,H=P+8|0,B=HEAPF32[H>>2];a=B;var j=r,F=h+36|0,I=F|0;HEAPF32[I>>2]=j;var q=h+48|0,R=q+8|0;HEAPF32[R>>2]=0;var U=s,z=U!=0;if(z){t=3;break}t=4;break;case 3:var W=i,X=i,V=W*X,$=s,J=s,K=$*J,Q=V+K,G=Q,Y=Math.sqrt(G),Z=Y;f=Z;var et=f,tt=1/et;l=tt;var nt=l,rt=i,it=rt*nt;i=it;var st=l,ot=s,ut=ot*st;s=ut;var at=i,ft=at*2,lt=u,ct=ft*lt,ht=s,pt=a,dt=o,vt=pt-dt,mt=ht*vt,gt=ct+mt;c=gt;var yt=o,bt=s,wt=c,Et=bt*wt,St=yt+Et,xt=h+36|0,Tt=xt+4|0;HEAPF32[Tt>>2]=St;var Nt=a,Ct=s,kt=c,Lt=Ct*kt,At=Nt-Lt,Ot=h+36|0,Mt=Ot+8|0;HEAPF32[Mt>>2]=At;var _t=f,Dt=h+48|0,Pt=Dt|0;HEAPF32[Pt>>2]=_t;var Ht=u,Bt=i,jt=c,Ft=Bt*jt,It=Ht-Ft,qt=h+48|0,Rt=qt+4|0;HEAPF32[Rt>>2]=It;var Ut=h|0,zt=Ut|0,Wt=zt|0;HEAPF32[Wt>>2]=1;var Xt=h|0,Vt=Xt|0,$t=Vt+4|0;HEAPF32[$t>>2]=0;var Jt=h|0,Kt=Jt|0,Qt=Kt+8|0;HEAPF32[Qt>>2]=0;var Gt=h|0,Yt=Gt+12|0,Zt=Yt|0;HEAPF32[Zt>>2]=0;var en=i,tn=h|0,nn=tn+12|0,rn=nn+4|0;HEAPF32[rn>>2]=en;var sn=s,on=h|0,un=on+12|0,an=un+8|0;HEAPF32[an>>2]=sn;var fn=h|0,ln=fn+24|0,cn=ln|0;HEAPF32[cn>>2]=0;var hn=s,pn=h|0,dn=pn+24|0,vn=dn+4|0;HEAPF32[vn>>2]=hn;var mn=i,gn=-mn,yn=h|0,bn=yn+24|0,wn=bn+8|0;HEAPF32[wn>>2]=gn;var En=h+60|0;HEAP8[En]=0,t=5;break;case 4:var Sn=o,xn=h+36|0,Tn=xn+4|0;HEAPF32[Tn>>2]=Sn;var Nn=a,Cn=h+36|0,kn=Cn+8|0;HEAPF32[kn>>2]=Nn;var Ln=i,An=h+48|0,On=An|0;HEAPF32[On>>2]=Ln;var Mn=u,_n=h+48|0,Dn=_n+4|0;HEAPF32[Dn>>2]=Mn;var Pn=h|0,Hn=Pn|0,Bn=Hn|0;HEAPF32[Bn>>2]=1;var jn=h|0,Fn=jn|0,In=Fn+4|0;HEAPF32[In>>2]=0;var qn=h|0,Rn=qn|0,Un=Rn+8|0;HEAPF32[Un>>2]=0;var zn=h|0,Wn=zn+12|0,Xn=Wn|0;HEAPF32[Xn>>2]=0;var Vn=h|0,$n=Vn+12|0,Jn=$n+4|0;HEAPF32[Jn>>2]=1;var Kn=h|0,Qn=Kn+12|0,Gn=Qn+8|0;HEAPF32[Gn>>2]=0;var Yn=h|0,Zn=Yn+24|0,er=Zn|0;HEAPF32[er>>2]=0;var tr=h|0,nr=tr+24|0,rr=nr+4|0;HEAPF32[rr>>2]=0;var ir=h|0,sr=ir+24|0,or=sr+8|0;HEAPF32[or>>2]=1;var ur=h+60|0;HEAP8[ur]=1,t=5;break;case 5:return;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE11QLAlgorithmEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;r=e;var y=r;i=32,s=0,t=3;break;case 3:var b=s,w=(b|0)<3;if(w){t=4;break}t=34;break;case 4:o=0,t=5;break;case 5:var E=o,S=(E|0)<32;if(S){t=6;break}t=30;break;case 6:var x=s;u=x,t=7;break;case 7:var T=u,N=(T|0)<=1;if(N){t=8;break}t=12;break;case 8:var C=u,k=y+36|0,L=k+(C<<2)|0,A=HEAPF32[L>>2],O=A,M=Math.abs(O),_=u,D=_+1|0,P=y+36|0,H=P+(D<<2)|0,B=HEAPF32[H>>2],j=B,F=Math.abs(j),I=M+F,q=I;a=q;var R=u,U=y+48|0,z=U+(R<<2)|0,W=HEAPF32[z>>2],X=W,V=Math.abs(X),$=a,J=$,K=V+J,Q=a,G=Q,Y=K==G;if(Y){t=9;break}t=10;break;case 9:t=12;break;case 10:t=11;break;case 11:var Z=u,et=Z+1|0;u=et,t=7;break;case 12:var tt=u,nt=s,rt=(tt|0)==(nt|0);if(rt){t=13;break}t=14;break;case 13:t=30;break;case 14:var it=s,st=it+1|0,ot=y+36|0,ut=ot+(st<<2)|0,at=HEAPF32[ut>>2],ft=s,lt=y+36|0,ct=lt+(ft<<2)|0,ht=HEAPF32[ct>>2],pt=at-ht,dt=s,vt=y+48|0,mt=vt+(dt<<2)|0,gt=HEAPF32[mt>>2],yt=gt*2,bt=pt/yt;f=bt;var wt=f,Et=f,St=wt*Et,xt=St+1,Tt=xt,Nt=Math.sqrt(Tt),Ct=Nt;l=Ct;var kt=f,Lt=kt<0;if(Lt){t=15;break}t=16;break;case 15:var At=u,Ot=y+36|0,Mt=Ot+(At<<2)|0,_t=HEAPF32[Mt>>2],Dt=s,Pt=y+36|0,Ht=Pt+(Dt<<2)|0,Bt=HEAPF32[Ht>>2],jt=_t-Bt,Ft=s,It=y+48|0,qt=It+(Ft<<2)|0,Rt=HEAPF32[qt>>2],Ut=f,zt=l,Wt=Ut-zt,Xt=Rt/Wt,Vt=jt+Xt;f=Vt,t=17;break;case 16:var $t=u,Jt=y+36|0,Kt=Jt+($t<<2)|0,Qt=HEAPF32[Kt>>2],Gt=s,Yt=y+36|0,Zt=Yt+(Gt<<2)|0,en=HEAPF32[Zt>>2],tn=Qt-en,nn=s,rn=y+48|0,sn=rn+(nn<<2)|0,on=HEAPF32[sn>>2],un=f,an=l,fn=un+an,ln=on/fn,cn=tn+ln;f=cn,t=17;break;case 17:c=1,h=1,p=0;var hn=u,pn=hn-1|0;d=pn,t=18;break;case 18:var dn=d,vn=s,mn=(dn|0)>=(vn|0);if(mn){t=19;break}t=28;break;case 19:var gn=c,yn=d,bn=y+48|0,wn=bn+(yn<<2)|0,En=HEAPF32[wn>>2],Sn=gn*En;v=Sn;var xn=h,Tn=d,Nn=y+48|0,Cn=Nn+(Tn<<2)|0,kn=HEAPF32[Cn>>2],Ln=xn*kn;m=Ln;var An=v,On=An,Mn=Math.abs(On),_n=f,Dn=_n,Pn=Math.abs(Dn),Hn=Mn>=Pn;if(Hn){t=20;break}t=21;break;case 20:var Bn=f,jn=v,Fn=Bn/jn;h=Fn;var In=h,qn=h,Rn=In*qn,Un=Rn+1,zn=Un,Wn=Math.sqrt(zn),Xn=Wn;l=Xn;var Vn=v,$n=l,Jn=Vn*$n,Kn=d,Qn=Kn+1|0,Gn=y+48|0,Yn=Gn+(Qn<<2)|0;HEAPF32[Yn>>2]=Jn;var Zn=l,er=1/Zn;c=er;var tr=c,nr=h,rr=nr*tr;h=rr,t=22;break;case 21:var ir=v,sr=f,or=ir/sr;c=or;var ur=c,ar=c,fr=ur*ar,lr=fr+1,cr=lr,hr=Math.sqrt(cr),pr=hr;l=pr;var dr=f,vr=l,mr=dr*vr,gr=d,yr=gr+1|0,br=y+48|0,wr=br+(yr<<2)|0;HEAPF32[wr>>2]=mr;var Er=l,Sr=1/Er;h=Sr;var xr=h,Tr=c,Nr=Tr*xr;c=Nr,t=22;break;case 22:var Cr=d,kr=Cr+1|0,Lr=y+36|0,Ar=Lr+(kr<<2)|0,Or=HEAPF32[Ar>>2],Mr=p,_r=Or-Mr;f=_r;var Dr=d,Pr=y+36|0,Hr=Pr+(Dr<<2)|0,Br=HEAPF32[Hr>>2],jr=f,Fr=Br-jr,Ir=c,qr=Fr*Ir,Rr=m,Ur=Rr*2,zr=h,Wr=Ur*zr,Xr=qr+Wr;l=Xr;var Vr=c,$r=l,Jr=Vr*$r;p=Jr;var Kr=f,Qr=p,Gr=Kr+Qr,Yr=d,Zr=Yr+1|0,ei=y+36|0,ti=ei+(Zr<<2)|0;HEAPF32[ti>>2]=Gr;var ni=h,ri=l,ii=ni*ri,si=m,oi=ii-si;f=oi,g=0,t=23;break;case 23:var ui=g,ai=(ui|0)<3;if(ai){t=24;break}t=26;break;case 24:var fi=d,li=fi+1|0,ci=g,hi=y|0,pi=hi+(ci*12&-1)|0,di=pi+(li<<2)|0,vi=HEAPF32[di>>2];v=vi;var mi=c,gi=d,yi=g,bi=y|0,wi=bi+(yi*12&-1)|0,Ei=wi+(gi<<2)|0,Si=HEAPF32[Ei>>2],xi=mi*Si,Ti=h,Ni=v,Ci=Ti*Ni,ki=xi+Ci,Li=d,Ai=Li+1|0,Oi=g,Mi=y|0,_i=Mi+(Oi*12&-1)|0,Di=_i+(Ai<<2)|0;HEAPF32[Di>>2]=ki;var Pi=h,Hi=d,Bi=g,ji=y|0,Fi=ji+(Bi*12&-1)|0,Ii=Fi+(Hi<<2)|0,qi=HEAPF32[Ii>>2],Ri=Pi*qi,Ui=c,zi=v,Wi=Ui*zi,Xi=Ri-Wi,Vi=d,$i=g,Ji=y|0,Ki=Ji+($i*12&-1)|0,Qi=Ki+(Vi<<2)|0;HEAPF32[Qi>>2]=Xi,t=25;break;case 25:var Gi=g,Yi=Gi+1|0;g=Yi,t=23;break;case 26:t=27;break;case 27:var Zi=d,es=Zi-1|0;d=es,t=18;break;case 28:var ts=p,ns=s,rs=y+36|0,is=rs+(ns<<2)|0,ss=HEAPF32[is>>2],os=ss-ts;HEAPF32[is>>2]=os;var us=f,as=s,fs=y+48|0,ls=fs+(as<<2)|0;HEAPF32[ls>>2]=us;var cs=u,hs=y+48|0,ps=hs+(cs<<2)|0;HEAPF32[ps>>2]=0,t=29;break;case 29:var ds=o,vs=ds+1|0;o=vs,t=5;break;case 30:var ms=o,gs=(ms|0)==32;if(gs){t=31;break}t=32;break;case 31:n=0,t=35;break;case 32:t=33;break;case 33:var ys=s,bs=ys+1|0;s=bs,t=3;break;case 34:n=1,t=35;break;case 35:var ws=n;return ws;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE14DecreasingSortEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r,i,s,o,u;n=e;var a=n;r=0,t=3;break;case 3:var f=r,l=(f|0)<=1;if(l){t=4;break}t=18;break;case 4:var c=r;i=c;var h=i,p=a+36|0,d=p+(h<<2)|0,v=HEAPF32[d>>2];s=v;var m=r,g=m+1|0;o=g,t=5;break;case 5:var y=o,b=(y|0)<3;if(b){t=6;break}t=10;break;case 6:var w=o,E=a+36|0,S=E+(w<<2)|0,x=HEAPF32[S>>2],T=s,N=x>T;if(N){t=7;break}t=8;break;case 7:var C=o;i=C;var k=i,L=a+36|0,A=L+(k<<2)|0,O=HEAPF32[A>>2];s=O,t=8;break;case 8:t=9;break;case 9:var M=o,_=M+1|0;o=_,t=5;break;case 10:var D=i,P=r,H=(D|0)!=(P|0);if(H){t=11;break}t=16;break;case 11:var B=r,j=a+36|0,F=j+(B<<2)|0,I=HEAPF32[F>>2],q=i,R=a+36|0,U=R+(q<<2)|0;HEAPF32[U>>2]=I;var z=s,W=r,X=a+36|0,V=X+(W<<2)|0;HEAPF32[V>>2]=z,o=0,t=12;break;case 12:var $=o,J=($|0)<3;if(J){t=13;break}t=15;break;case 13:var K=r,Q=o,G=a|0,Y=G+(Q*12&-1)|0,Z=Y+(K<<2)|0,et=HEAPF32[Z>>2];u=et;var tt=i,nt=o,rt=a|0,it=rt+(nt*12&-1)|0,st=it+(tt<<2)|0,ot=HEAPF32[st>>2],ut=r,at=o,ft=a|0,lt=ft+(at*12&-1)|0,ct=lt+(ut<<2)|0;HEAPF32[ct>>2]=ot;var ht=u,pt=i,dt=o,vt=a|0,mt=vt+(dt*12&-1)|0,gt=mt+(pt<<2)|0;HEAPF32[gt>>2]=ht;var yt=a+60|0,bt=HEAP8[yt],wt=bt&1,Et=wt^1,St=a+60|0,xt=Et&1;HEAP8[St]=xt,t=14;break;case 14:var Tt=o,Nt=Tt+1|0;o=Nt,t=12;break;case 15:t=16;break;case 16:t=17;break;case 17:var Ct=r,kt=Ct+1|0;r=kt,t=3;break;case 18:return;default:assert(0,"bad label: "+t)}}function __ZN8BEST_FIT5EigenIfE17GuaranteeRotationEv(e){var t=0;t=2;for(;;)switch(t){case 2:var n,r;n=e;var i=n,s=i+60|0,o=HEAP8[s],u=o&1;if(u){t=8;break}t=3;break;case 3:r=0,t=4;break;case 4:var a=r,f=(a|0)<3;if(f){t=5;break}t=7;break;case 5:var l=r,c=i|0,h=c+(l*12&-1)|0,p=h|0,d=HEAPF32[p>>2],v=-d,m=r,g=i|0,y=g+(m*12&-1)|0,b=y|0;HEAPF32[b>>2]=v,t=6;break;case 6:var w=r,E=w+1|0;r=E,t=4;break;case 7:t=8;break;case 8:return;default:assert(0,"bad label: "+t)}}function run(e){function r(){ensureInitRuntime(),preMain();var t=0;calledRun=!0,Module._main&&shouldRunNow&&(t=Module.callMain(e),Module.noExitRuntime||exitRuntime());if(Module.postRun){typeof Module["postRun"]=="function"&&(Module.postRun=[Module.postRun]);while(Module.postRun.length>0)Module.postRun.pop()()}return t}e=e||Module.arguments;if(runDependencies>0)return Module.printErr("run() called, but dependencies remain, so not running"),0;if(Module.preRun){typeof Module["preRun"]=="function"&&(Module.preRun=[Module.preRun]);var t=Module.preRun;Module.preRun=[];for(var n=t.length-1;n>=0;n--)t[n]();if(runDependencies>0)return 0}return Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),r()},1),0):r()}try{this.Module=Module}catch(e){this.Module=Module={}}var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof require=="function",ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_SHELL=!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_WORKER;if(ENVIRONMENT_IS_NODE){Module.print=function(e){process.stdout.write(e+"\n")},Module.printErr=function(e){process.stderr.write(e+"\n")};var nodeFS=require("fs"),nodePath=require("path");Module.read=function(e,t){e=nodePath.normalize(e);var n=nodeFS.readFileSync(e);return!n&&e!=nodePath["resolve"](e)&&(e=path.join(__dirname,"..","src",e),n=nodeFS.readFileSync(e)),n&&!t&&(n=n.toString()),n},Module.readBinary=function(e){return Module.read(e,!0)},Module.load=function(e){globalEval(read(e))},Module.arguments||(Module.arguments=process.argv.slice(2))}ENVIRONMENT_IS_SHELL&&(Module.print=print,typeof printErr!="undefined"&&(Module.printErr=printErr),Module.read=read,Module.readBinary=function(e){return read(e,"binary")},Module.arguments||(typeof scriptArgs!="undefined"?Module.arguments=scriptArgs:typeof arguments!="undefined"&&(Module.arguments=arguments))),ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_WORKER&&(Module.print||(Module.print=function(e){console.log(e)}),Module.printErr||(Module.printErr=function(e){console.log(e)}));if(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)Module.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},Module.arguments||typeof arguments!="undefined"&&(Module.arguments=arguments);if(ENVIRONMENT_IS_WORKER){var TRY_USE_DUMP=!1;Module.print||(Module.print=TRY_USE_DUMP&&typeof dump!="undefined"?function(e){dump(e)}:function(e){}),Module.load=importScripts}if(!ENVIRONMENT_IS_WORKER&&!ENVIRONMENT_IS_WEB&&!ENVIRONMENT_IS_NODE&&!ENVIRONMENT_IS_SHELL)throw"Unknown runtime environment. Where are we?";!Module["load"]=="undefined"&&Module.read&&(Module.load=function(e){globalEval(Module.read(e))}),Module.print||(Module.print=function(){}),Module.printErr||(Module.printErr=Module.print),Module.arguments||(Module.arguments=[]),Module.print=Module.print,Module.printErr=Module.printErr,Module.preRun||(Module.preRun=[]),Module.postRun||(Module.postRun=[]);var Runtime={stackSave:function(){return STACKTOP},stackRestore:function(e){STACKTOP=e},forceAlign:function(e,t){t=t||4;if(t==1)return e;if(isNumber(e)&&isNumber(t))return Math.ceil(e/t)*t;if(isNumber(t)&&isPowerOfTwo(t)){var n=log2(t);return"(((("+e+")+"+(t-1)+")>>"+n+")<<"+n+")"}return"Math.ceil(("+e+")/"+t+")*"+t},isNumberType:function(e){return e in Runtime.INT_TYPES||e in Runtime.FLOAT_TYPES},isPointerType:function(t){return t[t.length-1]=="*"},isStructType:function(t){return isPointerType(t)?!1:/^\[\d+\ x\ (.*)\]/.test(t)?!0:/<?{ ?[^}]* ?}>?/.test(t)?!0:t[0]=="%"},INT_TYPES:{i1:0,i8:0,i16:0,i32:0,i64:0},FLOAT_TYPES:{"float":0,"double":0},or64:function(e,t){var n=e|0|(t|0),r=(Math.round(e/4294967296)|Math.round(t/4294967296))*4294967296;return n+r},and64:function(e,t){var n=(e|0)&(t|0),r=(Math.round(e/4294967296)&Math.round(t/4294967296))*4294967296;return n+r},xor64:function(e,t){var n=(e|0)^(t|0),r=(Math.round(e/4294967296)^Math.round(t/4294967296))*4294967296;return n+r},getNativeTypeSize:function(e,t){if(Runtime.QUANTUM_SIZE==1)return 1;var n={"%i1":1,"%i8":1,"%i16":2,"%i32":4,"%i64":8,"%float":4,"%double":8}["%"+e];if(!n)if(e.charAt(e.length-1)=="*")n=Runtime.QUANTUM_SIZE;else if(e[0]=="i"){var r=parseInt(e.substr(1));assert(r%8==0),n=r/8}return n},getNativeFieldSize:function(e){return Math.max(Runtime.getNativeTypeSize(e),Runtime.QUANTUM_SIZE)},dedup:function(t,n){var r={};return n?t.filter(function(e){return r[e[n]]?!1:(r[e[n]]=!0,!0)}):t.filter(function(e){return r[e]?!1:(r[e]=!0,!0)})},set:function(){var t=typeof arguments[0]=="object"?arguments[0]:arguments,n={};for(var r=0;r<t.length;r++)n[t[r]]=0;return n},STACK_ALIGN:8,getAlignSize:function(e,t,n){return e=="i64"||e=="double"||n?8:e?Math.min(t||(e?Runtime.getNativeFieldSize(e):0),Runtime.QUANTUM_SIZE):Math.min(t,8)},calculateStructAlignment:function(t){t.flatSize=0,t.alignSize=0;var n=[],r=-1;return t.flatIndexes=t.fields.map(function(e){var i,s;if(Runtime.isNumberType(e)||Runtime.isPointerType(e))i=Runtime.getNativeTypeSize(e),s=Runtime.getAlignSize(e,i);else if(Runtime.isStructType(e))i=Types.types[e].flatSize,s=Runtime.getAlignSize(null,Types.types[e].alignSize);else{if(e[0]!="b")throw"Unclear type in struct: "+e+", in "+t.name_+" :: "+dump(Types.types[t.name_]);i=e.substr(1)|0,s=1}t.packed&&(s=1),t.alignSize=Math.max(t.alignSize,s);var o=Runtime.alignMemory(t.flatSize,s);return t.flatSize=o+i,r>=0&&n.push(o-r),r=o,o}),t.flatSize=Runtime.alignMemory(t.flatSize,t.alignSize),n.length==0?t.flatFactor=t.flatSize:Runtime.dedup(n).length==1&&(t.flatFactor=n[0]),t.needsFlattening=t.flatFactor!=1,t.flatIndexes},generateStructInfo:function(e,t,n){var r,i;if(t){n=n||0,r=(typeof Types=="undefined"?Runtime.typeInfo:Types.types)[t];if(!r)return null;if(r.fields.length!=e.length)return printErr("Number of named fields must match the type for "+t+": possibly duplicate struct names. Cannot return structInfo"),null;i=r.flatIndexes}else{var r={fields:e.map(function(e){return e[0]})};i=Runtime.calculateStructAlignment(r)}var s={__size__:r.flatSize};return t?e.forEach(function(e,t){if(typeof e=="string")s[e]=i[t]+n;else{var o;for(var u in e)o=u;s[o]=Runtime.generateStructInfo(e[o],r.fields[t],i[t])}}):e.forEach(function(e,t){s[e[1]]=i[t]}),s},dynCall:function(e,t,n){return n&&n.length?(assert(n.length==e.length-1),FUNCTION_TABLE[t].apply(null,n)):(assert(e.length==1),FUNCTION_TABLE[t]())},addFunction:function(e){var t=FUNCTION_TABLE,n=t.length;return t.push(e),t.push(0),n},removeFunction:function(e){var t=FUNCTION_TABLE;t[e]=null},warnOnce:function(e){Runtime.warnOnce.shown||(Runtime.warnOnce.shown={}),Runtime.warnOnce.shown[e]||(Runtime.warnOnce.shown[e]=1,Module.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){return assert(t),Runtime.funcWrappers[e]||(Runtime.funcWrappers[e]=function(){return Runtime.dynCall(t,e,arguments)}),Runtime.funcWrappers[e]},UTF8Processor:function(){var e=[],t=0;this.processCChar=function(n){n&=255,t&&(e.push(n),t--);if(e.length==0)return n<128?String.fromCharCode(n):(e.push(n),n>191&&n<224?t=1:t=2,"");if(t>0)return"";var r=e[0],i=e[1],s=e[2],o;return r>191&&r<224?o=String.fromCharCode((r&31)<<6|i&63):o=String.fromCharCode((r&15)<<12|(i&63)<<6|s&63),e.length=0,o},this.processJSString=function(e){e=unescape(encodeURIComponent(e));var t=[];for(var n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}},stackAlloc:function(e){var t=STACKTOP;return STACKTOP=STACKTOP+e|0,STACKTOP=STACKTOP+7>>3<<3,assert((STACKTOP|0)<(STACK_MAX|0)),t},staticAlloc:function(e){var t=STATICTOP;return STATICTOP=STATICTOP+(assert(!staticSealed),e)|0,STATICTOP=STATICTOP+7>>3<<3,t},dynamicAlloc:function(e){var t=DYNAMICTOP;return DYNAMICTOP=DYNAMICTOP+(assert(DYNAMICTOP>0),e)|0,DYNAMICTOP=DYNAMICTOP+7>>3<<3,DYNAMICTOP>=TOTAL_MEMORY&&enlargeMemory(),t},alignMemory:function(e,t){var n=e=Math.ceil(e/(t?t:8))*(t?t:8);return n},makeBigInt:function(e,t,n){var r=n?(e>>>0)+(t>>>0)*4294967296:(e>>>0)+(t|0)*4294967296;return r},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0},__THREW__=0,setjmpId=1,setjmpLabels={},ABORT=!1,undef=0,tempValue,tempInt,tempBigInt,tempInt2,tempBigInt2,tempPair,tempBigIntI,tempBigIntR,tempBigIntS,tempBigIntP,tempBigIntD,tempI64,tempI64b,tempRet0,tempRet1,tempRet2,tempRet3,tempRet4,tempRet5,tempRet6,tempRet7,tempRet8,tempRet9,globalScope=this;Module.ccall=ccall,Module.cwrap=cwrap,Module.setValue=setValue,Module.getValue=getValue;var ALLOC_NORMAL=0,ALLOC_STACK=1,ALLOC_STATIC=2,ALLOC_DYNAMIC=3,ALLOC_NONE=4;Module.ALLOC_NORMAL=ALLOC_NORMAL,Module.ALLOC_STACK=ALLOC_STACK,Module.ALLOC_STATIC=ALLOC_STATIC,Module.ALLOC_DYNAMIC=ALLOC_DYNAMIC,Module.ALLOC_NONE=ALLOC_NONE,Module.allocate=allocate,Module.Pointer_stringify=Pointer_stringify;var PAGE_SIZE=4096,HEAP,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,STATIC_BASE=0,STATICTOP=0,staticSealed=!1,STACK_BASE=0,STACKTOP=0,STACK_MAX=0,DYNAMIC_BASE=0,DYNAMICTOP=0,TOTAL_STACK=Module.TOTAL_STACK||5242880,TOTAL_MEMORY=Module.TOTAL_MEMORY||16777216,FAST_MEMORY=Module.FAST_MEMORY||2097152;assert(!!Int32Array&&!!Float64Array&&!!(new Int32Array(1)).subarray&&!!(new Int32Array(1)).set,"Cannot fallback to non-typed array case: Code is too specialized");var buffer=new ArrayBuffer(TOTAL_MEMORY);HEAP8=new Int8Array(buffer),HEAP16=new Int16Array(buffer),HEAP32=new Int32Array(buffer),HEAPU8=new Uint8Array(buffer),HEAPU16=new Uint16Array(buffer),HEAPU32=new Uint32Array(buffer),HEAPF32=new Float32Array(buffer),HEAPF64=new Float64Array(buffer),HEAP32[0]=255,assert(HEAPU8[0]===255&&HEAPU8[3]===0,"Typed arrays 2 must be run on a little-endian system"),Module.HEAP=HEAP,Module.HEAP8=HEAP8,Module.HEAP16=HEAP16,Module.HEAP32=HEAP32,Module.HEAPU8=HEAPU8,Module.HEAPU16=HEAPU16,Module.HEAPU32=HEAPU32,Module.HEAPF32=HEAPF32,Module.HEAPF64=HEAPF64;var __ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],runtimeInitialized=!1;Module.intArrayFromString=intArrayFromString,Module.intArrayToString=intArrayToString,Module.writeStringToMemory=writeStringToMemory,Module.writeArrayToMemory=writeArrayToMemory,Math.imul||(Math.imul=function(e,t){var n=e>>>16,r=e&65535,i=t>>>16,s=t&65535;return r*s+(n*s+r*i<<16)|0});var runDependencies=0,runDependencyTracking={},calledInit=!1,calledRun=!1,runDependencyWatcher=null;Module.addRunDependency=addRunDependency,Module.removeRunDependency=removeRunDependency,Module.preloadedImages={},Module.preloadedAudios={};var awaitingMemoryInitializer=!1;STATIC_BASE=8,STATICTOP=STATIC_BASE+88,allocate([91,37,102,44,32,37,102,44,32,37,102,44,32,37,102,93,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,63,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,40,107,110,78,40,107,110,78,40,107,110,78,0,0,0,0,40,107,110,206,40,107,110,206,40,107,110,206,0,0,0,0],"i8",ALLOC_NONE,Runtime.GLOBAL_BASE),awaitingMemoryInitializer||runPostSets();var tempDoublePtr=Runtime.alignMemory(allocate(12,"i8",ALLOC_STATIC),8);assert(tempDoublePtr%8==0);var _sqrt=Math.sqrt,_llvm_memcpy_p0i8_p0i8_i32=_memcpy,_cos=Math.cos,_sin=Math.sin,_llvm_memset_p0i8_i32=_memset,_fabs=Math.abs,Browser={mainLoop:{scheduler:null,shouldPause:!1,paused:!1,queue:[],pause:function(){Browser.mainLoop.shouldPause=!0},resume:function(){Browser.mainLoop.paused&&(Browser.mainLoop.paused=!1,Browser.mainLoop.scheduler()),Browser.mainLoop.shouldPause=!1},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,n=Browser.mainLoop.expectedBlockers;t?t<n?Module.setStatus(e+" ("+(n-t)+"/"+n+")"):Module.setStatus(e):Module.setStatus("")}}},isFullScreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){function t(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function s(){Browser.pointerLock=document.pointerLockElement===i||document.mozPointerLockElement===i||document.webkitPointerLockElement===i}if(Browser.initted)return;Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder=typeof MozBlobBuilder!="undefined"?MozBlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:Browser.hasBlobConstructor?null:console.log("warning: no BlobBuilder"),Browser.URLObject=typeof window!="undefined"?window.URL?window.URL:window.webkitURL:console.log("warning: cannot create object URLs"),Module.preloadPlugins||(Module.preloadPlugins=[]);var n={};n.canHandle=function(e){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/.exec(e)},n.handle=function(e,n,r,i){var s=null;if(Browser.hasBlobConstructor)try{s=new Blob([e],{type:t(n)})}catch(o){Runtime.warnOnce("Blob constructor present but fails: "+o+"; falling back to blob builder")}if(!s){var u=new Browser.BlobBuilder;u.append((new Uint8Array(e)).buffer),s=u.getBlob()}var a=Browser.URLObject.createObjectURL(s);assert(typeof a=="string","createObjectURL must return a url as a string");var f=new Image;f.onload=function(){assert(f.complete,"Image "+n+" could not be decoded");var t=document.createElement("canvas");t.width=f.width,t.height=f.height;var i=t.getContext("2d");i.drawImage(f,0,0),Module.preloadedImages[n]=t,Browser.URLObject.revokeObjectURL(a),r&&r(e)},f.onerror=function(e){console.log("Image "+a+" could not be decoded"),i&&i()},f.src=a},Module.preloadPlugins.push(n);var r={};r.canHandle=function(e){return!Module.noAudioDecoding&&e.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},r.handle=function(e,n,r,i){function o(t){if(s)return;s=!0,Module.preloadedAudios[n]=t,r&&r(e)}function u(){if(s)return;s=!0,Module.preloadedAudios[n]=new Audio,i&&i()}var s=!1;if(!Browser.hasBlobConstructor)return u();try{var a=new Blob([e],{type:t(n)})}catch(f){return u()}var l=Browser.URLObject.createObjectURL(a);assert(typeof l=="string","createObjectURL must return a url as a string");var c=new Audio;c.addEventListener("canplaythrough",function(){o(c)},!1),c.onerror=function(t){function r(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="=",r="",i=0,s=0;for(var o=0;o<e.length;o++){i=i<<8|e[o],s+=8;while(s>=6){var u=i>>s-6&63;s-=6,r+=t[u]}}return s==2?(r+=t[(i&3)<<4],r+=n+n):s==4&&(r+=t[(i&15)<<2],r+=n),r}if(s)return;console.log("warning: browser could not fully decode audio "+n+", trying slower base64 approach"),c.src="data:audio/x-"+n.substr(-3)+";base64,"+r(e),o(c)},c.src=l,setTimeout(function(){o(c)},1e4)},Module.preloadPlugins.push(r);var i=Module.canvas;i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,i.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,i.exitPointerLock=i.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",s,!1),document.addEventListener("mozpointerlockchange",s,!1),document.addEventListener("webkitpointerlockchange",s,!1),Module.elementPointerLock&&i.addEventListener("click",function(e){!Browser.pointerLock&&i.requestPointerLock&&(i.requestPointerLock(),e.preventDefault())},!1)},createContext:
function(e,t,n){var r;try{t?r=e.getContext("experimental-webgl",{alpha:!1}):r=e.getContext("2d");if(!r)throw":("}catch(i){return Module.print("Could not create canvas - "+i),null}return t&&(e.style.backgroundColor="black",e.addEventListener("webglcontextlost",function(e){alert("WebGL context lost. You will need to reload the page.")},!1)),n&&(Module.ctx=r,Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach(function(e){e()}),Browser.init()),r},destroyContext:function(e,t,n){},fullScreenHandlersInstalled:!1,lockPointer:undefined,resizeCanvas:undefined,requestFullScreen:function(e,t){function r(){Browser.isFullScreen=!1,(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement)===n?(n.cancelFullScreen=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen,n.cancelFullScreen=n.cancelFullScreen.bind(document),Browser.lockPointer&&n.requestPointerLock(),Browser.isFullScreen=!0,Browser.resizeCanvas&&Browser.setFullScreenCanvasSize()):Browser.resizeCanvas&&Browser.setWindowedCanvasSize(),Module.onFullScreen&&Module.onFullScreen(Browser.isFullScreen)}this.lockPointer=e,this.resizeCanvas=t,typeof this.lockPointer=="undefined"&&(this.lockPointer=!0),typeof this.resizeCanvas=="undefined"&&(this.resizeCanvas=!1);var n=Module.canvas;this.fullScreenHandlersInstalled||(this.fullScreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",r,!1),document.addEventListener("mozfullscreenchange",r,!1),document.addEventListener("webkitfullscreenchange",r,!1)),n.requestFullScreen=n.requestFullScreen||n.mozRequestFullScreen||(n.webkitRequestFullScreen?function(){n.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),n.requestFullScreen()},requestAnimationFrame:function(e){window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.setTimeout),window.requestAnimationFrame(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,calculateMouseEvent:function(e){if(Browser.pointerLock)e.type!="mousemove"&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY;else{var t=Module.canvas.getBoundingClientRect(),n=e.pageX-(window.scrollX+t.left),r=e.pageY-(window.scrollY+t.top),i=Module.canvas.width,s=Module.canvas.height;n*=i/t.width,r*=s/t.height,Browser.mouseMovementX=n-Browser.mouseX,Browser.mouseMovementY=r-Browser.mouseY,Browser.mouseX=n,Browser.mouseY=r}},xhrLoad:function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){r.status==200||r.status==0&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},asyncLoad:function(e,t,n,r){Browser.xhrLoad(e,function(n){assert(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),r||removeRunDependency("al "+e)},function(t){if(!n)throw'Loading data file "'+e+'" failed.';n()}),r||addRunDependency("al "+e)},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach(function(t){t(e.width,e.height)})},setCanvasSize:function(e,t,n){var r=Module.canvas;r.width=e,r.height=t,n||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullScreenCanvasSize:function(){var e=Module.canvas;this.windowedWidth=e.width,this.windowedHeight=e.height,e.width=screen.width,e.height=screen.height;var t=HEAPU32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2];t|=8388608,HEAP32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2]=t,Browser.updateResizeListeners()},setWindowedCanvasSize:function(){var e=Module.canvas;e.width=this.windowedWidth,e.height=this.windowedHeight;var t=HEAPU32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2];t&=-8388609,HEAP32[SDL.screen+Runtime.QUANTUM_SIZE*0>>2]=t,Browser.updateResizeListeners()}};Module.requestFullScreen=function(e,t){Browser.requestFullScreen(e,t)},Module.requestAnimationFrame=function(e){Browser.requestAnimationFrame(e)},Module.pauseMainLoop=function(){Browser.mainLoop.pause()},Module.resumeMainLoop=function(){Browser.mainLoop.resume()},STACK_BASE=STACKTOP=Runtime.alignMemory(STATICTOP),staticSealed=!0,STACK_MAX=STACK_BASE+5242880,DYNAMIC_BASE=DYNAMICTOP=Runtime.alignMemory(STACK_MAX),assert(DYNAMIC_BASE<TOTAL_MEMORY);var FUNCTION_TABLE=[0,0];Module._getBestFitPlane=_getBestFitPlane;var i64Math=null;Module.callMain=function(t){function r(){for(var e=0;e<3;e++)i.push(0)}assert(runDependencies==0,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(!Module.preRun||Module["preRun"].length==0,"cannot call main when preRun functions remain to be called"),t=t||[],ensureInitRuntime();var n=t.length+1,i=[allocate(intArrayFromString("/bin/this.program"),"i8",ALLOC_NORMAL)];r();for(var s=0;s<n-1;s+=1)i.push(allocate(intArrayFromString(t[s]),"i8",ALLOC_NORMAL)),r();i.push(0),i=allocate(i,"i32",ALLOC_NORMAL);var o,u=STACKTOP;try{o=Module._main(n,i,0)}catch(a){if(a.name=="ExitStatus")return a.status;if(a!="SimulateInfiniteLoop")throw a;Module.noExitRuntime=!0}finally{STACKTOP=u}return o},Module.run=Module.run=run;if(Module.preInit){typeof Module["preInit"]=="function"&&(Module.preInit=[Module.preInit]);while(Module.preInit.length>0)Module.preInit.pop()()}var shouldRunNow=!0;return Module.noInitialRun&&(shouldRunNow=!1),run(),{getBestFitPlane:function(coordarray){var floatData=new Float32Array(coordarray.length);for(i=0;i<floatData.length;i++)floatData[i]=coordarray[i];var numBytes=floatData.length*floatData.BYTES_PER_ELEMENT,ptr=_malloc(numBytes),heapBytes=new Uint8Array(Module.HEAPU8.buffer,ptr,numBytes);heapBytes.set(new Uint8Array(floatData.buffer));var o=_getBestFitPlane(coordarray.length,ptr);return _free(heapBytes.byteOffset),eval(Pointer_stringify(o))}}}();window.mobilecheck=function(){var e=!1;return function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=!0}(navigator.userAgent||navigator.vendor||window.opera),e};var CanvasTextFunctions={};CanvasTextFunctions.letters={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},",":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}},CanvasTextFunctions.letter=function(e){return CanvasTextFunctions.letters[e]},CanvasTextFunctions.ascent=function(e,t){return t},CanvasTextFunctions.descent=function(e,t){return 7*t/25},CanvasTextFunctions.measure=function(e,t,n){var r=0,s=n.length;for(i=0;i<s;i++){var o=CanvasTextFunctions.letter(n.charAt(i));o&&(r+=o.width*t/25)}return r},CanvasTextFunctions.draw=function(e,t,n,r,s,o){try{var u=0,a=o.length,f=n/25;e.save(),e.lineCap="round",e.lineWidth=2*f;for(i=0;i<a;i++){var l=CanvasTextFunctions.letter(o.charAt(i));if(!l)continue;e.beginPath();var c=1,h=0;for(j=0;j<l.points.length;j++){var p=l.points[j];if(p[0]==-1&&p[1]==-1){c=1;continue}c?(e.moveTo(r+p[0]*f,s-p[1]*f),c=!1):e.lineTo(r+p[0]*f,s-p[1]*f)}e.stroke(),r+=l.width*f}e.restore()}catch(d){}return u},CanvasTextFunctions.enable=function(e){e.drawText=function(t,n,r,i,s){return CanvasTextFunctions.draw(e,t,n,r,i,s)},e.measureText=function(e,t,n){return CanvasTextFunctions.measure(e,t,n)},e.fontAscent=function(e,t){return CanvasTextFunctions.ascent(e,t)},e.fontDescent=function(e,t){return CanvasTextFunctions.descent(e,t)},e.drawTextRight=function(t,n,r,i,s){var o=CanvasTextFunctions.measure(t,n,s);return CanvasTextFunctions.draw(e,t,n,r-o,i,s)},e.drawTextCenter=function(t,n,r,i,s){var o=CanvasTextFunctions.measure(t,n,s);return CanvasTextFunctions.draw(e,t,n,r-o/2,i,s)}};var Scif=function(){function e(e,t){return e&&this.parseCif(e,t),!0}return e._block=function(e){return this.id=e,this.cifitems=[],this.cifloops=[],this.rawdata="",this.structure=!1,this.mscif=!1,this.mmcif=!1,this.cifmol=!1,this},e._block.prototype.getItemValues=function(e){var t="";for(var n=0;n<e.length;n++){var r=this.cifitems[e[n]];if(!r)continue;var i=r.getValues(),s=!0;for(var o=0;o<i.length;o++){var u=i[o];u=u.replace(/^\s+|\s+$/g,""),u.substr(0,2)=="\\\n"&&(u=u.replace(/\\\s*\n/g,"")),u=u.replace(/^\s+|\s+$/g,"");if(u!="."&&u!="?"&&u!=""){s=!1,t=e[n];break}}if(s)continue;return{dn:t,dvs:i}}return null},e._block.prototype.getWavevectorMatrices=function(){var e="",t=this.getItemValues(["_cell_modulation_dimension"]),n=1;t&&t.dvs.length>0&&(n=parseInt(t.dvs[0]),isNaN(n)&&(n=1)),n+=3;var r=this.getItemValues(["_cell_subsystems_number"]),i=0;r&&r.dvs.length>0&&(i=parseInt(r.dvs[0]),isNaN(i)&&(i=0));if(i>0){var s=this.cifitems._cell_subsystem_code;s||(s=this.cifitems._cell_subsystem_description);if(!s)return null;var o=[],u="";for(var a=1;a<=n;++a)for(var f=1;f<=n;++f)a==f?u+="1":u+="0",o.push("_cell_subsystem_matrix_w_"+a+"_"+f);var l=[],c=this.cifloops[s.id];if(!c)return null;var h=c.loopheads,p=c.loopvalues,d=[];for(var v=0;v<o.length;v++)d[o[v]]=h.indexOf(o[v]);var m=h.length,g=p.length/m,y=0,b=[],w=[];for(var E=0;E<g;++E){var S=!0,x=0,T="",N=[];for(var v=0;v<o.length;v++){x++;var C=0;if(d[o[v]]>-1){var k=parseFloat(p[y+d[o[v]]]);isNaN(k)||(C=k,S=!1)}x>1&&(T+=" & "),T+=""+C,N.push(C),x==n&&(b.push(N.slice(0)),N.length=0,T+=" \\cr ",x=0)}!S&&T!=""&&(T="W^{"+(E+1)+"}=\\left(\\matrix{"+T+"}\\right)"),w.push(T),y+=m}return{matrices:b,tex:w}}return null},e._block.prototype.getBiomolData=function(){var e=this,t=[],n=0,r=e.cifitems["_pdbx_struct_assembly.id"];if(r){var i=e.cifloops[r.id],s=[],o=[];if(!i){o.push(r.value),s=["_pdbx_struct_assembly.id","_pdbx_struct_assembly.details"];for(var u=1;u<s.length;u++){var a=e.cifitems[s[u]];a?o.push(a.value):o.push("?")}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly.id"),l=s.indexOf("_pdbx_struct_assembly.details"),c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(f==-1){p+=c;continue}t[o[p+f]]={id:o[p+f],details:o[p+l],ops:[],opsByChain:[],chains:[],mats:[]},n++,p+=c}}r=e.cifitems["_pdbx_struct_assembly_gen.assembly_id"];if(r){var i=e.cifloops[r.id],s=[],o=[];if(!i){o.push(r.value),s=["_pdbx_struct_assembly_gen.assembly_id","_pdbx_struct_assembly_gen.oper_expression","_pdbx_struct_assembly_gen.asym_id_list"];for(var u=1;u<s.length;u++){var a=e.cifitems[s[u]];a?o.push(a.value):o.push("?")}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly_gen.assembly_id"),v=s.indexOf("_pdbx_struct_assembly_gen.oper_expression"),m=s.indexOf("_pdbx_struct_assembly_gen.asym_id_list"),c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(f==-1||v==-1||m==-1){p+=c;continue}var g=o[p+v],y=[];if(g.indexOf(/\)\s*\(/)==-1){var b=g.split(")");for(var w=0;w<b.length;w++){var E=b[w].replace(/\(/g,""),S=E.split(",");for(var x=0;x<S.length;x++){var T=/^(\d+)-(\d+)$/.exec(S[x]);if(T&&T.length==3){var N=parseInt(T[1]),C=parseInt(T[2]);for(var k=N;k<=C;k++)y.push(k+"")}else S[x].length>0&&y.push(S[x])}}}if(!t[o[p+f]]){var L=o[p+m].split(","),A=[];for(var O=0;O<L.length;O++)A[L[O]]=y;t[o[p+f]]={id:o[p+f],details:"",ops:y,opsByChain:A,chains:L,mats:[]},n++}else{var L=o[p+m].split(","),A=[];for(var O=0;O<L.length;O++)if(!t[o[p+f]].opsByChain[L[O]])t[o[p+f]].opsByChain[L[O]]=y.slice();else for(var w=0;w<y.length;w++)t[o[p+f]].opsByChain[L[O]].push(y[w]);t[o[p+f]].ops=t[o[p+f]].ops.concat(y),t[o[p+f]].chains=t[o[p+f]].chains.concat(L)}p+=c}}if(n>0){var M=[],_=e.cifitems["_pdbx_struct_oper_list.id"];if(_){var D=["_pdbx_struct_oper_list.id","_pdbx_struct_oper_list.matrix[1][1]","_pdbx_struct_oper_list.matrix[1][2]","_pdbx_struct_oper_list.matrix[1][3]","_pdbx_struct_oper_list.vector[1]","_pdbx_struct_oper_list.matrix[2][1]","_pdbx_struct_oper_list.matrix[2][2]","_pdbx_struct_oper_list.matrix[2][3]","_pdbx_struct_oper_list.vector[2]","_pdbx_struct_oper_list.matrix[3][1]","_pdbx_struct_oper_list.matrix[3][2]","_pdbx_struct_oper_list.matrix[3][3]","_pdbx_struct_oper_list.vector[3]"],i=e.cifloops[_.id],s=[],o=[];if(!i){o.push(_.value),s.push(D[0]);for(var u=1;u<D.length;u++){var a=e.cifitems[D[u]];a?o.push(a.value):o.push("?"),s.push(D[u])}}else s=i.loopheads,o=i.loopvalues;var f=s.indexOf("_pdbx_struct_assembly_gen.assembly_id"),P=[];for(var u=0;u<D.length;u++)P[D[u]]=s.indexOf(D[u]);var c=s.length,h=o.length/c,p=0;for(var d=0;d<h;++d){if(P[D[0]]==-1){p+=c;continue}var H=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],B=o[p+P[D[0]]],j=0,F=0;for(var u=1;u<D.length;u++){if(P[D[u]]>-1){var I=parseFloat(o[p+P[D[u]]]);isNaN(I)||(H[F][j]=I)}u>3&&u%4==0?(j++,F=0):F++}M[B]=H,p+=c}}for(var q in t){t[q].matsById=[];for(var w=0;w<t[q].ops.length;w++)M[t[q].ops[w]]&&(t[q].mats.push(M[t[q].ops[w]]),t[q].matsById[t[q].ops[w]]=M[t[q].ops[w]])}return t}return null},e._block.prototype.getBiomol=function(e){function K(e,t,n,r){var i=r[0][0]*e+r[1][0]*t+r[2][0]*n+r[3][0],s=r[0][1]*e+r[1][1]*t+r[2][1]*n+r[3][1],o=r[0][2]*e+r[1][2]*t+r[2][2]*n+r[3][2];return[i,s,o]}var t=this;if(this.biomols&&this.biomols[e])return this.biomols[e];this.biomols||(this.biomols=[]);if(!this.assemblies||!this.assemblies[e])return null;var n=this.assemblies[e],r=[];if(n.ops&&n.ops.length>10)return null;var i=!1,s=[],o=[],u=n.id,a=t.model.asu;for(var f in n.matsById)for(var l in a){var c=a[l];if(c==undefined)continue;if(n.chains.indexOf(c.chain)==-1)continue;var h=[c.x,c.y,c.z];if(!n.opsByChain[c.chain])continue;var p=!1;for(var d=0;d<n.opsByChain[c.chain].length;d++)if(n.opsByChain[c.chain][d]==f){p=!0;break}if(!p)continue;var v=K(c.x,c.y,c.z,n.matsById[f]),m=[],g="";if(c.hetflag||c.ligandid){for(var y=0;y<c.bonds.length;y++)m.push(c.bonds[y]+"_"+u+"_"+f);if(c.ligandid){g=c.ligandid+"_"+u+"_"+f;if(!t.ligands[c.resn][c.ligandid+"_"+u+"_"+f]){var b=t.ligands[c.resn][c.ligandid],w={name:c.ligandid+"_"+u+"_"+f,siteids:[],dims:[],pocketids:[],pocketdims:[],assembly:u,assembly_m:f};for(var E=0;E<b.siteids.length;E++)w.siteids.push(b.siteids[E]+"_"+u+"_"+f);for(var S=0;S<b.pocketids.length;S++)w.pocketids.push(b.pocketids[S]+"_"+u+"_"+f);t.ligands[c.resn][c.ligandid+"_"+u+"_"+f]=w,o.push({resn:c.resn,id:c.ligandid+"_"+u+"_"+f})}}}i=!0,s[l+"_"+u+"_"+f]={resn:c.resn,x:v[0],y:v[1],z:v[2],elem:c.elem,hetflag:c.hetflag,chain:c.chain,resi:c.resi,idx:l+"_"+u+"_"+f,atom:c.atom,ss:c.ss,color:16777215,bonds:m,bondOrder:c.bondOrder,b:c.b,ligandid:g,pocket:!1},r[c.resn+"_"+c.resi+"_"+c.chain]||(r[c.resn+"_"+c.resi+"_"+c.chain]=[]),r[c.resn+"_"+c.resi+"_"+c.chain].push(l+"_"+u+"_"+f)}if(i){t.model.biomols[e]={assembly:n,sites:s};for(var w=0;w<o.length;w++){var x=t.ligands[o[w].resn][o[w].id],T=x.siteids,N,C,k,L,A,O,M=ysum=zsum=cnt=0,_=[],D=0;for(var E=0;E<T.length;E++){var P=s[T[E]];E==0&&(L=P.x,A=P.y,O=P.z,N=P.x,C=P.y,k=P.z),P.x<L&&(L=P.x),P.y<A&&(A=P.y),P.z<O&&(O=P.z),P.x>N&&(N=P.x),P.y>C&&(C=P.y),P.z>k&&(k=P.z),cnt++,M+=P.x,ysum+=P.y,zsum+=P.z;for(var l in s){var H=s[l];if(H==undefined)continue;if(H.resn!=P.resn&&!H.hetflag&&!_[l]){var B=(P.x-H.x)*(P.x-H.x)+(P.y-H.y)*(P.y-H.y)+(P.z-H.z)*(P.z-H.z);B<36&&(_[l]=H.idx,D++)}}}x.dims=[[L,A,O],[N,C,k],[M/cnt,ysum/cnt,zsum/cnt]];var j=[],F=[];F.length=0;for(var S in _){j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain]||(j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain]=[]),j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].indexOf(S)==-1&&j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].push(S),F.push(S);if(r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain])for(var l=0;l<r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].length;l++){var H=s[r[s[S].resn+"_"+s[S].resi+"_"+s[S].chain][l]];if(H==undefined)continue;if(!_[H.idx]&&H.resn==s[S].resn&&H.resi==s[S].resi&&H.chain==s[S].chain){if(j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].indexOf(H.idx)>-1)continue;j[s[S].resn+"_"+s[S].resi+"_"+s[S].chain].push(H.idx),F.push(H.idx),D++}}}var I,q,R,U,z,W;for(var e=0;e<F.length;e++){var X=s[F[e]];e==0&&(U=X.x,z=X.y,W=X.z,I=X.x,q=X.y,R=X.z),X.x<U&&(U=X.x),X.y<z&&(z=X.y),X.z<W&&(W=X.z),X.x>I&&(I=X.x),X.y>q&&(q=X.y),X.z>R&&(R=X.z)}x.pocketids=F.slice(0),x.pocketdims=[[U,z,W],[I,q,R]];for(var V in j){var T=j[V];for(var E=0;E<T.length;E++){var P=s[T[E]];P.pocket=!0;for(var $=E+1;$<T.length;$++){var H=s[T[$]];H.pocket=!0;var J=Math.sqrt((P.x-H.x)*(P.x-H.x)+(P.y-H.y)*(P.y-H.y)+(P.z-H.z)*(P.z-H.z));J<(this.elements[P.elem].covRad+this.elements[H.elem].covRad)*1.3&&(P.bonds.push(T[$]),P.bondOrder.push(1),H.bonds.push(T[E]),H.bondOrder.push(1))}}}}}return this.model.biomols[e]},e._block.prototype.getBioligandData=function(){var e=this,t=[],n=e.cifitems["_chem_comp.id"];if(n){var r=e.cifloops[n.id],i=[],s=[];if(!r){s.push(n.value),i=["_chem_comp.id","_chem_comp.type","_chem_comp.name"];for(var o=1;o<i.length;o++){var u=e.cifitems[i[o]];u?s.push(u.value):s.push("?")}}else i=r.loopheads,s=r.loopvalues;var a=i.indexOf("_chem_comp.id"),f=i.indexOf("_chem_comp.type"),l=i.indexOf("_chem_comp.name"),c=i.length,h=s.length/c,p=0,d=0;for(var v=0;v<h;++v){if(a==-1||f==-1){p+=c;continue}var m=s[p+f].toUpperCase();if(m=="NON-POLYMER"||m.indexOf("SACCHARID")>-1||m=="OTHER")l>-1?t[s[p+a]]=s[p+l]:t[s[p+a]]=s[p+a],d++;p+=c}if(d>0)return t}return null},e._cifitem=function(e,t,n,r,i,s){return this.id=e,this.dataname=t,this.datablockid=n,this.value=r,this.looped=i,this.loop=s,this},e._cifitem.prototype.getValues=function(){return this.looped?this.loop.getValuesByDataname(this.dataname):[this.value]},e._cifloop=function(e,t,n,r){return this.id=e,this.datablockid=t,this.loopheads=n,this.loopvalues=r,this},e._cifloop.prototype.getValuesByDataname=function(e){var t=this.loopheads.indexOf(e);if(t==-1)return[];var n=[],r=this.loopheads.length;for(var i=0;i<this.loopvalues.length;++i){var s=i;s>=r&&(s=i%r),s==t&&n.push(this.loopvalues[i])}return n},e.prototype.parseCif=function(t,n){function b(t,n,i){var s=i.replace(/^\s+|\s+$/g,""),o=[],u=s.substr(0,s.search(/(\s|$)/));return u=="_",i=i.substr(i.indexOf(u)+u.length),r&&(l+=i.substring(0,i.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_dataitem"><span class="cif_dataname">'+u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),d=1,i=w(1,o,n,i),r&&(l+="</span>"),u=u.toLowerCase(),u.search(/^(_space_group_ssg_name|_space_group_ssg_name_it|_space_group_ssg_name_wjj|_space_group_symop_ssg_id|_space_group_symop_ssg_operation_algebraic)$/)>-1&&(t.mscif=!0),t.cifitems[u]=new e._cifitem(u,u,a,o[0],!1),i}function w(e,t,n,i,s){var o="",u="",a="",c=/^\s*("|')(.*?)(\1)(\s|$)/,h=/^\s*([^\s]+)(\s|$)/,p=/^\s*(data_|loop_|save_|_)/i,v=!1;for(;;){if(i==""||i.replace(/^\s+|\s+$/g,"")==""){r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(n.length==0)break;i=n.shift();if(i==undefined)break;f.push(i)}u=i.replace(/^\s+|\s+$/g,"");if(a=="")if(u.substr(0,1)=="#"||u=="")r&&(u.substr(0,1)=="#"?l+='<span class="cif_comment">'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>":l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i="";else{if(i.search(p)==0)break;if(i.search(/^\s*("|')/)==0){var g=i.match(c);if(g){r&&(l+=i.substring(0,g.index).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+' <span class="cif_datavalue"><span class="cif_delimiter">'+g[1]+'</span><span class="cif_value">'+g[2].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</span><span class="cif_delimiter">'+g[3]+"</span></span> "),t.push(g[2]);var y=g.index+g[0].length;i=i.substr(y)}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_error">#ERROR</span>'),m.push("ERROR: missing closing delimiter (line "+f.length+")"),t.push(i),i="";if(e==1)break}else if(i.indexOf(";")==0)v=!0,r&&(l+='<span class="cif_datavalue"><span class="cif_delimiter">;</span><span class="cif_value">'+i.substr(1).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),o=i.substr(1)+"\n",a=";",i="";else{var g=i.match(h);if(g){r&&(l+=i.substring(0,g.index).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+' <span class="cif_datavalue"><span class="cif_delimiter"></span><span class="cif_value">'+g[1].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</span><span class="cif_delimiter"></span></span> '),t.push(g[1]);var y=g.index+g[0].length;i=i.substr(y)}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),t.push(i),i="";if(e==1)break}}else if(i.indexOf(";")==0){v=!1,r&&(l+='</span><span class="cif_delimiter">;</span></span>'),o.replace(/^;|\n$/g,""),i=i.substr(1),t.push(o),o="",a="";if(e==1){d=0;break}}else r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),o+=i+"\n",i=""}return v&&(m.push("ERROR: unclosed data value (line "+f.length+")"),r&&(l+='</span><span class="cif_error">#ERROR</span></span>\n')),t.length==0&&(m.push("ERROR: missing data value (line "+f.length+")"),r&&(l+='<span class="cif_error">#ERROR</span>\n')),d=0,i}function E(e,t,n,r,i){var s="",o=/^\s*(data_|loop_|save_|_)/i;for(;;){if(r==""||r.replace(/^\s+|\s+$/g,"")==""){if(n.length==0)break;r=n.shift();if(r==undefined)break;f.push(r)}s=r.replace(/^\s+|\s+$/g,"");if(s.substr(0,1)=="#"||s=="")r="";else{if(s.search(o)==0)break;var u=s.replace(/\s+/g," ").split(" ");for(var a=0;a<u.length;a++)t.push(u[a]);r=""}}return r}function S(t,n,i){d=2;var s=[],o=[],u,c=!1,h=i.search(/loop_/i);r&&(l+=i.substring(0,h).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<div class="cif_loop"><span class="cif_loop_keyword">loop_</span>'),i=i.substr(h+5);for(;;){if(i==""||i.replace(/^\s+|\s+$/g,"")==""){r&&(l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(n.length==0)break;i=n.shift();if(i==undefined)break;f.push(i)}u=i.replace(/^\s+|\s+$/g,"");if(u.substr(0,5).toLowerCase()=="data_"||u.substr(0,5).toLowerCase()=="save_"){r&&(m.push("ERROR: found new datablock while looking for loop (line "+f.length+")"),l+="#ERROR:#\n");break}if(u.substr(0,5).toLowerCase()=="loop_"){m.push("ERROR: found loop_ keyword while already in loop (line "+f.length+")"),r&&(l+="#ERROR:#\n");break}if(u.substr(0,1)=="_"){var p=u.substr(0,u.search(/(\s|$)/));h=i.indexOf(p)+p.length,r&&(l+=i.substring(0,i.indexOf(p)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_dataname">'+p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>");var v=p.toLowerCase();o.push(v),v.indexOf("_atom_site.cartn_")==0&&(c=!0),i=i.substr(h)}else{if(u.substr(0,1)!="#"&&u!=""){t.mmcifmol&&c?i=E(0,s,n,i):i=w(0,s,n,i);break}r&&(u.substr(0,1)=="#"?l+='<span class="cif_comment">'+i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>":l+=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i=""}}d==2&&(d=0),s.length==0?m.push("ERROR: loop with no data values (line "+f.length+")"):o.length>0&&s.length%o.length!=0&&m.push("ERROR: loop imbalance (line "+f.length+")"),o.length==0&&m.push("ERROR: loop with no data names (line "+f.length+")"),r&&(l+="</div>");var g=o.join(" "),y=new e._cifloop(g,a,o,s);t.cifloops[g]=y;for(var b=0;b<o.length;b++)t.cifitems[o[b]]=new e._cifitem(g,o[b],a,null,!0,y);return g.indexOf("_atom_site_fract_")>-1&&(t.structure=!0),g.indexOf("_cifmol_atom_site_id")>-1&&(t.cifmol=!0),g.indexOf("_atom_site.cartn_")>-1&&(t.structure=!0,t.mmcif=!0),g.search(/(_space_group_ssg_name|_space_group_ssg_name_it|_space_group_ssg_name_wjj|_space_group_symop_ssg_id|_space_group_symop_ssg_operation_algebraic)/)>-1&&(t.mscif=!0),i}var r=!1;n&&n.indexOf("tagged_html")>-1&&(r=!0),this.blocks=[];var i=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"),s=new Date,o=parseInt(s.getTime()),u="",a="",f=[],l="",c="",h="",p=0,d=-1,v=!1,m=[];for(;;){p++;if(c==""||c.replace(/^\s*|\s*$/g,"")==""){r&&(l+=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n");if(i.length==0)break;c=i.shift();if(c==undefined)break;f.push(c)}p==1&&c.indexOf("#\\#MMCIFMOL")==0&&(v=!0),h=c.replace(/^\s*|\s*$/g,"");if(h=="")c="";else if(u=="")h.substr(0,5).toLowerCase()=="data_"?(d=0,u=h.substring(0,h.search(/(\s|$)/)),u.toLowerCase()=="data_"?(a="ERROR"+o++,m.push("ERROR: datablock with no ID (line "+f.length+")")):a=u.substr(5),this.blocks[a]=new e._block(a),this.blocks[a].mmcifmol=v,r&&(l+=c.substring(0,c.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<div class="publcif_datablock"><span class="cif_datablock_id">data_'+a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=c.substr(c.indexOf(u)+u.length)):h.substr(0,1)!="#"?(r&&(l+='<span class="cif_error">'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),m.push("ERROR: unexpected string before first data block (line "+f.length+")"),c=""):(r&&(l+=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),c="");else if(h.substr(0,5).toLowerCase()=="data_"||h.substr(0,5).toLowerCase()=="save_"){d>0&&m.push("ERROR: expected data value but found a new data block (line "+f.length+")"),d=0;var g=h.substring(0,h.search(/(\s|$)/));if(g.toLowerCase()!="save_"){r&&(l+="</div>",this.blocks[a].taggedHTML=l,l="");var y=f.pop();this.blocks[a].rawdata=f.join("\n"),f.length=0,f.push(y),u=g,u.toLowerCase()=="data_"?(a="ERROR"+o++,m.push("ERROR: datablock with no ID (line "+f.length+")")):a=u.substr(5),r&&(l+='<div class="cif_datablock">'+c.substring(0,c.indexOf(u)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+'<span class="cif_datablock_id">data_'+a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=c.substr(c.indexOf(u)+u.length),this.blocks[a]=new e._block(a)}else c=""}else h.substr(0,5).toLowerCase()=="loop_"?c=S(this.blocks[a],i,c):h.substr(0,1)=="_"?c=b(this.blocks[a],i,c):h.substr(0,1)=="#"?(r&&(l+='<span class="cif_comment">'+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</span>"),c=""):(r&&(l+="#ERROR:"+c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),m.push("ERROR: unexpected string (line "+f.length+")"),c="")}d>0&&m.push("ERROR: expected data value but found end of file (line "+f.length+")"),r&&(l+="</div>",this.blocks[a].taggedHTML=l,l=""),this.blocks[a].rawdata=f.join("\n"),f.length=0},e.prototype._getValSu=function(e){e=e.replace(/^\s*\-\.(\d)/,"-0.$1"),e=e.replace(/^\s*\.(\d)/,"0.$1");var t="",n="",r="";e.match(/-[\d\.]+/g)&&(r="-");var i=e.match(/([\d\.]+)(\s*\(\d+\))?/);i!=null&&i.length>1&&(t=i[1]),i!=null&&i.length>2&&(n=i[2]);if(!t||t=="")return[0,0];if(!n||n=="")return[parseFloat(r+t),0];var s=0,o=t.match(/(\.\d+$)/);o!=null&&o.length>1&&(s=o[1].length-1),n=n.replace(/\(/g,""),n=n.replace(/\)/g,"");var u=parseInt(r+n),a=u/Math.pow(10,s);return isNaN(a)?[parseFloat(r+t),0]:[parseFloat(r+t),a]},e.prototype._quickRoundUp=function(e,t){var n=Math.pow(10,t||0),r=String(Math.round(e*n)/n),i=r.indexOf("."),s=0;i==-1?r+=t>0?".":"":s=r.length-i-1;for(var o=0;o<t-s;o++)r+="0";return r},e.prototype._xyzToUnitSu=function(e,t){var n=[0,0,0],r=this._xyzModulusSu(e,t);if(r[0]===0)return t?[[e[0],e[1],e[2]],[t[0],t[1],t[2]]]:[[e[0],e[1],e[2]],n];var i=e[0]/r[0],s=e[1]/r[0],o=e[2]/r[0],u=[i,s,o];if(t){var a=Math.sqrt((t[0]/e[0]*(t[0]/e[0])+r[1]/r[0]*(r[1]/r[0]))*i*i),f=Math.sqrt((t[1]/e[1]*(t[1]/e[1])+r[1]/r[0]*(r[1]/r[0]))*s*s),l=Math.sqrt((t[2]/e[2]*(t[2]/e[2])+r[1]/r[0]*(r[1]/r[0]))*o*o);n=[isNaN(a)?0:a,isNaN(f)?0:f,isNaN(l)?0:l]}return[u,n]},e.prototype._xyzModulusSu=function(e,t){var n=this._xyzDotSu(e,e,t,t),r=Math.sqrt(n[0]),i=0;return t&&(i=Math.sqrt(n[1]/n[0]*(n[1]/n[0])*.25*r*r)),isNaN(i)&&(i=0),[r,i]},e.prototype._xyzDotSu=function(e,t,n,r){var i=0,s=0;for(var o=0;o<3;o++){var u=e[o]*t[o];i+=u,n&&r&&(s+=(n[o]/e[o]*(n[o]/e[o])+r[o]/t[o]*(r[o]/t[o]))*u*u)}return n&&r&&(s=Math.sqrt(s)),isNaN(s)&&(s=0),[i,s]},e.prototype._xyzCrossSu=function(e,t,n,r){var i=e[1]*t[2],s=e[2]*t[1],o=i-s,u=0;if(n&&r){var a=Math.sqrt((n[1]/e[1]*(n[1]/e[1])+r[2]/t[2]*(r[2]/t[2]))*i*i),f=Math.sqrt((n[2]/e[2]*(n[2]/e[2])+r[1]/t[1]*(r[1]/t[1]))*s*s);u=Math.sqrt(a*a+f*f)}var l=e[2]*t[0],c=e[0]*t[2],h=l-c,p=0;if(n&&r){var d=Math.sqrt((n[2]/e[2]*(n[2]/e[2])+r[0]/t[0]*(r[0]/t[0]))*l*l),v=Math.sqrt((n[0]/e[0]*(n[0]/e[0])+r[2]/t[2]*(r[2]/t[2]))*c*c);p=Math.sqrt(d*d+v*v)}var m=e[0]*t[1],g=e[1]*t[0],y=m-g,b=0;if(n&&r){var w=Math.sqrt((n[0]/e[0]*(n[0]/e[0])+r[1]/t[1]*(r[1]/t[1]))*m*m),E=Math.sqrt((n[1]/e[1]*(n[1]/e[1])+r[0]/t[0]*(r[0]/t[0]))*g*g);b=Math.sqrt(w*w+E*E)}var S=[o,h,y],x=[isNaN(u)?0:u,isNaN(p)?0:p,isNaN(b)?0:b];return[S,x]},e.prototype._xyzSubtractSu=function(e,t,n,r){var i=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],s=[0,0,0];if(n&&r){var o=Math.sqrt(n[0]*n[0]+r[0]*r[0]),u=Math.sqrt(n[0]*n[0]+r[1]*r[1]),a=Math.sqrt(n[2]*n[2]+r[2]*r[2]);s=[isNaN(o)?0:o,isNaN(u)?0:u,isNaN(a)?0:a]}return[i,s]},e.prototype._xyzApplyMatrix=function(e,t){return[t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2]]},e.prototype._calcBondC=function(e,t,n,r){var i=t[0]-e[0],s=t[1]-e[1],o=t[2]-e[2],u=Math.sqrt(i*i+s*s+o*o),a=0;if(n&&r){var f=n[0]*n[0],l=r[0]*r[0],c=n[1]*n[1],h=r[1]*r[1],p=n[2]*n[2],d=r[2]*r[2],v=f+l,m=c+h,g=p+d,y=v*(i/u)*(i/u),b=m*(s/u)*(s/u),w=g*(o/u)*(o/u),E=y+b+w;a=Math.sqrt(E),isNaN(a)&&(a=0)}return[u,a]},e.prototype._calcAngleC=function(e,t,n,r,i,s){var o=this._calcBondC(e,t,r,i),u=o[0],a=o[1],f=this._calcBondC(t,n,i,s),l=f[0],c=f[1],h=this._calcBondC(e,n,r,s),p=h[0],d=h[1],v=u*u,m=l*l,g=p*p,y=v+m-g,b=2*u*l,w=y/b,E=Math.acos(w)*(180/Math.PI);if(a==0||c==0||d==0)return[E,0];var S=a/u*(a/u)*4*v*v,x=c/l*(c/l)*4*m*m,T=d/p*(d/p)*4*g*g,N=Math.sqrt(S+x+T),C=Math.sqrt((2*(a/u)*(a/u)+c/l*(c/l))*b*b),k=Math.sqrt((N/y*(N/y)+C/b*(C/b))*w*w),L=-1/Math.sqrt(1-w*w);return L=L*L*k*k,L=Math.sqrt(L)*(180/Math.PI),[E,isNaN(L)?0:L]},e.prototype._calcTorsionC=function(e,t,n,r,i,s,o,u){var a=this._xyzSubtractSu(e,t,i,s),f=this._xyzSubtractSu(t,n,s,o),l=this._xyzSubtractSu(n,r,o,u),c=a[0],h=f[0],p=l[0],d=a[1],v=f[1],m=l[1],g=this._xyzCrossSu(c,h,d,v),y=g[0],b=g[1],w=this._xyzCrossSu(h,p,v,m),E=w[0],S=w[1],x=this._xyzToUnitSu(y,b);y=x[0],b=x[1];var T=this._xyzToUnitSu(E,S);E=T[0],S=T[1];var N=this._xyzToUnitSu(h,v);h=N[0],v=N[1];var C=this._xyzCrossSu(y,h,b,v),k=C[0],L=C[1],A=this._xyzDotSu(y,E,b,S),O=this._xyzDotSu(k,E,L,S),M=Math.atan2(O[0],A[0])*(180/Math.PI),_=O[0],D=A[0],P=_*_,H=D*D,B=P+H,j=Math.sqrt(-_/B*(-_/B)*A[1]*A[1]+D/B*(D/B)*O[1]*O[1])*(180/Math.PI);return[M,isNaN(j)?0:j]},e}();(function(Scif){Scif.prototype._getCellData=function(e){var t={},n="",r="",i="",s="",o="",u="",a="";e.cifitems._symmetry_cell_setting&&(n=e.cifitems._symmetry_cell_setting.value),e.cifitems._cell_length_a&&(r=e.cifitems._cell_length_a.value),e.cifitems._cell_length_b&&(i=e.cifitems._cell_length_b.value),e.cifitems._cell_length_c&&(s=e.cifitems._cell_length_c.value),i.search(/^\s*[\.\?]*\s*$/)>-1&&(i=r),s.search(/^\s*[\.\?]*\s*$/)>-1&&(s=r),t.a=this._getValSu(r)[0],t.b=this._getValSu(i)[0],t.c=this._getValSu(s)[0],e.cifitems._cell_angle_alpha&&(o=e.cifitems._cell_angle_alpha.value),e.cifitems._cell_angle_beta&&(u=e.cifitems._cell_angle_beta.value),e.cifitems._cell_angle_gamma&&(a=e.cifitems._cell_angle_gamma.value);if(o.search(/^\s*[\.\?]*\s*$/)>-1||u.search(/^\s*[\.\?]*\s*$/)>-1||a.search(/^\s*[\.\?]*\s*$/)>-1)typeof n=="string"?(n=n.toUpperCase(),n=="RHOMBOHEDRAL"||n=="TRIGONAL"||n=="HEXAGONAL"?(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="120")):(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="90"))):(o.search(/^\s*[\.\?]*\s*$/)>-1&&(o="90"),u.search(/^\s*[\.\?]*\s*$/)>-1&&(u="90"),a.search(/^\s*[\.\?]*\s*$/)>-1&&(a="90"));t.alpha=this._getValSu(o)[0]*(Math.PI/180),t.beta=this._getValSu(u)[0]*(Math.PI/180),t.gamma=this._getValSu(a)[0]*(Math.PI/180),t.cosAlpha=Math.cos(t.alpha),t.sinAlpha=Math.sin(t.alpha),t.cosBeta=Math.cos(t.beta),t.sinBeta=Math.sin(t.beta),t.cosGamma=Math.cos(t.gamma),t.sinGamma=Math.sin(t.gamma);var f=Math.sqrt(t.sinAlpha*t.sinAlpha+t.sinBeta*t.sinBeta+t.sinGamma*t.sinGamma+2*t.cosAlpha*t.cosBeta*t.cosGamma-2);return t.volume=t.a*t.b*t.c*f,t.cA_=(t.cosAlpha-t.cosBeta*t.cosGamma)/t.sinGamma,t.cB_=f/t.sinGamma,t.a_=t.b*t.c*t.sinAlpha/t.volume,t.b_=t.a*t.c*t.sinBeta/t.volume,t.c_=t.a*t.b*t.sinGamma/t.volume,e.cell=t,t},Scif.prototype._getF2Cmatrix=function(e){if(!e)return null;if(e.F2Cmatrix)return e.F2Cmatrix;e.cell||this._getCellData(e);var t=e.cell.a,n=e.cell.b,r=e.cell.c,i=e.cell.alpha,s=e.cell.beta,o=e.cell.gamma,u=e.cell.cosAlpha,a=e.cell.cosBeta,f=e.cell.cosGamma;e._bpars={asq:t*t,bsq:n*n,csq:r*r,cosa2bc:u*2*n*r,cosb2ac:a*2*t*r,cosg2ab:f*2*t*n},e.calcBondF=function(e,t,n){return Math.sqrt(this._bpars.asq*e*e+this._bpars.bsq*t*t+this._bpars.csq*n*n+this._bpars.cosa2bc*t*n+this._bpars.cosb2ac*e*n+this._bpars.cosg2ab*e*t)};var l=Math.sin(o),c=t,h=n*f,p=r*a,d=0,v=n*l,m=r*(u-a*f)/l,g=0,y=0,b=r/l,w=u*u,E=a*a,S=f*f,x=1-(w+E+S)+2*u*a*f,T=Math.sqrt(x);b*=T;var N=[[c,h,p],[d,v,m],[g,y,b]];return e.F2Cmatrix=N,N},Scif.prototype._getF2CmatrixCell=function(e){return e?e.F2CmatrixCell?e.F2CmatrixCell:(e.F2Cmatrix||this._getF2Cmatrix(e),e.F2Cmatrix?(e.F2CmatrixCell=[[e.F2Cmatrix[0][0],0,0],[e.F2Cmatrix[0][1],e.F2Cmatrix[1][1],0],[e.F2Cmatrix[0][2],e.F2Cmatrix[1][2],e.F2Cmatrix[2][2]]],e.F2CmatrixCell):null):null},Scif.prototype._getC2Fmatrix=function(e){if(!e)return null;if(e.C2Fmatrix)return e.C2Fmatrix;e.cell||this._getCellData(e);var t=e.cell.a,n=e.cell.b,r=e.cell.c,i=e.cell.alpha,s=e.cell.beta,o=e.cell.gamma,u=e.cell.cosAlpha,a=e.cell.cosBeta,f=e.cell.cosGamma,l=Math.sin(o),c=u*u,h=a*a,p=f*f,d=1-(c+h+p)+2*u*a*f,v=1/(t*n*r*Math.sqrt(d)),m=1/t,g=-1*(f/(t*l)),y=(n*f*r*(u-a*f)/l-n*r*a*l)*v,b=0,w=1/(n*l),E=-1*(v*t*r*(u-a*f)/l),S=0,x=0,T=t*n/l*v,N=[[m,g,y],[b,w,E],[S,x,T]];return e.C2Fmatrix=N,N},Scif.prototype._getSymOps=function(e){function d(e){var t={},n=e.replace(/\s+/ig,"");n=n.toLowerCase(),t.full=n;var r=n.split(",");if(r.length!=3)return null;var i=m(e);t.rotmat=i[0],t.transvec=i[1],t.xpart=r[0],t.ypart=r[1],t.zpart=r[2];var s=v(t.xpart+"");if(!s)return null;t.xchar=s[0],t.xnum=s[1];var o=v(t.ypart+"");if(!o)return null;t.ychar=o[0],t.ynum=o[1];var u=v(t.zpart+"");return u?(t.zchar=u[0],t.znum=u[1],t):null}function v(e){var t=e,n=new RegExp("([-+]*[1-9]*[xyz])","gi"),r=t.match(n);if(!r||r.length==0)return null;var i="";for(var s=0;s<r.length;++s)i+=r[s];var o=t.replace(n,"");return[i,o]}function m(e){var t=[[0,0,0],[0,0,0],[0,0,0]],n=[0,0,0],r=e.replace(/\s+/ig,"").toLowerCase().split(","),i=new RegExp("([+-]?)(\\d*)/?(\\d*)([x-z])","gi"),s=new RegExp("([+-]?)(\\d+)/?(\\d*)(?![x-z])","gi");for(var o=0;o<r.length;o++){var u;while((u=i.exec(r[o]))!==null){var a=1;u[1]=="-"&&(a=-1),u[2]!=""&&(u[3]!=""?a*=parseFloat(u[2])/parseFloat(u[3]):a*=parseFloat(u[2]));var f=u[4].charCodeAt(0)-120;t[o][f]=a}var l;while((l=s.exec(r[o]))!==null){var a=1;l[1]=="-"&&(a=-1);var c=parseFloat(l[2]);l[3]!=""&&(c=parseFloat(l[2])/parseFloat(l[3])),n[o]+=c*a}}return[t,n]}if(!e)return null;if(e.symOps)return e.symOps;var t=[],n="_symmetry_equiv_pos_as_xyz",r=e.cifitems[n];r||(n="_space_group_symop_operation_xyz",r=e.cifitems[n]);var i=!1;r||(n="_space_group_symop_ssg_operation_algebraic",r=e.cifitems[n],r&&(i=!0));if(!r)t.push("x,y,z");else if(!r.looped)t.push(r.value);else{var s=e.cifloops[r.id],o=s.loopheads.indexOf(n),u=s.loopvalues.length/s.loopheads.length,a=0;for(var f=0;f<u;++f)t.push(s.loopvalues[o+a]),a+=s.loopheads.length}var l=[];for(var c=0;c<t.length;c++){if(i){t[c]=t[c].replace(/x1/gi,"x"),t[c]=t[c].replace(/x2/gi,"y"),t[c]=t[c].replace(/x3/gi,"z");var h=t[c].split(",");h&&h.length>2?t[c]=h[0]+","+h[1]+","+h[2]:t[c]=""}var p=d(t[c]);p&&(l[c+1]=p)}return e.symOps=l,l},Scif.prototype._transformSymCode=function(e,t){function h(e,t){var n="";if(e!=""){var r=e.indexOf("/");if(r>0){var i=e.match(/(^[^\d\-\+]*)([\-\+]?\d+)\/(\d+)([^\d]*$)/),s=i[2],o=i[3],u=parseInt(o)*t+parseInt(s);n=i[1]+"+"+u+"/"+o+i[4]}else{var a=parseInt(e)+t;a>0?n="+"+a:a<0?n=a+"":n=""}}else t>0?n="+"+t:t<0?n=t+"":n="";return n=String(n),n=n.replace(/[+][-]/g,"-"),n=n.replace(/[-][+]/g,"-"),n}if(!e)return null;e.symOps||this._getSymOps(e);if(!e.symOps)return null;var n=e.symOps,r={};t.search(/^\d+$/)==0&&(t+="_555");var i=t.match(/(\d+)_(\d)(\d)(\d)/);if(i){var s=n[parseInt(i[1])],o=parseInt(i[2])-5,u=parseInt(i[3])-5,a=parseInt(i[4])-5,f=h(String(s.xnum),o),l=h(String(s.ynum),u),c=h(String(s.znum),a),r={};return r.full=s.xchar+f+","+s.ychar+l+","+s.zchar+c,r.xpart=s.xchar+f,r.ypart=s.ychar+l,r.zpart=s.zchar+c,r.xchar=s.xchar,r.xnum=f,r.ychar=s.ychar,r.ynum=l,r.zchar=s.zchar,r.znum=c,r}return null},Scif.prototype._getGeomData=function(e){if(!e)return;var t=0,n=[],r=[],i=[],s=[],o=e.cifitems._geom_bond_distance;if(o){var u=e.cifloops[o.id],a=u.loopheads,f=u.loopvalues,l=a.indexOf("_geom_bond_atom_site_label_1"),c=a.indexOf("_geom_bond_atom_site_label_2"),h=a.indexOf("_geom_bond_site_symmetry_1"),p=a.indexOf("_geom_bond_site_symmetry_2"),d=a.indexOf("_geom_bond_distance");if(l==-1||c==-1||d==-1){e.geomdata={},e.geomdata.bonds=r,e.geomdata.bondcount=0,e.geomdata.bondsByLabel=i,e.geomdata.bondSites=s,e.geomdata.symRange=[5,5,5,5,5,5];return}for(var v=0;v<f.length;v+=a.length){var m=parseFloat(f[v+d]);if(m>3||m<.8)continue;var g=f[v+l],y=f[v+c],b="",w="";h>-1&&f[v+h]!="."&&f[v+h]!="?"?f[v+h].length<5?(b=f[v+h],w="555"):(b=f[v+h].substring(0,f[v+h].length-4),w=f[v+h].substring(f[v+h].length-3)):(b="1",w="555"),r[g+"_"+b+"_"+w]||(r[g+"_"+b+"_"+w]=[]);var E="",S="";p>-1&&f[v+p]!="."&&f[v+p]!="?"?f[v+p].length<5?(E=f[v+p],S="555"):(E=f[v+p].substring(0,f[v+p].length-4),S=f[v+p].substring(f[v+p].length-3)):(E="1",S="555"),r[y+"_"+E+"_"+S]||(r[y+"_"+E+"_"+S]=[]),n.indexOf(w)==-1&&n.push(w),n.indexOf(S)==-1&&n.push(S),i[g]||(i[g]=[]),i[g].indexOf(y)==-1&&(i[g].push(y),i[g].push(parseFloat(f[v+d]))),i[y]||(i[y]=[]),i[y].indexOf(g)==-1&&(i[y].push(g),i[y].push(parseFloat(f[v+d]))),r[g+"_"+b+"_"+w].indexOf(y+"_"+E+"_"+S)==-1&&(r[g+"_"+b+"_"+w].push(y+"_"+E+"_"+S),t++),r[y+"_"+E+"_"+S].indexOf(g+"_"+b+"_"+w)==-1&&(r[y+"_"+E+"_"+S].push(g+"_"+b+"_"+w),t++),w!="555"&&s.push([g,b,w]),S!="555"&&s.push([y,E,S])}}e.geomdata={},e.geomdata.bonds=r,e.geomdata.bondcount=t,e.geomdata.bondsByLabel=i,e.geomdata.bondSites=s;var x=5,T=5,N=5,C=5,k=5,L=5;if(n.length>0){for(var A=0;A<n.length;A++){var O=/.*(\d)(\d)(\d).*/.exec(n[A]);if(O){var M=parseInt(O[1]),_=parseInt(O[2]),D=parseInt(O[3]);M>x&&(x=M),M<C&&(C=M),_>T&&(T=_),_<k&&(k=_),D>N&&(N=D),D<L&&(L=D)}}txmin=C,tymin=k,tzmin=L,txmax=x,tymax=T,tzmax=N}e.geomdata.symRange=[C,k,L,x,T,N]},Scif.prototype._getModelSet=function(e,t,n,r){if(!e)return null;this.readyCallback=r;var i;if(typeof t=="string"){var s=t.match(/.*([2-8])([2-8])([2-8])\-?([2-8])([[2-8])([2-8]).*/);s?(i=[s[1],s[2],s[3],s[4],s[5],s[6]],t=i.join("")+""):t=null}e.model||this._getModelSites(e,i),i&&e.model.symRangeStr!=t&&this._getModelSites(e,i),e.mmcif&&n&&n.indexOf("cell")>-1&&(n="asu");var o;if(!n||n=="mol")e.model.mol?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"mol");else if(n=="cell555")e.model.cell555?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"cell555");else if(n=="cell5551")e.model.cell5551?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"cell5551");else if(n=="asu")e.model.asu?typeof this.readyCallback=="function"&&this.readyCallback():this._getModel(e,"asu");else if(n.substr(0,6)=="biomol"){var u=parseInt(n.substr(6));e.model.biomols[u]?(e.model.mol=e.model.biomols[u].sites,typeof this.readyCallback=="function"&&this.readyCallback()):(e.getBiomol(u),e.model.mol=e.model.biomols[u].sites,typeof this.readyCallback=="function"&&this.readyCallback())}},Scif.prototype._getModel=function(e,t){function g(t){if(l[t]){var r=l[t];for(var s in i){if(!i[s]||!i[s].fxyz||r==s)continue;if(i[r].bonds.indexOf(s)>-1)continue;var o=e.calcBondF(i[s].fxyz[0]-i[r].fxyz[0],i[s].fxyz[1]-i[r].fxyz[1],i[s].fxyz[2]-i[r].fxyz[2]);o<n.elements[i[r].elem].covRad+n.elements[i[s].elem].covRad+.4&&(i[r].bonds.push(s),i[s].bonds.push(r),i[r].bondOrder.push(1),i[s].bondOrder.push(1),a[i[r].atom]||(a[i[r].atom]=[]),a[i[r].atom].push(i[s].atom),a[i[r].atom].push(o),a[i[s].atom]||(a[i[s].atom]=[]),a[i[s].atom].push(i[r].atom),a[i[s].atom].push(o),f[i[r].atom]||(f[i[r].atom]=[]),f[i[r].atom].indexOf(i[s].atom)==-1&&f[i[r].atom].push(i[s].atom),f[i[s].atom]||(f[i[s].atom]=[]),f[i[s].atom].indexOf(i[r].atom)==-1&&f[i[s].atom].push(i[r].atom))}h.indexOf(r)==-1&&i[r].bonds.length>0&&(h[h.length]=r),t++,setTimeout(function(){g(t)},0)}else e.geomdata.bondsByLabel=a,e.geomdata.bonds=f
,e.geomdata.bondcount=1,c=!1,setTimeout(function(){y(0)},0)}function y(t){if(!h[t]){var d=[];if(r&&r!="mol"){for(var v in i){if(!i[v]&&!i[v].atom)continue;r=="cell5551"&&i[v].cell5551?(i[v].xyz=n._xyzApplyMatrix(i[v].fxyz,e.F2Cmatrix),i[v].xyzSu=n._xyzApplyMatrix(i[v].fxyzSu,e.F2Cmatrix),i[v].x=i[v].xyz[0],i[v].y=i[v].xyz[1],i[v].z=i[v].xyz[2],d[v]=i[v]):r=="cell555"&&i[v].cell555?(i[v].xyz=n._xyzApplyMatrix(i[v].fxyz,e.F2Cmatrix),i[v].xyzSu=n._xyzApplyMatrix(i[v].fxyzSu,e.F2Cmatrix),i[v].x=i[v].xyz[0],i[v].y=i[v].xyz[1],i[v].z=i[v].xyz[2],d[v]=i[v]):r=="asu"&&i[v].asu&&(i[v].xyz=n._xyzApplyMatrix(i[v].fxyz,e.F2Cmatrix),i[v].xyzSu=n._xyzApplyMatrix(i[v].fxyzSu,e.F2Cmatrix),i[v].x=i[v].xyz[0],i[v].y=i[v].xyz[1],i[v].z=i[v].xyz[2],d[v]=i[v])}r=="cell555"?e.model.cell555=d:r=="cell5551"?e.model.cell5551=d:r=="asu"&&(e.model.asu=d),typeof n.readyCallback=="function"&&n.readyCallback();return}for(var v in i){if(!i[v]&&!i[v].atom)continue;i[v].mol&&(d[v]=i[v])}if(s.length<20)for(var v in d){if(!d[v]&&!d[v].atom)continue;if(!n.elements[d[v].elem])continue;if(!n.elements[d[v].elem].type)continue;if(n.elements[d[v].elem].type<1)continue;if(!e.geomdata.bondsByLabel[d[v].atom])continue;o=b(d[v],o)}var m=[];for(var v in i){if(!i[v]&&!i[v].atom)continue;i[v].extra&&(i[v].mol=1),i[v].mol&&(i[v].xyz=n._xyzApplyMatrix(i[v].fxyz,e.F2Cmatrix),i[v].xyzSu=n._xyzApplyMatrix(i[v].fxyzSu,e.F2Cmatrix),i[v].x=i[v].xyz[0],i[v].y=i[v].xyz[1],i[v].z=i[v].xyz[2],m[v]=i[v])}e.model.mol=m,typeof n.readyCallback=="function"&&n.readyCallback();return}var a=h[t];if(c){g(0);return}if(!i[a].idx){o++,i[a].idx=o,i[a][u]=1;for(var f in i){if(!i[f]||!i[f].fxyz||a==f)continue;if(i[a].bonds.indexOf(f)>-1)continue;if(r=="mol"&&n.elements[i[a].elem].type<1&&i[a].symt!="555")continue;if(r=="cell5551"&&!i[f].cell1)continue;if(r=="cell555"&&i[f].symt!="555")continue;if(r=="asu"&&(i[f].symt!="555"||i[f].symop!=1))continue;if(e.geomdata.bondsByLabel[i[a].atom]){var l=e.geomdata.bondsByLabel[i[a].atom].indexOf(i[f].atom);if(l>-1){var p=e.calcBondF(i[f].fxyz[0]-i[a].fxyz[0],i[f].fxyz[1]-i[a].fxyz[1],i[f].fxyz[2]-i[a].fxyz[2]);if(p<n.elements[i[a].elem].covRad+n.elements[i[f].elem].covRad+.4||p<e.geomdata.bondsByLabel[i[a].atom][l+1]*1.1)i[a].bonds.push(f),i[f].bonds.push(a),i[a].bondOrder.push(1),i[f].bondOrder.push(1),i[f].idx||(o++,i[f].idx=o,i[f][u]=1,o=x(f,o,0,1))}}}}t++,setTimeout(function(){y(t)},0)}function b(t,r){if(!n.elements[t.elem])return r;if(n.elements[t.elem].type<1)return r;if(t.bonds.length>=n.elements[t.elem].type)return r;if(!e.geomdata.bondsByLabel[t.atom])return r;var o=e.geomdata.bondsByLabel[t.atom],u=o.length/2;u<n.elements[t.elem].type&&elem!="C"&&u!=3&&(u=n.elements[t.elem].type);if(t.bonds.length>=u)return r;var a=[],f=3,l=3,c=3,h=7,p=7,d=7;for(var v=0;v<o.length;v+=2)for(var m in s){var g=i[o[v]+"_"+m+"_555"];if(!g)continue;var y=g.atom;for(var S=f;S<=h;S++){var x=S-5,T=S+"55";if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,0,0],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var N=l;N<=p;N++){var C=N-5,T=S+""+N+"5";if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,0],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var k=c;k<=d;k++){var L=k-5,T=S+""+N+""+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}}}for(var k=c;k<=d;k++){var L=k-5,T=S+"5"+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,0,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1);if(i[y+"_"+m+"_"+T]){r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r}a[y+"_"+m+"_"+T]=1}for(var N=l;N<=p;N++){var C=N-5,T=S+""+N+""+k;if(!a[y+"_"+m+"_"+T]&&t!=i[y+"_"+m+"_"+T]&&t.extra&&i[y+"_"+m+"_"+T]&&i[y+"_"+m+"_"+T].extra&&t.bonds.indexOf(y+"_"+m+"_"+T)==-1){if(w(t,i[y+"_"+m+"_"+T],e.geomdata.bondsByLabel[t.atom][v+1]*1.1)&&t.bonds.length>=u)return r}else if(!i[y+"_"+m+"_"+T]&&!a[y+"_"+m+"_"+T]){i[y+"_"+m+"_"+T]=E(t,g,[x,C,L],e.geomdata.bondsByLabel[t.atom][v+1]*1.1),r++,i[y+"_"+m+"_"+T].idx=r,i[y+"_"+m+"_"+T].extra=1,r=b(i[y+"_"+m+"_"+T],r);if(t.bonds.length>=u)return r;a[y+"_"+m+"_"+T]=1}}}}}return r}function w(t,r,i){var s=e.calcBondF(t.fxyz[0]-r.fxyz[0],t.fxyz[1]-r.fxyz[1],t.fxyz[2]-r.fxyz[2]);return s<n.elements[t.elem].covRad+n.elements[r.elem].covRad+.4||s<i?(r.bonds.indexOf(t.atom+"_"+t.symop+"_"+t.symt)==-1&&(r.bonds.push(t.atom+"_"+t.symop+"_"+t.symt),r.bondOrder.push(1)),t.bonds.indexOf(r.atom+"_"+r.symop+"_"+r.symt)==-1&&(t.bonds.push(r.atom+"_"+r.symop+"_"+r.symt),t.bondOrder.push(1)),!0):!1}function E(t,r,i,s){var o=e.calcBondF(t.fxyz[0]-(r.fxyz[0]+i[0]),t.fxyz[1]-(r.fxyz[1]+i[1]),t.fxyz[2]-(r.fxyz[2]+i[2]));if(o<n.elements[t.elem].covRad+n.elements[r.elem].covRad+.4||o<s){var u={};u.fxyz=[r.fxyz[0]+i[0],r.fxyz[1]+i[1],r.fxyz[2]+i[2]],u.fxyzSu=r.fxyzSu,u.symop=r.symop,u.symc=[r.symc[0]+i[0],r.symc[1]+i[1],r.symc[2]+i[2]],u.symt=u.symc[0]+""+u.symc[1]+""+u.symc[2],u.xyz=[],u.atom=r.atom,u.elem=r.elem,u.bondOrder=[];if(e.geomdata.bonds[u.atom+"_"+u.symop+"_"+u.symt]){u.bonds=e.geomdata.bonds[u.atom+"_"+u.symop+"_"+u.symt];for(var a=0;a<u.bonds.length;a++)u.bondOrder.push(1)}else u.bonds=[];return u.bonds.push(t.atom+"_"+t.symop+"_"+t.symt),u.bondOrder.push(1),t.bonds.push(u.atom+"_"+u.symop+"_"+u.symt),t.bondOrder.push(1),u.occ=r.occ,u.dis_ass=r.dis_ass,u.dis_grp=r.dis_grp,u}return 0}function S(t,n){var r={};r.fxyz=[t.fxyz[0]+n[0],t.fxyz[1]+n[1],t.fxyz[2]+n[2]],r.fxyzSu=t.fxyzSu,r.symop=t.symop,r.symc=[t.symc[0]+n[0],t.symc[1]+n[1],t.symc[2]+n[2]],r.symt=r.symc[0]+""+r.symc[1]+""+r.symc[2],r.xyz=[],r.atom=t.atom,r.elem=t.elem,r.bondOrder=[];if(e.geomdata.bonds[r.atom+"_"+r.symop+"_"+r.symt]){r.bonds=e.geomdata.bonds[r.atom+"_"+r.symop+"_"+r.symt];for(var i=0;i<r.bonds.length;i++)r.bondOrder.push(1)}else r.bonds=[];return r.occ=t.occ,r.dis_ass=t.dis_ass,r.dis_grp=t.dis_grp,r}function x(t,r,s,o){if(o&&n.elements[i[t].elem].type<1)return r;for(var a in i){if(!i[a]||!i[a].fxyz||t==a)continue;if(i[t].bonds.indexOf(a)>-1)continue;if(o&&n.elements[i[a].elem].type<1)continue;if(s){if(s=="cell5551"&&!i[a].cell1)continue;if(s=="cell555"&&i[a].symt!="555")continue;if(s=="asu"&&(i[a].symt!="555"||i[a].symop!=1))continue}if(e.geomdata.bondsByLabel[i[t].atom]){var f=e.geomdata.bondsByLabel[i[t].atom].indexOf(i[a].atom);if(f>-1){var l=e.calcBondF(i[a].fxyz[0]-i[t].fxyz[0],i[a].fxyz[1]-i[t].fxyz[1],i[a].fxyz[2]-i[t].fxyz[2]);if(l<n.elements[i[t].elem].covRad+n.elements[i[a].elem].covRad+.4||l<e.geomdata.bondsByLabel[i[t].atom][f+1]*1.1)i[t].bonds.push(a),i[a].bonds.push(t),i[t].bondOrder.push(1),i[a].bondOrder.push(1),i[a].idx||(r++,i[a].idx=r,i[a][u]=1,o&&(r=x(a,r,s,o)))}}}return r}if(!e)return null;var n=this,r=t||"mol",i=e.model.sites,s=e.symOps,o=0,u=r,a=[],f=[],l=[],c=!1;if(!e.geomdata.bonds||e.geomdata.bondcount==0)c=!0;var h=[],p=0,d=0;for(var v in i){if(!i[v]||!i[v].fxyz)continue;var m=!1;r=="mol"?m=i[v].symt=="555"&&i[v].symop==1||i[v].bonds.length>0||i[v].cell1&&i[v].symop==1:r=="cell5551"?m=i[v].cell1:r=="cell555"?m=i[v].symt=="555":r=="asu"&&(m=i[v].symt=="555"&&i[v].symop==1),c&&(r=="cell5551"&&i[v].cell1?(l[d]=v,d++):i[v].symt=="555"&&(l[d]=v,d++)),m&&(i[v].idx=null,h[p]=v,p++)}y(0)},Scif.prototype._getUBparams=function(e){var t=e.cifitems._atom_site_aniso_label;t||(t=e.cifitems._atom_site_aniso_type_symbol);if(!t)return null;var n=e.cifloops[t.id],r=n.loopheads,i=n.loopvalues,s=r.indexOf("_atom_site_aniso_type_symbol"),o=r.indexOf("_atom_site_aniso_label");o==-1&&(o=s);if(o==-1)return null;var u=r.indexOf("_atom_site_aniso_u_11"),a=r.indexOf("_atom_site_aniso_u_22"),f=r.indexOf("_atom_site_aniso_u_33"),l=r.indexOf("_atom_site_aniso_u_12"),c=r.indexOf("_atom_site_aniso_u_13"),h=r.indexOf("_atom_site_aniso_u_23");if(u==-1||a==-1||f==-1||l==-1||c==-1||h==-1)return;var p=r.length,d=i.length/p,v=[],m=0;for(var g=0;g<d;++g){var y=i[m+o],b=this._getValSu(i[m+u])[0],w=this._getValSu(i[m+a])[0],E=this._getValSu(i[m+f])[0],S=this._getValSu(i[m+l])[0],x=this._getValSu(i[m+c])[0],T=this._getValSu(i[m+h])[0];m+=p,v[y]=[b,w,E,S,x,T]}e.adps=v},Scif.prototype._getModelSitesM=function(e){function Nt(e,t,n,r){var i=r[0][0]*e+r[1][0]*t+r[2][0]*n+r[3][0],s=r[0][1]*e+r[1][1]*t+r[2][1]*n+r[3][1],o=r[0][2]*e+r[1][2]*t+r[2][2]*n+r[3][2];return[i,s,o]}var t=e.cifitems["_atom_site.id"];if(!t)return null;var n=e.cifloops[t.id];if(!n)return null;var r=n.loopheads,i=n.loopvalues,s=r.indexOf("_atom_site.id"),o=r.indexOf("_atom_site.label_alt_id"),u=r.indexOf("_atom_site.occupancy"),a=r.indexOf("_atom_site.type_symbol"),f=r.indexOf("_atom_site.label_atom_id");f==-1&&(f=a);if(f==-1)return null;var l=r.indexOf("_atom_site.cartn_x"),c=r.indexOf("_atom_site.cartn_y"),h=r.indexOf("_atom_site.cartn_z"),p=r.indexOf("_atom_site.b_iso_or_equiv"),d=r.indexOf("_atom_site.label_comp_id"),v=r.indexOf("_atom_site.label_seq_id"),m=r.indexOf("_atom_site.label_asym_id"),g=r.indexOf("_atom_site.group_pdb"),y=r.length,b=i.length/y,w=[],E=[],S=0;for(var x=0;x<b;++x){if(o>-1&&i[S+o]!="."&&i[S+o].toUpperCase()!="A"){S+=y;continue}var T=i[S+d],N=this._getValSu(i[S+l])[0],C=this._getValSu(i[S+c])[0],k=this._getValSu(i[S+h])[0],L="";a>-1?L=i[S+a]:L=i[S+f].replace(/[^A-Za-z]/g,""),L.length>1&&(L=L.substring(0,1).toUpperCase()+L.substring(1).toLowerCase());var A=i[S+f];this.elements[L]||(L="Xx");var O=!1;g>-1&&i[S+g].toLowerCase().indexOf("het")>-1&&(O=!0);var M=i[S+m],_=parseInt(i[S+v]),D=i[S+s],P=this._getValSu(i[S+p])[0];w[D]={resn:T,x:N,y:C,z:k,elem:L,hetflag:O,chain:M,resi:_,idx:D,atom:A,ss:"c",color:16777215,bonds:[],bondOrder:[],b:P},E[T+"_"+_+"_"+M]||(E[T+"_"+_+"_"+M]=[]),E[T+"_"+_+"_"+M].push(D),S+=y}var H=e.getBioligandData();e.ligands=[];if(H)for(var B in H){if(B.toUpperCase()=="HOH")continue;var F=[];e.ligands[B]=[];for(var S in w){var I=w[S];if(I==undefined)continue;I.resn==B&&(F[I.resn+"_"+I.resi+"_"+I.chain]||(F[I.resn+"_"+I.resi+"_"+I.chain]=[]),F[I.resn+"_"+I.resi+"_"+I.chain].push(I.idx))}for(var q in F){var R=[],U=0,z={name:q,siteids:[],dims:[],pocketids:[],pocketdims:[],assembly:"asu"},W=F[q];z.siteids=W;var X,V,$,J,K,Q,G=ysum=zsum=cnt=0;for(var Y=0;Y<W.length;Y++){var Z=w[W[Y]];Z.ligandid=q,Y==0&&(J=Z.x,K=Z.y,Q=Z.z,X=Z.x,V=Z.y,$=Z.z),Z.x<J&&(J=Z.x),Z.y<K&&(K=Z.y),Z.z<Q&&(Q=Z.z),Z.x>X&&(X=Z.x),Z.y>V&&(V=Z.y),Z.z>$&&($=Z.z),cnt++,G+=Z.x,ysum+=Z.y,zsum+=Z.z;for(var et=Y+1;et<W.length;et++){var tt=w[W[et]],nt=Math.sqrt((Z.x-tt.x)*(Z.x-tt.x)+(Z.y-tt.y)*(Z.y-tt.y)+(Z.z-tt.z)*(Z.z-tt.z));nt<(this.elements[Z.elem].covRad+this.elements[tt.elem].covRad)*1.3&&(Z.bonds.push(W[et]),Z.bondOrder.push(1),tt.bonds.push(W[Y]),tt.bondOrder.push(1))}for(var S in w){var tt=w[S];if(tt==undefined)continue;if(tt.resn!=Z.resn&&!tt.hetflag&&!R[tt.idx]){var nt=Math.sqrt((Z.x-tt.x)*(Z.x-tt.x)+(Z.y-tt.y)*(Z.y-tt.y)+(Z.z-tt.z)*(Z.z-tt.z));nt<6&&(R[tt.idx]=tt.idx,U++)}}}z.dims=[[J,K,Q],[X,V,$],[G/cnt,ysum/cnt,zsum/cnt]];var rt=[],it=[];it.length=0;for(var st in R){rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain]||(rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain]=[]),rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain].indexOf(st)==-1&&rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain].push(st),it.push(st);if(E[w[st].resn+"_"+w[st].resi+"_"+w[st].chain])for(var S=0;S<E[w[st].resn+"_"+w[st].resi+"_"+w[st].chain].length;S++){var tt=w[E[w[st].resn+"_"+w[st].resi+"_"+w[st].chain][S]];if(tt==undefined)continue;if(!R[tt.idx]&&tt.resn==w[st].resn&&tt.resi==w[st].resi&&tt.chain==w[st].chain){if(rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain].indexOf(tt.idx)>-1)continue;rt[w[st].resn+"_"+w[st].resi+"_"+w[st].chain].push(tt.idx),it.push(tt.idx),U++}}}var ot,ut,at,ft,lt,ct;for(var ht=0;ht<it.length;ht++){var pt=w[it[ht]];ht==0&&(ft=pt.x,lt=pt.y,ct=pt.z,ot=pt.x,ut=pt.y,at=pt.z),pt.x<ft&&(ft=pt.x),pt.y<lt&&(lt=pt.y),pt.z<ct&&(ct=pt.z),pt.x>ot&&(ot=pt.x),pt.y>ut&&(ut=pt.y),pt.z>at&&(at=pt.z)}z.pocketids=it.slice(0),z.pocketdims=[[ft,lt,ct],[ot,ut,at]];for(var dt in rt){var W=rt[dt];for(var Y=0;Y<W.length;Y++){var Z=w[W[Y]];Z.pocket=!0;for(var et=Y+1;et<W.length;et++){var tt=w[W[et]];tt.pocket=!0;var nt=Math.sqrt((Z.x-tt.x)*(Z.x-tt.x)+(Z.y-tt.y)*(Z.y-tt.y)+(Z.z-tt.z)*(Z.z-tt.z));nt<(this.elements[Z.elem].covRad+this.elements[tt.elem].covRad)*1.3&&(Z.bonds.push(W[et]),Z.bondOrder.push(1),tt.bonds.push(W[Y]),tt.bondOrder.push(1))}}}e.ligands[B][z.name]=z}}var vt=[];t=e.cifitems["_struct_conf.conf_type_id"];if(t){var n=e.cifloops[t.id],r=[],i=[];if(!n){i.push(t.value),r=["_struct_conf.conf_type_id","_struct_conf.beg_label_asym_id","_struct_conf.end_label_asym_id","_struct_conf.beg_label_seq_id","_struct_conf.end_label_seq_id"];for(var nt=1;nt<r.length;nt++){var mt=e.cifitems[r[nt]];mt?i.push(mt.value):i.push("?")}}else r=n.loopheads,i=n.loopvalues;var gt=r.indexOf("_struct_conf.conf_type_id"),yt=r.indexOf("_struct_conf.beg_label_asym_id"),bt=r.indexOf("_struct_conf.end_label_asym_id"),wt=r.indexOf("_struct_conf.beg_label_seq_id"),Et=r.indexOf("_struct_conf.end_label_seq_id"),y=r.length,b=i.length/y,S=0;for(var x=0;x<b;++x){if(gt==-1||yt==-1||bt==-1||wt==-1||Et==-1){S+=y;continue}if(i[S+gt].toUpperCase().indexOf("HELX")==-1){S+=y;continue}vt.push([i[S+yt],parseInt(i[S+wt]),i[S+bt],parseInt(i[S+Et])]),S+=y}}var St=[];t=e.cifitems["_struct_sheet_range.sheet_id"];if(t){var n=e.cifloops[t.id],r=[],i=[];if(!n){i.push(t.value),r=["_struct_sheet_range.sheet_id","_struct_sheet_range.beg_label_asym_id","_struct_sheet_range.end_label_asym_id","_struct_sheet_range.beg_label_seq_id","_struct_sheet_range.end_label_seq_id"];for(var nt=1;nt<r.length;nt++){var mt=e.cifitems[r[nt]];mt?i.push(mt.value):i.push("?")}}else r=n.loopheads,i=n.loopvalues;var gt=r.indexOf("_struct_sheet_range.sheet_id"),yt=r.indexOf("_struct_sheet_range.beg_label_asym_id"),bt=r.indexOf("_struct_sheet_range.end_label_asym_id"),wt=r.indexOf("_struct_sheet_range.beg_label_seq_id"),Et=r.indexOf("_struct_sheet_range.end_label_seq_id"),y=r.length,b=i.length/y,S=0;for(var x=0;x<b;++x){if(gt==-1||yt==-1||bt==-1||wt==-1||Et==-1){S+=y;continue}St.push([i[S+yt],parseInt(i[S+wt]),i[S+bt],parseInt(i[S+Et])]),S+=y}}for(var S in w){var I=w[S];if(I==undefined)continue;for(j=0;j<St.length;j++){if(I.chain!=St[j][0])continue;if(I.resi<St[j][1])continue;if(I.resi>St[j][3])continue;I.ss="s",I.resi==St[j][1]&&(I.ssbegin=!0),I.resi==St[j][3]&&(I.ssend=!0)}for(j=0;j<vt.length;j++){if(I.chain!=vt[j][0])continue;if(I.resi<vt[j][1])continue;if(I.resi>vt[j][3])continue;I.ss="h",I.resi==vt[j][1]?I.ssbegin=!0:I.resi==vt[j][3]&&(I.ssend=!0)}}var xt=[];xt=e.getBiomolData(),e.assemblies=[];for(var ht in xt){if(xt[ht].id==undefined)continue;if(xt[ht].ops&&xt[ht].ops.length>10)continue;e.assemblies.push(xt[ht])}var Tt=[];e.model={},e.model.sites=w,e.model.symRangeStr="",e.model.biomols=Tt,e.model.mol=w,e.model.asu=w,e.model.cell555=null,e.model.cell5551=null},Scif.prototype._getCifMolModels=function(e){var t=e.cifitems._cifmol_atom_site_id;if(!t)return!1;this._getF2Cmatrix(e),this._getF2CmatrixCell(e),this._getC2Fmatrix(e),e.adps||this._getUBparams(e);var n=[],r=e.cifloops[t.id],i=r.loopheads,s=r.loopvalues,o=[],u=[],a=i.indexOf("_cifmol_atom_site_type_symbol"),f=i.indexOf("_cifmol_atom_site_id"),l=i.indexOf("_cifmol_atom_site_cartn_x"),c=i.indexOf("_cifmol_atom_site_cartn_y"),h=i.indexOf("_cifmol_atom_site_cartn_z"),p=i.indexOf("_cifmol_atom_site_connected_sites"),d=i.indexOf("_cifmol_atom_site_connected_sites_types"),v=i.indexOf("_cifmol_atom_site_model_ids"),m=i.indexOf("_cifmol_atom_site_disorder_assembly"),g=i.indexOf("_cifmol_atom_site_disorder_group"),y=i.indexOf("_cifmol_atom_site_occupancy");if(a==-1||f==-1||l==-1||h==-1||p==-1||d==-1||v==-1)return null;var b=i.length,w=s.length/b,E=0,S=0,x=[];for(var T=0;T<w;++T){var N={};N.asu=!1,N.cell=!1,N.mol=!1,N.idx=S++,N.elem=s[E+a],N.atom=s[E+f].replace(/_\d+_\d\d\d$/g,"");var C=s[E+f].split("_");C&&C.length>2&&(N.symop=C[1],N.symt=C[2]),N.x=parseFloat(s[E+l]),N.y=parseFloat(s[E+c]),N.z=parseFloat(s[E+h]),N.xyz=[N.x,N.y,N.z],N.bonds=[];if(s[E+p]!="."){var k=s[E+p].split(",");if(k.length<12){N.bonds=k;var L=N.atom;n[L]||(n[L]=[]);for(var A=0;A<k.length;A++){var O=k[A].replace(/_\d+_\d\d\d$/g,"");n[L].indexOf(O)==-1&&(n[L].push(O),n[L].push(0)),n[O]||(n[O]=[]),n[O].indexOf(L)==-1&&(n[O].push(L),n[O].push(0))}}}N.bondOrder=[];if(s[E+d]!="."){var M=s[E+d].split(",");M.length<12&&(N.bondOrder=M)}if(N.bonds.length!=N.bondOrder.length)for(var _=0;_<N.bonds.length;_++)N.bondOrder.push(1);s[E+v].indexOf("asu")>-1&&(N.asu=!0),s[E+v].indexOf("mol")>-1&&(N.mol=!0),s[E+v].indexOf("cell1")>-1&&(N.cell1=!0),s[E+v].indexOf("cell555")>-1&&(N.cell555=!0),N.dis_ass=".",N.dis_grp=".",N.occ=1,m>-1&&(N.dis_ass=s[E+m]),g>-1&&(N.dis_grp=s[E+g]),y>-1&&s[E+y]!="."&&s[E+y]!="?"&&(N.occ=parseFloat(s[E+y])),x[s[E+f]]=N,E+=b}var D=[],P=[],H=[],B=[],j=0,F=0;for(var I in x){if(x[I].asu){D[I]=x[I];var q=x[I].atom;e.adps&&e.adps[q]&&(x[I].adp=e.adps[q])}x[I].mol&&(P[I]=x[I],j++),x[I].cell1&&(B[I]=x[I],F++),x[I].cell555&&(H[I]=x[I])}return e.model={},e.model.sites=x,e.model.symRangeStr="",e.model.mol=P,e.model.molsize=j,e.model.asu=D,e.model.cell555=H,e.model.cell5551=B,e.model.cellsize=F,e.geomdata={},e.geomdata.bondsByLabel=n,!0},Scif.prototype._getMoieties=function(e){var t=e.cifitems._cifmol_moiety_id;if(!t)return!1;var n=e.cifloops[t.id],r=n.loopheads,i=n.loopvalues,s=[],o=[],u=r.indexOf("_cifmol_moiety_id"),a=r.indexOf("_cifmol_moiety_site_id"),f=r.indexOf("_cifmol_moiety_symops");if(u==-1||a==-1||f==-1)return!1;var l=r.length,c=i.length/l,h=0,p=0,d=[];for(var v=0;v<c;++v){var m=i[h+f].split(","),g=i[h+a].split(",");for(var y=0;y<m.length;y++){var b={};p++,b.idx=i[h+u],b.id=p,b.labels=g,b.symops=[m[y]],b.size=g.length,b.formula="",d.push(b)}h+=l}return e.moieties=d,!0},Scif.prototype._getModelSites=function(cifblock,symrange){function _siteFromSite(e,t){var n={};n.fxyz=[e.fxyz[0]+t[0],e.fxyz[1]+t[1],e.fxyz[2]+t[2]],n.fxyzSu=e.fxyzSu,n.symop=e.symop,n.symc=[e.symc[0]+t[0],e.symc[1]+t[1],e.symc[2]+t[2]],n.symt=n.symc[0]+""+n.symc[1]+""+n.symc[2],n.xyz=[],n.atom=e.atom,n.elem=e.elem,n.bondOrder=[];if(cifblock.geomdata.bonds[n.atom+"_"+n.symop+"_"+n.symt]){n.bonds=cifblock.geomdata.bonds[n.atom+"_"+n.symop+"_"+n.symt];for(var r=0;r<n.bonds.length;r++)n.bondOrder.push(1)}else n.bonds=[];return n.dis_ass=e.dis_ass,n.dis_grp=e.dis_grp,n.occ=e.occ,n}if(!cifblock)return null;this._getMoieties(cifblock);if(cifblock.mmcif){this._getModelSitesM(cifblock);return}if(cifblock.cifmol&&this._getCifMolModels(cifblock,symrange))return;this._getF2Cmatrix(cifblock),this._getF2CmatrixCell(cifblock),this._getGeomData(cifblock),this._getSymOps(cifblock),cifblock.adps||this._getUBparams(cifblock),symrange||(symrange=cifblock.geomdata.symRange);var txmin=symrange[0],tymin=symrange[1],tzmin=symrange[2],txmax=symrange[3],tymax=symrange[4],tzmax=symrange[5],litem=cifblock.cifitems._atom_site_label;litem||(litem=cifblock.cifitems._atom_site_type_symbol);if(!litem)return null;var loop=cifblock.cifloops[litem.id],dns=loop.loopheads,dvs=loop.loopvalues,sites=[],asites=[],ia=dns.indexOf("_atom_site_type_symbol"),il=dns.indexOf("_atom_site_label");il==-1&&(il=ia);if(il==-1)return null;var ix=dns.indexOf("_atom_site_fract_x"),iy=dns.indexOf("_atom_site_fract_y"),iz=dns.indexOf("_atom_site_fract_z"),disa=dns.indexOf("_atom_site_disorder_assembly"),disg=dns.indexOf("_atom_site_disorder_group"),diso=dns.indexOf("_atom_site_occupancy"),cc=dns.length,rows=dvs.length/cc,sym=cifblock.symOps,offsets=[],si=0;for(var sc in sym){var sumx=0,sumy=0,sumz=0,i=0;if(!sym[sc].full)continue;si++;for(var r=0;r<rows;++r){var vsx=this._getValSu(dvs[i+ix]),vsy=this._getValSu(dvs[i+iy]),vsz=this._getValSu(dvs[i+iz]),x=vsx[0],y=vsy[0],z=vsz[0],nx=eval(sym[sc].xpart),ny=eval(sym[sc].ypart),nz=eval(sym[sc].zpart),elem="";ia>-1?elem=dvs[i+ia]:(elem=dvs[i+il].replace(/^\s*|\s*$/g,"").replace(/[^A-Za-z]/g,""),elem=elem.replace(/^([A-Z][a-z]{0,3}).*$/g,"$1")),this.elements[elem]||(elem="Xx");var asite={};sumx+=nx,sumy+=ny,sumz+=nz;var symt="555",asite={};asite.fxyz=[nx,ny,nz],asite.fxyzSu=[vsx[1],vsy[1],vsz[1]],asite.symop=si,asite.symc=[5,5,5],asite.symt="555",asite.xyz=[],asite.cell1=!0,asite.atom=dvs[i+il],asite.elem=elem,cifblock.adps&&cifblock.adps[asite.atom]&&(asite.adp=cifblock.adps[asite.atom]),asite.bondOrder=[];if(cifblock.geomdata.bonds[dvs[i+il]+"_"+si+"_"+symt]){asite.bonds=cifblock.geomdata.bonds[dvs[i+il]+"_"+si+"_"+symt];for(var b=0;b<asite.bonds.length;b++)asite.bondOrder.push(1)}else asite.bonds=[];asite.dis_ass=".",asite.dis_grp=".",asite.occ=1,disa>-1&&(asite.dis_ass=dvs[i+disa]),disg>-1&&(asite.dis_grp=dvs[i+disg]),diso>-1&&dvs[i+diso]!="."&&dvs[i+diso]!="?"&&(asite.occ=parseFloat(dvs[i+diso])),sites[dvs[i+il]+"_"+si+"_"+symt]=asite,i+=cc}var cx=sumx/rows,cy=sumy/rows,cz=sumz/rows,ox=0,oy=0,oz=0;while(cx<-0.0001||cx>=1.0001)ox+=cx<0?1:-1,cx+=cx<0?1:-1;while(cy<-0.0001||cy>=1.0001)oy+=cy<0?1:-1,cy+=cy<0?1:-1;while(cz<-0.0001||cz>=1.0001)oz+=cz<0?1:-1,cz+=cz<0?1:-1;offsets[sc]=[ox,oy,oz,5+ox+""+(5+oy)+""+(5+oz)]}for(var as in sites){if(!sites[as]||sites[as].symop==undefined)continue;var si=sites[as].symop;if(!offsets[si]||offsets[si][3]=="555")continue;sites[as].cell1=!1,sites[sites[as].atom+"_"+si+"_"+offsets[si][3]]||(sites[sites[as].atom+"_"+si+"_"+offsets[si][3]]=_siteFromSite(sites[as],offsets[si]),sites[sites[as].atom+"_"+si+"_"+offsets[si][3]].cell1=!0)}if(cifblock.moieties){var mc=0;for(var m=0;m<cifblock.moieties.length;m++)for(var s=0;s<cifblock.moieties[m].symops.length;s++){var so=cifblock.moieties[m].symops[s],sn=so.split("_")[0],dxyz=so.split("_")[1].split("");for(var l=0;l<cifblock.moieties[m].labels.length;l++){var lbl=cifblock.moieties[m].labels[l];sites[lbl+"_"+so]||(sites[lbl+"_"+so]=_siteFromSite(sites[lbl+"_"+sn+"_555"],[parseInt(dxyz[0])-5,parseInt(dxyz[1])-5,parseInt(dxyz[2])-5,so])),sites[lbl+"_"+so].cell1=!0,sites[lbl+"_"+so].moiety=cifblock.moieties[m].id}}cifblock.model={},cifblock.model.sites=sites,cifblock.model.symRangeStr=symrange.join("")+"",cifblock.model.mol=null,cifblock.model.asu=null,cifblock.model.cell555=null,cifblock.model.cell5551=null;return}for(var as in sites){if(!sites[as]||sites[as].symop==undefined)continue;var si=sites[as].symop,lbl=sites[as].atom;for(var xt=txmin;xt<=txmax;xt++){var dx=xt-5,symt=xt+"55";sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,0,0,symt]));for(var yt=tymin;yt<=tymax;yt++){var dy=yt-5,symt=xt+""+yt+"5";sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,0,symt]));for(var zt=tzmin;zt<=tzmax;zt++){var dz=zt-5,symt=xt+""+yt+""+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,dz,symt]))}}for(var zt=tzmin;zt<=tzmax;zt++){var dz=zt-5,symt=xt+"5"+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,0,dz,symt]));for(var yt=tymin;yt<=tymax;yt++){var dy=yt-5,symt=xt+""+yt+""+zt;sites[lbl+"_"+si+"_"+symt]||(sites[lbl+"_"+si+"_"+symt]=_siteFromSite(sites[as],[dx,dy,dz,symt]))}}}}cifblock.model={},cifblock.model.sites=sites,cifblock.model.symRangeStr=symrange.join("")+"",cifblock.model.mol=null,cifblock.model.asu=null,cifblock.model.cell555=null,cifblock.model.cell5551=null};var elem=[];elem.Xx={atomNo:0,vdwRad:1,covRad:0,type:0},elem.H={atomNo:1,vdwRad:1.2,covRad:.23,type:1},elem.He={atomNo:2,vdwRad:1.4,covRad:.93,type:1},elem.Li={atomNo:3,vdwRad:1.82,covRad:.68,type:0},elem.Be={atomNo:4,vdwRad:1.7,covRad:.35,type:0},elem.B={atomNo:5,vdwRad:2.08,covRad:.83,type:3},elem.C={atomNo:6,vdwRad:1.95,covRad:.68,type:4},elem.N={atomNo:7,vdwRad:1.85,covRad:.68,type:3},elem.O={atomNo:8,vdwRad:1.7,covRad:.68,type:2},elem.F={atomNo:9,vdwRad:1.73,covRad:.64,type:1},elem.Ne={atomNo:10,vdwRad:1.54,covRad:1.12,type:1},elem.Na={atomNo:11,vdwRad:2.27,covRad:.97,type:0},elem.Mg={atomNo:12,vdwRad:1.73,covRad:1.1,type:0},elem.Al={atomNo:13,vdwRad:2.05,covRad:1.35,type:0},elem.Si={atomNo:14,vdwRad:2.1,covRad:1.2,type:4},elem.P={atomNo:15,vdwRad:2.08,covRad:.75,type:6},elem.S={atomNo:16,vdwRad:2,covRad:1.02,type:4},elem.Cl={atomNo:17,vdwRad:1.97,covRad:.99,type:1},elem.Ar={atomNo:18,vdwRad:1.88,covRad:1.57,type:1},elem.K={atomNo:19,vdwRad:2.75,covRad:1.33,type:0},elem.Ca={atomNo:20,vdwRad:1.973,covRad:.99,type:0},elem.Sc={atomNo:21,vdwRad:1.7,covRad:1.44,type:0},elem.Ti={atomNo:22,vdwRad:1.7,covRad:1.47,type:0},elem.V={atomNo:23,vdwRad:1.7,covRad:1.33,type:0},elem.Cr={atomNo:24,vdwRad:1.7,covRad:1.35,type:0},elem.Mn={atomNo:25,vdwRad:1.7,covRad:1.35,type:0},elem.Fe={atomNo:26,vdwRad:1.7,covRad:1.34,type:0},elem.Co={atomNo:27,vdwRad:1.7,covRad:1.33,type:0},elem.Ni={atomNo:28,vdwRad:1.63,covRad:1.5,type:0},elem.Cu={atomNo:29,vdwRad:1.4,covRad:1.52,type:0},elem.Zn={atomNo:30,vdwRad:1.39,covRad:1.45,type:0},elem.Ga={atomNo:31,vdwRad:1.87,covRad:1.22,type:0},elem.Ge={atomNo:32,vdwRad:1.7,covRad:1.17,type:0},elem.As={atomNo:33,vdwRad:1.85,covRad:1.21,type:0},elem.Se={atomNo:34,vdwRad:1.9,covRad:1.22,type:0},elem.Br={atomNo:35,vdwRad:2.1,covRad:1.21,type:1},elem.Kr={atomNo:36,vdwRad:2.02,covRad:1.91,type:0},elem.Rb={atomNo:37,vdwRad:1.7,covRad:1.47,type:0},elem.Sr={atomNo:38,vdwRad:1.7,covRad:1.12,type:0},elem.Y={atomNo:39,vdwRad:1.7,covRad:1.78,type:0},elem.Zr={atomNo:40,vdwRad:1.7,covRad:1.56,type:0},elem.Nb={atomNo:41,vdwRad:1.7,covRad:1.48,type:0},elem.Mo={atomNo:42,vdwRad:1.7,covRad:1.47,type:0},elem.Tc={atomNo:43,vdwRad:1.7,covRad:1.35,type:0},elem.Ru={atomNo:44,vdwRad:1.7,covRad:1.4,type:0},elem.Rh={atomNo:45,vdwRad:1.7,covRad:1.45,type:0},elem.Pd={atomNo:46,vdwRad:1.63,covRad:1.5,type:0},elem.Ag={atomNo:47,vdwRad:1.72,covRad:1.59,type:0},elem.Cd={atomNo:48,vdwRad:1.58,covRad:1.69,type:0},elem.In={atomNo:49,vdwRad:1.93,covRad:1.63,type:0},elem.Sn={atomNo:50,vdwRad:2.17,covRad:1.46,type:0},elem.Sb={atomNo:51,vdwRad:2.2,covRad:1.46,type:0},elem.Te={atomNo:52,vdwRad:2.06,covRad:1.47,type:0},elem.I={atomNo:53,vdwRad:2.15,covRad:1.4,type:1},elem.Xe={atomNo:54,vdwRad:2.16,covRad:1.98,type:0},elem.Cs={atomNo:55,vdwRad:1.7,covRad:1.67,type:0},elem.Ba={atomNo:56,vdwRad:1.7,covRad:1.34,type:0},elem.La={atomNo:57,vdwRad:1.7,covRad:1.87,type:0},elem.Ce={atomNo:58,vdwRad:1.7,covRad:1.83,type:0},elem.Pr={atomNo:59,vdwRad:1.7,covRad:1.82,type:0},elem.Nd={atomNo:60,vdwRad:1.7,covRad:1.81,type:0},elem.Pm={atomNo:61,vdwRad:1.7,covRad:1.8,type:0},elem.Sm={atomNo:62,vdwRad:1.7,covRad:1.8,type:0},elem.Eu={atomNo:63,vdwRad:1.7,covRad:1.99,type:0},elem.Gd={atomNo:64,vdwRad:1.7,covRad:1.79,type:0},elem.Tb={atomNo:65,vdwRad:1.7,covRad:1.76,type:0},elem.Dy={atomNo:66,vdwRad:1.7,covRad:1.75,type:0},elem.Ho={atomNo:67,vdwRad:1.7,covRad:1.74,type:0},elem.Er={atomNo:68,vdwRad:1.7,covRad:1.73,type:0},elem.Tm={atomNo:69,vdwRad:1.7,covRad:1.72,type:0},elem.Yb={atomNo:70,vdwRad:1.7,covRad:1.94,type:0},elem.Lu={atomNo:71,vdwRad:1.7,covRad:1.72,type:0},elem.Hf={atomNo:72,vdwRad:1.7,covRad:1.57,type:0},elem.Ta={atomNo:73,vdwRad:1.7,covRad:1.43,type:0},elem.W={atomNo:74,vdwRad:1.7,covRad:1.37,type:0},elem.Re={atomNo:75,vdwRad:1.7,covRad:1.35,type:0},elem.Os={atomNo:76,vdwRad:1.7,covRad:1.37,type:0},elem.Ir={atomNo:77,vdwRad:1.7,covRad:1.32,type:0},elem.Pt={atomNo:78,vdwRad:1.72,covRad:1.5,type:0},elem.Au={atomNo:79,vdwRad:1.66,covRad:1.5,type:0},elem.Hg={atomNo:80,vdwRad:1.55,covRad:1.7,type:0},elem.Tl={atomNo:81,vdwRad:1.96,covRad:1.55,type:0},elem.Pb={atomNo:82,vdwRad:2.02,covRad:1.54,type:0},elem.Bi={atomNo:83,vdwRad:1.7,covRad:1.54,type:0},elem.Po={atomNo:84,vdwRad:1.7,covRad:1.68,type:0},elem.At={atomNo:85,vdwRad:1.7,covRad:1.7,type:0},elem.Rn={atomNo:86,vdwRad:1.7,covRad:2.4,type:0},elem.Fr={atomNo:87,vdwRad:1.7,covRad:2,type:0},elem.Ra={atomNo:88,vdwRad:1.7,covRad:1.9,type:0},elem.Ac={atomNo:89,vdwRad:1.7,covRad:1.88,type:0},elem.Th={atomNo:90,vdwRad:1.7,covRad:1.79,type:0},elem.Pa={atomNo:91,vdwRad:1.7,covRad:1.61,type:0},elem.U={atomNo:92,vdwRad:1.86,covRad:1.58,type:0},elem.Np={atomNo:93,vdwRad:1.7,covRad:1.55,type:0},elem.Pu={atomNo:94,vdwRad:1.7,covRad:1.53,type:0},elem.Am={atomNo:95,vdwRad:1.7,covRad:1.51,type:0},elem.Cm={atomNo:96,vdwRad:1.7,covRad:1.5,type:0},elem.Bk={atomNo:97,vdwRad:1.7,covRad:1.5,type:0},elem.Cf={atomNo:98,vdwRad:1.7,covRad:1.5,type:0},elem.Es={atomNo:99,vdwRad:1.7,covRad:1.5,type:0},elem.Fm={atomNo:100,vdwRad:1.7,covRad:1.5,type:0},elem.Md={atomNo:101,vdwRad:1.7,covRad:1.5,type:0},elem.No={atomNo:102,vdwRad:1.7,covRad:1.5,type:0},elem.Lr={atomNo:103,vdwRad:1.7,covRad:1.5,type:0},elem.Rf={atomNo:104,vdwRad:1.7,covRad:1.6,type:0},elem.Db={atomNo:105,vdwRad:1.7,covRad:1.6,type:0},elem.Sg={atomNo:106,vdwRad:1.7,covRad:1.6,type:0},elem.Bh={atomNo:107,vdwRad:1.7,covRad:1.6,type:0},elem.Hs={atomNo:108,vdwRad:1.7,covRad:1.6,type:0},elem.Mt={atomNo:109,vdwRad:1.7,covRad:1.6,type:0},Scif.prototype.elements=elem,Scif._block.prototype.elements=elem})(Scif),function(e){function t(e){return e=="."||e=="?"||e==""?!0:!1}e._block.prototype.getItemValue=function(e){for(var t=0;t<e.length;t++){var n=this.cifitems[e[t]];if(!n)continue;n.looped}}}(Scif);var BouncyScrollyDiv=function(){function e(e,t){if(!e)return;if(!t)return;t.parentNode.insertBefore(e,t)}function t(e,t){if(!e)return;if(!t)return;t.parentNode.insertBefore(e,t.nextSibling)}function n(e){var t=curtop=0;if(e.offsetParent)do t+=e.offsetLeft,curtop+=e.offsetTop;while(e=e.offsetParent);return[t,curtop]}function r(e,t){var r=[];if(typeof IE7!="undefined")var i=n(e);if(t=="canvas"&&typeof FlashCanvas!="undefined"){var s=e.getElementsByTagName("object");for(var o=0;o<s.length;o++){var u=s[o].offsetLeft,a=s[o].offsetTop;if(typeof IE7!="undefined"){var f=n(s[o]);u=f[0]-i[0],a=f[1]-i[1]}r.push([u,a,s[o].offsetWidth+0,s[o].offsetHeight+0])}return r}var l=e.getElementsByTagName(t)[0],c=0;while(l){if(l.nodeType==1&&l.nodeName&&l.nodeName==t.toUpperCase()){var u=l.offsetLeft,a=l.offsetTop;if(typeof IE7!="undefined"){var f=n(l);u=f[0]-i[0],a=f[1]-i[1]}r.push([u,a,l.offsetWidth+0,l.offsetHeight+0])}l=l.nextSibling,c++;if(c>1e3)break}return r}function i(e,t){var n=r(e.getElementsByTagName("div")[0],t),i=0,s=0,o=[],u=[];for(var a=0;a<n.length;a++)a==0&&(i=n[a][1],s=n[a][0]),n[a][1]-=i,n[a][0]-=s,o.indexOf(n[a][0])==-1&&o.push([n[a][0],n[a][2]]),u.indexOf(n[a][1])==-1&&u.push([n[a][1],n[a][3]]);e._scrollTabs=n,e._hTabs=o,e._vTabs=u;var f=0,l=0;e._scrollButs=="top"||e._scrollButs=="bottom"?f=e._tbr.offsetHeight>0?e._tbr.offsetHeight:e._tbr.offsetHeight:e._scrollButs=="topbottom"&&(f=e._tbr.offsetHeight+e._tbl.offsetHeight);if(e._scrollButs=="left"||e._scrollButs=="right"||e._scrollButs=="leftright")l=e._tbr.offsetWidth+e._tbl.offsetWidth;e._h=e.offsetHeight-f,e._w=e.offsetWidth-l,e._incToNextElH=function(){for(var e=0;e<this._hTabs.length;e++){if(this._hTabs[e][0]>this.scrollLeft&&this._hTabs[e][0]-this.scrollLeft<this._w&&this._hTabs[e][0]-this.scrollLeft+this._hTabs[e][1]>this._w)return this._hTabs[e][0]-this.scrollLeft+this._hTabs[e][1]-this._w;if(this._hTabs[e][0]>this.scrollLeft&&this._hTabs[e][0]-this.scrollLeft>=this._w)return e==this._hTabs.length-1?this._hTabs[e][1]:this._hTabs[e+1][0]-this._hTabs[e][0]}return 0},e._incToNextElV=function(){for(var e=0;e<this._vTabs.length;e++){if(this._vTabs[e][0]>this.scrollTop&&this._vTabs[e][0]-this.scrollTop<this._h&&this._vTabs[e][0]-this.scrollTop+this._vTabs[e][1]>this._h)return this._vTabs[e][0]-this.scrollTop+this._vTabs[e][1]-this._h;if(this._vTabs[e][0]>this.scrollTop&&this._vTabs[e][0]-this.scrollTop>=this._h)return e==this._vTabs.length-1?this._vTabs[e][1]:this._vTabs[e+1][0]-this._vTabs[e][0]}return 0},e._incToPreviousElH=function(){for(var e=this._hTabs.length-1;e>=0;e--){if(this._hTabs[e][0]<this.scrollLeft&&this._hTabs[e][0]+this._hTabs[e][1]>this.scrollLeft)return this.scrollLeft-this._hTabs[e][0];if(this._hTabs[e][0]<this.scrollLeft)return this._hTabs[e+1][0]-this._hTabs[e][0]}return 0},e._incToPreviousElV=function(){for(var e=this._vTabs.length-1;e>=0;e--){if(this._vTabs[e][0]<this.scrollTop&&this._vTabs[e][0]+this._vTabs[e][1]>this.scrollTop)return this.scrollTop-this._vTabs[e][0];if(this._vTabs[e][0]<this.scrollTop)return this._vTabs[e+1][0]-this._vTabs[e][0]}return 0}}function s(e,t){e._unfinishedScroll=!0,e._useEls&&!e._scrollTabs&&i(e,e._step),t&&(e._incc=0,e._dy=1,e._ddy=1,e._inc=Math.abs(t),t<0&&(e._ddy=-1),e._useEls||(e._scrollMode==1?e._padding=(e.scrollWidth-e.offsetWidth)%e._inc:e._padding=(e.scrollHeight-e.offsetHeight)%e._inc));if(e._incc<=e._inc){e._dy<10&&(e._dy+=1),e._incc+e._dy>e._inc&&(e._dy=e._inc-e._incc),e._incc+=e._dy,e._scrollMode==1?e.scrollLeft+=e._ddy*e._dy:e.scrollTop+=e._ddy*e._dy;if(e._incc>=e._inc){if(e._isScrolling){if(e._useEls)if(e._ddy==-1){var n;e._scrollMode==1?n=e._incToPreviousElH():n=e._incToPreviousElV(),n==0&&e._scrollMode==1?u(e,3,-100):n==0?u(e,3,-100):e._scrollRate?setTimeout(function(){s(e,-1*n)},e._scrollRate):s(e,-1*n)}else{var n;e._scrollMode==1?n=e._incToNextElH():n=e._incToNextElV(),n==0&&e._scrollMode==1?u(e,3,100):n==0?u(e,3,-100):e._scrollRate?setTimeout(function(){s(e,n)},e._scrollRate):s(e,n)}else if(e._scrollMode==1){var r=e.scrollWidth-e.scrollLeft-e.offsetWidth;e._ddy==1&&r<e._padding+e._inc?u(e,3,-100):e._ddy==-1&&e.scrollLeft<e._inc/2?(e.scrollLeft=0,u(e,3,100)):e._scrollRate?setTimeout(function(){s(e,e._ddy*e._inc)},e._scrollRate):s(e,e._ddy*e._inc)}else{var r=e.scrollHeight-e.scrollTop-e.offsetHeight;e._ddy==1&&r<e._padding+e._inc?u(e,3,e._ddy*100):e._ddy==-1&&e.scrollTop<e._inc/2?(e.scrollTop=0,u(e,3,e._ddy*100)):e._scrollRate?setTimeout(function(){s(e,e._ddy*e._inc)},e._scrollRate):s(e,e._ddy*e._inc)}typeof e._onScrollCallback=="function"&&e._onScrollCallback()}else a(e),e._stepBounce?u(e,3,e._ddy*100):(e._unfinishedScroll=!1,o(e));return}e._t=setTimeout(function(){s(e)},10)}}function o(e){e._scrollRate=0;var t=e._scrollCallback.pop();typeof t=="function"&&t(),typeof e._onScrollEndCallback=="function"&&e._onScrollEndCallback()}function u(e,t,n){if(e._scrollCallback.length>0){e._unfinishedScroll=!1,a(e),o(e);return}t&&(e._b=t,e._incc=0,e._dy=1,n?(e._scrollMode==1?e._cscroll=e.scrollLeft:e._cscroll=e.scrollTop,n>0?e._ddy=1:e._ddy=-1,e._inc=Math.abs(n),e._newb=!0,e._dy=4):(e._scrollMode==1?e.scrollLeft=e._cscroll:e.scrollTop=e._cscroll,e._inc=parseInt(e._inc*.3),e._inc=e._inc-e._inc%2,e._newb=!0,e._dy=4,e._b<5&&(e._dy=1)));if(e._incc<e._inc)e._newb&&e._incc>=e._inc/2&&(e._ddy==-1?e._ddy=1:e._ddy=-1,e._newb=!1),e._incc+e._dy>e._inc&&(e._dy=e._inc-e._incc),e._scrollMode==1?e.style.left=parseInt(e.style.left)+e._ddy*e._dy+"px":e.style.top=parseInt(e.style.top)+e._ddy*e._dy+"px",e._incc+=e._dy,e._t=setTimeout(function(){u(e)},10);else{e._b--;if(e._inc<5||e._b<1){e._scrollMode==1?(e.scrollLeft=e._cscroll,e.style.left="0px"):(e.scrollTop=e._cscroll,e.style.top="0px"),e._unfinishedScroll=!1,a(e),o(e);return}e._ddy==-1?e._ddy=1:e._ddy=-1,u(e,e._b)}}function a(e){if(e._scrollMode==1)if(e.scrollLeft>0){e._tbl.style.display="inline-block",typeof IE7!="undefined"&&(e._tbl.style.zoom="1",e._tbl.style.display="inline");if(e._scrollButs=="top"||e._scrollButs=="bottom")e._tbr.style.left="0px"}else{e._tbl.style.display="none";if(e._scrollButs=="top"||e._scrollButs=="bottom")e._tbr.style.left="50%"}else e.scrollTop>0?(e._tbl.style.display="inline-block",typeof IE7!="undefined"&&(e._tbl.style.zoom="1",e._tbl.style.display="inline"),e._tbr.style.left="0px"):e._tbl.style.display="none";if(e._useEls){e._scrollTabs||i(e,e._step);var t;e._scrollMode==1?t=e._incToNextElH():t=e._incToNextElV(),t==0?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}else if(e._scrollMode==1){var n=e.scrollWidth-e.scrollLeft-e.offsetWidth;n<=e._padding?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}else{var n=e.scrollHeight-e.scrollTop-e.offsetHeight;n<=e._padding?e._tbr.style.display="none":(e._tbr.style.display="inline-block",typeof IE7!="undefined"&&(e._tbr.style.zoom="1",e._tbr.style.display="inline"))}}function f(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}return{init:function(t,r){function h(e){var t=c,n=e||window.event;n.targetTouches||(n.preventDefault?n.preventDefault():n.returnValue=!1);var r=n.pageX,i=n.pageY;n.targetTouches&&n.targetTouches[0]&&(r=n.targetTouches[0].pageX,i=n.targetTouches[0].pageY),r==undefined&&(r=n.clientX,i=n.clientY);if(r==undefined)return;t._isDragging=!0,t._mouseStartX=r,t._mouseStartY=i}function p(e){var t=e||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1;var n=c;if(!n._isDragging)return;var r=t.pageX,i=t.pageY;t.targetTouches&&t.targetTouches[0]&&(r=t.targetTouches[0].pageX,i=t.targetTouches[0].pageY),r==undefined&&(r=t.clientX,i=t.clientY);if(r==undefined)return;var s=r-n._mouseStartX,o=i-n._mouseStartY;n._mouseStartX=r,n._mouseStartY=i,n._scrollMode==1?n.scrollLeft+=-1*s:n.scrollTop+=-1*o,typeof n._onScrollCallback=="function"&&n._onScrollCallback()}function d(e,t){var r=c;if(!r._isDragging)return;if(!t||t!="out"){r._isDragging=!1,a(r),typeof r._onScrollEndCallback=="function"&&r._onScrollEndCallback();return}var i=e||window.event,s=i.pageX,o=i.pageY;i.targetTouches&&i.targetTouches[0]&&(s=i.targetTouches[0].pageX,o=i.targetTouches[0].pageY),s==undefined&&(s=i.clientX,o=i.clientY);if(s==undefined)return;var u=n(r);s<u[0]+100?r._isDragging=!1:s>u[0]+r.offsetWidth-100?r._isDragging=!1:o<u[1]?r._isDragging=!1:o>u[1]+r.offsetHeight&&(r._isDragging=!1),a(r),typeof r._onScrollEndCallback=="function"&&r._onScrollEndCallback()}if(t._sdiv)return;var o=document.createDocumentFragment(),l=document.createElement("div");l.style.position="relative",l.style.padding=0,l.style.margin=0,l.className="boo";if(!r.scrollMode||r.scrollMode!="vertical")t.style.width?l.style.width=t.style.width:l.style.width="100%";e(l,t);var c=document.createElement("div");t.className&&(l.className=t.className),c.style.padding=0,c.style.margin=0,c.style.overflow="hidden",c.style.position="relative",c.style.left="0px",c.style.top="0px",t.style.width&&(c.style.width=t.style.width),t.style.height&&(c.style.height=t.style.height),r.scrollMode&&r.scrollMode=="vertical"?c._scrollMode=0:c._scrollMode=1,r.buttonsPosition?c._scrollButs=r.buttonsPosition:c._scrollMode==1?c._scrollButs="leftright":c._scrollButs="bottom",r.stepBounce?c._stepBounce=r.stepBounce:c._stepBounce=!1,c._scrollButs!="leftrightouter"&&(l.style.overflow="hidden"),r.onScrollCallback&&(c._onScrollCallback=r.onScrollCallback),r.onScrollEndCallback&&(c._onScrollEndCallback=r.onScrollEndCallback),c._scrollCallback=[],c._scrollMode==1?(c.style.whiteSpace="nowrap",c.style.display="inline-block",typeof IE7!="undefined"&&(c.style.zoom="1",c.style.display="inline"),c.style.verticalAlign="top",c.style.width||(c.style.width="100%"),l.style.whiteSpace="nowrap"):c.style.display="block",c._step=10,c._useEls=!1,c._allowDrag=!0,r.allowDrag!==undefined&&r.allowDrag==0&&(c._allowDrag=!1),r.scrollStep&&(typeof r.scrollStep=="string"?c._useEls=!0:c._useEls=!1,c._step=r.scrollStep),t.style.height=null,t.style.width=null,t.style.position="relative",c._scrollMode==1&&(t.style.display="inline-block",typeof IE7!="undefined"&&(t.style.zoom="1",t.style.display="inline"),t.style.verticalAlign="top"),c.appendChild(t),c._allowDrag&&(f(t,"mousedown",function(e){h(e)}),f(t,"mousemove",function(e){p(e)}),f(t,"mouseup",function(e){d(e)}),f(t,"mouseout",function(e){d(e,"out")}),f(t,"touchstart",function(e){h(e)}),f(t,"touchmove",function(e){p(e)}),f(t,"touchend",function(e){d(e)}));var v=document.createElement("div");v.style.position="relative",c._scrollMode==1?(v.style.height="10px",v.style.width="100px",v.style.display="inline-block",typeof IE7!="undefined"&&(v.style.zoom="1",v.style.display="inline")):(v.style.height="100px",v.style.width="10px",v.style.display="block"),c.appendChild(v);var m=" &lt; ",g=" &gt; ";r.forwardbutton&&(g=r.forwardbutton),r.backbutton&&(m=r.backbutton);var y=document.createElement("div");r.buttonsClassName&&(y.className=r.buttonsClassName);var b=document.createElement("div");r.buttonsClassName&&(b.className=r.buttonsClassName),y._sdiv=c,y.onmousedown=function(){return this._sdiv._isScrolling?!1:(this._sdiv._scrollBack(),!1)},y.onmouseup=function(){return this._sdiv._isScrolling=!1,!1},y.innerHTML=m,b._sdiv=c,b.onmousedown=function(){return this._sdiv._isScrolling?!1:(this._sdiv._scrollForward(),!1)},b.onmouseup=function(){return this._sdiv._isScrolling=!1,!1},b.innerHTML=g;if(c._scrollButs=="leftright"||c._scrollButs=="leftrightouter")b.style.position="absolute",b.style.height="100%",b.style.right="0px",c._scrollButs=="leftrightouter"?(b.style.right="-100px",b.style.width="100px"):b.style.right="0px",b.style.top="0px",b.style.verticalAlign="top",b.style.zIndex=1001,b.style.background="transparent",y.style.position="absolute",y.style.verticalAlign="top",y.style.zIndex=1002,y.style.top="0px",c._scrollButs=="leftrightouter"?(y.style.left="-100px",y.style.width="100px"):y.style.left="0px",y.style.display="inline-block",typeof IE7!="undefined"&&(y.style.zoom="1",y.style.display="inline"),o.appendChild(y),o.appendChild(b),o.appendChild(c);else if(c._scrollButs=="bottom"||c._scrollButs=="top"){b.style.margin=0,b.style.position="relative",b.style.verticalAlign="top",b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline"),b.style.width="50%",b.style.top="0px",b.style.zIndex=1001,y.style.margin=0,y.style.position="relative",y.style.verticalAlign="top",y.style.display="inline-block",typeof IE7!="undefined"&&(y.style.zoom="1",y.style.display="inline"),y.style.width="50%";var w=document.createElement("div");w.style.position="relative",w.style.width="100%",w.style.whiteSpace="nowrap",w.appendChild(y),w.appendChild(b),c._scrollButs=="bottom"?(o.appendChild(c),o.appendChild(w)):(o.appendChild(w),o.appendChild(c))}c.scrollLeft=0,c.scrollTop=0,l.appendChild(o),c._scrollMode==1?(c._scrollButs=="leftright"&&(y.style.height=l.offsetHeight+"px"),c.scrollWidth>=c.offsetWidth+100?(b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline")):b.style.display="none",y.style.display="none"):(c.scrollHeight>c.offsetHeight+100?(b.style.display="inline-block",typeof IE7!="undefined"&&(b.style.zoom="1",b.style.display="inline")):b.style.display="none",y.style.display="none"),c._tbl=y,c._tbr=b,t._sdiv=c,c._scrollRepeat=function(e,n){typeof e=="function"&&this._scrollCallback.push(e),n?this._scrollRate=n:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var r;this._scrollMode==1?r=this._incToNextElH():r=this._incToNextElV(),r==0&&this._scrollMode==1?u(this,3,-100):r==0?s(this,-1*r):s(this,r)}else{this._scrollMode==1?this._padding=(this.scrollWidth-this.offsetWidth)%this._step:this._padding=(this.scrollHeight-this.offsetHeight)%this._step;if(this._scrollMode==1){var o=t.scrollWidth-t.scrollLeft-t.offsetWidth;o<=t._padding?u(this,3,-100):s(this,this._step)}else{var o=t.scrollHeight-t.scrollTop-t.offsetHeight;o<=t._padding?u(this,3,100):s(this,this._step)}}},c._scrollForward=function(e,n){typeof e=="function"&&this._scrollCallback.push(e),n?this._scrollRate=n:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var r;this._scrollMode==1?r=this._incToNextElH():r=this._incToNextElV(),r==0&&this._scrollMode==1?u(this,3,-100):r==0?u(this,3,-100):s(this,r)}else{this._scrollMode==1?this._padding=(this.scrollWidth-this.offsetWidth)%this._step:this._padding=(this.scrollHeight-this.offsetHeight)%this._step;if(this._scrollMode==1){var o=t.scrollWidth-t.scrollLeft-t.offsetWidth;o<=t._padding?u(this,3,-100):s(this,this._step)}else{var o=t.scrollHeight-t.scrollTop-t.offsetHeight;o<=t._padding?u(this,3,100):s(this,this._step)}}},c._scrollBack=function(e,t){typeof e=="function"&&this._scrollCallback.push(e),t?this._scrollRate=t:this._scrollRate=0;if(this._unfinishedScroll)return;this._isScrolling=!0;if(this._useEls){i(this,this._step);var n;this._scrollMode==1?n=this._incToPreviousElH():n=this._incToPreviousElV(),n==0&&this._scrollMode==1?u(this,3,100):n==0?u(this,3,-100):s(this,-1*n)}else this._scrollMode==1?this.scrollLeft<this._step/2?(this.scrollLeft=0,u(this,3,-100)):s(this,-1*this._step):this.scrollTop<this._step/2?(this.scrollTop=0,u(this,3,100)):s(this,-1*this._step)},t.ensureElVisible=function(e){i(this._sdiv,this._sdiv._step);var t=this._sdiv._hTabs;if(t[e]){var n=this._sdiv.scrollLeft,r=this._sdiv.scrollLeft+this._sdiv.offsetWidth,s=t[e][0],o=t[e][0]+t[e][1];s>n&&o<r||(s>n&&o>r?this._sdiv.scrollLeft=o:s<n&&o<r&&(this._sdiv.scrollLeft=s)),a(this._sdiv)}},t.resetScroll=function(e){this._sdiv._scrollMode==1?(this._sdiv.scrollLeft=0,this._sdiv.scrollWidth>=this._sdiv.offsetWidth+100?(this._sdiv._tbr.style.display="inline-block",typeof IE7!="undefined"&&(this._sdiv._tbr.style.zoom="1",this._sdiv._tbr.style.display="inline")):this._sdiv._tbr.style.display="none",this._sdiv._tbl.style.display="none"):(this._sdiv.scrollTop=0,this._sdiv.scrollHeight>this._sdiv.offsetHeight+100?(this._sdiv._tbr.style.display="inline-block",typeof IE7!="undefined"&&(this._sdiv._tbr.style.zoom="1",this._sdiv._tbr.style.display="inline")):this._sdiv._tbr.style.display="none",this._sdiv._tbl.style.display="none"),this._sdiv._unfinishedScroll=!1,this._sdiv._isScrolling=!1},t.setScrollStep=function(e){this._sdiv._step=e,typeof e=="string"?(this._sdiv._useEls=!0,i(this._sdiv,this._sdiv._step)):this._sdiv._useEls=!1,this.resetScroll()},t.scrollRepeat=function(){var e=this;this._sdiv._scrollForward(function(){e.resetScroll()},1e3)},c._winResizeTimer=setTimeout(function(){},0),t._winResize=function(e){window.clearTimeout(this._sdiv._winResizeTimer);var t=this;this._sdiv._winResizeTimer=setTimeout(function(){if(t._sdiv._scrollMode==1){var e=t._sdiv.parentNode;if(e){t._sdiv.style.display="none";var n=e.offsetWidth-t._sdiv.offsetLeft;n>0&&(t._sdiv.style.maxWidth=n+"px"),t._sdiv.style.display="block"}}t.resetScroll()},500)},window.addEventListener?window.addEventListener("resize",function(){t._winResize()},!1):window.attachEvent&&window.attachEvent("onresize",function(){t._winResize()});if(t._sdiv._scrollMode==1){var E=t._sdiv.parentNode;if(E){t._sdiv.style.display="none";var S=E.offsetWidth-t._sdiv.offsetLeft;S>0&&(t._sdiv.style.maxWidth=S+"px"),t._sdiv.style.display="block"}}t.resetScroll()}}}();/*
 * Smol - *S*imple HTML5 canvas *S*mall-molecule viewer 
 * - designed primarily as a 'quick' viewer to be used alongside Jmol
 * (i.e. Jmol is a full app so load time can be very slow esp. on mobile devices,
 * so use the Smol quick view on load, then call Jmol if requested by user...)
 * 
 * - built using GLmol as a 'model', but doesn't use webGL and has removed all dependency on three.js
 *   and Jquery - so can standalone (Jmol already has its own version of GLmol/THREE, so could conflict...)
 *
*/// TODO set gradcolors earlier!!!!!!!!!!!!!!!
var oldBrowser=!1;if(console===undefined){function _console(){return{log:function(e){}}}var console=new _console}(function(){var e=0,t=["webkit","moz"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var SmolElementData=function(){return _elColours={H:14932681,He:14286847,Li:13402367,Be:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,Na:11230450,Mg:9109248,Al:12560038,Si:1578e4,P:16744448,S:16777008,Cl:2093087,Ar:8442339,K:9388244,Ca:4062976,Sc:15132390,Ti:12567239,V:10921643,Cr:9083335,Mn:10255047,Fe:14706227,Co:15765664,Ni:5296208,Cu:13140019,Zn:8224944,Ga:12750735,Ge:6721423,As:12419299,Se:16752896,Br:10889513,Kr:6076625,Rb:7351984,Sr:65280,Y:9764863,Zr:9756896,Nb:7586505,Mo:5551541,Tc:3907230,Ru:2396047,Rh:687500,Pd:27013,Ag:12632256,Cd:16767375,In:10909043,Sn:6717568,Sb:10380213,Te:13924864,I:9699476,Xe:4366e3,Cs:5707663,Ba:51456,La:7394559,Ce:16777159,Pr:14286791,Nd:13107143,Pm:10747847,Sm:9437127,Eu:6422471,Gd:4587463,Tb:3211207,Dy:2097095,Ho:65436,Er:58997,Tm:54354,Yb:48952,Lu:43812,Hf:5096191,Ta:5089023,W:2200790,Re:2522539,Os:2516630,Ir:1528967,Pt:13684960,Au:16765219,Hg:12105936,Tl:10900557,Pb:5724513,Bi:10375093,Po:11230208,At:7688005,Rn:4358806,Fr:4325478,Ra:32e3,Ac:7384058,Th:47871,Pa:41471,U:36863,Np:33023,Pu:27647,Am:5528818,Cm:7888099,Bk:9064419,Cf:10565332,Es:11739092,Fm:11739066,Md:11734438,No:12389767,Lr:13041766,Rf:13369433,Db:13697103,Sg:14221381,Bh:14680120,Hs:15073326,Mt:15400998,Ds:0,Rg:0,Cn:0,Uut:0,Uuq:0,Uup:0,Uuh:0,Uus:0,Uuo:0},_elVdwRadii={H:1,He:1.4,Li:1.82,Be:1.7,B:1.7,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.7,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:1.7,Sc:1.7,Ti:1.7,V:1.7,Cr:1.7,Mn:1.7,Fe:1.7,Co:1.7,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:1.7,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:1.7,Sr:1.7,Y:1.7,Zr:1.7,Nb:1.7,Mo:1.7,Tc:1.7,Ru:1.7,Rh:1.7,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:1.7,Te:2.06,I:1.98,Xe:2.16,Cs:1.7,Ba:1.7,La:1.7,Ce:1.7,Pr:1.7,Nd:1.7,Pm:1.7,Sm:1.7,Eu:1.7,Gd:1.7,Tb:1.7,Dy:1.7,Ho:1.7,Er:1.7,Tm:1.7,Yb:1.7,Lu:1.7,Hf:1.7,Ta:1.7,W:1.7,Re:1.7,Os:1.7,Ir:1.7,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:1.7,Po:1.7,At:1.7,Rn:1.7,Fr:1.7,Ra:1.7,Ac:1.7,Th:1.7,Pa:1.7,U:1.86,Np:1.7,Pu:1.7,Am:1.7,Cm:1.7,Bk:1.7,Cf:1.7,Es:1.7,Fm:1.7,Md:1.7,No:1.7,Lr:1.7,Rf:1.7,Db:1.7,Sg:1.7,Bh:1.7,Hs:1.7,Mt:1.7,Ds:1.7,Rg:1.7,Cn:1.7,Uut:1.7,Uuq:1.7,Uup:1.7,Uuh:1.7,Uus:1.7,Uuo:1.7},_elCovRadii={H:.23,He:.93,Li:.68,Be:.35,B:.83,C:.68,N:.68,O:.68,F:.64,Ne:1.12,Na:.97,Mg:1.1,Al:1.35,Si:1.2,P:.75,S:1.02,Cl:.99,Ar:1.57,K:1.33,Ca:.99,Sc:1.44,Ti:1.47,V:1.33,Cr:1.35,Mn:1.35,Fe:1.34,Co:1.33,Ni:1.5,Cu:1.52,Zn:1.45,Ga:1.22,Ge:1.17,As:1.21,Se:1.22,Br:1.21,Kr:1.91,Rb:1.47,Sr:1.12,Y:1.78,Zr:1.56,Nb:1.48,Mo:1.47,Tc:1.35,Ru:1.4,Rh:1.45,Pd:1.5,Ag:1.59,Cd:1.69,In:1.63,Sn:1.46,Sb:1.46,Te:1.47,I:1.4,Xe:1.98,Cs:1.67,Ba:1.34,La:1.87,Ce:1.83,Pr:1.82,Nd:1.81,Pm:1.8,Sm:1.8,Eu:1.99,Gd:1.79,Tb:1.76,Dy:1.75,Ho:1.74,Er:1.73,Tm:1.72,Yb:1.94,Lu:1.72,Hf:1.57,Ta:1.43,W:1.37,Re:1.35,Os:1.37,Ir:1.32,Pt:1.5,Au:1.5,Hg:1.7,Tl:1.55,Pb:1.54,Bi:1.54,Po:1.68,At:1.7,Rn:2.4,Fr:2,Ra:1.9,Ac:1.88,Th:1.79,Pa:1.61,U:1.58,Np:1.55,Pu:1.53,Am:1.51,Cm:1.5,Bk:1.5,Cf:1.5,Es:1.5,Fm:1.5,Md:1.5,No:1.5,Lr:1.5,Rf:1.6,Db:1.6,Sg:1.6,Bh:1.6,Hs:1.6,Mt:1.6},{elColours:_elColours,elVdwRadii:_elVdwRadii,elCovRadii:_elCovRadii}}(),Smol=function(){function e(e,t){return this._create(e,t),this}return e.prototype._create=function(e,t){this._options={id:(new Date).getTime()+"",show:-1,spin:!1,spinToBestFit:!1,background:"transparent",viewStyle:"ball_and_stick",mmViewStyle:"ribbon",colourScheme:"rainbow",size:300,readyCallback:!1,clickCallback:!1,pickCallback:!1,bondpickCallback:!1,selectCallback:!1,changedCallback:!1,spinCallback:!1,mouseOverCallback:!1,type:"mol",view:"",symRange:"",vdwScale:.22,ellipScale:.5,picking:0,bondpicking:0,label:!1,popup:!1,popupOptions:{},info:"",title:"",dataformat:""};if(t)for(var n in t)typeof this._options[n]!="undefined"&&(this._options[n]=t[n]);this._widgets=[],_elColours=SmolElementData.elColours,_elVdwRadii=SmolElementData.elVdwRadii,_aaColours=[],_aaColours.ALA={r:200,g:200,b:200},_aaColours.ARG={r:20,g:90,b:255},_aaColours.ASN={r:0,g:220,b:220},_aaColours.ASP={r:230,g:10,b:10},_aaColours.CYS={r:230,g:230,b:0},_aaColours.GLN={r:0,g:220,b:220},_aaColours.GLU={r:230,g:10,b:10},_aaColours.GLY={r:235,g:235,b:235},_aaColours.HIS={r:130,g:130,b:210},_aaColours.ILE={r:15,g:130,b:15},_aaColours.LEU={r:15,g:130,b:15},_aaColours.LYS={r:20,g:90,b:255},_aaColours.MET={r:230,g:230,b:0},_aaColours.PHE={r:50,g:50,b:170},_aaColours.PRO={r:220,g:150,b:130},_aaColours.SER={r:250,g:150,b:0},_aaColours.THR={r:250,g:150,b:0},_aaColours.TRP={r:180,g:90,b:180},_aaColours.TYR={r:50,g:50,b:170},_aaColours.VAL={r:15,g:130,b:15},_aaColours.ASX={r:255,g:105,b:180},_aaColours.GLX={r:255,g:105,b:180},_aaColours.other={r:190,g:160,b:110},_aaColoursD=[],_aaColoursD.other={r:95,g:80,b:55},_aaColoursD.GLX={r:128,g:53,b:90},_aaColoursD.ASX={r:128,g:53,b:90},_aaColoursD.VAL={r:8,g:65,b:8},_aaColoursD.TYR={r:25,g:25,b:85},_aaColoursD.TRP={r:90,g:45,b:90},_aaColoursD.THR={r:125,g:75,b:0},_aaColoursD.SER={r:125,g:75,b:0},_aaColoursD.PRO={r:110,g:75,b:65},_aaColoursD.PHE={r:25,g:25,b:85},_aaColoursD.MET={r:115,g:115,b:0},_aaColoursD.LYS={r:10,g:45,b:128},_aaColoursD.LEU={r:8,g:65,b:8},_aaColoursD.ILE={r:8,g:65,b:8},_aaColoursD.HIS={r:65,g:65,b:105},_aaColoursD.GLY={r:118,g:118,b:118},_aaColoursD.GLU={r:115,g:5,b:5},_aaColoursD.GLN={r:0,g:110,b:110},_aaColoursD.CYS={r:115,g:115,b:0},_aaColoursD.ASP={r:115,g:5,b:5},_aaColoursD.ASN={r:0,g:110,b:110},_aaColoursD.ARG={r:10,g:45,b:128},_aaColoursD.ALA={r:100,g:100,b:100},_ssSheetColour={r:255,g:200,b:0},_ssSheetColourD={r:128,g:100,b:0},_ssHelixColour={r:255,g:0,b:128},_ssHelixColourD={r:128,g:0,b:64},_nonpolarCol={r:255,g:0,b:0},_polarCol={r:0,g:0,b:255},_nonpolarColD={r:128,g:0,b:0},_polarColD={r:0,g:0,b:128},_polarResidues=["ARG","HIS","LYS","ASP","GLU","SER","THR","ASN","GLN","CYS"],_nonpolarResidues=["GLY","PRO","ALA","VAL","LEU","ILE","MET","PHE","TYR","TRP"],_chainColours=[],_chainColours.A={r:192,g:208,b:255},_chainColours.a={r:144,g:160,b:207},_chainColours.B={r:176,g:255,b:176},_chainColours.b={r:128,g:207,b:152},_chainColours.C={r:255,g:192,b:200},_chainColours.c={r:207,g:144,b:176},_chainColours.D={r:255,g:255,b:128},_chainColours.d={r:207,g:207,b:112},_chainColours.E={r:255,g:192,b:255},_chainColours.e={r:207,g:144,b:207},_chainColours.F={r:176,g:240,b:240},_chainColours.f={r:128,g:192,b:192},_chainColours.G={r:255,g:208,b:112},_chainColours.g={r:207,g:160,b:96},_chainColours.H={r:240,g:128,b:128},_chainColours.h={r:192,g:80,b:112},_chainColours.I={r:245,g:222,b:179},_chainColours.i={r:197,g:174,b:131},_chainColours.J={r:0,g:191,b:255},_chainColours.j={r:0,g:167,b:207},_chainColours.K={r:205,g:92,b:92},_chainColours.k={r:181,g:76,b:76},_chainColours.L={r:102,g:205,b:170},_chainColours.l={r:86,g:181,b:146},_chainColours.M={r:154,g:205,b:50},_chainColours.m={r:138,g:181,b:42},_chainColours.N={r:238,g:130,b:238},_chainColours.n={r:190,g:114,b:190},_chainColours.O={r:0,g:206,b:209},_chainColours.o={r:0,g:182,b:161},_chainColours.P={r:0,g:255,b:127},_chainColours.p={r:0,g:207,b:111},_chainColours[0]={r:0,g:207,b:111},_chainColours.Q={r:60,g:179,b:113},_chainColours.q={r:52,g:155,b:97},_chainColours[1]={r:52,g:155,b:97},_chainColours.R={r:0,g:0,b:139},_chainColours.r={r:0,g:0,b:187},_chainColours[2]={r:0,g:0,b:187},_chainColours.S={r:189,g:183,b:107},_chainColours.s={r:165,g:159,b:91},_chainColours[3]={r:165,g:159,b:91},_chainColours.T={r:0,g:100,b:0},_chainColours.t={r:0,g:148,b:0},_chainColours[4]={r:0,g:148,b:0},_chainColours.U={r:128,g:0,b:0},_chainColours.u={r:176,g:0,b:0},_chainColours[5]={r:176,g:0,b:0},_chainColours.V={r:128,g:128,b:0},_chainColours.v={r:176,g:176,b:0},_chainColours[6]={r:176,g:176,b:0},_chainColours.W={r:128,g:0,b:128},_chainColours.w={r:176,g:0,b:176},_chainColours[7]={r:176,g:0,b:176},_chainColours.X={r:0,g:128,b:128},_chainColours.x={r:0,g:176,b:176},_chainColours[8]={r:0,g:176,b:176},_chainColours.Y={r:184,g:134,b:11},_chainColours.y={r:232,g:182,b:19},_chainColours[9]={r:232,g:182,b:19},_chainColours.Z={r:178,g:34,b:34},_chainColours.z={r:194,g:50,b:50},_chainColours.other={r:190,g:160,b:110},_chainColoursD=[],_chainColoursD.other={r:95,g:80,b:55},_chainColoursD.z={r:97,g:25,b:25},_chainColoursD.Z={r:89,g:17,b:17},_chainColoursD[9]={r:116,g:91,b:10},_chainColoursD.y={r:116,g:91,b:10},_chainColoursD.Y={r:92,g:67,b:6},_chainColoursD[8]={r:0,g:88,b:88},_chainColoursD.x={r:0,g:88,b:88},_chainColoursD.X={r:0,g:64,b:64},_chainColoursD[7]={r:88,g:0,b:88},_chainColoursD.w={r:88,g:0,b:88},_chainColoursD.W={r:64,g:0,b:64},_chainColoursD[6]={r:88,g:88,b:0},_chainColoursD.v={r:88,g:88,b:0},_chainColoursD.V={r:64,g:64,b:0},_chainColoursD[5]={r:88,g:0,b:0},_chainColoursD.u={r:88,g:0,b:0},_chainColoursD.U={r:64,g:0,b:0},_chainColoursD[4]={r:0,g:74,b:0},_chainColoursD.t={r:0,g:74,b:0},_chainColoursD.T={r:0,g:50,b:0},_chainColoursD[3]={r:83,g:80,b:46},_chainColoursD.s={r:83,g:80,b:46},_chainColoursD.S={r:95,g:92,b:54},_chainColoursD[2]={r:0,g:0,b:94},_chainColoursD.r={r:0,g:0,b:94},_chainColoursD.R={r:0,g:0,b:70},_chainColoursD[1]={r:26,g:78,b:49},_chainColoursD.q={r:26,g:78,b:49},_chainColoursD.Q={r:30,g:90,b:57},_chainColoursD[0]={r:0,g:104,b:56},_chainColoursD.p={r:0,g:104,b:56},_chainColoursD.P={r:0,g:128,b:64},_chainColoursD.o={r:0,g:91,b:81},_chainColoursD.O={r:0,g:103,b:105},_chainColoursD.n={r:95,g:57,b:95},_chainColoursD.N={r:119,g:65,b:119},_chainColoursD.m={r:69,g:91,b:21},_chainColoursD.M={r:77,g:103,b:25},_chainColoursD.l={r:43,g:91,b:73},_chainColoursD.L={r:51,g:103,b:85},_chainColoursD.k={r:91,g:38,b:38},_chainColoursD.K={r:103,g:46,b:46},_chainColoursD.j={r:0,g:84,b:104},_chainColoursD.J={r:0,g:96,b:128},_chainColoursD.i={r:99,g:87,b:66},_chainColoursD.I={r:123,g:111,b:90},_chainColoursD.h={r:96,g:40,b:56},_chainColoursD.H={r:120,g:64,b:64},_chainColoursD.g={r:104,g:80,b:48},_chainColoursD.G={r:128,g:104,b:56},_chainColoursD.f={r:64,g:96,b:96},_chainColoursD.F={r:88,g:120,b:120},_chainColoursD.e={r:104,g:72,b:104},_chainColoursD.E={r:128,g:96,b:128},_chainColoursD.d={r:104,g:104,b:56},_chainColoursD.D={r:128,g:128,b:64},_chainColoursD.c={r:104,g:72,b:88},_chainColoursD.C={r:128,g:96,b:100},_chainColoursD.b={r:64,g:104,b:76},_chainColoursD.B={r:88,g:128,b:88},_chainColoursD.a={r:72,g:80,b:104},_chainColoursD.A={r:96,g:104,b:128},this._getModels(e)},e.prototype._getModels=function(t){function y(e){n[e]?(c=new Date,m._getModelSet(m.blocks[n[e].cifblk],v._options.symRange,n[e].type,function(){b(e)})):typeof v._options.readyCallback=="function"&&v._options.readyCallback(v)}function b(t){n[t].atoms=m.blocks[n[t].cifblk].model[n[t].type],n[t].selection=[],n[t].selection.length=0,_addAtomProperties(n[t].atoms),m.blocks[n[t].cifblk].mmcif&&(n[t].macromol=!0,n[t].colourScheme=v._options.colourScheme,_setRibbonData(n[t])),n[t].cell=m.blocks[n[t].cifblk].F2CmatrixCell,n[t].celldata=m.blocks[n[t].cifblk].cell;if(m.blocks[n[t].cifblk].mmcif){var r=n[t].ribbondata.extent;n[t].center2d={x:r[2][0],y:r[2][1],z:r[2][2]},n[t].center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];n[t].maxD=Math.sqrt(i*i+s*s+o*o)}else{var r=_getExtent(n[t].atoms);n[t].center2d={x:r[2][0],y:r[2][1],z:r[2][2]},n[t].center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];n[t].maxD=Math.sqrt(i*i+s*s+o*o)}n[t].scaleFactor2d=1;var u=v._options.id,a;v._options.popup&&(a=new SmolPopup({size:v._options.size,info:v._options.info,title:v._options.title,popupOptions:v._options.popupOptions}),u=a.popup._smoldiv.id);var f=new e._widget(u,t,v._options);a&&(a.popup._smolwidget=f,f.pup=a.popup);var l=f.w;f.h<l&&(l=f.h),n[t].scaleFactor2d=.9*l/n[t].maxD,f.model=n[t],f._cif=m,v._widgets[t]=f;if(v._options.show==-1||v._options.show==t)if(v._options.view=="cell555"||v._options.view=="cell5551"){v._widgets[t]._show();var c=v._widgets[t],h=v._options.view;setTimeout(function(){c.changeModel(h)},0)}else v._widgets[t]._show();t++,setTimeout(function(){y(t)},0)}var n=[],r=0;if(this._options.dataformat=="pdb"){var i=this._parsePDB(t);if(i&&i.length>0)for(var s=0;s<i.length;++s){var o={};o.cifblk=null,o.atoms=i[s],o.macromol=!0,o.colourScheme=this._options.colourScheme,_addAtomProperties(o.atoms),_setRibbonData(o);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l),o.scaleFactor2d=1,n[r]=o,r++}}if(n&&n.length>0){this._createWidgets(n);return}if(typeof t=="string"){var c=new Date;if(t.indexOf("#\\#PLATON")==0){var h=this._parsePlatonLis(t);if(h&&h.length>0)for(var p=0;p<h.length;++p){var o={};o.cifblk=null,o.atoms=h[p].atoms,o.bestfit=h[p].q,o.bestfit.push(1),o.moieties=h[p].moieties,o.platonsymops=h[p].platonsymops,o.cifblock=h[p].cifblock,_addAtomProperties(o.atoms);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l),o.scaleFactor2d=1,n[r]=o,r++}if(n&&n.length>0){this._createWidgets(n);return}}if(t.indexOf("#\\#MMCIFMOL")==0){var i=this._parseMMCIFmol(t);if(i&&i.length>0)for(var s=0;s<i.length;++s){var o={};o.cifblk=null,o.atoms=i[s],o.macromol=!0,o.colourScheme=this._options.colourScheme,_addAtomProperties(o.atoms,0,0,!0),_setRibbonData(o,6e4);var u=o.ribbondata.extent;o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l),o.scaleFactor2d=1,n[r]=o,r++}}if(n&&n.length>0){this._createWidgets(n);return}if(t.indexOf("#\\#CIFMOL")==0){var d=this._parseCIFmol(t);if(d&&d.length>0)for(var p=0;p<d.length;++p){var o={};o.cell=d[p].cell,o.cifblk=null,o.atoms=d[p].cell555,_addAtomProperties(o.atoms);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l),o.scaleFactor2d=1,n[r]=o,r++}if(n&&n.length>0){this._createWidgets(n);return}}var h=this._parseSDF(t);if(h&&h.length>0)for(var p=0;p<h.length;++p){var o={};o.cifblk=null,o.atoms=h[p],_addAtomProperties(o.atoms);var u=_getExtent(o.atoms);o.center2d={x:u[2][0],y:u[2][1],z:u[2][2]},o.center2d_orig={x:u[2][0],y:u[2][1],z:u[2][2]};var a=u[1][0]-u[0][0],f=u[1][1]-u[0][1],l=u[1][2]-u[0][2];o.maxD=Math.sqrt(a*a+f*f+l*l),o.scaleFactor2d=1,n[r]=o,r++}}if(n&&n.length>0){this._createWidgets(n);return}var v=this,m;typeof t!="string"&&t.blocks?m=t:m=new Scif(t);for(var g in m.blocks)if(m.blocks[g].structure){var o={};o.type=this._options.type,o.cifblk=g,n[r]=o,r++}var c=new Date;y(0)},e.prototype._createWidgets=function(t){function u(t){if(r[t]){var i=new e._widget(s,t,n._options);o&&(o.popup._smolwidget=i,i.pup=o.popup);var a=i.w;i.h<a&&(a=i.h),r[t].scaleFactor2d=.9*a/r[t].maxD,i.model=r[t],n._widgets[t]=i,(n._options.show==-1||n._options.show==t)&&n._widgets[t]._show(),t++,setTimeout(function(){u(t)},1)}else typeof n._options.readyCallback=="function"&&n._options.readyCallback(n)}var n=this,r=t,i=this._widgets.length,s=this._options.id,o;this._options.popup&&(o=new SmolPopup({size:n._options.size,info:n._options.info,title:n._options.title,popupOptions:n._options.popupOptions}),s=o.popup._smoldiv.id),setTimeout(function(){u(0)},0)},e.prototype._parsePDB=function(e){var t=[],n={},r={sheet:[],helix:[],biomtChains:"",biomtMatrices:[],symMat:[],pdbID:"",title:""},i,s=0,o=e.split("\n");for(var u=0;u<o.length;u++){line=o[u].replace(/^\s*/,"");var a=line.substr(0,6);if(a=="ATOM  "||a=="HETATM"){var f,l,c,h,p,d,v,m,g,y,b,w;b=line.substr(16,1);if(b!=" "&&b!="A")continue;y=parseInt(line.substr(6,5)),f=line.substr(12,4).replace(/ /g,""),l=line.substr(17,3),c=line.substr(21,1),h=parseInt(line.substr(22,5)),p=parseFloat(line.substr(30,8)),d=parseFloat(line.substr(38,8)),v=parseFloat(line.substr(46,8)),w=parseFloat(line.substr(60,8)),g=line.substr(76,2).replace(/ /g,""),g==""&&(g=line.substr(12,4).replace(/ /g,"")),g.length>1&&(g=g.substring(0,1).toUpperCase()+g.substring(1).toLowerCase()),line[0]=="H"?m=!0:m=!1,n[y]={resn:l,x:p,y:d,z:v,elem:g,hetflag:m,chain:c,resi:h,idx:y,atom:f,bonds:[],ss:"c",color:16777215,bonds:[],bondOrder:[],b:w}}else if(a=="SHEET "){var E=line.substr(21,1),S=parseInt(line.substr(22,4)),x=line.substr(32,1),T=parseInt(line.substr(33,4));r.sheet.push([E,S,x,T])}else if(a=="CONECT"){var N=parseInt(line.substr(6,5));for(var C=0;C<4;C++){var k=parseInt(line.substr([11,16,21,26][C],5));if(isNaN(k))continue;n[N]!=undefined&&(n[N].bonds.push(k),n[N].bondOrder.push(1))}}else if(a=="HELIX "){var E=line.substr(19,1),S=parseInt(line.substr(21,4)),x=line.substr(31,1),T=parseInt(line.substr(33,4));r.helix.push([E,S,x,T])}else if(a=="CRYST1")r.a=parseFloat(line.substr(6,9)),r.b=parseFloat(line.substr(15,9)),r.c=parseFloat(line.substr(24,9)),r.alpha=parseFloat(line.substr(33,7)),r.beta=parseFloat(line.substr(40,7)),r.gamma=parseFloat(line.substr(47,7)),r.spacegroup=line.substr(55,11);else if(a=="REMARK"){var L=parseInt(line.substr(7,3));if(L==290&&line.substr(13,5)=="SMTRY"){var A=parseInt(line[18])-1,O=parseInt(line.substr(21,2));r.symMat[O]==undefined&&(r.symMat[O]=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r.symMat[O][A]=parseFloat(line.substr(24,9)),r.symMat[O][A+4]=parseFloat(line.substr(34,9)),r.symMat[O][A+8]=parseFloat(line.substr(44,9)),r.symMat[O][A+12]=parseFloat(line.substr(54,10))}else if(L==350&&line.substr(13,5)=="BIOMT"){var A=parseInt(line[18])-1,O=parseInt(line.substr(21,2));r.biomtMatrices[O]==undefined&&(r.biomtMatrices[O]=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),r.biomtMatrices[O][A]=parseFloat(line.substr(24,9)),r.biomtMatrices[O][A+4]=parseFloat(line.substr(34,9)),r.biomtMatrices[O][A+8]=parseFloat(line.substr(44,9)),r.biomtMatrices[O][A+12]=parseFloat(line.substr(54,10))}else L==350&&line.substr(11,11)=="BIOMOLECULE"?(r.biomtMatrices=[],r.biomtChains=""):L==350&&line.substr(34,6)=="CHAINS"&&(r.biomtChains+=line.substr(41,40))}else a=="HEADER"?r.pdbID=line.substr(62,4):a=="TITLE "?(r.title==undefined&&(r.title=""),r.title+=line.substr(10,70)+"\n"):a=="COMPND"}for(var u in n){var M=n[u];if(M==undefined)continue;for(C=0;C<r.sheet.length;C++){if(M.chain!=r.sheet[C][0])continue;if(M.resi<r.sheet[C][1])continue;if(M.resi>r.sheet[C][3])continue;M.ss="s",M.resi==r.sheet[C][1]&&(M.ssbegin=!0),M.resi==r.sheet[C][3]&&(M.ssend=!0)}for(C=0;C<r.helix.length;C++){if(M.chain!=r.helix[C][0])continue;if(M.resi<r.helix[C][1])continue;if(M.resi>r.helix[C][3])continue;M.ss="h",M.resi==r.helix[C][1]?M.ssbegin=!0:M.resi==r.helix[C][3]&&(M.ssend=!0)}}return r.smallMolecule=!1,t.push(n),t},e.prototype._parseSDF=function(e){var t=[],n=e.split("\n");if(n.length<4)return;var r=0,i=0;while(i<n.length-1){if(r>-1){var s=[],o=parseInt(n[r+3].substr(0,3));if(isNaN(o)||o<=0)return;var u=parseInt(n[r+3].substr(3,3));if(isNaN(u))return;var a=r+4;if(n.length<4+o+u)return;for(var f=1;f<=o;f++){var l=n[a];a++;var c={};c.idx=f,c.x=parseFloat(l.substr(0,10)),c.y=parseFloat(l.substr(10,10)),c.z=parseFloat(l.substr(20,10)),c.xyz=[c.x,c.y,c.z],c.elem=l.substr(31,3).replace(/ /g,""),c.atom=c.elem+c.idx+"",c.bonds=[],c.bondOrder=[],s[f]=c}for(f=1;f<=u;f++){var l=n[a];a++;var h=parseInt(l.substr(0,3)),p=parseInt(l.substr(3,3)),d=parseInt(l.substr(6,3));if(isNaN(h)||isNaN(p)||isNaN(d))return;s[h].bonds.push(p),s[h].bondOrder.push(d),s[p].bonds.push(h),s[p].bondOrder.push(d)}t.push(s),r=-1,i=a}else n[i].substr(0,4)=="$$$$"&&(r=i+1);i++}return t},e.prototype._parseCIFmol=function(e){var t=[],n=0,r=e.split("\n"),i=[],s=[],o=[],u=[],a,f=0;for(var l=0;l<r.length;l++){var c=r[l].replace(/\s+/g," ").replace(/^\s*|\s*$/g,"");if(c.indexOf("_data")==0){if(t.length>0){for(var h in i)i[h].asu&&(o[h]=i[h]),i[h].mol&&(s[h]=i[h]),i[h].cell&&(u[h]=i[h]);t.push({atoms:i,asu:o,cell555:u,mol:s,cell:a}),i.length=0,o.length=0,u.length=0,s.length=0,a=null}n=1}else if(c.indexOf("_cifmol_cell_matrix")==0)a=JSON.parse(r[l].replace(/\s*_cifmol_cell_matrix\s*/i,""));else if(c.indexOf("loop_ _cifmol_atom_site_type_symbol")==0)n=2;else if(n==2){var p=c.split(" "),d={};f++,d.asu=!1,d.cell=!1,d.mol=!1,d.idx=f,d.elem=p[0],d.atom=p[1],d.x=parseFloat(p[2]),d.y=parseFloat(p[3]),d.z=parseFloat(p[4]),d.bonds=[],p.length>=6&&p[5]!="."&&(d.bonds=p[5].split(",")),d.bondOrder=[],p.length>=7&&p[6]!="."&&(d.bondOrder=p[6].split(",")),p.length>=8&&(p[7].indexOf("asu")>-1&&(d.asu=!0),p[7].indexOf("mol")>-1&&(d.mol=!0),p[7].indexOf("cell")>-1&&(d.cell=!0)),i[p[1]]=d}}for(var h in i)i[h].asu&&(o[h]=i[h]),i[h].mol&&(s[h]=i[h]),i[h].cell&&(u[h]=i[h]);return t.push({atoms:i,asu:o,cell555:u,mol:s,cell:a}),t},e.prototype._parseMMCIFmol=function(e){var t=[],n={},r={sheet:[],helix:[],biomtChains:"",biomtMatrices:[],symMat:[],pdbID:"",title:""},i,s=0,o=e.split("\n");for(var u=0;u<o.length;u++){var a=o[u].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),f=a.split(" "),l=f[0];if(l=="ATOM"&&(f[3]=="CA"||f[3]=="O")||l=="HETATM"){var c,h,p,d,v,m,g,y,b,w,E,S;w=parseInt(f[1]),c=f[3],h=f[5],p=f[6],d=parseInt(f[8]),v=parseFloat(f[10]),m=parseFloat(f[11]),g=parseFloat(f[12]),S=parseFloat(f[13]),b=f[2],b.length>1&&(b=b.substring(0,1).toUpperCase()+b.substring(1).toLowerCase()),l=="HETATM"?y=!0:y=!1,n[w]={resn:h,x:v,y:m,z:g,elem:b,hetflag:y,chain:p,resi:d,idx:w,atom:c,ss:"c",color:0,bonds:[],bondOrder:[],b:S},s++}else l!="SHEET "&&l!="CONECT"&&l!="HELIX "&&l!="CRYST1"&&l!="REMARK"&&l!="HEADER"&&l!="TITLE "&&l=="COMPND";if(s>8e4)break}return r.smallMolecule=!1,t.push(n),t},e.prototype._parsePlatonLis=function(e){var t=[],n=0,r,i,s,o=0,u=[],a=[],f=0,l=[],c=[],h=!1,p=[],d=[],v="",m=[],g=e.split("\n");if(g.length<4)return;for(var y=0;y<g.length;y++){v==""&&g[y].search(/^CIFBLOCK:/)>-1&&(v=g[y].replace(/^CIFBLOCK:/,""));if(g[y].search(/::\s+NEW\s+Xrot,\s+Yrot,\s+Zrot\s+=\s+/i)>-1){var b=g[y].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" ");if(w.length>8){r=parseInt(w[6]),i=parseInt(w[7]),s=parseInt(w[8]),s*=-1,r*=-1,r*=Math.PI/180,i*=Math.PI/180,s*=Math.PI/180;var E=Math.cos(i/2),S=Math.sin(i/2),x=Math.cos(s/2),T=Math.sin(s/2),N=Math.cos(r/2),C=Math.sin(r/2),k=E*x,L=S*T,A=k*N-L*C,O=k*C+L*N,M=S*x*N-E*T*C,_=E*T*N+S*x*C;a=[O,M,_,A]}}if(g[y].search(/^\-+\s*$/)>-1)continue;if(g[y].search(/^=+\s*$/)>-1)continue;if(g[y].indexOf("\f")==0)continue;g[y].search(/^\s*Flags\s+Label\s+Fractional\s+Coordinates/i)>-1&&(f++,l.push({id:f,formula:"",size:0}),f>1&&(c.push(m),m=[],m.length=0),n=2),g[y].search(/^\s*Flag\s+Label\s+\-\s+Connected\s+to/i)>-1&&(n=3),g[y].search(/^\s*ARU\-CODE\s+CIF\-CODE\s+Symmetry\-Code/i)>-1&&(n=4);if(n==4&&h)if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1)n=0;else for(var D=0;D<p.length;D++)if(g[y].indexOf(" "+p[D])>-1){var P=g[y].split("=");if(P.length>4){var H=P[0].replace(/^\s*|\s*$/g,""),B=P[3].replace(/^\s*|\s*$/g,"");d[p[D]]=[H,B]}}if(n==2)if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1)n=0,c.push(m),m=[],m.length=0;else if(g[y].search(/^[^\s]+\s+[^\s]+(\s+\-?\d\/\d+|\s+\-?\d+\.\d+(\(\d+\))?|\s+\d\s+){6,}/i)>-1){var b=g[y].replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" "),j={};if(w.length>11&&w[11].search(/^\d+(\.\d\d\d)?$/ig)>-1){var F=w[11].replace(/\./ig,"")+".";f<10&&(F+="0"),F+=f,j.platonsym=F;var I=!0;for(var D=0;D<p.length;D++)if(p[D]==F){I=!1;break}I&&(p.push(F),h=!0)}j.fx=parseFloat(w[2]),j.fy=parseFloat(w[3]),j.fz=parseFloat(w[4]),j.x=parseFloat(w[5]),j.y=parseFloat(w[6]),j.z=parseFloat(w[7]),j.fxyz=[j.fx,j.fy,j.fz],j.xyz=[j.x,j.y,j.z];var q=w[1].replace(/[\*<>]/g,"");j.elem=q.replace(/^([A-Z][a-z]?).*$/g,"$1"),typeof m[j.elem]=="undefined"&&(m[j.elem]=0),m[j.elem]++,j.atom=j.elem+o+"",j.bonds=[],j.bondOrder=[],j.moiety=f,j.idx=q,u[q]=j,o++}if(n==3){if(g[y].search(/Asymmetric\s+Residue\s+Unit|Unit\s+Cell\s+Contents|Displacement\s+Parameters/i)>-1){n=0;break}if(g[y].search(/^[^\s]+\s+[^\s]+\s+\-[\s<>\*]+[^\s]+/i)>-1){var b=g[y].replace(/[<>\*]/g," ").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""),w=b.split(" "),q=w[1];if(u[q])for(var R=3;R<w.length;R++){var U=w[R];if(!u[U])break;u[q].bonds.push(U),u[q].bondOrder.push(1)}}}}for(var z=0;z<c.length;z++){var W=[];for(var X in c[z])W.push(X);W.sort();var V=W.length,$="",J="",K="",Q=0;for(var G=0;G<W.length;G++){var Y=W[G],Z=c[z][Y];Q+=Z;var et="&#8203;";Z>1&&(et="<sub>"+Z+"</sub>&#8203;"),Y=="C"?$=Y+et:Y=="H"?J=Y+et:K+=Y+et}var tt=$+J+K;l[z].formula=tt,l[z].size=Q}return t.push({atoms:u,q:a,moieties:l,platonsymops:d,cifblock:v}),t},_getExtent=function(e){var t=ymin=zmin=9999,n=ymax=zmax=-9999,r=ysum=zsum=cnt=0;for(var i in e){var s=e[i];if(s==undefined)continue;if(s.x==undefined)continue;cnt++,r+=s.x,ysum+=s.y,zsum+=s.z,t=t<s.x?t:s.x,ymin=ymin<s.y?ymin:s.y,zmin=zmin<s.z?zmin:s.z,n=n>s.x?n:s.x,ymax=ymax>s.y?ymax:s.y,zmax=zmax>s.z?zmax:s.z}return[[t,ymin,zmin],[n,ymax,zmax],[r/cnt,ysum/cnt,zsum/cnt]]},_gradColor=function(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r},_addAtomProperties=function(e,t,n,r){t||(t=.3),n||(n=.7);for(var i in e){var s=e[i];if(!s||!s.elem)continue;s.bonds||(s.bonds=[],s.bondOrder=[],s.bonds.length=0,s.bondOrder.length=0);if(s.bonds.length!=s.bondOrder.length){s.bondOrder.length=0;for(var o=0;o<s.bonds.length;o++)s.bondOrder.push(1)}s.vdwRad=_elVdwRadii[s.elem];var u=_elColours[s.elem];u==undefined&&(u=0);var a=u>>16,f=u>>8&255,l=u&255,c="rgb("+a+","+f+","+l+")",h="rgb("+a+","+f+","+l+")",p=1;typeof s.occ!="undefined"&&s.occ<1&&(p=s.occ,p<.3&&(p=.3),c="rgba("+a+","+f+","+l+","+p+")",h="rgba("+a+","+f+","+l+","+p+")"),s.color={hex:u,r:a,g:f,b:l,rgb:h,rgbBase:c},s.color.rgbLa="rgba("+a+","+f+","+l+", 0.7)";if(r){s.color.rgbD=s.color.rgbL=s.color.rgb50=s.color.rgb;continue}var d={r:a,b:l,g:f},v={r:255,b:255,g:255},m=_gradColor(d,v,.5),g=m.r,y=m.g,b=m.b;g==255&&b<50&&y<50&&(b=100,y=100),b==255&&g<50&&y<50&&(g=100,y=100),y==255&&b<50&&g<50&&(b=100,g=100),s.color.rgb50="rgb("+g+","+y+","+b+")",m=_gradColor(d,v,n);var g=m.r,y=m.g,b=m.b;g==255&&b<50&&y<50&&(b=100,y=100),b==255&&g<50&&y<50&&(g=100,y=100),y==255&&b<50&&g<50&&(b=100,g=100),p==1?s.color.rgbL="rgb("+g+","+y+","+b+")":s.color.rgbL="rgba("+g+","+y+","+b+","+p+")",v={r:0,b:0,g:0},m=_gradColor(d,v,t);var g=m.r,y=m.g,b=m.b;g==255&&b<50&&y<50&&(b=100,y=100),b==255&&g<50&&y<50&&(g=100,y=100),y==255&&b<50&&g<50&&(b=100,g=100),p==1?s.color.rgb="rgb("+g+","+y+","+b+")":s.color.rgb="rgba("+g+","+y+","+b+","+p+")",v={r:0,b:0,g:0},m=_gradColor(d,v,.5);var g=m.r,y=m.g,b=m.b;g==255&&b<50&&y<50&&(b=100,y=100),b==255&&g<50&&y<50&&(g=100,y=100),y==255&&b<50&&g<50&&(b=100,g=100),p==1?s.color.rgbD="rgb("+g+","+y+","+b+")":s.color.rgbD="rgba("+g+","+y+","+b+","+p+")"}},_setRibbonData=function(e,t){var n=e.atoms,r=3,i=20,s=1.3,o=1.3,u=1.9,a=.3;e.ribbondata=[];var f,l,c,h,p,d,v=ysum=zsum=cnt=0,m=[];for(var g=0;g<r;g++)m[g]=[];var y=[];for(var g=0;g<r;g++)y[g]=[];var b,w,E,S=null,x=null,T=!1,N=null,C=[];for(var g=0;g<r;g++)C[g]=[];var k=[];for(var g=0;g<r;g++)k[g]=[];var L,A,O,M=null,_=null,D=!1,P=null,H=0;if(t)H=t,H>1e4&&(i=10),H>5e4&&(i=5),H>1e5&&(i=2);else for(var B in n){H++,H>1e4&&(i=10),H>5e4&&(i=5);if(H>1e5){i=2;break}}var j=[],F,I,q,R;for(var B in n){var U=n[B];if(U==undefined)continue;if(U.resi!=R||U.chain!=q)F!=null&&I!=null&&j.push({start:F,end:I}),F=null,I=null;U.atom=="O3'"&&!U.hetflag&&(F=U),U.resn=="A"||U.resn=="G"||U.resn=="DA"||U.resn=="DG"?U.atom=="N1"&&(I=U):U.atom=="N3"&&(I=U),R=U.resi,q=U.chain;if(U.atom!="O"&&U.atom!="CA"||!!U.hetflag)if(U.atom=="O3'"||U.atom=="OP2")if(U.atom=="O3'"){if(C[0]&&C[0].length>0&&L&&A&&(L!=U.chain||A+1!=U.resi)){var z=[];if(O&&M)for(var Q=0;Q<r;Q++){var G=-1+2/(r-1)*Q,Y={x:O[0]+M[0]*G,y:O[1]+M[1]*G,z:O[2]+M[2]*G};C[Q].push(Y),k[Q].push(P)}for(var W=0;W<C.length;W++){if(C[W].length==0)continue;C[W]=_subDividePoints(C[W],i);for(var X=0;X<C[W].length;++X){var V=X==0?0:Math.round((X-1)/i);C[W][X].atomidx=k[W][V]}z.push(C[W])}z.length>0&&e.ribbondata.push(z),C=[];for(var g=0;g<r;g++)C[g]=[];k=[];for(var g=0;g<r;g++)k[g]=[];M=null,_=null,D=!1,P=null}O=[U.x,U.y,U.z],L=U.chain,A=U.resi,_=U.ss,D=U.ssbegin||U.ssend,P=B}else{if(!O){M=null;continue}var Z=[U.x-O[0],U.y-O[1],U.z-O[2]],J=Math.sqrt(Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]);Z=[Z[0]/J,Z[1]/J,Z[2]/J];var K=.8;_=="h"?K=u:_=="s"&&(K=o),Z=[Z[0]*K,Z[1]*K,Z[2]*K],M!=undefined&&Z[0]*M[0]+Z[1]*M[1]+Z[2]*M[2]<0&&(Z=[Z[0]*-1,Z[1]*-1,Z[2]*-1]),M=Z;for(var Q=0;Q<r;Q++){var G=-1+2/(r-1)*Q,Y={x:O[0]+M[0]*G,y:O[1]+M[1]*G,z:O[2]+M[2]*G};_=="s"&&(Y.smoothen=!0),typeof f=="undefined"&&(f=Y.x,l=Y.y,c=Y.z,h=Y.x,p=Y.y,d=Y.z),Y.x>f&&(f=Y.x),Y.y>l&&(l=Y.y),Y.z>c&&(c=Y.z),Y.x<h&&(h=Y.x),Y.y<p&&(p=Y.y),Y.z<d&&(d=Y.z),cnt++,v+=Y.x,ysum+=Y.y,zsum+=Y.z,C[Q].push(Y),k[Q].push(P)}}else{var Y=U;typeof f=="undefined"&&(f=Y.x,l=Y.y,c=Y.z,h=Y.x,p=Y.y,d=Y.z),Y.x>f&&(f=Y.x),Y.y>l&&(l=Y.y),Y.z>c&&(c=Y.z),Y.x<h&&(h=Y.x),Y.y<p&&(p=Y.y),Y.z<d&&(d=Y.z),cnt++,v+=Y.x,ysum+=Y.y,zsum+=Y.z}else if(U.atom=="CA"){if(m[0]&&m[0].length>0&&b&&w&&(b!=U.chain||w+1!=U.resi)){var z=[];for(var W=0;W<m.length;W++){if(m[W].length==0)continue;m[W]=_subDividePoints(m[W],i);for(var X=0;X<m[W].length;++X){var V=X==0?0:Math.round((X-1)/i);m[W][X].atomidx=y[W][V]}z.push(m[W])}z.length>0&&e.ribbondata.push(z),m=[];for(var g=0;g<r;g++)m[g]=[];y=[];for(var g=0;g<r;g++)y[g]=[];S=null,x=null,T=!1,N=null}E=[U.x,U.y,U.z],b=U.chain,w=U.resi,x=U.ss,T=U.ssbegin||U.ssend,N=B}else{var $=[U.x-E[0],U.y-E[1],U.z-E[2]],J=Math.sqrt($[0]*$[0]+$[1]*$[1]+$[2]*$[2]);$=[$[0]/J,$[1]/J,$[2]/J];var K;x=="h"?K=u:x=="s"?K=o:K=a,$=[$[0]*K,$[1]*K,$[2]*K],S!=undefined&&$[0]*S[0]+$[1]*S[1]+$[2]*S[2]<0&&($=[$[0]*-1,$[1]*-1,$[2]*-1]),S=$;for(var Q=0;Q<r;Q++){var G=-1+2/(r-1)*Q,Y={x:E[0]+S[0]*G,y:E[1]+S[1]*G,z:E[2]+S[2]*G};x=="s"&&(Y.smoothen=!0),typeof f=="undefined"&&(f=Y.x,l=Y.y,c=Y.z,h=Y.x,p=Y.y,d=Y.z),Y.x>f&&(f=Y.x),Y.y>l&&(l=Y.y),Y.z>c&&(c=Y.z),Y.x<h&&(h=Y.x),Y.y<p&&(p=Y.y),Y.z<d&&(d=Y.z),cnt++,v+=Y.x,ysum+=Y.y,zsum+=Y.z,m[Q].push(Y),y[Q].push(N)}}}if(m[0]&&m[0].length>0){var z=[];for(var W=0;W<m.length;W++){if(m[W].length==0)continue;m[W]=_subDividePoints(m[W],i);for(var X=0;X<m[W].length;++X){var V=X==0?0:Math.round((X-1)/i);m[W][X].atomidx=y[W][V]}z.push(m[W])}z.length>0&&e.ribbondata.push(z)}if(C[0]&&C[0].length>0){if(O&&M)for(var Q=0;Q<r;Q++){var G=-1+2/(r-1)*Q,Y={x:O[0]+M[0]*G,y:O[1]+M[1]*G,z:O[2]+M[2]*G};C[Q].push(Y),k[Q].push(P)}var z=[];for(var W=0;W<C.length;W++){if(C[W].length==0)continue;C[W]=_subDividePoints(C[W],i);for(var X=0;X<C[W].length;++X){var V=X==0?0:Math.round((X-1)/i);C[W][X].atomidx=k[W][V]}z.push(C[W])}z.length>0&&e.ribbondata.push(z)}F!=null&&I!=null&&j.push({start:F,end:I}),e.ribbondata.rungs=j,e.ribbondata.extent=[[h,p,d],[f,l,c],[v/cnt,ysum/cnt,zsum/cnt]],_colourRibbonData(e)},_subDividePoints=function(e,t){var n=[],r=e;r=new Array,r.push(e[0]);for(var i=1,s=e.length-1;i<s;i++){var o=e[i],u=e[i+1];o.smoothen?r.push({x:(o.x+u.x)/2,y:(o.y+u.y)/2,z:(o.z+u.z)/2}):r.push(o)}r.push(e[e.length-1]);for(var i=-1,a=r.length;i<=a-3;i++){var f=r[i==-1?0:i],o=r[i+1],u=r[i+2],l=r[i==a-3?a-1:i+3],c={x:(u.x-f.x)*.5,y:(u.y-f.y)*.5,z:(u.z-f.z)*.5},h={x:(l.x-o.x)*.5,y:(l.y-o.y)*.5,z:(l.z-o.z)*.5};for(var p=0;p<t;p++){var d=1/t*p,v=o.x+d*c.x+d*d*(-3*o.x+3*u.x-2*c.x-h.x)+d*d*d*(2*o.x-2*u.x+c.x+h.x),m=o.y+d*c.y+d*d*(-3*o.y+3*u.y-2*c.y-h.y)+d*d*d*(2*o.y-2*u.y+c.y+h.y),g=o.z+d*c.z+d*d*(-3*o.z+3*u.z-2*c.z-h.z)+d*d*d*(2*o.z-2*u.z+c.z+h.z);n.push({x:v,y:m,z:g})}}return n.push(r[r.length-1]),n},_colourRibbonData=function(e){var t=e.colourScheme;t||(t="rainbow",e.colourScheme=t),t=="rainbow"&&_colorChainbow(e);for(var n=0;n<e.ribbondata.length;n++)for(var r=0;r<e.ribbondata
[n][0].length;r++){var i=e.ribbondata[n][0][r].atomidx;if(!e.atoms[i])continue;t=="aminoacid"?_aaColours[e.atoms[i].resn]?(e.ribbondata[n][0][r].color=_aaColours[e.atoms[i].resn],e.ribbondata[n][0][r].colorD=_aaColoursD[e.atoms[i].resn]):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other):t=="structure"?e.atoms[i].ss&&e.atoms[i].ss=="s"?(e.ribbondata[n][0][r].color=_ssSheetColour,e.ribbondata[n][0][r].colorD=_ssSheetColourD):e.atoms[i].ss&&e.atoms[i].ss=="h"?(e.ribbondata[n][0][r].color=_ssHelixColour,e.ribbondata[n][0][r].colorD=_ssHelixColourD):_aaColours[e.atoms[i].resn]?(e.ribbondata[n][0][r].color=_aaColours[e.atoms[i].resn],e.ribbondata[n][0][r].colorD=_aaColoursD[e.atoms[i].resn]):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other):t=="rainbow"?(e.ribbondata[n][0][r].color=e.atoms[i].rainbow,e.ribbondata[n][0][r].colorD=e.atoms[i].rainbowD):t=="chain"?_chainColours[e.atoms[i].chain]?(e.ribbondata[n][0][r].color=_chainColours[e.atoms[i].chain],e.ribbondata[n][0][r].colorD=_chainColoursD[e.atoms[i].chain]):(e.ribbondata[n][0][r].color=_chainColours.other,e.ribbondata[n][0][r].colorD=_chainColours.other):t=="polar"&&(_polarResidues.indexOf(e.atoms[i].resn)>-1?(e.ribbondata[n][0][r].color=_polarCol,e.ribbondata[n][0][r].colorD=_polarColD):_nonpolarResidues.indexOf(e.atoms[i].resn)>-1?(e.ribbondata[n][0][r].color=_nonpolarCol,e.ribbondata[n][0][r].colorD=_nonpolarColD):(e.ribbondata[n][0][r].color=_aaColours.other,e.ribbondata[n][0][r].colorD=_aaColoursD.other))}},_colorChainbow=function(e,t){t=!0;var n=0,r,i,s=e.atoms,o="",u=[];for(var i in s){var r=s[i];if(r==undefined)continue;(t||r.atom!="CA"||r.atom!="O3'")&&!r.hetflag&&(n++,o==""&&(o=r.chain),r.chain!=o&&(u.push(n),n=0,o=r.chain))}u.push(n);var a=u[0];n=0;var f=0;for(i in s){r=s[i];if(r==undefined)continue;r.rainbow={r:r.color.r,g:r.color.g,b:r.color.b},r.rainbowD={r:r.color.r,g:r.color.g,b:r.color.b};if((t||r.atom!="CA"||r.atom!="O3'")&&!r.hetflag){var l={r:0,g:0,b:0};l=_rgbFromHSV(240/360*(1-n/a),1,.9),r.rainbow.r=l.r*255|0,r.rainbow.g=l.g*255|0,r.rainbow.b=l.b*255|0,l=_rgbFromHSV(240/360*(1-n/a),1,.4),r.rainbowD.r=l.r*255|0,r.rainbowD.g=l.g*255|0,r.rainbowD.b=l.b*255|0,n++,n>=a&&(f++,u[f]&&(a=u[f]),n=0)}}},_rgbFromHSV=function(e,t,n){var r,i,s;ret={r:0,g:0,b:0};if(n===0)ret.r=ret.g=ret.b=0;else{r=Math.floor(e*6),i=e*6-r,e=n*(1-t),s=n*(1-t*i),t=n*(1-t*(1-i));switch(r){case 1:ret.r=s,ret.g=n,ret.b=e;break;case 2:ret.r=e,ret.g=n,ret.b=t;break;case 3:ret.r=e,ret.g=s,ret.b=n;break;case 4:ret.r=t,ret.g=e,ret.b=n;break;case 5:ret.r=n,ret.g=e,ret.b=s;break;case 6:case 0:ret.r=n,ret.g=t,ret.b=e}}return ret},e.prototype.resetColors=function(e,t,n){if(typeof n=="object")_addAtomProperties(n.model.atoms,e,t),n._show();else for(var r=0;r<this._widgets.length;++r)typeof n=="undefined"||n==-1||r==n},e.prototype.loadCIF=function(e,t){var n=document.getElementById(this._options.id);n&&(n.innerHTML="");for(var r=0;r<this._widgets.length;++r)delete this._widgets[r];this._widgets.length=0,this._createWidgets(this._getModels(e))},e.prototype.changeOptions=function(e,t){if(typeof t=="undefined"||t==-1)for(var n=0;n<this._widgets.length;++n)this._widgets[n]._show(e);else typeof t=="object"?t._show(e):this._widgets[t]&&this._widgets[t]._show(e)},e.prototype.changeModel=function(e,t){if(typeof t=="object")t.changeModel(e);else for(var n=0;n<this._widgets.length;++n)(typeof t=="undefined"||t==-1||n==t)&&this._widgets[n].changeModel(e)},e}();(function(e){function t(){var e=0;return self.innerHeight?e=self.innerWidth:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientWidth:document.body&&(e=document.body.clientWidth),e}function n(){var e=0;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function r(e,t,n){var r=e.idx,i=t.idx;e.symop!=undefined&&(r=e.atom+"_"+e.symop+"_"+e.symt,i=t.atom+"_"+t.symop+"_"+t.symt);var s=!1;for(var o=0,u=e.bonds.length;o<u;o++)if(e.bonds[o]==i){if(n==undefined){var a=e.bondOrder[o];typeof a=="undefined"&&(a=0),a==.5?a=0:(a++,a>3&&(a=.5)),n=a}e.bondOrder[o]=n,s=!0;break}s||(e.bonds.push(i),e.bondOrder.push(1)),s=!1;for(var o=0,u=t.bonds.length;o<u;o++)if(t.bonds[o]==r){if(n==undefined){var a=t.bondOrder[o];typeof a=="undefined"&&(a=0),a==.5?a=0:(a++,a>3&&(a=.5)),n=a}t.bondOrder[o]=n,s=!0;break}s||(t.bonds.push(r),t.bondOrder.push(1))}function i(e,t){var n=e.idx,r=t.idx;e.symop!=undefined&&(n=e.atom+"_"+e.symop+"_"+e.symt,r=t.atom+"_"+t.symop+"_"+t.symt);for(var i=0,s=e.bonds.length;i<s;i++)if(e.bonds[i]==r){var o=e.bondOrder[i];return typeof o=="undefined"&&(o=0),o}return 0}function s(e,t,n){var r=[],i=t.x-e.x,s=t.y-e.y,o=t.z-e.z,u=.1,a=i*i+s*s;u=1/(a/(n*n));for(var f=0;f<=1;f+=u){var l=e.x+f*i,c=e.y+f*s,h=e.z+f*o;r.push({x:l,y:c,z:h})}return r.push({x:t.x,y:t.y,z:t.z}),r}function o(e,t,n){var r=[],i=t.x-e.x,s=t.y-e.y,o=t.z-e.z,u=.1,a=i*i+s*s+o*o;u=1/(a/(n*n));for(var f=0;f<=1;f+=u){var l=e.x+f*i,c=e.y+f*s,h=e.z+f*o;r.push({x:l,y:c,z:h})}return r.push({x:t.x,y:t.y,z:t.z}),r}function u(e,t,n,r){var i=e.length,s,o,u=0;for(s=0,o=i-1;s<i;o=s++)t[s]>r!=t[o]>r&&n<(e[o]-e[s])*(r-t[s])/(t[o]-t[s])+e[s]&&(u=!u);return u}function a(e,t){if(typeof numeric=="undefined")return null;if(e==null)return null;var n=[],r=8;if(r==12)n[0]=e[0]*19.739208802178716,n[1]=e[1]*19.739208802178716,n[2]=e[2]*19.739208802178716,n[3]=e[3]*19.739208802178716*2,n[4]=e[4]*19.739208802178716*2,n[5]=e[5]*19.739208802178716*2,e[7]=(e[0]+e[1]+e[3])/3;else{var i=r==4||r==5||r==8||r==9,s=2-r%2,o=r==8||r==9||r==10?19.739208802178716:r==4||r==5?.25:r==2||r==3?Math.log(2):1,u=e[0]*o*(i?t.a_*t.a_:1),a=e[1]*o*(i?t.b_*t.b_:1),l=e[2]*o*(i?t.c_*t.c_:1),c=e[3]*o*(i?t.a_*t.b_:1)*s,h=e[4]*o*(i?t.a_*t.c_:1)*s,p=e[5]*o*(i?t.b_*t.c_:1)*s;e[7]=Math.pow(u/19.739208802178716/t.a_/t.a_*a/19.739208802178716/t.b_/t.b_*l/19.739208802178716/t.c_/t.c_,.3333),n[0]=t.a*t.a*u+t.b*t.b*t.cosGamma*t.cosGamma*a+t.c*t.c*t.cosBeta*t.cosBeta*l+t.a*t.b*t.cosGamma*c+t.b*t.c*t.cosGamma*t.cosBeta*p+t.a*t.c*t.cosBeta*h,n[1]=t.b*t.b*t.sinGamma*t.sinGamma*a+t.c*t.c*t.cA_*t.cA_*l+t.b*t.c*t.cA_*t.sinGamma*p,n[2]=t.c*t.c*t.cB_*t.cB_*l,n[3]=2*t.b*t.b*t.cosGamma*t.sinGamma*a+2*t.c*t.c*t.cA_*t.cosBeta*l+t.a*t.b*t.sinGamma*c+t.b*t.c*(t.cA_*t.cosGamma+t.sinGamma*t.cosBeta)*p+t.a*t.c*t.cA_*h,n[4]=2*t.c*t.c*t.cB_*t.cosBeta*l+t.b*t.c*t.cosGamma*p+t.a*t.c*t.cB_*h,n[5]=2*t.c*t.c*t.cA_*t.cB_*l+t.b*t.c*t.cB_*t.sinGamma*p}var d=f(n);return d}function f(e){var t=e[0],n=e[1],r=e[2],i=e[3]/2,s=e[4]/2,o=e[5]/2,u=i,a=s,f=o,c=[[t,u,a],[i,n,f],[s,o,r]],h=numeric.eig(c),p=[Math.sqrt(h.lambda.x[0]),Math.sqrt(h.lambda.x[1]),Math.sqrt(h.lambda.x[2])],d=h.E.x,v=l(d,p);return[p,d,v]}function l(e,t){var n,r,i,s,o,u,a,f,l;n=e[0][0],s=e[0][1],a=e[0][2],r=e[1][0],o=e[1][1],f=e[1][2],i=e[2][0],u=e[2][1],l=e[2][2];var c=numeric.inv([[n,r,i],[s,o,u],[a,f,l]]);return c}function c(e,t,n,r,i,s,o){function b(e,t,n,r,i){var s=t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],o=t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],u=t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2];return[s+n,o+r,u+i]}var u=[],a=[],f=[],l=[],c,h,p,d,v;for(var m=0;m<=360;m+=10){c=3.14159/180*m,p=r*Math.cos(c),d=i*Math.sin(c),v=0;var g=b([p,d,v],o,e,t,n);a.push(g)}for(var y=0;y<=360;y+=10){h=3.14159/180*y,p=0,d=i*Math.cos(h),v=s*Math.sin(h);var g=b([p,d,v],o,e,t,n);f.push(g)}for(var y=0;y<=360;y+=10){h=3.14159/180*y,p=r*Math.cos(h),d=0,v=s*Math.sin(h);var g=b([p,d,v],o,e,t,n);l.push(g)}for(var y=0;y<=90;y+=10){h=3.14159/180*y;for(var m=0;m<=90;m+=10){c=3.14159/180*m,p=r*Math.cos(h)*Math.cos(c),d=i*Math.cos(h)*Math.sin(c),v=s*Math.sin(h);var g=b([p,-1*d,v],o,e,t,n);u.push(g),g=b([p,-1*d,-1*v],o,e,t,n),u.push(g),g=b([-1*p,-1*d,v],o,e,t,n),u.push(g),g=b([-1*p,-1*d,-1*v],o,e,t,n),u.push(g),g=b([p,d,v],o,e,t,n),u.push(g),g=b([p,d,-1*v],o,e,t,n),u.push(g),g=b([-1*p,d,-1*v],o,e,t,n),u.push(g),g=b([-1*p,d,v],o,e,t,n),u.push(g)}}return[a,f,l,u]}function h(e){function s(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}e.sort(function(e,t){return e.x==t.x?e.y-t.y:e.x-t.x});var t=[];for(var n=0;n<e.length;n++){while(t.length>=2&&s(t[t.length-2],t[t.length-1],e[n])<=0)t.pop();t.push(e[n])}var r=[];for(var i=e.length-1;i>=0;i--){while(r.length>=2&&s(r[r.length-2],r[r.length-1],e[i])<=0)r.pop();r.push(e[i])}return r.pop(),t.pop(),t.concat(r)}e._widget=function(e,n,r,i){this._isFF=navigator.userAgent.toLowerCase().indexOf("firefox")!=-1,this._isSlow=!1,this._isVSlow=!1,oldBrowser&&(this._isSlow=!0),typeof FlashCanvas!="undefined"&&(this._isSlow=!0),typeof window.mobilecheck!="undefined"&&window.mobilecheck()&&(this._isSlow=!0,this._isVSlow=!0),this.parent=i,this._isSlow=!0,this._container=document.getElementById(e);if(!this._container){var s=document.createElement("div");s.id=e,document.body.appendChild(s),this._container=s}this._id=e,this._midx=n,this.w=300,this.h=300;var o=0,u=0;r&&r.size?typeof r.size=="object"?(r.size.width&&(o=parseInt(r.size.width)),r.size.height&&(u=parseInt(r.size.height))):o=parseInt(r.size):this._container.style.width?o=parseInt(this._container.style.width)-20:this._container.offsetWidth&&(o=parseInt(this._container.offsetWidth)-20),o>20&&o<2001&&(this.w=o,this.h=o,u>20&&u<2001&&(this.h=u));var a=t();this.w>a&&(this.w=a-20,this.h=a-20),this._canvas2d=document.createElement("canvas"),typeof FlashCanvas!="undefined"&&FlashCanvas.initElement(this._canvas2d),this._container.appendChild(this._canvas2d),this._canvas2d.height=this.h,this._canvas2d.width=this.w,this.background="transparent",this.vdwScale=.22,this.ellipScale=.5,this.view="",this.picking=0,this.bondpicking=0,this.spin=!1,this.spinToBestFit=!1,this.label=!1,this.viewStyle="ball_and_stick",this.mmViewStyle="ribbon",this.colourScheme="rainbow",this.clickCallback=!1,this.pickCallback=!1,this.bondpickCallback=!1,this.selectCallback=!1,this.spinCallback=!1,this.mouseOverCallback=!1,this.changedCallback=!1,this._isDragging=!1,this._mouseStartX=0,this._mouseStartY=0,this._picked=[],this._addEvents(),this._select=[];if(r)for(var f in r)this[f]!=undefined&&r[f]!=undefined&&(this[f]=r[f]);return this},e._widget.prototype._addEvents=function(){function t(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function n(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1),e.detachEvent&&e.detachEvent("on"+t,n)}function r(t){e.spin=!1,e._isDragging=!1;var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1,e.model._scaleFactorInc||(e.model._scaleFactorInc=.1*e.model.scaleFactor2d),n.scale?(e._isSlow=!0,n.scale<1?e.model.scaleFactor2d-=e.model._scaleFactorInc:n.scale>1&&(e.model.scaleFactor2d+=e.model._scaleFactorInc)):n.detail?n.detail<0?e.model.scaleFactor2d-=e.model._scaleFactorInc:e.model.scaleFactor2d+=e.model._scaleFactorInc:n.wheelDelta&&(n.wheelDelta<0?e.model.scaleFactor2d-=e.model._scaleFactorInc:e.model.scaleFactor2d+=e.model._scaleFactorInc),e.model.scaleFactor2d<5*e.model._scaleFactorInc&&(e.model.scaleFactor2d=5*e.model._scaleFactorInc),e._isScrolling=!0,window.requestAnimationFrame(function(){e._show()})}function i(t){e._isScrolling=!1,e._fingerSeparation=0,e.spin=!1,e.targPlane=null,e.rotPlanes=null;var n=t||window.event;n.targetTouches||(n.preventDefault?n.preventDefault():n.returnValue=!1);var r=n.pageX,i=n.pageY;if(n.targetTouches&&n.targetTouches.length>1){e._isSlow=!0,e._isDragging=!1,n.targetTouches.length==2&&(e.model._scaleFactorInc||(e.model._scaleFactorInc=.05*e.model.scaleFactor2d),e._isScrolling=!0,e._fingerSeparation=(n.targetTouches[0].pageX-n.targetTouches[1].pageX)*(n.targetTouches[0].pageX-n.targetTouches[1].pageX)+(n.targetTouches[0].pageY-n.targetTouches[1].pageY)*(n.targetTouches[0].pageY-n.targetTouches[1].pageY));return}n.targetTouches&&n.targetTouches[0]&&(e._isSlow=!0,r=n.targetTouches[0].pageX,i=n.targetTouches[0].pageY),r==undefined&&(r=n.clientX,i=n.clientY);if(r==undefined)return;e._isDragging=!0,e._mouseStartX=r,e._mouseStartY=i,e._pressStartX=r,e._pressStartY=i,e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1})}function s(t){var n=t||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1;if(e._isScrolling){if(n.targetTouches&&n.targetTouches.length==2){e._isScrolling=!0;var r=(n.targetTouches[0].pageX-n.targetTouches[1].pageX)*(n.targetTouches[0].pageX-n.targetTouches[1].pageX)+(n.targetTouches[0].pageY-n.targetTouches[1].pageY)*(n.targetTouches[0].pageY-n.targetTouches[1].pageY);Math.abs(r-e._fingerSeparation)>1e4&&(r>e._fingerSeparation?e.model.scaleFactor2d+=e.model._scaleFactorInc:r>0&&(e.model.scaleFactor2d-=e.model._scaleFactorInc),e.model.scaleFactor2d<10*e.model._scaleFactorInc&&(e.model.scaleFactor2d=10*e.model._scaleFactorInc),window.requestAnimationFrame(function(){e._show()}),e._fingerSeparation=r),e._isDragging=!1}return}if(!e._isDragging)return;var i=n.pageX,s=n.pageY;n.targetTouches&&n.targetTouches[0]&&(e._isSlow=!0,i=n.targetTouches[0].pageX,s=n.targetTouches[0].pageY),i==undefined&&(i=n.clientX,s=n.clientY);if(i==undefined)return;var o=(i-e._mouseStartX)/e.w,u=(s-e._mouseStartY)/e.h;e._mouseStartX=i,e._mouseStartY=s;var a=Math.sqrt(o*o+u*u),f=Math.sin(a*Math.PI)/a,l=0,c=0,h=0,p=1,d=f*u,v=-1*f*o,m=0,g=-1*Math.cos(a*Math.PI),y=l*g+p*d+c*m-h*v,b=c*g+p*v+h*d-l*m,w=h*g+p*m+l*v-c*d,E=p*g-l*d-c*v-h*m;l=y,c=b,h=w,p=E,d=e.rotationQuaternion.x,v=e.rotationQuaternion.y,m=e.rotationQuaternion.z,g=e.rotationQuaternion.w,y=l*g+p*d+c*m-h*v,b=c*g+p*v+h*d-l*m,w=h*g+p*m+l*v-c*d,E=p*g-l*d-c*v-h*m;if(!isFinite(y)||isNaN(y)||!isFinite(b)||isNaN(b)||!isFinite(w)||isNaN(w)||!isFinite(E)||isNaN(E)){console.log("qNan - skip");return}e.rotationQuaternion.x=y,e.rotationQuaternion.y=b,e.rotationQuaternion.z=w,e.rotationQuaternion.w=E,window.requestAnimationFrame(function(){e._show()})}function o(t,n){var r=t||window.event;r.targetTouches||(r.preventDefault?r.preventDefault():r.returnValue=!1),e._fingerSeparation=0,e._isDragging&&(e._isDragging=!1);if(e._isScrolling){e._isScrolling=!1;return}var i=r.pageX,s=r.pageY;r.targetTouches&&r.targetTouches.length==1&&r.targetTouches[0]&&(e._isSlow=!0,i=r.targetTouches[0].pageX,s=r.targetTouches[0].pageY),i==undefined&&(i=r.clientX,s=r.clientY);if(i==undefined)return;if(n&&n=="out")return;var o=Math.abs(i-e._pressStartX),u=Math.abs(s-e._pressStartY),a=!1,f=curtop=0,l=e._canvas2d;if(l.offsetParent)do{l.style&&l.style.position=="fixed"&&(a=!0);if(l==document.body)break;f+=l.offsetLeft,curtop+=l.offsetTop,curtop-=l.scrollTop||0,f-=l.scrollLeft||0}while(l=l.offsetParent);e.canvasPos={x:f,y:curtop},a&&(i=r.clientX,s=r.clientY,r.targetTouches&&r.targetTouches.length==1&&r.targetTouches[0]&&(e._isSlow=!0,i=r.targetTouches[0].clientX,s=r.targetTouches[0].clientY)),o<2&&u<2?(e.clickx=i-e.canvasPos.x,e.clicky=s-e.canvasPos.y,e.clickxs=(e.clickx-e.w/2)/e.model.scaleFactor2d,e.clickys=(e.clicky-e.h/2)/e.model.scaleFactor2d):e.clickx=null,window.requestAnimationFrame(function(){e._show()})}function u(t,n){var r=t||window.event;r.preventDefault?r.preventDefault():r.returnValue=!1,e.clickCallback&&typeof e.clickCallback=="function"&&e.clickCallback(e)}function a(t,n){var r=t||window.event;r.preventDefault?r.preventDefault():r.returnValue=!1,e.mouseOverCallback&&typeof e.mouseOverCallback=="function"&&e.mouseOverCallback(e)}var e=this;t(this._canvas2d,"DOMMouseScroll",function(e){r(e)}),t(this._canvas2d,"mousewheel",function(e){r(e)}),t(this._canvas2d,"mousedown",function(e){i(e)}),t(this._canvas2d,"mousemove",function(e){s(e)}),t(this._canvas2d,"mouseup",function(e){o(e)}),t(this._canvas2d,"touchstart",function(e){i(e)}),t(this._canvas2d,"touchmove",function(e){s(e)}),t(this._canvas2d,"touchend",function(e){o(e)}),t(this._canvas2d,"mouseout",function(e){o(e,"out")}),t(this._canvas2d,"click",function(e){u(e)}),t(this._canvas2d,"mouseover",function(e){a(e)})},e._widget.prototype.resize=function(e,t){this.w=parseInt(e),this.h=parseInt(t),this._canvas2d.height=this.h,this._canvas2d.width=this.w,this._show()},e._widget.prototype.changeModel=function(e){function s(t){t.selection=[],t.selection.length=0,e.substr(0,6)=="biomol"?t.atoms=n._cif.blocks[t.cifblk].model.mol:t.atoms=n._cif.blocks[t.cifblk].model[t.type],_addAtomProperties(t.atoms);if(n._cif.blocks[t.cifblk].mmcif){t.macromol=!0,_setRibbonData(t);var r=t.ribbondata.extent;t.center2d={x:r[2][0],y:r[2][1],z:r[2][2]},t.center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]};var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];t.maxD=Math.sqrt(i*i+s*s+o*o)}else{var r=_getExtent(t.atoms);t.center2d={x:r[2][0],y:r[2][1],z:r[2][2]},t.center2d_orig={x:r[2][0],y:r[2][1],z:r[2][2]},t.cell=n._cif.blocks[t.cifblk].F2CmatrixCell,t.celldata=n._cif.blocks[t.cifblk].cell;var i=r[1][0]-r[0][0],s=r[1][1]-r[0][1],o=r[1][2]-r[0][2];t.maxD=Math.sqrt(i*i+s*s+o*o)}var u=n.w;n.h<n.w&&(u=n.h),t.scaleFactor2d=.9*u/t.maxD,n.model=t,n.changedCallback&&typeof n.changedCallback=="function"&&n.changedCallback(n),n._show({view:t.type,rotationQuaternion:{x:0,y:0,z:0,w:1}})}var t={};if(this.model&&this.model.cifblk){var n=this;n._select.length=0;for(var r in this.model.atoms){if(!this.model.atoms[r])continue;this.model.atoms[r].xtra&&(this.model.atoms[r]=null)}var i=this.model.cifblk;t.cifblk=i,t.type=e,this.model.colourScheme&&(t.colourScheme=this.model.colourScheme),n._cif._getModelSet(n._cif.blocks[i],0,e,function(){s(t)})}},e._widget.prototype._zoomToObject=function(e){var t=this;if(!e||!e.id||!e.type){this.model.center2d=this.model.center2d_orig;var n=this.w;this.h<this.w&&(n=this.h),this.model.scaleFactor2d=.9*n/this.model.maxD,this.model.selection=[],this.model.selection.length=0;return}var r=Math.round(this.w/this.model.maxD);this.model.selection=null,this.model.selection=[];if(this.model.macromol&&e.type=="ligand"){this.mmViewStyle="ligand_pockets";var i=this._cif.blocks[this.model.cifblk].ligands;for(var s in i)if(s==e.id){var o,u="asu";this.model.type.indexOf("biomol")>-1&&(u=parseInt(this.model.type.substr(6))+1);for(var a in i[s])if(i[s][a].assembly==u+""){o=a;break}this.model.selection=i[s][o].siteids.slice(0);for(var f in i[s][o].pocketids)this.model.selection.push(i[s][o].pocketids[f]);var l=i[s][o].dims;this.model.center2d={x:l[2][0],y:l[2][1],z:l[2][2]},l=i[s][o].pocketdims;var c=l[1][0]-l[0][0],h=l[1][1]-l[0][1],p=l[1][2]-l[0][2],d=Math.sqrt(c*c+h*h+p*p);d==0?r=2*this.model.scaleFactor2d:r=Math.round(this.w/d);break}}setTimeout(function(){t._zoomBy(.5,r)},1)},e._widget.prototype._zoomBy=function(e,t){if(this._isVSlow){this.model.scaleFactor2d=t,this._isDragging=!1,this._show();return}var n=this;this.model.scaleFactor2d+=e,this.model.scaleFactor2d>t?(this.model.scaleFactor2d=t,this._isDragging=!1,this._show()):(this._isDragging=!0,this._show(),setTimeout(function(){n._zoomBy(e,t)},1))},e._widget.prototype._translateBy=function(e,t){var n=this;this.model.center2d.x+=e.x,this.model.center2d.y+=e.y,this.model.center2d.z+=e.z,e.x>0&&this.model.center2d.x>t.x?this.model.center2d.x=t.x:e.x<0&&this.model.center2d.x<t.x&&(this.model.center2d.x=t.x),e.y>0&&this.model.center2d.y>t.y?this.model.center2d.y=t.y:e.y<0&&this.model.center2d.y<t.y&&(this.model.center2d.y=t.y),this.model.center2d.x==t.x&&this.model.center2d.y==t.y?(this.model.center2d.z=t.z,this._show()):(this._show(),setTimeout(function(){n._translateBy(e,t)},1))},e._widget.prototype._show=function(e){if(e)for(var t in e)if(this[t]!=undefined&&e[t]!=undefined)this[t]=e[t],t=="colourScheme"&&this.model.macromol&&this.model.ribbondata&&(this.model.colourScheme=e[t],_colourRibbonData(this.model));else if(t=="zoomTo"){this._zoomToObject(e[t]);return}this._render2d();if(this.view=="cell5551"||this.view=="cell555"||this.view=="asu")if(this._isDragging||this._isScrolling){var n=this._canvas2d.getContext("2d");this._showCell(n)}var r=this;this.spinToBestFit&&this.model.bestfit?(window.requestAnimationFrame(function(){r.rotateToPlanes([[0,0,1,0],r.model.bestfit])}),this.spinToBestFit=0):this.spin?window.requestAnimationFrame(function(){r.spinmol()}):this.targPlane&&window.requestAnimationFrame(function(){r.rotateToPlanes()})},e._widget.prototype._exportSvg=function(){var e=this._render2d("svg");return this._show(),e},e._widget.prototype._exportSdf=function(){function m(e,t){var n=Math.pow(10,t||0),r=String(Math.round(e*n)/n),i=r.indexOf("."),s=0;i==-1?r+=t>0?".":"":s=r.length-i-1;for(var o=0;o<t-s;o++)r+="0";return r}function g(e,t){var n=e,r=t-n.length;for(var i=0;i<r;i++)n=" "+n;return n}function y(e,t){var n=e,r=t-n.length;for(var i=0;i<r;i++)n+=" ";return n}var e=this.model.atoms,t=0,n=0,r="",i="",s=[];for(var o in e){var u=e[o];if(u==undefined)continue;if(u.x==undefined)continue;u.screen={x:u.x,y:u.y,z:u.z};if(this.rotationQuaternion){var a=this._rotateByQ(u.screen.x,u.screen.y*-1,u.screen.z);u.screen.x=a[0],u.screen.y=a[1]*-1,u.screen.z=a[2];if(isNaN(u.screen.x)||isNaN(u.screen.y)||isNaN(u.screen.z))u.screen={x:u.x,y:u.y,z:u.z}}r+=g(m(u.screen.x,4),10)+g(m(u.screen.y,4),10)+g(m(u.screen.z,4),10),r+=" "+y(u.elem,3)+" 0  0  0  0  0  0\n",t++,s[o]=t}var f=[];for(var o in s){var u=e[o];if(u==undefined)continue;if(u.x==undefined)continue;for(var l=0,c=u.bonds.length;l<c;l++){if(!s[u.bonds[l]])continue;var h=e[u.bonds[l]];if(h==undefined)continue;if(h.x==undefined)continue;if(f[o+"---"+u.bonds[l]])continue;if(f[u.bonds[l]+"---"+o])continue;var p=1;typeof u.bondOrder!="undefined"&&l<u.bondOrder.length&&(p=u.bondOrder[l]),p!=1&&p!=2&&p!=3&&(p=1),i+=g(s[o]+"",3)+g(s[u.bonds[l]]+"",3)+"  "+p+"  0  0  0\n",f[o+"---"+u.bonds[l]]=1,f[u.bonds[l]+"---"+o]=1,n++}}var d=g(t+"",3)+g(n+"",3)+"  0  0  0  0              1 V2000\n",v="CIFMOL\n\n\n"+d+r+i+"M  END\n\n$$$$\n";return v},e._widget.prototype._render2d=function(e){function t(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r}this._canvas2d.width=this._canvas2d.width,this._canvas2d.height=this._canvas2d.height;var n;e?n=new C2S(this.w,this.h):n=this._canvas2d.getContext("2d"),CanvasTextFunctions.enable(n),this.viewStyle=="scheme"?n.fillStyle="rgb(255, 255, 255)":this.background=="black"?n.fillStyle="rgb(0, 0, 0)":n.fillStyle="rgb(255, 255, 255)",this.background!="transparent"&&n.fillRect(0,0,this.w,this.h),n.translate(this.w/2,this.h/2);if(isNaN(this.model.scaleFactor2d)||this.model.scaleFactor2d<=0)this.model.scaleFactor2d=1;n.scale(this.model.scaleFactor2d,this.model.scaleFactor2d),n.lineCap="round",n.lineWidth=.01;var s=[],o=Math.PI*2,f=[],l=[],p=this.model.atoms;for(var d in p){var v=p[d];if(v==undefined)continue;if(v.x==undefined)continue;if(v.hide)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(d)==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}v.screen={x:v.x,y:v.y,z:v.z},v.screen.x-=this.model.center2d.x,v.screen.y-=this.model.center2d.y,v.screen.z-=this.model.center2d.z,v.screen.y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(v.screen.x,v.screen.y,v.screen.z);v.screen.x=m[0],v.screen.y=m[1],v.screen.z=m[2];if(isNaN(v.screen.x)||isNaN(v.screen.y)||isNaN(v.screen.z))throw"NaN"}if(this.viewStyle=="ellipsoids"&&!this._isDragging&&!this._isScrolling){this.vdwScale=.1;if(typeof v.ellipsoid=="undefined"){var g=a(v.adp,this.model.celldata);if(!g)v.ellipsoid=!1;else{var y=g[0],b=g[2],w={};w.axcoords=c(v.x,v.y,v.z,y[0]/2,y[1]/2,y[2]/2,b),w.prop=.5,w.matrix=b,w.axlengths=y,w.axvectors=g[1],v.ellipsoid=w}}else v.ellipsoid&&v.ellipsoid.prob!=this.ellipScale&&(v.ellipsoid.axcoords=c(v.x,v.y,v.z,v.ellipsoid.axlengths[0]*this.ellipScale,v.ellipsoid.axlengths[1]*this.ellipScale,v.ellipsoid.axlengths[2]*this.ellipScale,v.ellipsoid.matrix),v.ellipsoid.prob=this.ellipScale);if(v.ellipsoid){var E=0,S=4;if(this._isDragging||this._isScrolling)E=0,S=4;var x=[],T=[];for(var N=E;N<S;N++){var C=[],k=[];for(var L=0;L<v.ellipsoid.axcoords[N].length;L++){var m=v.ellipsoid.axcoords[N][L],A=m[0]-this.model.center2d.x,O=m[1]-this.model.center2d.y;O*=-1;var M=m[2]-this.model.center2d.z;if(this.rotationQuaternion){var _=this._rotateByQ(A,O,M);if(isNaN(_[0])||isNaN(_[1])||isNaN(_[2]))throw"NaN";A=_[0],O=_[1],M=_[2]}N==3?(M>=v.screen.z-.9&&M<=v.screen.z+.9&&k.push({x:A,y:O,z:M}),M>=v.screen.z-.1&&T.push({x:A,y:O,z:M})):C.push({x:A,y:O,z:M})}N==3?(k=h(k),x.push(k)):x.push(C)}v.ellipsoid.plotaxes=x,v.ellipsoid.surf=T}}this.model.bestfit||v.elem!="H"&&(s.push(v.x),s.push(-1*v.y),s.push(v.z)),f.push([!1,v.screen.z,d])}var D=!0;this.model.bondcount&&this.model.bondcount>2e3&&(this._isDragging||this._isScrolling)&&(D=!1);if(D){for(var d in p){var v=p[d];if(v==undefined)continue;if(v.x==undefined)continue;if(v.hide)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(d)==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}for(var P=0,H=v.bonds.length;P<H;P++){var B=p[v.bonds[P]];if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(v.bonds[P])==-1)continue;if(!B.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!B.pocket)continue}if(B.resn=="HOH")continue}if(B==undefined)continue;if(B.x==undefined)continue;if(B.hide)continue;if(l[d+"---"+v.bonds[P]])continue;if(l[v.bonds[P]+"---"+d])continue;if(this.viewStyle=="scheme"&&!this.model.cifblk)if(v.elem=="H"||B.elem=="H")if(v.elem=="C"||B.elem=="C"){v.ex=1,B.ex=1;continue}l[d+"---"+v.bonds[P]]=1,l[v.bonds[P]+"---"+d]=1,f.push([!0,(v.screen.z+B.screen.z)/2,d,v.bonds[P],v.bondOrder[P]])}}if(!this.model.bondcount){var j=0;for(var F in l){j++;if(j>4e3)break}this.model.bondcount=j/2}}if(!this.model.bestfit&&!this.model.macromol)try{this.model.bestfit=bestFit.getBestFitPlane(s),this.model.bestfit.push(1)}catch(I){this.model.bestfit=[0,0,1,0]}var q=[];for(var R=0;R<f.length;R++)q.push({type:"smallmol",dataidx:R,zindex:f[R][1]});var U=[];if(!this._isDragging&&!this._isScrolling)if(this.view=="cell5551"||this.view=="cell555"||this.view=="asu"){U=this._getCellDrawObjects();if(U!=null){for(var z=0;z<U.labels.length;z++)q.push({type:"cell_label",dataidx:z,zindex:U.labels[z].z});for(var W=0;W<U.lines.length;W++)q.push({type:"cell_line",dataidx:W,zindex:U.lines[W].z})}}var X=[],V=[],$=!1;this.mmViewStyle=="ligand_pockets"&&($=!0);if(this.model.macromol&&!$){if(!this.model.datasize){this.model.datasize=0;for(var J=0;J<this.model.ribbondata.length;J++)this.model.datasize+=this.model.ribbondata[J][0].length}var K,Q,G=1;this._isVSlow?(G=10,this.model.datasize>7e4&&(G=20)):this.model.datasize>7e4?G=10:this.model.datasize>2e4&&(G=5);if(this._isDragging||this._isScrolling)G=10,this.model.datasize>2e4&&(G=50),this.model.datasize>7e4&&(G=30);if(this.model.ribbondata&&this.model.ribbondata.rungs&&this.model.ribbondata.length)for(var J=0;J<this.model.ribbondata.rungs.length;J++){var Y={},Z=this.model.ribbondata.rungs[J].start,et=this.model.ribbondata.rungs[J].end;Z.screenx=Z.x-this.model.center2d.x,Z.screeny=(Z.y-this.model.center2d.y)*-1,Z.screenz=Z.z-this.model.center2d.z,et.screenx=et.x-this.model.center2d.x,et.screeny=(et.y-this.model.center2d.y)*-1,et.screenz=et.z-this.model.center2d.z;var tt=Z.rainbow;if(this.rotationQuaternion){var m=this._rotateByQ(Z.screenx,Z.screeny,Z.screenz);Z.screenx=m[0],Z.screeny=m[1],Z.screenz=m[2];if(isNaN(Z.screenx)||isNaN(Z.screeny)||isNaN(Z.screenz))throw"NaN";m=this._rotateByQ(et.screenx,et.screeny,et.screenz),et.screenx=m[0],et.screeny=m[1],et.screenz=m[2];if(isNaN(et.screenx)||isNaN(et.screeny)||isNaN(et.screenz))throw"NaN"}var nt=(Z.screenz+et.screenz)/2;V.push({pa:Z,pb:et,zi:nt,color:tt}),q.push({type:"rung",dataidx:J,zindex:nt})}for(var J=0;J<this.model.ribbondata.length;J++){var rt=[],it=[],st=-1,ot=[],ut=[];for(var at=0;at<this.model.ribbondata[J][0].length;at+=G){st++;var ft=this.model.ribbondata[J][0][at].atomidx;if(this._isDragging||this._isScrolling){rt[st]={x:this.model.ribbondata[J][1][at].x,y:this.model.ribbondata[J][1][at].y,z:this.model.ribbondata[J][1][at].z},rt[st].x-=this.model.center2d.x,rt[st].y-=this.model.center2d.y,rt[st].z-=this.model.center2d.z,rt[st].y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(rt[st].x,rt[st].y,rt[st].z);rt[st].x=m[0],rt[st].y=m[1],rt[st].z=m[2];if(isNaN(rt[st].x)||isNaN(rt[st].y)||isNaN(rt[st].z))throw"NaN"}it[st]=rt[st]}else{rt[st]={x:this.model.ribbondata[J][0][at].x,y:this.model.ribbondata[J][0][at].y,z:this.model.ribbondata[J][0][at].z},it[st]={x:this.model.ribbondata[J][2][at].x,y:this.model.ribbondata[J][2][at].y,z:this.model.ribbondata[J][2][at].z},rt[st].x-=this.model.center2d.x,rt[st].y-=this.model.center2d.y,rt[st].z-=this.model.center2d.z,rt[st].y*=-1,it[st].x-=this.model.center2d.x,it[st].y-=this.model.center2d.y,it[st].z-=this.model.center2d.z,it[st].y*=-1;if(this.rotationQuaternion){var m=this._rotateByQ(rt[st].x,rt[st].y,rt[st].z);rt[st].x=m[0],rt[st].y=m[1],rt[st].z=m[2];if(isNaN(rt[st].x)||isNaN(rt[st].y)||isNaN(rt[st].z))throw"NaN";m=this._rotateByQ(it[st].x,it[st].y,it[st].z),it[st].x=m[0],it[st].y=m[1],it[st].z=m[2];if(isNaN(it[st].x)||isNaN(it[st].y)||isNaN(it[st].z))throw"NaN"}}ot[st]=this.model.ribbondata[J][0][at].color,ut[st]=this.model.ribbondata[J][0][at].colorD,K==undefined&&(K=rt[st].z,Q=rt[st].z),K<rt[st].z&&(K=rt[st].z),Q>rt[st].z&&(Q=rt[st].z)}for(var lt=0;lt<rt.length-1;lt++){var ct=(rt[lt].z+it[lt].z+rt[lt+1].z+it[lt+1].z)/4;X.push({pa:rt[lt],pb:it[lt],pd:rt[lt+1],pc:it[lt+1],zi:ct,color:ot[lt],colorD:ut[lt]})}}}for(var lt=0;lt<X.length;lt++)q.push({type:"ribbon",dataidx:lt,zindex:X[lt].zi});q.sort(function(e,t){return e.zindex-t.zindex});var ht=0,pt=[];for(var dt=0;dt<q.length;dt++)if(q[dt].type=="rung")n.strokeStyle="rgb("+V[q[dt].dataidx].color.r+","+V[q[dt].dataidx].color.g+","+V[q[dt].dataidx].color.b+")",n.lineWidth=.2,n.beginPath(),n.moveTo(V[q[dt].dataidx].pa.screenx,V[q[dt].dataidx].pa.screeny),n.lineTo(V[q[dt].dataidx].pb.screenx,V[q[dt].dataidx].pb.screeny),n.closePath(),n.stroke();else if(q[dt].type=="cell_label"){var vt=U.labels[q[dt].dataidx];n.strokeStyle=vt.colour,n.drawText("sans",1,vt.x,vt.y,vt.text)}else if(q[dt].type=="cell_line"){var mt=U.lines[q[dt].dataidx];n.beginPath(),n.lineWidth=.1,n.strokeStyle=mt.colour,n.moveTo(mt.P1.x,mt.P1.y),n.lineTo(mt.P2.x,mt.P2.y),n.stroke(),n.closePath()}else if(q[dt].type=="ribbon"){if(this.mmViewStyle=="ligand_pockets")continue;n.lineWidth=.05;var lt=q[dt].dataidx,gt={r:X[lt].color.r,g:X[lt].color.g,b:X[lt].color.b},yt;if(!this._isDragging&&!this._isScrolling){var bt=t({r:X[lt].color.r,g:X[lt].color.g,b:X[lt].color.b},{r:X[lt].colorD.r,g:X[lt].colorD.g,b:X[lt].colorD.b},1-dt/q.length);yt="rgb("+bt.r+","+bt.g+","+bt.b+")"}else yt="rgb("+X[lt].color.r+","+X[lt].color.g+","+X[lt].color.b+")";var wt="rgb("+X[lt].colorD.r+","+X[lt].colorD.g+","+X[lt].colorD.b+")",Et="rgb("+X[lt].color.r+","+X[lt].color.g+","+X[lt].color.b+")",St=(X[lt].pa.z+X[lt].pd.z)/2,xt=(X[lt].pb.z+X[lt].pc.z)/2;if(!this._isDragging&&!this._isScrolling&&!this._isVSlow){var Tt,Nt=[];X[lt].pa.z>X[lt].pd.z?Nt=[X[lt].pa.x,X[lt].pa.y]:Nt=[X[lt].pd.x,X[lt].pd.y];var Ct=[];X[lt].pb.z>X[lt].pc.z?Ct=[X[lt].pc.x,X[lt].pc.y]:Ct=[X[lt].pb.x,X[lt].pb.y],Tt=n.createLinearGradient(Nt[0],Nt[1],Ct[0],Ct[1]);var kt=t({r:bt.r,g:bt.g,b:bt.b},{r:X[lt].colorD.r,g:X[lt].colorD.g,b:X[lt].colorD.b},Math.abs(St-xt)*dt/q.length*.5),Lt="rgb("+kt.r+","+kt.g+","+kt.b+")";St<xt?(Tt.addColorStop(0,Lt),Tt.addColorStop(1,yt)):(Tt.addColorStop(0,yt),Tt.addColorStop(1,Lt))}!this._isDragging&&!this._isScrolling&&!this._isVSlow?n.fillStyle=Tt:n.fillStyle=yt,n.strokeStyle="rgb("+X[lt].colorD.r+","+X[lt].colorD.g+","+X[lt].colorD.b+")",n.beginPath(),n.moveTo(X[lt].pa.x,X[lt].pa.y),!this._isDragging&&!this._isScrolling?(n.lineWidth=.05,n.lineTo(X[lt].pb.x,X[lt].pb.y),n.lineTo(X[lt].pc.x,X[lt].pc.y),n.lineTo(X[lt].pd.x,X[lt].pd.y),n.closePath(),n.fill(),this._isVSlow?n.strokeStyle=yt:n.strokeStyle=Tt,n.stroke()):(n.lineWidth=.5,n.lineTo(X[lt].pd.x,X[lt].pd.y),n.closePath(),n.strokeStyle=yt,n.stroke()),!this._isDragging&&!this._isScrolling&&(n.lineWidth=.05,n.strokeStyle=wt,n.beginPath(),n.moveTo(X[lt].pa.x,X[lt].pa.y),n.lineTo(X[lt].pd.x,X[lt].pd.y),n.closePath(),n.stroke(),n.beginPath(),n.moveTo(X[lt].pb.x,X[lt].pb.y),n.lineTo(X[lt].pc.x,X[lt].pc.y),n.closePath(),n.stroke())}else if(q[dt].type=="smallmol"){var d=q[dt].dataidx,v=p[f[d][2]];if(v==undefined)continue;if(v.x==undefined)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(f[d][2])==-1)continue;if(!v.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!v.pocket)continue}if(v.resn=="HOH")continue}var At;this.viewStyle=="scheme"?
v.elem=="C"||v.ex?At=0:At=.7:(At=v.vdwRad!=undefined?v.vdwRad:1,At*=this.vdwScale);if(!f[d][0]){if(!this._isDragging&&!this._isScrolling&&this.picking>1&&this.clickx!=null){var Ot=v.screen.x,Mt=v.screen.y,_t=At;this.clickxs>Ot-_t&&this.clickxs<Ot+_t&&this.clickys>Mt-_t&&this.clickys<Mt+_t&&(ht=v)}if(this.viewStyle=="ellipsoids"&&v.ellipsoid&&!this._isDragging&&!this._isScrolling){var Dt=new Date;for(var N=0;N<v.ellipsoid.plotaxes.length;N++){n.fillStyle=v.color.rgbLa,n.strokeStyle=v.color.rgbD,n.lineWidth=.01,n.beginPath();for(var L=0;L<v.ellipsoid.plotaxes[N].length;L++)N<4&&(L==0?n.moveTo(v.ellipsoid.plotaxes[N][L].x,v.ellipsoid.plotaxes[N][L].y):n.lineTo(v.ellipsoid.plotaxes[N][L].x,v.ellipsoid.plotaxes[N][L].y));n.closePath(),N<4&&n.stroke(),N==3&&n.fill()}}n.lineWidth=.02;if(this.mmViewStyle=="ligand_pockets"&&v.pocket){At=v.vdwRad!=undefined?v.vdwRad:1;if(this._isDragging||this._isScrolling)continue;var Pt=_aaColours[v.resn];Pt||(Pt=_aaColours.other),n.fillStyle="rgba("+Pt.r+", "+Pt.g+", "+Pt.b+", 0.05)"}else if(this.viewStyle=="scheme")n.fillStyle="rgba(255, 255, 255, 0.5)";else if(this._isSlow&&(this._isDragging||this._isScrolling))n.fillStyle=v.color.rgbBase;else{var Ht=-At*.4,Tt=n.createRadialGradient(v.screen.x+Ht,v.screen.y+Ht,At/100,v.screen.x,v.screen.y,At*.95);this.background=="black"?Tt.addColorStop(0,v.color.rgbL):Tt.addColorStop(0,v.color.rgbL),Tt.addColorStop(1,v.color.rgb),n.fillStyle=Tt}n.beginPath(),n.arc(v.screen.x,v.screen.y,At,0,o,!0),n.closePath(),n.fill(),n.fillStyle=v.color.rgb,this.viewStyle=="scheme"?n.strokeStyle="rgba(255, 255, 255, 0.5)":this._isSlow&&(this._isDragging||this._isScrolling)?n.strokeStyle="#000000":n.strokeStyle=v.color.rgb,this.mmViewStyle=="ligand_pockets"&&!v.pocket&&n.stroke(),this.viewStyle=="scheme"&&v.elem!="C"&&!v.ex?(v.elem!="H"?n.strokeStyle=v.color.rgb:n.strokeStyle="#000000",n.drawTextCenter("sans",At,v.screen.x,v.screen.y+.3*At,v.elem)):this.label&&v.elem!="C"&&!v.ex&&v.elem!="H"&&(n.strokeStyle="#000000",n.drawTextCenter("sans",At,v.screen.x,v.screen.y+.3*At,v.elem))}else{var B=p[f[d][3]];if(B==undefined)continue;if(B.x==undefined)continue;if(this.model.macromol){if(this.model.selection&&this.model.selection.length>0&&this.model.selection.indexOf(f[d][3])==-1)continue;if(!B.hetflag){if(this.mmViewStyle!="ligand_pockets")continue;if(!B.pocket)continue}if(B.resn=="HOH")continue}var Bt;this.viewStyle=="scheme"?B.elem=="C"||B.ex?Bt=0:Bt=.7:(Bt=B.vdwRad!=undefined?B.vdwRad:1,Bt*=this.vdwScale);var jt=v.screen.x,Ft=v.screen.y,It=B.screen.x,qt=B.screen.y,Rt=v.screen.z,Ut=B.screen.z;if(this.mmViewStyle=="ligand_pockets"&&B.pocket){if(isNaN(jt)||isNaN(Ft)||isNaN(It)||isNaN(qt))continue;n.lineWidth=.1,n.beginPath(),n.moveTo(jt,Ft),n.lineTo(It,qt),n.closePath();var Pt=_aaColours[v.resn];Pt||(Pt=_aaColours.other),n.strokeStyle="rgb("+Pt.r+", "+Pt.g+", "+Pt.b+")",n.stroke();continue}var Ht=It-jt,zt=qt-Ft,R=Math.sqrt(Ht*Ht+zt*zt),Wt=.85*At*Ht/R;jt+=Wt,Wt=.85*Bt*Ht/R,It-=Wt,Wt=.85*At*zt/R,Ft+=Wt,Wt=.85*Bt*zt/R,qt-=Wt;var Xt=Math.atan2(zt,Ht);Xt-=90*Math.PI/180;var Vt=Math.cos(Xt),$t=Math.sin(Xt);if(!this._isDragging&&!this._isScrolling&&this.bondpicking>0&&this.clickx!=null){var Jt=.2*Vt,Kt=.2*$t,Qt=[],Gt=[];Qt.push(jt-Jt),Qt.push(jt+Jt),Qt.push(It+Jt),Qt.push(It-Jt),Gt.push(Ft-Kt),Gt.push(Ft+Kt),Gt.push(qt+Kt),Gt.push(qt-Kt),u(Qt,Gt,this.clickxs,this.clickys)&&(pt=[v,B])}var Yt,Zt,en;this.viewStyle=="scheme"?(en=.05,Yt="rgb(0, 0, 0)",bondcolor2="rgb(0, 0, 0)"):(en=.15,Yt=v.color.rgbBase,bondcolor2=B.color.rgbBase);if(isNaN(jt)||isNaN(Ft)||isNaN(It)||isNaN(qt))continue;var tn=(v.screen.x+B.screen.x)/2,nn=(v.screen.y+B.screen.y)/2,Tt,rn,sn,on;if(f[d][4]==1.5||f[d][4]==2||f[d][4]==3){var un=.1;f[d][4]==3&&(un=.2);var Jt=un*Vt,Kt=un*$t;if(this.viewStyle=="scheme")Tt=sn=on=grad4="rgb(0, 0, 0)";else if(this._isSlow&&(this._isDragging||this._isScrolling))Tt=on=Yt,sn=grad4=bondcolor2;else if(this._isVSlow)Tt=on=Yt,sn=grad4=bondcolor2;else if(typeof v.occ!="undefined"&&typeof B.occ!="undefined"&&(v.occ<1||B.occ<1))Tt=on=Yt,sn=grad4=bondcolor2;else{var an=en*Vt,fn=en*$t;Tt=n.createLinearGradient(tn-Jt+an,nn-Kt+fn,tn-Jt-an,nn-Kt-fn),Tt.addColorStop(.2,v.color.rgb),this.background=="black"?Tt.addColorStop(.5,v.color.rgbL):Tt.addColorStop(.5,v.color.rgbL),Tt.addColorStop(.8,v.color.rgb),sn=n.createLinearGradient(tn-Jt+an,nn-Kt+fn,tn-Jt-an,nn-Kt-fn),sn.addColorStop(.2,B.color.rgb),this.background=="black"?sn.addColorStop(.5,B.color.rgbL):sn.addColorStop(.5,B.color.rgbL),sn.addColorStop(.8,B.color.rgb),on=n.createLinearGradient(tn+Jt+an,nn+Kt+fn,tn+Jt-an,nn+Kt-fn),on.addColorStop(.2,v.color.rgb),this.background=="black"?on.addColorStop(.5,v.color.rgbL):on.addColorStop(.5,v.color.rgbL),on.addColorStop(.8,v.color.rgb),grad4=n.createLinearGradient(tn+Jt+an,nn+Kt+fn,tn+Jt-an,nn+Kt-fn),grad4.addColorStop(.2,B.color.rgb),this.background=="black"?grad4.addColorStop(.5,B.color.rgbL):grad4.addColorStop(.5,B.color.rgbL),grad4.addColorStop(.8,B.color.rgb)}n.lineWidth=en,n.strokeStyle=Tt,n.beginPath(),n.moveTo(jt-Jt,Ft-Kt),n.lineTo(tn-Jt,nn-Kt),n.closePath(),n.stroke(),n.strokeStyle=sn,n.beginPath(),n.moveTo(It-Jt,qt-Kt),n.lineTo(tn-Jt,nn-Kt),n.closePath(),n.stroke(),n.strokeStyle=on,n.beginPath(),n.moveTo(jt+Jt,Ft+Kt),n.lineTo(tn+Jt,nn+Kt),n.closePath(),n.stroke(),n.strokeStyle=grad4,n.beginPath(),n.moveTo(It+Jt,qt+Kt),n.lineTo(tn+Jt,nn+Kt),n.closePath(),n.stroke()}if(f[d][4]==.5){Tt=sn=on=grad4="rgb(0, 0, 200)";var N={};N.x=jt,N.y=Ft,N.z=Rt;var ln={};ln.x=It,ln.y=qt,ln.z=Ut,this._drawDashedLine(n,N,ln,.1,Tt)}else if(f[d][4]==0){Tt=sn=on=grad4="rgba(255, 0, 0, 0.5)";var N={};N.x=jt,N.y=Ft,N.z=Rt;var ln={};ln.x=It,ln.y=qt,ln.z=Ut,this._drawZigZagLine(n,N,ln,.15,Tt)}else if(f[d][4]!=2){var un=en;if(this.viewStyle=="scheme")Tt=sn=on=grad4="rgb(0, 0, 0)";else if(this._isSlow&&(this._isDragging||this._isScrolling))Tt=on=Yt,sn=grad4=bondcolor2;else if(this._isVSlow)Tt=on=Yt,sn=grad4=bondcolor2;else if(typeof v.occ!="undefined"&&typeof B.occ!="undefined"&&(v.occ<1||B.occ<1))Tt=on=Yt,sn=grad4=bondcolor2;else{var Jt=un*Vt,Kt=un*$t,Tt=n.createLinearGradient(v.screen.x+Jt,v.screen.y+Kt,v.screen.x-Jt,v.screen.y-Kt);Tt.addColorStop(.2,v.color.rgb),this.background=="black"?Tt.addColorStop(.5,v.color.rgbL):Tt.addColorStop(.5,v.color.rgbL),Tt.addColorStop(.8,v.color.rgb);var sn=n.createLinearGradient(B.screen.x+Jt,B.screen.y+Kt,B.screen.x-Jt,B.screen.y-Kt);sn.addColorStop(.2,B.color.rgb),this.background=="black"?sn.addColorStop(.5,B.color.rgbL):sn.addColorStop(.5,B.color.rgbL),sn.addColorStop(.8,B.color.rgb)}n.lineWidth=en,n.strokeStyle=Tt,n.beginPath(),n.moveTo(jt,Ft),n.lineTo(tn,nn),n.closePath(),n.stroke(),n.strokeStyle=sn,n.beginPath(),n.moveTo(It,qt),n.lineTo(tn,nn),n.closePath(),n.stroke()}}}if(ht){var cn=-1;this._picked.length==this.picking&&(this._picked.length=0);var hn=ht.idx;ht.symop!=undefined&&(hn=ht.atom+"_"+ht.symop+"_"+ht.symt);for(var lt=0;lt<this._picked.length;lt++){var pn=this._picked[lt].idx;this._picked[lt].symop!=undefined&&(pn=this._picked[lt].atom+"_"+this._picked[lt].symop+"_"+this._picked[lt].symt);if(pn==hn){cn=lt;break}}cn==-1?this._picked.push(ht):this._picked.splice(cn,1)}if(this._select&&this._select.length>0&&this._picked.length==0){for(var dn=0;dn<this._select.length;dn++){var At=this._select[dn].vdwRad!=undefined?this._select[dn].vdwRad:1;At*=this.vdwScale,n.fillStyle="rgba(255, 215, 0, 0.5)",n.beginPath(),n.arc(this._select[dn].screen.x,this._select[dn].screen.y,2*At,0,o,!0),n.closePath(),n.fill()}if(!this._isDragging&&!this._isScrolling){this._cif||(this._cif=new Scif),this._select.length==1&&this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,this._select[0].atom);if(this._select.length==2){var vn=this._cif._calcBondC(this._select[0].xyz,this._select[1].xyz,this._select[0].xyzSu,this._select[1].xyzSu),mn=this._cif._quickRoundUp(vn[1],3);mn=mn.replace(/^[-0\.]*/g,"").replace(/\./,""),mn!=""&&(mn="("+mn+")"),mn="";var gn=this._select[0].atom+"-"+this._select[1].atom+" = "+this._cif._quickRoundUp(vn[0],3)+mn+" &#197;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,gn)}else if(this._select.length==3){var vn=this._cif._calcAngleC(this._select[0].xyz,this._select[1].xyz,this._select[2].xyz,this._select[0].xyzSu,this._select[1].xyzSu,this._select[2].xyzSu),mn=this._cif._quickRoundUp(vn[1],1);mn=mn.replace(/^[-0\.]*/g,"").replace(/\./,""),mn!=""&&(mn="("+mn+")"),mn="";var gn=this._select[0].atom+"-"+this._select[1].atom+"-"+this._select[2].atom+" = "+this._cif._quickRoundUp(vn[0],1)+mn+"&#176;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,gn)}else if(this._select.length==4){var vn=this._cif._calcTorsionC(this._select[0].xyz,this._select[1].xyz,this._select[2].xyz,this._select[3].xyz,this._select[0].xyzSu,this._select[1].xyzSu,this._select[2].xyzSu,this._select[3].xyzSu),mn=this._cif._quickRoundUp(vn[1],1);mn=mn.replace(/^[-0\.]*/g,"").replace(/\./,""),mn!=""&&(mn="("+mn+")"),mn="";var gn=this._select[0].atom+"-"+this._select[1].atom+"-"+this._select[2].atom+"-"+this._select[3].atom+" = "+this._cif._quickRoundUp(vn[0],1)+mn+"&#176;";this.selectCallback&&typeof this.selectCallback=="function"&&this.selectCallback(this,gn)}}}if(this.picking>0){var yn="";for(var lt=0;lt<this._picked.length;lt++){var At=this._picked[lt].vdwRad!=undefined?this._picked[lt].vdwRad:1;At*=this.vdwScale,n.fillStyle="rgba(255, 215, 0, 0.5)",n.beginPath(),n.arc(this._picked[lt].screen.x,this._picked[lt].screen.y,2*At,0,o,!0),n.closePath(),n.fill(),yn+=" "+this._picked[lt].atom}if(!this._isDragging&&!this._isScrolling)if(this._picked.length==this.picking){this._cif||(this._cif=new Scif);if(this.picking==2){var vn=this._cif._calcBondC(this._picked[0].xyz,this._picked[1].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu),mn=this._cif._quickRoundUp(vn[1],3);mn=mn.replace(/^[-0\.]*/g,"").replace(/\./,""),mn!=""&&(mn="("+mn+")"),mn="";var gn=this._picked[0].atom+"-"+this._picked[1].atom+" = "+this._cif._quickRoundUp(vn[0],3)+mn+" &#197;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(gn,this)}else if(this.picking==3){var vn=this._cif._calcAngleC(this._picked[0].xyz,this._picked[1].xyz,this._picked[2].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu,this._picked[2].xyzSu),mn=this._cif._quickRoundUp(vn[1],1);mn!=""&&(mn="("+mn+")"),mn="";var gn=this._picked[0].atom+"-"+this._picked[1].atom+"-"+this._picked[2].atom+" = "+this._cif._quickRoundUp(vn[0],1)+mn+"&#176;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(gn,this)}else if(this.picking==4){var vn=this._cif._calcTorsionC(this._picked[0].xyz,this._picked[1].xyz,this._picked[2].xyz,this._picked[3].xyz,this._picked[0].xyzSu,this._picked[1].xyzSu,this._picked[2].xyzSu,this._picked[3].xyzSu),mn=this._cif._quickRoundUp(vn[1],1);mn=mn.replace(/^[-0\.]*/g,"").replace(/\./,""),mn!=""&&(mn="("+mn+")"),mn="";var gn=this._picked[0].atom+"-"+this._picked[1].atom+"-"+this._picked[2].atom+"-"+this._picked[3].atom+" = "+this._cif._quickRoundUp(vn[0],1)+mn+"&#176;";this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(gn,this)}this.picking==2&&this.bondpicking>0&&this.bondpickCallback&&typeof this.bondpickCallback=="function"&&(pt=[this._picked[0],this._picked[1]]),this._picked.length=0,this._select.length=0}else this._picked.length>0&&this.pickCallback&&typeof this.pickCallback=="function"&&this.pickCallback(yn,this)}this.clickx=null;if(e){var bn=n.getSerializedSvg();return bn}if(!this._isDragging&&!this._isScrolling&&pt[0])if(this.bondpickCallback&&typeof this.bondpickCallback=="function"){var wn=i(pt[0],pt[1]);this.bondpickCallback(this,pt[0],pt[1],wn)}else r(pt[0],pt[1]),this._show()},e._widget.prototype._showBox=function(e){var t=this.model.box;if(!t)return;var n=[];for(var r=0;r<t.length;r++){var i={x:t[r][0],y:t[r][1],z:t[r][2]};i.x-=this.model.center2d.x,i.y-=this.model.center2d.y,i.z-=this.model.center2d.z,i.y*=-1;if(this.rotationQuaternion){var s=this._rotateByQ(i.x,i.y,i.z);i.x=s[0],i.y=s[1],i.z=s[2];if(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))throw"NaN"}n.push([i.x,i.y,i.z])}e.strokeStyle="#000000",e.beginPath(),e.moveTo(n[0][0],n[0][1]),e.lineTo(n[1][0],n[1][1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(n[4][0],n[4][1]),e.stroke(),e.moveTo(n[4][0],n[4][1]),e.lineTo(n[3][0],n[3][1]),e.stroke(),e.moveTo(n[3][0],n[3][1]),e.lineTo(n[0][0],n[0][1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(n[2][0],n[2][1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(n[6][0],n[6][1]),e.stroke(),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[7][0],n[7][1]),e.stroke(),e.moveTo(n[6][0],n[6][1]),e.lineTo(n[1][0],n[1][1]),e.stroke(),e.moveTo(n[7][0],n[7][1]),e.lineTo(n[5][0],n[5][1]),e.stroke(),e.moveTo(n[5][0],n[5][1]),e.lineTo(n[3][0],n[3][1]),e.stroke(),e.moveTo(n[5][0],n[5][1]),e.lineTo(n[2][0],n[2][1]),e.stroke(),e.moveTo(n[7][0],n[7][1]),e.lineTo(n[4][0],n[4][1]),e.stroke(),e.closePath()},e._widget.prototype._showCell=function(e){if(!this.model||!this.model.cell)return;var t=this._rotateByQ(0-this.model.center2d.x,(0-this.model.center2d.y)*-1,0-this.model.center2d.z),n={};e.strokeStyle="#aaaaaa",e.drawText("sans",1,t[0],t[1],"O");for(var r=0;r<3;r++){var i=this.model.cell[r][0],s=this.model.cell[r][1],o=this.model.cell[r][2];i-=this.model.center2d.x,s-=this.model.center2d.y,o-=this.model.center2d.z,n[r]=this._rotateByQ(i,s*-1,o),e.beginPath(),r==0?e.strokeStyle="rgb(255,0,0)":r==1?e.strokeStyle="rgb(0,255,0)":e.strokeStyle="rgb(0,0,255)",e.lineWidth=.08,e.moveTo(t[0],t[1]),e.lineTo(n[r][0],n[r][1]),e.stroke(),e.closePath(),e.drawText("sans",1,n[r][0],n[r][1],String.fromCharCode(97+r))}e.strokeStyle="#aaaaaa",e.lineWidth=.04;var u=this._rotateByQ(0-this.model.center2d.x+this.model.cell[0][0]+this.model.cell[1][0]+this.model.cell[2][0],(0-this.model.center2d.y+this.model.cell[0][1]+this.model.cell[1][1]+this.model.cell[2][1])*-1,0-this.model.center2d.z+this.model.cell[0][2]+this.model.cell[1][2]+this.model.cell[2][2]),a=this._rotateByQ(this.model.cell[0][0]+this.model.cell[1][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[1][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[1][2]-this.model.center2d.z),f=this._rotateByQ(this.model.cell[0][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[2][2]-this.model.center2d.z),l=this._rotateByQ(this.model.cell[1][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[1][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[1][2]+this.model.cell[2][2]-this.model.center2d.z);e.beginPath(),e.moveTo(u[0],u[1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(u[0],u[1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(u[0],u[1]),e.lineTo(l[0],l[1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(n[0][0],n[0][1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(f[0],f[1]),e.stroke(),e.moveTo(n[2][0],n[2][1]),e.lineTo(l[0],l[1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(a[0],a[1]),e.stroke(),e.moveTo(n[1][0],n[1][1]),e.lineTo(l[0],l[1]),e.stroke(),e.closePath()},e._widget.prototype._getCellDrawObjects=function(){if(!this.model||!this.model.cell)return null;var e=this._rotateByQ(0-this.model.center2d.x,(0-this.model.center2d.y)*-1,0-this.model.center2d.z),t=[],n=[],r={};n.push({text:"0",x:e[0],y:e[1],z:e[2],colour:"#aaaaaa"});for(var i=0;i<3;i++){var s=this.model.cell[i][0],u=this.model.cell[i][1],a=this.model.cell[i][2];s-=this.model.center2d.x,u-=this.model.center2d.y,a-=this.model.center2d.z,r[i]=this._rotateByQ(s,u*-1,a);var f="rgb(255,0,0)";i==1?f="rgb(0,255,0)":i==2&&(f="rgb(0,0,255)");var l=o({x:e[0],y:e[1],z:e[2]},{x:r[i][0],y:r[i][1],z:r[i][2]},3),c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:f,z:(l[h].z+l[h+1].z)/2});n.push({text:String.fromCharCode(97+i),colour:f,x:r[i][0],y:r[i][1],z:r[i][2]})}var p=this._rotateByQ(0-this.model.center2d.x+this.model.cell[0][0]+this.model.cell[1][0]+this.model.cell[2][0],(0-this.model.center2d.y+this.model.cell[0][1]+this.model.cell[1][1]+this.model.cell[2][1])*-1,0-this.model.center2d.z+this.model.cell[0][2]+this.model.cell[1][2]+this.model.cell[2][2]),d=this._rotateByQ(this.model.cell[0][0]+this.model.cell[1][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[1][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[1][2]-this.model.center2d.z),v=this._rotateByQ(this.model.cell[0][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[0][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[0][2]+this.model.cell[2][2]-this.model.center2d.z),m=this._rotateByQ(this.model.cell[1][0]+this.model.cell[2][0]-this.model.center2d.x,(this.model.cell[1][1]+this.model.cell[2][1]-this.model.center2d.y)*-1,this.model.cell[1][2]+this.model.cell[2][2]-this.model.center2d.z);l=o({x:p[0],y:p[1],z:p[2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:p[0],y:p[1],z:p[2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:p[0],y:p[1],z:p[2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[0][0],y:r[0][1],z:r[0][2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[0][0],y:r[0][1],z:r[0][2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[2][0],y:r[2][1],z:r[2][2]},{x:v[0],y:v[1],z:v[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[2][0],y:r[2][1],z:r[2][2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[1][0],y:r[1][1],z:r[1][2]},{x:d[0],y:d[1],z:d[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});l=o({x:r[1][0],y:r[1][1],z:r[1][2]},{x:m[0],y:m[1],z:m[2]},3);var c=0;for(var h=0;h<l.length;h++)h+1<l.length&&t.push({P1:l[h],P2:l[h+1],colour:"#aaaaaa",z:(l[h].z+l[h+1].z)/2});return{lines:t,labels:n}},e._widget.prototype._drawDashedLine=function(e,t,n,r,i){e.beginPath(),e.lineWidth=.05,e.strokeStyle=i;var s=n.x-t.x,o=n.y-t.y,u=Math.floor(Math.sqrt(s*s+o*o)/r),a=s/u,f=o/u,l=0,c=t.x,h=t.y;while(l++<u)c+=a,h+=f,l%2==0?e.moveTo(c,h):e.lineTo(c,h);l%2==0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y),e.stroke(),e.closePath()},e._widget.prototype._drawZigZagLine=function(e,t,n,r,i){e.beginPath(),e.lineWidth=.05,e.strokeStyle=i,e.moveTo(t.x,t.y);var s=n.x-t.x,o=n.y-t.y,u=Math.floor(Math.sqrt(s*s+o*o)/r),a=s/u,f=o/u,l=Math.atan2(o,s);l-=90*Math.PI/180;var c=Math.cos(l)*.1,h=Math.sin(l)*.1,p=0,d=t.x,v=t.y;while(p++<u)d+=a,v+=f,p%2==0?e.lineTo(d+c,v+h):e.lineTo(d-c,v-h);e.lineTo(n.x,n.y),e.stroke(),e.closePath()},e._widget.prototype._rotateByQ=function(e,t,n){if(this.rotationQuaternion){var r=this.rotationQuaternion.x,i=this.rotationQuaternion.y,s=this.rotationQuaternion.z,o=this.rotationQuaternion.w;if(isNaN(r)||isNaN(i)||isNaN(s))return[e,t,n];var u=e,a=t,f=n,l=o*u+i*f-s*a,c=o*a+s*u-r*f,h=o*f+r*a-i*u,p=-r*u-i*a-s*f;return u=l*o+p*-r+c*-s-h*-i,a=c*o+p*-i+h*-r-l*-s,f=h*o+p*-s+l*-i-c*-r,isNaN(u)||isNaN(a)||isNaN(f)?[e,t,n]:[u,a,f]}return[e,t,n]},e._widget.prototype.equalQs=function(e,t,n){return n==undefined&&(n=1e-6),Math.abs(e.x-t.x)>n?!1:Math.abs(e.y-t.y)>n?!1:Math.abs(e.z-t.z)>n?!1:Math.abs(e.w-t.w)>n?!1:!0},e._widget.prototype.slerp=function(e,t,n){var r={x:e.x,y:e.y,z:e.z,w:e.w},i={x:t.x,y:t.y,z:t.z,w:t.w},s=r.x,o=r.y,u=r.z,a=r.w,f=a*i.w+s*i.x+o*i.y+u*i.z;f<0?(r.w=-i.w,r.x=-i.x,r.y=-i.y,r.z=-i.z,f=-f):(r.x=i.x,r.y=i.y,r.z=i.z,r.w=i.w);if(f>=1)return r.w=a,r.x=s,r.y=o,r.z=u,r;var l=Math.acos(f),c=Math.sqrt(1-f*f);if(Math.abs(c)<.001)return r.w=.5*(a+r.w),r.x=.5*(s+r.x),r.y=.5*(o+r.y),r.z=.5*(u+r.z),r;var h=Math.sin((1-n)*l)/c,p=Math.sin(n*l)/c;return r.w=a*h+r.w*p,r.x=s*h+r.x*p,r.y=o*h+r.y*p,r.z=u*h+r.z*p,r},e._widget.prototype.quaternionToPlatonAngles=function(){var e=this;e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1});var t=e.rotationQuaternion.x,n=e.rotationQuaternion.y,r=e.rotationQuaternion.z,i=e.rotationQuaternion.w,s,o,u,a=i*i,f=t*t,l=n*n,c=r*r,h=f+l+c+a,p=t*i-n*r;return p>.4995*h?(s=2*Math.atan2(n,t),o=Math.PI/2,s=0):p<-0.4995*h?(s=-2*Math.atan2(n,t),o=-Math.PI/2,u=0):(s=Math.atan2(2*t*i+2*n*r,1-2*(r*r+i*i)),o=Math.asin(2*(t*r-i*n)),u=Math.atan2(2*t*n+2*r*i,1-2*(n*n+r*r))),s=-1*parseInt(s*(180/Math.PI)),s<0?s+=180:s-=180,o=parseInt(o*(180/Math.PI)),u=parseInt(u*(180/Math.PI)),[s,o,u]},e._widget.prototype.rotateToPlanes=function(e,t){if(typeof FlashCanvas!="undefined")return;var n=this;n.rotSpeed||(n.rotSpeed=.6),t&&(n.rotSpeed=t),e&&(n.rotPlanes=e);if(!n.rotPlanes)return;if(!n.targPlane&&n.rotPlanes.length==0)return;if(!n.targQ){n.targPlane=n.rotPlanes.shift();var r=n.targPlane,i=r[0],s=r[1],o=r[2],u=r[3];if(n.targPlane.length>4)u*=-1;else{n._cif||(n._cif=new Scif);var a=n._cif._xyzToUnitSu([i,s,o]),f=n._cif._xyzCrossSu([0,0,1],[i,s,o]);i=f[0][0],s=f[0][1],o=f[0][2];var l=n._cif._calcTorsionC([0,0,1],f[0],[0,0,0],a[0]),c=l[0]+180;u=c*(Math.PI/180);var h=1/Math.sqrt(i*i+s*s+o*o+u*u);i*=h,s*=h,o*=h,u*=h;var p=0,d=0,v=0,m=1,g=i,y=s,b=o,w=u;i=p*w+m*g+d*b-v*y,s=d*w+m*y+v*g-p*b,o=v*w+m*b+p*y-d*g,u=m*w-p*g-d*y-v*b}n.targQ={x:i,y:s,z:o,w:u}}n.rotationQuaternion||(n.rotationQuaternion={x:0,y:0,z:0,w:1}),n.rotationQuaternion=n.slerp(n.targQ,n.rotationQuaternion,n.rotSpeed),n.equalQs(n.rotationQuaternion,n.targQ,.01)&&(n.rotationQuaternion=n.targQ,n.rotDeg=0,n.rotPlanes.length==0&&(n.targPlane=null,n.spinCallback&&typeof n.spinCallback=="function"&&n.spinCallback(n)),n.targQ=null),window.requestAnimationFrame(function(){n._show()}),n.spincount=0,n.spin=0},e._widget.prototype.spinmol=function(){if(typeof FlashCanvas!="undefined")return;var e=this;if(e.spin){e.spincount||(e.spinx=.008,e.spiny=.004,e.spincount=1,e.spindir=1);if(e.spincount>50&&e.spincount<100)e.spinx=.004*e.spindir,e.spiny=.008*e.spindir;else if(e.spincount>100&&e.spincount<150)e.spinx=.008*e.spindir,e.spiny=.008*e.spindir;else if(e.spincount>150&&e.spincount<200)e.spinx=.008*e.spindir,e.spiny=.004*e.spindir;else if(e.spincount>200&&e.spincount<250){e.rotateToPlanes([[0,0,1,0],e.model.bestfit]),e.spincount=0,e.spin=0;return}e.spincount++;var t=Math.sqrt(this.spinx*this.spinx+this.spiny*this.spiny),n=Math.sin(t*Math.PI)/t,r=0,i=0,s=0,o=1,u=n*e.spiny,a=-1*n*e.spinx,f=0,l=-1*Math.cos(t*Math.PI),c=r*l+o*u+i*f-s*a,h=i*l+o*a+s*u-r*f,p=s*l+o*f+r*a-i*u,d=o*l-r*u-i*a-s*f;r=c,i=h,s=p,o=d,e.rotationQuaternion||(e.rotationQuaternion={x:0,y:0,z:0,w:1}),u=e.rotationQuaternion.x,a=e.rotationQuaternion.y,f=e.rotationQuaternion.z,l=e.rotationQuaternion.w,c=r*l+o*u+i*f-s*a,h=i*l+o*a+s*u-r*f,p=s*l+o*f+r*a-i*u,d=o*l-r*u-i*a-s*f,!isFinite(c)||isNaN(c)||!isFinite(h)||isNaN(h)||!isFinite(p)||isNaN(p)||!isFinite(d)||isNaN(d)?console.log("qNan - skip"):(e.rotationQuaternion.x=c,e.rotationQuaternion.y=h,e.rotationQuaternion.z=p,e.rotationQuaternion.w=d),window.requestAnimationFrame(function(){e._show()})}},e._widget.prototype._addSite=function(e,t,n){function m(e,t,n){var r={};return r.r=e.r+Math.round(n*(t.r-e.r)),r.b=e.b+Math.round(n*(t.b-e.b)),r.g=e.g+Math.round(n*(t.g-e.g)),r}function g(e,t,n){t||(t=.3),n||(n=.7);if(!e||!e.elem)return;e.vdwRad=SmolElementData.elVdwRadii[e.elem];var r=SmolElementData.elColours[e.elem];r==undefined&&(r=0);var i=r>>16,s=r>>8&255,o=r&255,u="rgb("+i+","+s+","+o+")",a="rgb("+i+","+s+","+o+")",f=1;typeof e.occ!="undefined"&&e.occ<1&&(f=e.occ,f<.3&&(f=.3),u="rgba("+i+","+s+","+o+","+f+")",a="rgba("+i+","+s+","+o+","+f+")"),e.color={hex:r,r:i,g:s,b:o,rgb:a,rgbBase:u},e.color.rgbLa="rgba("+i+","+s+","+o+", 0.7)";var l={r:i,b:o,g:s},c={r:255,b:255,g:255},h=m(l,c,.5),p=h.r,d=h.g,v=h.b;p==255&&v<50&&d<50&&(v=100,d=100),v==255&&p<50&&d<50&&(p=100,d=100),d==255&&v<50&&p<50&&(v=100,p=100),e.color.rgb50="rgb("+p+","+d+","+v+")",h=m(l,c,n);var p=h.r,d=h.g,v=h.b;p==255&&v<50&&d<50&&(v=100,d=100),v==255&&p<50&&d<50&&(p=100,d=100),d==255&&v<50&&p<50&&(v=100,p=100),f==1?e.color.rgbL="rgb("+p+","+d+","+v+")":e.color.rgbL="rgba("+p+","+d+","+v+","+f+")",c={r:0,b:0,g:0},h=m(l,c,t);var p=h.r,d=h.g,v=h.b;p==255&&v<50&&d<50&&(v=100,d=100),v==255&&p<50&&d<50&&(p=100,d=100),d==255&&v<50&&p<50&&(v=100,p=100),f==1?e.color.rgb="rgb("+p+","+d+","+v+")":e.color.rgb="rgba("+p+","+d+","+v+","+f+")",c={r:0,b:0,g:0},h=m(l,c,.5);var p=h.r,d=h.g,v=h.b;p==255&&v<50&&d<50&&(v=100,d=100),v==255&&p<50&&d<50&&(p=100,d=100),d==255&&v<50&&p<50&&(v=100,p=100),f==1?e.color.rgbD="rgb("+p+","+d+","+v+")":e.color.rgbD="rgba("+p+","+d+","+v+","+f+")"}var r=this;if(r.model.atoms[e+"_"+t+"_"+n])return;var i=r._cif.blocks[r.model.cifblk],s=n.split(""),o=s[0]-5,u=s[1]-5,a=s[2]-5,f=i.model.sites[e+"_"+t+"_555"];if(!f)return;var l={};if(!f.fxyz){var c=r._cif._getC2Fmatrix(i);f.symc=[5,5,5],f.fxyz=r._cif._xyzApplyMatrix(f.xyz,i.C2Fmatrix),f.fxyzSu=[0,0,0]}l.fxyz=[f.fxyz[0]+o,f.fxyz[1]+u,f.fxyz[2]+a],l.fxyzSu=f.fxyzSu,l.symop=f.symop,l.symc=[f.symc[0]+o,f.symc[1]+u,f.symc[2]+a],l.symt=l.symc[0]+""+l.symc[1]+""+l.symc[2],l.xyz=[],l.atom=f.atom,l.elem=f.elem,l.bondOrder=[];if(i.geomdata&&i.geomdata.bonds&&i.geomdata.bonds[l.atom+"_"+l.symop+"_"+l.symt]){l.bonds=i.geomdata.bonds[l.atom+"_"+l.symop+"_"+l.symt];for(var h=0;h<l.bonds.length;h++)l.bondOrder.push(1)}else l.bonds=[];var p=r._cif._getF2Cmatrix(i);l.xyz=r._cif._xyzApplyMatrix(l.fxyz,i.F2Cmatrix),l.xyzSu=r._cif._xyzApplyMatrix(l.fxyzSu,i.F2Cmatrix),l.x=l.xyz[0],l.y=l.xyz[1],l.z=l.xyz[2],l.occ=f.occ,l.dis_ass=f.dis_ass,l.dis_grp=f.dis_grp,g(l),l.xtra=!0,r.model.atoms[e+"_"+t+"_"+n]=l;var d=i.geomdata.bondsByLabel[l.atom];if(d)for(var h=0;h<d.length;h+=2){if(r.model.atoms[v+"_"+t+"_"+n])continue;var v=d[h]+"";r._addSite(v,t,n)}},e._widget.prototype._changeBondOrder=function(e,t,n){r(e,t,n),this._show()},e._widget.prototype._getMoieties=function(){var e=this;if(!e.model.moieties){var t=e._cif.blocks[e.model.cifblk];t&&t.moieties&&(e.model.moieties=t.moieties)}return e.model.moieties},e._widget.prototype._selectSitesByMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&t&&n._select.push(n.model.atoms[r])}},e._widget.prototype._toggleSitesByMoiety=function(e){var t=this,n=!1;for(var r in t.model.atoms){if(!t.model.atoms[r])continue;t.model.atoms[r].moiety&&t.model.atoms[r].moiety==e&&(t.model.atoms[r].hide?(t.model.atoms[r].hide=!1,n=!0):t.model.atoms[r].hide=!0)}return n},e._widget.prototype._showSitesByMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&(t?n.model.atoms[r].hide=!1:n.model.atoms[r].hide=!0)}},e._widget.prototype._showSingleMoiety=function(e,t){var n=this;for(var r in n.model.atoms){if(!n.model.atoms[r])continue;n.model.atoms[r].hide=!0,n.model.atoms[r].moiety&&n.model.atoms[r].moiety==e&&(t?n.model.atoms[r].hide=!1:n.model.atoms[r].hide=!0)}},e._widget.prototype._showAll=function(){var e=this;for(var t in e.model.atoms){if(!e.model.atoms[t])continue;e.model.atoms[t].hide=!1}},e._widget.prototype._selectSitesByLabel=function(e,t){var n=this;n._select.length=0;for(var r=0;r<e.length;r++)if(n.model.atoms[e[r]])n._select.push(n.model.atoms[e[r]]);else{var i=e[r].split("_");n._addSite(i[0],i[1],i[2]),n.model.atoms[e[r]]&&n._select.push(n.model.atoms[e[r]])}var s=[],o=0;for(var u in n.model.atoms){o++;if(!n.model.atoms[u])continue;n.model.atoms[u].xtra&&(s[u]=n.model.atoms[u])}var a=n._cif.blocks[n.model.cifblk];for(var f in s)for(var l in s){if(!s[l]||!s[l].xyz||f==l)continue;if(s[f].bonds&&s[f].bonds.indexOf(l)>-1)continue;if(a.geomdata.bondsByLabel[s[f].atom]){var c=a.geomdata.bondsByLabel[s[f].atom].indexOf(s[l].atom);if(c>-1){var h=n._cif._calcBondC(s[f].xyz,s[l].xyz,s[f].xyzSu,s[l].xyzSu);if(h[0]<SmolElementData.elCovRadii[s[f].elem]+SmolElementData.elCovRadii[s[l].elem]+.4||h[0]<a.geomdata.bondsByLabel[s[f].atom][c+1]*1.1)s[f].bonds.push(l),s[l].bonds.push(f),s[f].bondOrder.push(1),s[l].bondOrder.push(1)}}}e.length==3&&t&&t=="hinteractions"&&n.model.atoms[e[1]]&&n.model.atoms[e[2]]&&(n.model.atoms[e[1]].bonds.indexOf(e[2])==-1&&(n.model.atoms[e[1]].bonds.push(e[2]),n.model.atoms[e[1]].bondOrder.push(.5)),n.model.atoms[e[2]].bonds.indexOf(e[1])==-1&&(n.model.atoms[e[2]].bonds.push(e[1]),n.model.atoms[e[2]].bondOrder.push(.5)))},e._widget.prototype._selectSitesByAtomAndSymop=function(e,t,n){var r=this;r._select.length=0,r._symopList||(r._symopList=r._getSymopList());var i=[];for(var s=0;s<t.length;s++){var o="";if(t[s]=="")o=e[s]+"_1_555";else{for(var u in r._symopList)if(r._symopList[u].full==t[s]){o=e[s]+"_"+u;break}o==""}o!=""&&i.push(o)}r._selectSitesByLabel(i,n)},e._widget.prototype._getSymopList=function(){var e=this,t=[],n=e._cif.blocks[e.model.cifblk],r=n.model.sites;for(var i in r){var s=r[i];if(s.symop!=undefined){var o=s.symop+"_"+s.symt;if(t[o])continue;t[o]=e._cif._transformSymCode(e._cif.blocks[e.model.cifblk],o)}}var u=["_geom_bond_site_symmetry_1","_geom_bond_site_symmetry_2","_geom_hbond_site_symmetry_d","_geom_hbond_site_symmetry_a"];for(x=0;x<u.length;x++){var a=n.cifitems[u[x]];if(a){var f=a.getValues();for(var l=0;l<f.length;l++){if(t[f[l]])continue;f[l].search(/^\d+$/)==0&&(f[l]+="_555");if(f[l].search(/^\d+(_\d\d\d)?$/)==-1)continue;t[f[l]]=e._cif._transformSymCode(e._cif.blocks[e.model.cifblk],f[l])}}}return t}})(Smol);var SmolPopup=function(){function e(e){return this._create(e),this}return e.prototype._create=function(e){this._options={id:(new Date).getTime()+"",dragmode:"absolute",resizable:!0,parent:document.body,info:"",title:"",style:"smolpop",position:[],size:300,closable:!0,toolbox:!0,popupOptions:{}};if(e)for(var t in e)typeof this._options[t]!="undefined"&&(this._options[t]=e[t]);if(typeof e["popupOptions"]!="undefined")for(var n in e.popupOptions)typeof this._options[n]!="undefined"&&(this._options[n]=this._options.popupOptions[n]);var r=300,i=300,s=0;typeof this._options.size=="object"?(this._options.size.width&&(l=parseInt(this._options.size.width)),this._options.size.height&&(s=parseInt(this._options.size.height))):l=parseInt(this._options.size),l>20&&l<2001&&(r=l,i=l,s>20&&s<2001&&(i=s));var o=getWinWidth(),u=getWinHeight();r>o&&(r=o-20,i=o-20),i+100>u&&this._options.dragmode!="relative"&&(this._options.dragmode="absolute");if(this._options.position.length==0&&this._options.dragmode!="relative"){var a=0,f=0;if(this._options.dragmode!="fixed"){var l=getScreenScrollXY();a=l[0],f=l[1]}var c=o/2-r/2+a;c<20&&(c=0);var h=u/4-i/4+f;h<20&&(h=0),this._options.position=[c,h]}else this._options.position.length==0&&(this._options.position=[0,0]);if(this._options.dragmode=="relative"){var p=findPos(this._options.parent)[0]+this._options.position[0];r+p+30>o&&(r=o-p-30,i=r)}this._options.size=[r,i],this.popup=this._createSmolStructureWidget()},e.prototype._createSmolStructureWidget=function(){function p(e){var t=e.className,n=document.createElement("div");n.className=t+"_toolbox",n.style.border="1px solid #ccc",n.style.background="#efefef",n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.margin="0",n.style.padding="0",n.style.visibility="hidden",n.style.zIndex=1,e.appendChild(n),e.toolbox=n,n._p=e,e.showtoolbox=function(e){this.style.zIndex=highestZIndex++;if(e&&e=="hide"){this.toolbox.style.zIndex=1;for(var t=0;t<this.toolbox.buttons.length;t++)this.toolbox.buttons[t].deactivate();this.toolbox.style.top="0px",this.toolbox.style.left="0px",this.toolbox.style.visibility="hidden";return}if(this.toolbox.style.visibility=="hidden"||e&&e=="show"){this.toolbox.style.visibility="visible";var n=getWinWidth();n==0&&(n=200);var r=parseInt(this.style.left);this.style.position=="relative"&&(r=findPos(this)[0]);if(r+parseInt(this.style.width)+144<n)this.toolbox.style.width="144px",this.toolbox.style.top="0px",this.toolbox.style.left=parseInt(this.style.width)-144+"px",divMoveAnim(this.toolbox,parseInt(this.style.width),0,"block","div.style.visibility='visible';");else if(r-144>0)this.toolbox.style.width="144px",this.toolbox.style.top="0px",this.toolbox.style.left="0px",divMoveAnim(this.toolbox,-144,0,"block","div.style.visibility='visible';");else{this.toolbox.style.width=this.style.width,this.toolbox.style.top="0px",this.toolbox.style.left="0px";var i=-this.toolbox.offsetHeight
;this.style.position=="fixed"&&parseInt(this.style.top)+i<1?(this.toolbox.style.top="30px",this.toolbox.style.visibility="visible",this.toolbox.style.zIndex=highestZIndex++):divMoveAnim(this.toolbox,0,i,"block","div.style.visibility='visible';div.style.zIndex=highestZIndex++;")}}else{this.toolbox.style.zIndex=1;for(var t=0;t<this.toolbox.buttons.length;t++)this.toolbox.buttons[t].deactivate();if(parseInt(this.toolbox.style.top)==0)divMoveAnim(this.toolbox,parseInt(this.style.width)-this.toolbox.offsetWidth,0,"block","div.style.visibility='hidden';");else{var i=0;divMoveAnim(this.toolbox,0,i,"block","div.style.visibility='hidden';")}}},d(n)}function d(e){var t=e._p.className;e.buttons=[],e.buttonChanged=function(e,t){var n=!1;t&&t=="reset"&&(n=!0);for(var r=0;r<this.buttons.length;r++)this.buttons[r]!=e&&(n?this.buttons[r].reset():this.buttons[r].deactivate())};var n=document.createElement("div");n.className=t+"_button",n.style.cssFloat="left",n.style.position="relative",n.style.verticalAlign="top",n.style.display="inline-block",n.style.border="1px solid #aaa",n.style.borderRadius="4px",n.style.textAlign="center",n.style.lineHeight="32px",n.style.margin="4px",n.style.paddingTop="0px",n.style.paddingBottom="0px",n.style.paddingLeft="4px",n.style.paddingRight="4px",n.innerHTML="asymmetric unit",e.appendChild(n),n.onmousedown=function(){return!1},n.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle="ellipsoids",this.smol.changeModel("asu")),!1};var r=document.createElement("div");r.className=t+"_button",r.style.cssFloat="left",r.style.position="relative",r.style.verticalAlign="top",r.style.display="inline-block",r.style.border="1px solid #aaa",r.style.borderRadius="4px",r.style.textAlign="center",r.style.lineHeight="32px",r.style.margin="4px",r.style.paddingTop="0px",r.style.paddingBottom="0px",r.style.paddingLeft="4px",r.style.paddingRight="4px",r.innerHTML="molecule",e.appendChild(r),r.onmousedown=function(){return!1},r.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="ellipsoids"&&(this.smol.viewStyle="ball_and_stick",this.smol.vdwScale=.22),this.smol.changeModel("mol")),!1};var i=document.createElement("div");i.className=t+"_button",i.style.cssFloat="left",i.style.position="relative",i.style.verticalAlign="top",i.style.display="inline-block",i.style.border="1px solid #aaa",i.style.borderRadius="4px",i.style.textAlign="center",i.style.lineHeight="32px",i.style.margin="4px",i.style.paddingTop="0px",i.style.paddingBottom="0px",i.style.paddingLeft="4px",i.style.paddingRight="4px",i.innerHTML="unit cell",e.appendChild(i),i.onmousedown=function(){return!1},i.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="ellipsoids"&&(this.smol.viewStyle="ball_and_stick",this.smol.vdwScale=.22),this.smol.changeModel("cell5551")),!1};var s=document.createElement("div");s.style.width="124px",s.style.height="32px",s.style.cssFloat="left",s.style.position="relative",s.className=t+"_button_vdw_slider",s.style.border="1px solid #aaa",s.style.borderRadius="4px",s.style.backgroundPosition="0% 0%",s.style.backgroundColor="#efefef",s.style.lineHeight="32px",s.style.margin="4px",s.style.paddingTop="0px",s.style.paddingBottom="0px",s.style.paddingLeft="4px",s.style.paddingRight="4px",s.style.position="relative",s.style.display="inline-block",s.style.verticalAlign="top",s.style.textAlign="left",s.style.background="url(http://publcif.iucr.org/widgets/images/slidebarbg.png) no-repeat center",s.style.cursor="pointer",e.appendChild(s);var o=document.createElement("div");o.style.width="32px",o.style.height="32px",o.style.position="relative",o.style.left="22px",o.style.background="url(http://publcif.iucr.org/widgets/images/_ball_32.png) no-repeat center",o.style.cursor="pointer",s.appendChild(o),s.slider=o,s.onmouseup=function(e){this.slider.clickmove(e)},o.scale=parseInt(22),o.enabled=0,o.style.left=o.scale+"px",Drag.init(o,null,0,100,0,0),o.reset=function(e){this.scale=parseInt(1*e),this.style.left=this.scale+"px"},o.moveto=function(e){this.clickmove(e)},o.onDragStart=function(t,n){this.smol||(this.smol=e._p._smolwidget),this.smol&&(this.smol.viewStyle=="scheme"?this.smol._show({label:!1,viewStyle:"ball_and_stick"}):this.smol._show({viewStyle:"ball_and_stick"}))},o.onDrag=function(e,t){var n=parseInt(e);this.smol&&(this.smol._isDragging=!0,this.smol._show({viewStyle:"ball_and_stick",vdwScale:n/100})),this.scale=e},o.onDragEnd=function(e,t){var n=parseInt(e);this.smol&&(this.smol._isDragging=!1,this.smol._show({viewStyle:"ball_and_stick",vdwScale:n/100})),this.scale=e};var u=document.createElement("div");u.className=t+"_button",u.style.cssFloat="left",u.style.position="relative",u.style.verticalAlign="top",u.style.display="inline-block",u.style.border="1px solid #aaa",u.style.borderRadius="4px",u.style.textAlign="center",u.style.lineHeight="32px",u.style.margin="4px",u.style.paddingTop="0px",u.style.paddingBottom="0px",u.style.paddingLeft="4px",u.style.paddingRight="4px",u.innerHTML="schematic",e.appendChild(u),u.onmousedown=function(){return!1},u.onmouseup=function(){return this.smol||(this.smol=e._p._smolwidget),this.smol&&this.smol._show({label:!0,viewStyle:"scheme"}),e._p._backdiv.style.background="white",e._p._infodiv.style.color="#000",!1};var a=[],f=[],l=[];f[0]="bonds",l[0]="pick bonds",a[0]=2,f[1]="angles",l[1]="pick angles",a[1]=3,f[2]="torsions",l[2]="pick torsions",a[2]=4,f[3]="nothing",l[3]="measure",a[3]=0;var c=v(f.length,null,null,null,t);c.style.width="124px",c.group=e;for(var h=0;h<c.optionDivs.length;h++)c.optionDivs[h].innerHTML=f[h],c.optionDivs[h].script=a[h],c.optionDivs[h].onmouseup=function(){this.smol||(this.smol=e._p._smolwidget),e._p.statusBar.innerHTML="",this.smol&&this.smol._show({picking:this.script,pickCallback:function(t){e._p.statusBar.innerHTML=t}})},c.optionDivs[h].selectedLabel=l[h];c.labelSpan.innerHTML="measure",c.displayChange=function(){this.group.buttonChanged(this)},e.appendChild(c.container),e.pickingButton=c,e.buttons.push(c);var p=[],d=[],m=[];d[0]="black",m[0]="background",p[0]="black",d[1]="white",p[1]="white",m[1]="background";var g=v(2,null,null,null,t);g.style.width="124px";for(var h=0;h<g.optionDivs.length;h++)g.optionDivs[h].innerHTML=d[h],g.optionDivs[h].script=p[h],g.optionDivs[h].onmouseup=function(){e._p._backdiv.style.background=this.script,this.script=="black"?e._p._infodiv.style.color="#ebebeb":e._p._infodiv.style.color="#000"},g.optionDivs[h].selectedLabel=m[h];g.labelSpan.innerHTML="background",g.group=e,g.displayChange=function(){this.group.buttonChanged(this)},e.appendChild(g.container),e.buttons.push(g)}function v(e,t,n,r,i){var s=document.createElement("div");s.style.cssFloat="left",s.style.display="inline-block";var o=document.createElement("div");o.style.display="block",o.style.color="#666666",o.style.margin="4px",o.style.marginTop="6px",o.style.marginBottom="2px",o.style.fontWeight="bold",o.className=i+"_heading",s.appendChild(o),r?o.innerHTML=r:o.style.display="none";var u=document.createElement("div");u.className=i+"_button_dropdown",u.style.cssFloat="left",u.style.position="relative",u.style.verticalAlign="top",u.style.display="block",u.style.border="1px solid #aaa",u.style.borderRadius="4px",u.style.textAlign="left",u.style.lineHeight="32px",u.style.margin="4px",u.style.paddingTop="0px",u.style.paddingBottom="0px",u.style.paddingLeft="4px",u.style.paddingRight="4px",u.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/triang_d_24.png)",u.style.backgroundRepeat="no-repeat",u.style.backgroundPosition="98% 50%",s.appendChild(u);var a=document.createElement("div");u.appendChild(a);var f=document.createElement("span");a.appendChild(f),u.labelSpan=f;var l=document.createElement("div");l.style.position="absolute",l.style.display="none",l.style.left="-1px",l.className=i+"_button_dropdown_options",l.style.verticalAlign="top",l.style.border="1px solid #aaa",l.style.borderRadius="4px",l.style.textAlign="left",l.style.lineHeight="2em",l.style.margin="0px",l.style.paddingTop="0px",l.style.paddingBottom="0px",l.style.paddingLeft="0px",l.style.paddingRight="0px",l.style.width="100%",l.style.background="#ddd",a.appendChild(l);var c=[];for(var h=0;h<e;h++){var p=document.createElement("div");p.className=i+"_button_option",p.style.border="1px solid transparent",p.style.paddingTop="0px",p.style.paddingBottom="0px",p.style.paddingLeft="4px",p.style.paddingRight="4px",p.onclick=function(){this.selectedLabel?u.labelSpan.innerHTML=this.selectedLabel:u.labelSpan.innerHTML=this.innerHTML,u.selectedEl=this},l.appendChild(p),c[h]=p}return u.optionDivs=c,u.optionsDiv=l,typeof n=="function"?u.displayChange=n:u.displayChange=function(){},u.onclick=function(){l.style.zIndex=1,l.style.display=="block"?(this.deactivate(),this.displayChange()):(this.activate(),this.displayChange())},t&&t=="hover"&&(u.onmouseover=function(){this.activate(),this.displayChange()},u.onmouseout=function(){this.deactivate(),this.displayChange()}),u.activate=function(){l.style.display="block",this.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/triang_u_24.png)",this.className=this.className.replace(/_dropdown$/,"_rollup")},u.deactivate=function(){l.style.display="none",this.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/triang_d_24.png)",this.className=this.className.replace(/_rollup$/,"_dropdown")},u.reset=function(){l.style.display="none",this.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/triang_u_24.png)",this.className=this.className.replace(/_rollup$/,"_dropdown"),typeof this.defaultSelectedIdx=="undefined"&&(this.defaultSelectedIdx=0),this.optionDivs[this.defaultSelectedIdx].selectedLabel?this.labelSpan.innerHTML=this.optionDivs[this.defaultSelectedIdx].selectedLabel:this.labelSpan.innerHTML=this.optionDivs[this.defaultSelectedIdx].innerHTML,this.selectedEl=u.optionDivs[this.defaultSelectedIdx]},u.selectedEl=u.optionDivs[0],u.container=s,u}var e=this._options,t=document.createElement("div");t.className=e.style,t.style.border="1px solid #ccc",t.style.background="#ffffff",t.style.borderRadius="4px",t.id=e.id,t.style.width=e.size[0]+"px",e["resizable"]==1?(t.style.height=e.size[1]+60+"px",t.resizeBar=!0):(t.style.height=e.size[1]+30+"px",t.resizeBar=!1),t.style.left=e.position[0]+"px",t.style.top=e.position[1]+"px",t.style.position=e.dragmode,t.style.margin="0",t.style.padding="0",e.parent.appendChild(t);var n=document.createElement("div");n.style.cursor="move",n.style.backgroundColor="#ddd",n.style.backgroundImage="linear-gradient(#ccc, #eee)",n.className=e.style+"_titlebar",n.id=e.id+"_draghandle",n.style.height="30px",n.style.overflow="visible",n.style.position="relative",n.style.margin="0",n.style.zIndex=2,t.appendChild(n);var r=document.createElement("div");r.className=e.style+"_closebutton",r.style.width="30px",r.style.height="30px",r.style.position="relative",r.style.cssFloat="left",r.style.margin="0",r.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/delete_24.png)",r.style.backgroundRepeat="no-repeat",r.style.backgroundPosition="center",r.style.cursor="pointer",r._p=t,n.appendChild(r),r.onmouseup=function(){this._p.hide()},e["closable"]!=1&&(r.style.display="none");var i=document.createElement("div");i.className=e.style+"_title",i.style.lineHeight="30px",i.style.fontSize="14px",i.style.paddingLeft="5px",i.style.fontWeight="bold",i.style.color="#666666",i.style.position="relative",i.style.cssFloat="left",i.style.margin="0",i.innerHTML=e.title,n.appendChild(i);var s=document.createElement("div");s.className=e.style+"_infobutton",s.style.width="30px",s.style.height="30px",s.style.position="relative",s.style.cssFloat="right",s.style.margin="0",s.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/info_24.png)",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="center",s.style.cursor="pointer",s._p=t,n.appendChild(s),s.onmouseup=function(){this._p._infodiv.style.display=="block"?(this._p._infodiv.style.display="none",this.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/info_24.png)",this.className=this.className.replace(/_smolbutton$/,"_infobutton")):(this._p._infodiv.style.display="block",this.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/smol_32.png)",this.className=this.className.replace(/_infobutton$/,"_smolbutton"))},e["info"]==""&&(s.style.display="none");var o=document.createElement("div");o.className=e.style+"_toolsbutton",o.style.width="30px",o.style.height="30px",o.style.position="relative",o.style.cssFloat="right",o.style.margin="0",o.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/spanner_24.png)",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="center",o.style.cursor="pointer",o._p=t,n.appendChild(o),o.onmouseup=function(){this._p.showtoolbox()},e["toolbox"]!=1&&(o.style.display="none");var u=document.createElement("div");u.id=e.id+"_backdiv",u.className=e.style+"_backdiv",u.style.position="absolute",u.style.width=e.size[0]+"px",u.style.height=e.size[1]+"px",u.style.zIndex=2,u.style.margin="0",u.style.background="#ffffff",t.appendChild(u),t._backdiv=u;var a=document.createElement("div");a.id=e.id+"_infodiv",a.className=e.style+"_info",a.style.position="absolute",a.style.zIndex=2,a.style.margin="0",a.style.overflow="hidden",a.innerHTML=e.info,a.style.display="none",t.appendChild(a),t._infodiv=a;var f=document.createElement("div");f.id=e.id+"_smoldiv",f.style.position="relative",f.style.zIndex=2,f.style.width=e.size[0]+"px",f.style.height=e.size[1]+"px",f.style.margin="0",f.style.padding="0",t.appendChild(f);var l=document.createElement("div");l.className=e.style+"_statusbar",l.id=e.id+"_statusbar",l.style.height="30px",l.style.lineHeight="30px",l.style.paddingLeft="5px",l.style.position="relative",l.style.zIndex=2,l.style.margin="0",l.style.padding="0",l.style.bottom="0px",l.style.backgroundImage="url(http://publcif.iucr.org/widgets/images/resize_24.png)",l.style.backgroundRepeat="no-repeat",l.style.backgroundPosition="right bottom",l.style.cursor="se-resize",t.appendChild(l),t.statusBar=l,e["resizable"]!=1&&(l.style.display="none"),t.hide=function(){this.style.display="none"},t.show=function(){if(this.style.position!="relative"){var e=0,t=0;if(this.style.position!="fixed"){var n=getScreenScrollXY();e=n[0],t=n[1]}var r=getWinWidth()-20,i=getWinHeight(),s=parseInt(this.style.width),o=parseInt(this.style.height);s>r&&(s=r,o=s+60);var u=r/2-s/2+e;u<20&&(u=0);var a=i/4-o/4+t;a<0&&(a=0);var f=parseInt(this.style.left),l=parseInt(this.style.top);f+s>r&&(f=r-s),l+o>i&&(l=i/4-o/4+t),l<0&&(l=0),f<0&&(f=0),this.style.width=s+"px",this.style.height=o+"px",this.style.left=f+"px",this.style.top=l+"px",this._smoldiv.style.height=o-60+"px",this._smoldiv.style.width=s+"px",this._backdiv.style.height=o-60+"px",this._backdiv.style.width=s+"px",this._infodiv.style.width=s+"px",this._smolwidget&&this._smolwidget.resize(s,o-60),this.style.zIndex=highestZIndex++}else parseInt(this.style.left)+s>r&&(this.style.left=r-s-10+"px");this.style.display="block"},t.resize=function(e,t){this.showtoolbox("hide"),this.style.height=t+"px",this.style.width=e+"px";var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)},t.style.display="block",e["dragmode"]!="relative"?t.style.zIndex=highestZIndex++:t.style.zIndex=0,t._smoldiv=f;var c=null,h=null;return e["dragmode"]!="relative"?(c=0,h=0,Drag.init(n,t,c,null,h)):n.style.cursor="auto",e["resizable"]==1&&(DragResize.init(l,t),t.onDragResizeStart=function(e,t){this.showtoolbox("hide")},t.onDragResize=function(e,t){var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)},t.onDragResizeEnd=function(e,t){var n=30;this.resizeBar&&(n=60),this._smoldiv.style.height=t-n+"px",this._smoldiv.style.width=e+"px",this._backdiv.style.height=t-n+"px",this._backdiv.style.width=e+"px",this._infodiv.style.width=e+"px",this._smolwidget&&this._smolwidget.resize(e,t-n)}),p(t),t},e.prototype.resize=function(e,t){this.popup.showtoolbox("hide"),this.popup.style.height=t+"px",this.popup.style.width=e+"px";var n=30;this.popup.resizeBar&&(n=60),this.popup._smoldiv.style.height=t-n+"px",this.popup._smoldiv.style.width=e+"px",this.popup._backdiv.style.height=t-n+"px",this.popup._backdiv.style.width=e+"px",this.popup._infodiv.style.width=e+"px",this.popup._smolwidget&&this.popup._smolwidget.resize(e,t-n)},e}();//"use strict";
var numeric=typeof exports=="undefined"?function(){}:exports;typeof global!="undefined"&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(t,n){var r,i,s,o;typeof n=="undefined"&&(n=15),s=.5,r=new Date;for(;;){s*=2;for(o=s;o>3;o-=4)t(),t(),t(),t();while(o>0)t(),o--;i=new Date;if(i-r>n)break}for(o=s;o>3;o-=4)t(),t(),t(),t();while(o>0)t(),o--;return i=new Date,1e3*(3*s-1)/(i-r)},numeric._myIndexOf=function(t){var n=this.length,r;for(r=0;r<n;++r)if(this[r]===t)return r;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(t){function n(e){if(e===0)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+n(-e);if(isFinite(e)){var t=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,t),i=r.toPrecision(numeric.precision);return parseFloat(i)===10&&(t++,r=1,i=r.toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+t.toString()}return"Infinity"}function i(e){var t;if(typeof e=="undefined")return r.push(Array(numeric.precision+8).join(" ")),!1;if(typeof e=="string")return r.push('"'+e+'"'),!1;if(typeof e=="boolean")return r.push(e.toString()),!1;if(typeof e=="number"){var s=n(e),o=e.toPrecision(numeric.precision),u=parseFloat(e.toString()).toString(),a=[s,o,u,parseFloat(o).toString(),parseFloat(u).toString()];for(t=1;t<a.length;t++)a[t].length<s.length&&(s=a[t]);return r.push(Array(numeric.precision+8-s.length).join(" ")+s),!1}if(e===null)return r.push("null"),!1;if(typeof e=="function"){r.push(e.toString());var f=!1;for(t in e)e.hasOwnProperty(t)&&(f?r.push(",\n"):r.push("\n{"),f=!0,r.push(t),r.push(": \n"),i(e[t]));return f&&r.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return r.push("...Large Array..."),!0;var f=!1;r.push("[");for(t=0;t<e.length;t++)t>0&&(r.push(","),f&&r.push("\n ")),f=i(e[t]);return r.push("]"),!0}r.push("{");var f=!1;for(t in e)e.hasOwnProperty(t)&&(f&&r.push(",\n"),f=!0,r.push(t),r.push(": \n"),i(e[t]));return r.push("}"),!0}var r=[];return i(t),r.join("")},numeric.parseDate=function(t){function n(e){if(typeof e=="string")return Date.parse(e.replace(/-/g,"/"));if(e instanceof Array){var t=[],r;for(r=0;r<e.length;r++)t[r]=n(e[r]);return t}throw new Error("parseDate: parameter must be arrays of strings")}return n(t)},numeric.parseFloat=function(t){function n(e){if(typeof e=="string")return parseFloat(e);if(e instanceof Array){var t=[],r;for(r=0;r<e.length;r++)t[r]=n(e[r]);return t}throw new Error("parseFloat: parameter must be arrays of strings")}return n(t)},numeric.parseCSV=function(t){var n=t.split("\n"),r,i,s=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,u=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,a=function(e){return e.substr(0,e.length-1)},f=0;for(i=0;i<n.length;i++){var l=(n[i]+",").match(o),c;if(l.length>0){s[f]=[];for(r=0;r<l.length;r++)c=a(l[r]),u.test(c)?s[f][r]=parseFloat(c):s[f][r]=c;f++}}return s},numeric.toCSV=function(t){var n=numeric.dim(t),r,i,s,o,u,a;s=n[0],o=n[1],a=[];for(r=0;r<s;r++){u=[];for(i=0;i<s;i++)u[i]=t[r][i].toString();a[r]=u.join(", ")}return a.join("\n")+"\n"},numeric.getURL=function(t){var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n},numeric.imageURL=function(t){function n(e){var t=e.length,n,r,i,s,o,u,a,f,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="";for(n=0;n<t;n+=3)r=e[n],i=e[n+1],s=e[n+2],o=r>>2,u=((r&3)<<4)+(i>>4),a=((i&15)<<2)+(s>>6),f=s&63,n+1>=t?a=f=64:n+2>=t&&(f=64),c+=l.charAt(o)+l.charAt(u)+l.charAt(a)+l.charAt(f);return c}function r(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=e.length);var r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=-1,s=0,o=e.length,u;for(u=t;u<n;u++)s=(i^e[u])&255,i=i>>>8^r[s];return i^-1}var i=t[0].length,s=t[0][0].length,o,u,a,f,l,c,h,p,d,v,m,g=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,s>>24&255,s>>16&255,s>>8&255,s&255,i>>24&255,i>>16&255,i>>8&255,i&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];m=r(g,12,29),g[29]=m>>24&255,g[30]=m>>16&255,g[31]=m>>8&255,g[32]=m&255,o=1,u=0;for(p=0;p<i;p++){p<i-1?g.push(0):g.push(1),c=3*s+1+(p===0)&255,h=3*s+1+(p===0)>>8&255,g.push(c),g.push(h),g.push(~c&255),g.push(~h&255),p===0&&g.push(0);for(d=0;d<s;d++)for(f=0;f<3;f++)c=t[f][p][d],c>255?c=255:c<0?c=0:c=Math.round(c),o=(o+c)%65521,u=(u+o)%65521,g.push(c);g.push(0)}return v=(u<<16)+o,g.push(v>>24&255),g.push(v>>16&255),g.push(v>>8&255),g.push(v&255),l=g.length-41,g[33]=l>>24&255,g[34]=l>>16&255,g[35]=l>>8&255,g[36]=l&255,m=r(g,37),g.push(m>>24&255),g.push(m>>16&255),g.push(m>>8&255),g.push(m&255),g.push(0),g.push(0),g.push(0),g.push(0),g.push(73),g.push(69),g.push(78),g.push(68),g.push(174),g.push(66),g.push(96),g.push(130),"data:image/png;base64,"+n(g)},numeric._dim=function(t){var n=[];while(typeof t=="object")n.push(t.length),t=t[0];return n},numeric.dim=function(t){var n,r;if(typeof t=="object")return n=t[0],typeof n=="object"?(r=n[0],typeof r=="object"?numeric._dim(t):[t.length,n.length]):[t.length];return[]},numeric.mapreduce=function(t,n){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+n+";\n"+'if(typeof x === "number") { var xi = x; '+t+"; return accum; }\n"+'if(typeof _s === "undefined") _s = numeric.dim(x);\n'+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i,xi;\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) {\n"+"        accum = arguments.callee(x[i],accum,_s,_k+1);\n"+"    }"+"    return accum;\n"+"}\n"+"for(i=_n-1;i>=1;i-=2) { \n"+"    xi = x[i];\n"+"    "+t+";\n"+"    xi = x[i-1];\n"+"    "+t+";\n"+"}\n"+"if(i === 0) {\n"+"    xi = x[i];\n"+"    "+t+"\n"+"}\n"+"return accum;")},numeric.mapreduce2=function(t,n){return Function("x","var n = x.length;\nvar i,xi;\n"+n+";\n"+"for(i=n-1;i!==-1;--i) { \n"+"    xi = x[i];\n"+"    "+t+";\n"+"}\n"+"return accum;")},numeric.same=function same(e,t){var n,r;if(e instanceof Array&&t instanceof Array){r=e.length;if(r!==t.length)return!1;for(n=0;n<r;n++){if(e[n]===t[n])continue;if(typeof e[n]!="object")return!1;if(!same(e[n],t[n]))return!1}return!0}return!1},numeric.rep=function(t,n,r){typeof r=="undefined"&&(r=0);var i=t[r],s=Array(i),o;if(r===t.length-1){for(o=i-2;o>=0;o-=2)s[o+1]=n,s[o]=n;return o===-1&&(s[0]=n),s}for(o=i-1;o>=0;o--)s[o]=numeric.rep(t,n,r+1);return s},numeric.dotMMsmall=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m;o=t.length,u=n.length,a=n[0].length,f=Array(o);for(r=o-1;r>=0;r--){l=Array(a),c=t[r];for(s=a-1;s>=0;s--){h=c[u-1]*n[u-1][s];for(i=u-2;i>=1;i-=2)p=i-1,h+=c[i]*n[i][s]+c[p]*n[p][s];i===0&&(h+=c[0]*n[0][s]),l[s]=h}f[r]=l}return f},numeric._getCol=function(t,n,r){var i=t.length,s;for(s=i-1;s>0;--s)r[s]=t[s][n],--s,r[s]=t[s][n];s===0&&(r[0]=t[0][n])},numeric.dotMMbig=function(t,n){var r=numeric._getCol,i=n.length,s=Array(i),o=t.length,u=n[0].length,a=new Array(o),f,l=numeric.dotVV,c,h,p,d;--i,--o;for(c=o;c!==-1;--c)a[c]=Array(u);--u;for(c=u;c!==-1;--c){r(n,c,s);for(h=o;h!==-1;--h)d=0,f=t[h],a[h][c]=l(f,s)}return a},numeric.dotMV=function(t,n){var r=t.length,i=n.length,s,o=Array(r),u=numeric.dotVV;for(s=r-1;s>=0;s--)o[s]=u(t[s],n);return o},numeric.dotVM=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;o=t.length,u=n[0].length,f=Array(u);for(s=u-1;s>=0;s--){h=t[o-1]*n[o-1][s];for(i=o-2;i>=1;i-=2)p=i-1,h+=t[i]*n[i][s]+t[p]*n[p][s];i===0&&(h+=t[0]*n[0][s]),f[s]=h}return f},numeric.dotVV=function(t,n){var r,i=t.length,s,o=t[i-1]*n[i-1];for(r=i-2;r>=1;r-=2)s=r-1,o+=t[r]*n[r]+t[s]*n[s];return r===0&&(o+=t[0]*n[0]),o},numeric.dot=function(t,n){var r=numeric.dim;switch(r(t).length*1e3+r(n).length){case 2002:return n.length<10?numeric.dotMMsmall(t,n):numeric.dotMMbig(t,n);case 2001:return numeric.dotMV(t,n);case 1002:return numeric.dotVM(t,n);case 1001:return numeric.dotVV(t,n);case 1e3:return numeric.mulVS(t,n);case 1:return numeric.mulSV(t,n);case 0:return t*n;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(t){var n,r,i,s=t.length,o=Array(s),u;for(n=s-1;n>=0;n--){u=Array(s),r=n+2;for(i=s-1;i>=r;i-=2)u[i]=0,u[i-1]=0;i>n&&(u[i]=0),u[n]=t[n];for(i=n-1;i>=1;i-=2)u[i]=0,u[i-1]=0;i===0&&(u[0]=0),o[n]=u}return o},numeric.getDiag=function(e){var t=Math.min(e.length,e[0].length),n,r=Array(t);for(n=t-1;n>=1;--n)r[n]=e[n][n],--n,r[n]=e[n][n];return n===0&&(r[0]=e[0][0]),r},numeric.identity=function(t){return numeric.diag(numeric.rep([t],1))},numeric.pointwise=function(t,n,r){typeof r=="undefined"&&(r="");var i=[],s,o=/\[i\]$/,u,a="",f=!1;for(s=0;s<t.length;s++)o.test(t[s])?(u=t[s].substring(0,t[s].length-3),a=u):u=t[s],u==="ret"&&(f=!0),i.push(u);return i[t.length]="_s",i[t.length+1]="_k",i[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+");\n"+'if(typeof _k === "undefined") _k = 0;\n'+"var _n = _s[_k];\n"+"var i"+(f?"":", ret = Array(_n)")+";\n"+"if(_k < _s.length-1) {\n"+"    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+t.join(",")+",_s,_k+1);\n"+"    return ret;\n"+"}\n"+r+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+"    "+n+"\n"+"}\n"+"return ret;",Function.apply(null,i)},numeric.pointwise2=function(t,n,r){typeof r=="undefined"&&(r="");var i=[],s,o=/\[i\]$/,u,a="",f=!1;for(s=0;s<t.length;s++)o.test(t[s])?(u=t[s].substring(0,t[s].length-3),a=u):u=t[s],u==="ret"&&(f=!0),i.push(u);return i[t.length]="var _n = "+a+".length;\n"+"var i"+(f?"":", ret = Array(_n)")+";\n"+r+"\n"+"for(i=_n-1;i!==-1;--i) {\n"+n+"\n"+"}\n"+"return ret;",Function.apply(null,i)},numeric._biforeach=function _biforeach(e,t,n,r,i){if(r===n.length-1){i(e,t);return}var s,o=n[r];for(s=o-1;s>=0;s--)_biforeach(typeof e=="object"?e[s]:e,typeof t=="object"?t[s]:t,n,r+1,i)},numeric._biforeach2=function _biforeach2(e,t,n,r,i){if(r===n.length-1)return i(e,t);var s,o=n[r],u=Array(o);for(s=o-1;s>=0;--s)u[s]=_biforeach2(typeof e=="object"?e[s]:e,typeof t=="object"?t[s]:t,n,r+1,i);return u},numeric._foreach=function _foreach(e,t,n,r){if(n===t.length-1){r(e);return}var i,s=t[n];for(i=s-1;i>=0;i--)_foreach(e[i],t,n+1,r)},numeric._foreach2=function _foreach2(e,t,n,r){if(n===t.length-1)return r(e);var i,s=t[n],o=Array(s);for(i=s-1;i>=0;i--)o[i]=_foreach2(e[i],t,n+1,r);return o},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";numeric.myIndexOf.call(numeric.mathfuns2,e)!==-1?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},numeric.opseq.hasOwnProperty(e+"eq")?r=function(e,n){return e+" "+t+"= "+n}:r=function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+"SV;\n"+"var dim = numeric.dim;\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof x === "object") {\n'+'      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n'+"      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n"+'  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n'+"  else "+r("x","y")+"\n"+"}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+"eqS\n"+"var s = numeric.dim(x);\n"+"for(i=1;i!==n;++i) { \n"+"  y = arguments[i];\n"+'  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n'+"  else numeric._biforeach(x,y,s,0,S);\n"+"}\nreturn x;\n")}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],numeric.myIndexOf.call(numeric.mathfuns,e)!==-1&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\n"+"var i;\n"+"var V = numeric."+e+"eqV;\n"+"var s = numeric.dim(x);\n"+"numeric._foreach(x,s,0,V);\n"+"return x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\n"+"var i;\n"+"var V = numeric."+e+"V;\n"+"var s = numeric.dim(x);\n"+"return numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {'+"    xi = x;\n"+t[0]+";\n"+"    return accum;\n"+"}"+'if(typeof s === "undefined") s = numeric.dim(x);\n'+'if(typeof k === "undefined") k = 0;\n'+"if(k === s.length-1) return numeric."+e+"V(x);\n"+"var xi;\n"+"var n = x.length, i;\n"+"for(i=n-1;i!==-1;--i) {\n"+"   xi = arguments.callee(x[i]);\n"+t[0]+";\n"+"}\n"+"return accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(t,n){return typeof t=="object"?typeof n=="object"?numeric.truncVV(t,n):numeric.truncVS(t,n):typeof n=="object"?numeric.truncSV(t,n):Math.round(t/n)*n},numeric.inv=function(t){var n=numeric.dim(t),r=Math.abs,i=n[0],s=n[1],o=numeric.clone(t),u,a,f=numeric.identity(i),l,c,h,p,d,t;for(p=0;p<s;++p){var v=-1,m=-1;for(h=p;h!==i;++h)d=r(o[h][p]),d>m&&(v=h,m=d);a=o[v],o[v]=o[p],o[p]=a,c=f[v],f[v]=f[p],f[p]=c,t=a[p];for(d=p;d!==s;++d)a[d]/=t;for(d=s-1;d!==-1;--d)c[d]/=t;for(h=i-1;h!==-1;--h)if(h!==p){u=o[h],l=f[h],t=u[p];for(d=p+1;d!==s;++d)u[d]-=a[d]*t;for(d=s-1;d>0;--d)l[d]-=c[d]*t,--d,l[d]-=c[d]*t;d===0&&(l[0]-=c[0]*t)}}return f},numeric.det=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: det() only works on square matrices");var r=n[0],i=1,s,o,u,a=numeric.clone(t),f,l,c,h,p,d,v;for(o=0;o<r-1;o++){u=o;for(s=o+1;s<r;s++)Math.abs(a[s][o])>Math.abs(a[u][o])&&(u=s);u!==o&&(h=a[u],a[u]=a[o],a[o]=h,i*=-1),f=a[o];for(s=o+1;s<r;s++){l=a[s],c=l[o]/f[o];for(u=o+1;u<r-1;u+=2)p=u+1,l[u]-=f[u]*c,l[p]-=f[p]*c;u!==r&&(l[u]-=f[u]*c)}if(f[o]===0)return 0;i*=f[o]}return i*a[o][o]},numeric.transpose=function(t){var n,r,i=t.length,s=t[0].length,o=Array(s),u,a,f;for(r=0;r<s;r++)o[r]=Array(i);for(n=i-1;n>=1;n-=2){a=t[n],u=t[n-1];for(r=s-1;r>=1;--r)f=o[r],f[n]=a[r],f[n-1]=u[r],--r,f=o[r],f[n]=a[r],f[n-1]=u[r];r===0&&(f=o[0],f[n]=a[0],f[n-1]=u[0])}if(n===0){u=t[0];for(r=s-1;r>=1;--r)o[r][0]=u[r],--r,o[r][0]=u[r];r===0&&(o[0][0]=u[0])}return o},numeric.negtranspose=function(t){var n,r,i=t.length,s=t[0].length,o=Array(s),u,a,f;for(r=0;r<s;r++)o[r]=Array(i);for(n=i-1;n>=1;n-=2){a=t[n],u=t[n-1];for(r=s-1;r>=1;--r)f=o[r],f[n]=-a[r],f[n-1]=-u[r],--r,f=o[r],f[n]=-a[r],f[n-1]=-u[r];r===0&&(f=o[0],f[n]=-a[0],f[n-1]=-u[0])}if(n===0){u=t[0];for(r=s-1;r>=1;--r)o[r][0]=-u[r],--r,o[r][0]=-u[r];r===0&&(o[0][0]=-u[0])}return o},numeric._random=function _random(e,t){var n,r=e[t],i=Array(r),s;if(t===e.length-1){s=Math.random;for(n=r-1;n>=1;n-=2)i[n]=s(),i[n-1]=s();return n===0&&(i[0]=s()),i}for(n=r-1;n>=0;n--)i[n]=_random(e,t+1);return i},numeric.random=function(t){return numeric._random(t,0)},numeric.norm2=function(t){return Math.sqrt(numeric.norm2Squared(t))},numeric.linspace=function(t,n,r){typeof r=="undefined"&&(r=Math.max(Math.round(n-t)+1,1));if(r<2)return r===1?[t]:[];var i,s=Array(r);r--;for(i=r;i>=0;i--)s[i]=(i*n+(r-i)*t)/r;return s},numeric.getBlock=function(t,n,r){function s(e,t){var o,u=n[t],a=r[t]-u,f=Array(a);if(t===i.length-1){for(o=a;o>=0;o--)f[o]=e[o+u];return f}for(o=a;o>=0;o--)f[o]=s(e[o+u],t+1);return f}var i=numeric.dim(t);return s(t,0)},numeric.setBlock=function(t,n,r,i){function o(e,t,i){var u,a=n[i],f=r[i]-a;if(i===s.length-1)for(u=f;u>=0;u--)e[u+a]=t[u];for(u=f;u>=0;u--)o(e[u+a],t[u],i+1)}var s=numeric.dim(t);return o(t,i,0),t},numeric.getRange=function(t,n,r){var i=n.length,s=r.length,o,u,a=Array(i),f,l;for(o=i-1;o!==-1;--o){a[o]=Array(s),f=a[o],l=t[n[o]];for(u=s-1;u!==-1;--u)f[u]=l[r[u]]}return a},numeric.blockMatrix=function(t){var n=numeric.dim(t);if(n.length<4)return numeric.blockMatrix([t]);var r=n[0],i=n[1],s,o,u,a,f;s=0,o=0;for(u=0;u<r;++u)s+=t[u][0].length;for(a=0;a<i;++a)o+=t[0][a][0].length;var l=Array(s);for(u=0;u<s;++u)l[u]=Array(o);var c=0,h,p,d,v,m;for(u=0;u<r;++u){h=o;for(a=i-1;a!==-1;--a){f=t[u][a],h-=f[0].length;for(d=f.length-1;d!==-1;--d){m=f[d],p=l[c+d];for(v=m.length-1;v!==-1;--v)p[h+v]=m[v]}}c+=t[u][0].length}return l},numeric.tensor=function(t,n){if(typeof t=="number"||typeof n=="number")return numeric.mul(t,n);var r=numeric.dim(t),i=numeric.dim(n);if(r.length!==1||i.length!==1)throw new Error("numeric: tensor product is only defined for vectors");var s=r[0],o=i[0],u=Array(s),a,f,l,c;for(f=s-1;f>=0;f--){a=Array(o),c=t[f];for(l=o-1;l>=3;--l)a[l]=c*n[l],--l,a[l]=c*n[l],--l,a[l]=c*n[l],--l,a[l]=c*n[l];while(l>=0)a[l]=c*n[l],--l;u[f]=a}return u},numeric.T=function(t,n){this.x=t,this.y=n},numeric.t=function(t,n){return new numeric.T(t,n)},numeric.Tbinop=function(t,n,r,i,s){var o=numeric.indexOf;if(typeof s!="string"){var u;s="";for(u in numeric)numeric.hasOwnProperty(u)&&(t.indexOf(u)>=0||n.indexOf(u)>=0||r.indexOf(u)>=0||i.indexOf(u)>=0)&&u.length>1&&(s+="var "+u+" = numeric."+u+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+s+"\n"+"if(x.y) {"+"  if(y.y) {"+"    return new numeric.T("+i+");\n"+"  }\n"+"  return new numeric.T("+r+");\n"+"}\n"+"if(y.y) {\n"+"  return new numeric.T("+n+");\n"+"}\n"+"return new numeric.T("+t+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var t=numeric.mul,n=numeric.div;if(this.y){var r=numeric.add(t(this.x,this.x),t(this.y,this.y));return new numeric.T(n(this.x,r),n(numeric.neg(this.y),r))}return new T(n(1,this.x))},numeric.T.prototype.div=function div(e){e instanceof numeric.T||(e=new numeric.T(e));if(e.y)return this.mul(e.reciprocal());var div=numeric.div;return this.y?new numeric.T(div(this.x,e.x),div(this.y,e.x)):new numeric.T(div(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),t(r)):new numeric.T(t(n))},numeric.T.prototype.transjugate=function(){var t=numeric.transpose,n=this.x,r=this.y;return r?new numeric.T(t(n),numeric.negtranspose(r)):new numeric.T(t(n))},numeric.Tunop=function(t,n,r){return typeof r!="string"&&(r=""),Function("var x = this;\n"+r+"\n"+"if(x.y) {"+"  "+n+";\n"+"}\n"+t+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var t=this;if(typeof t.y=="undefined")return new numeric.T(numeric.inv(t.x));var n=t.x.length,r,i,s,o=numeric.identity(n),u=numeric.rep([n,n],0),a=numeric.clone(t.x),f=numeric.clone(t.y),l,c,h,p,d,v,m,g,r,i,s,y,b,w,E,S,x,T;for(r=0;r<n;r++){w=a[r][r],E=f[r][r],y=w*w+E*E,s=r;for(i=r+1;i<n;i++)w=a[i][r],E=f[i][r],b=w*w+E*E,b>y&&(s=i,y=b);s!==r&&(T=a[r],a[r]=a[s],a[s]=T,T=f[r],f[r]=f[s],f[s]=T,T=o[r],o[r]=o[s],o[s]=T,T=u[r],u[r]=u[s],u[s]=T),l=a[r],c=f[r],d=o[r],v=u[r],w=l[r],E=c[r];for(i=r+1;i<n;i++)S=l[i],x=c[i],l[i]=(S*w+x*E)/y,c[i]=(x*w-S*E)/y;for(i=0;i<n;i++)S=d[i],x=v[i],d[i]=(S*w+x*E)/y,v[i]=(x*w-S*E)/y;for(i=r+1;i<n;i++){h=a[i],p=f[i],m=o[i],g=u[i],w=h[r],E=p[r];for(s=r+1;s<n;s++)S=l[s],x=c[s],h[s]-=S*w-x*E,p[s]-=x*w+S*E;for(s=0;s<n;s++)S=d[s],x=v[s],m[s]-=S*w-x*E,g[s]-=x*w+S*E}}for(r=n-1;r>0;r--){d=o[r],v=u[r];for(i=r-1;i>=0;i--){m=o[i],g=u[i],w=a[i][r],E=f[i][r];for(s=n-1;s>=0;s--)S=d[s],x=v[s],m[s]-=w*S-E*x,g[s]-=w*x+E*S}}return new numeric.T(o,u)},numeric.T.prototype.get=function(t){var n=this.x,r=this.y,i=0,s,o=t.length;if(r){while(i<o)s=t[i],n=n[s],r=r[s],i++;return new numeric.T(n,r)}while(i<o)s=t[i],n=n[s],i++;return new numeric.T(n)},numeric.T.prototype.set=function(t,n){var r=this.x,i=this.y,s=0,o,u=t.length,a=n.x,f=n.y;if(u===0)return f?this.y=f:i&&(this.y=undefined),this.x=r,this;if(f){i||(i=numeric.rep(numeric.dim(r),0),this.y=i);while(s<u-1)o=t[s],r=r[o],i=i[o],s++;return o=t[s],r[o]=a,i[o]=f,this}if(i){while(s<u-1)o=t[s],r=r[o],i=i[o],s++;return o=t[s],r[o]=a,a instanceof Array?i[o]=numeric.rep(numeric.dim(a),0):i[o]=0,this}while(s<u-1)o=t[s],r=r[o],s++;return o=t[s],r[o]=a,this},numeric.T.prototype.getRows=function(t,n){var r=n-t+1,i,s=Array(r),o,u=this.x,a=this.y;for(i=t;i<=n;i++)s[i-t]=u[i];if(a){o=Array(r);for(i=t;i<=n;i++)o[i-t]=a[i];return new numeric.T(s,o)}return new numeric.T(s)},numeric.T.prototype.setRows=function(t,n,r){var i,s=this.x,o=this.y,u=r.x,a=r.y;for(i=t;i<=n;i++)s[i]=u[i-t];if(a){o||(o=numeric.rep(numeric.dim(s),0),this.y=o);for(i=t;i<=n;i++)o[i]=a[i-t]}else if(o)for(i=t;i<=n;i++)o[i]=numeric.rep([u[i-t].length],0);return this},numeric.T.prototype.getRow=function(t){var n=this.x,r=this.y;return r?new numeric.T(n[t],r[t]):new numeric.T(n[t])},numeric.T.prototype.setRow=function(t,n){var r=this.x,i=this.y,s=n.x,o=n.y;return r[t]=s,o?(i||(i=numeric.rep(numeric.dim(r),0),this.y=i),i[t]=o):i&&(i=numeric.rep([s.length],0)),this},numeric.T.prototype.getBlock=function(t,n){var r=this.x,i=this.y,s=numeric.getBlock;return i?new numeric.T(s(r,t,n),s(i,t,n)):new numeric.T(s(r,t,n))},numeric.T.prototype.setBlock=function(t,n,r){r instanceof numeric.T||(r=new numeric.T(r));var i=this.x,s=this.y,o=numeric.setBlock,u=r.x,a=r.y;if(a)return s||(this.y=numeric.rep(numeric.dim(this),0),s=this.y),o(i,t,n,u),o(s,t,n,a),this;o(i,t,n,u),s&&o(s,t,n,numeric.rep(numeric.dim(u),0))},numeric.T.rep=function(t,n){var r=numeric.T;n instanceof r||(n=new r(n));var i=n.x,s=n.y,o=numeric.rep;return s?new r(o(t,i),o(t,s)):new r(o(t,i))},numeric.T.diag=function diag(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,diag=numeric.diag;return n?new numeric.T(diag(t),diag(n)):new numeric.T(diag(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(t){return new numeric.T(numeric.identity(t))},numeric.T.prototype.getDiag=function(){var t=numeric,n=this.x,r=this.y;return r?new t.T(t.getDiag(n),t.getDiag(r)):new t.T(t.getDiag(n))},numeric.house=function(t){var n=numeric.clone(t),r=t[0]>=0?1:-1,i=r*numeric.norm2(t);n[0]+=i;var s=numeric.norm2(n);if(s===0)throw new Error("eig: internal error");return numeric.div(n,s)},numeric.toUpperHessenberg=function(t){var n=numeric.dim(t);if(n.length!==2||n[0]!==n[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var r=n[0],i,s,o,u,a,f=numeric.clone(t),l,c,h,p,d=numeric.identity(r),v;for(s=0;s<r-2;s++){u=Array(r-s-1);for(i=s+1;i<r;i++)u[i-s-1]=f[i][s];if(numeric.norm2(u)>0){a=numeric.house(u),l=numeric.getBlock(f,[s+1,s],[r-1,r-1]),c=numeric.tensor(a,numeric.dot(a,l));for(i=s+1;i<r;i++){h=f[i],p=c[i-s-1];for(o=s;o<r;o++)h[o]-=2*p[o-s]}l=numeric.getBlock(f,[0,s+1],[r-1,r-1]),c=numeric.tensor(numeric.dot(l,a),a);for(i=0;i<r;i++){h=f[i],p=c[i];for(o=s+1;o<r;o++)h[o]-=2*p[o-s-1]}l=Array(r-s-1);for(i=s+1;i<r;i++)l[i-s-1]=d[i];c=numeric.tensor(a,numeric.dot(a,l));for(i=s+1;i<r;i++){v=d[i],p=c[i-s-1];for(o=0;o<r;o++)v[o]-=2*p[o]}}}return{H:f,Q:d}},numeric.epsilon=2.220446049250313e-16,numeric.QRFrancis=function(e,t){typeof t=="undefined"&&(t=1e4),e=numeric.clone(e);var n=numeric.clone(e),r=numeric.dim(e),i=r[0],s,o,u,a,f,l,c,h,p,d=numeric.identity(i),v,m,g,y,b,w,E,S,x;if(i<3)return{Q:d,B:[[0,i-1]]};var T=numeric.epsilon;for(x=0;x<t;x++){for(E=0;E<i-1;E++)if(Math.abs(e[E+1][E])<T*(Math.abs(e[E][E])+Math.abs(e[E+1][E+1]))){var N=numeric.QRFrancis(numeric.getBlock(e,[0,0],[E,E]),t),C=numeric.QRFrancis(numeric.getBlock(e,[E+1,E+1],[i-1,i-1]),t);g=Array(E+1);for(w=0;w<=E;w++)g[w]=d[w];y=numeric.dot(N.Q,g);for(w=0;w<=E;w++)d[w]=y[w];g=Array(i-E-1);for(w=E+1;w<i;w++)g[w-E-1]=d[w];y=numeric.dot(C.Q,g);for(w=E+1;w<i;w++)d[w]=y[w-E-1];return{Q:d,B:N.B.concat(numeric.add(C.B,E+1))}}u=e[i-2][i-2],a=e[i-2][i-1],f=e[i-1][i-2],l=e[i-1][i-1],h=u+l,c=u*l-a*f,p=numeric.getBlock(e,[0,0],[2,2]);if(h*h>=4*c){var k,L;k=.5*(h+Math.sqrt(h*h-4*c)),L=.5*(h-Math.sqrt(h*h-4*c)),p=numeric.add(numeric.sub(numeric.dot(p,p),numeric.mul(p,k+L)),numeric.diag(numeric.rep([3],k*L)))}else p=numeric.add(numeric.sub(numeric.dot(p,p),numeric.mul(p,h)),numeric.diag(numeric.rep([3],c)));s=[p[0][0],p[1][0],p[2][0]],o=numeric.house(s),g=[e[0],e[1],e[2]],y=numeric.tensor(o,numeric.dot(o,g));for(w=0;w<3;w++){m=e[w],b=y[w];for(S=0;S<i;S++)m[S]-=2*b[S]}g=numeric.getBlock(e,[0,0],[i-1,2]),y=numeric.tensor(numeric.dot(g,o),o);for(w=0;w<i;w++){m=e[w],b=y[w];for(S=0;S<3;S++)m[S]-=2*b[S]}g=[d[0],d[1],d[2]],y=numeric.tensor(o,numeric.dot(o,g));for(w=0;w<3;w++){v=d[w],b=y[w];for(S=0;S<i;S++)v[S]-=2*b[S]}var A;for(E=0;E<i-2;E++){for(S=E;S<=E+1;S++)if(Math.abs(e[S+1][S])<T*(Math.abs(e[S][S])+Math.abs(e[S+1][S+1]))){var N=numeric.QRFrancis(numeric.getBlock(e,[0,0],[S,S]),t),C=numeric.QRFrancis(numeric.getBlock(e,[S+1,S+1],[i-1,i-1]),t);g=Array(S+1);for(w=0;w<=S;w++)g[w]=d[w];y=numeric.dot(N.Q,g);for(w=0;w<=S;w++)d[w]=y[w];g=Array(i-S-1);for(w=S+1;w<i;w++)g[w-S-1]=d[w];y=numeric.dot(C.Q,g);for(w=S+1;w<i;w++)d[w]=y[w-S-1];return{Q:d,B:N.B.concat(numeric.add(C.B,S+1))}}A=Math.min(i-1,E+3),s=Array(A-E);for(w=E+1;w<=A;w++)s[w-E-1]=e[w][E];o=numeric.house(s),g=numeric.getBlock(e,[E+1,E],[A,i-1]),y=numeric.tensor(o,numeric.dot(o,g));for(w=E+1;w<=A;w++){m=e[w],b=y[w-E-1];for(S=E;S<i;S++)m[S]-=2*b[S-E]}g=numeric.getBlock(e,[0,E+1],[i-1,A]),y=numeric.tensor(numeric.dot(g,o),o);for(w=0;w<i;w++){m=e[w],b=y[w];for(S=E+1;S<=A;S++)m[S]-=2*b[S-E-1]}g=Array(A-E);for(w=E+1;w<=A;w++)g[w-E-1]=d[w];y=numeric.tensor(o,numeric.dot(o,g));for(w=E+1;w<=A;w++){v=d[w],b=y[w-E-1];for(S=0;S<i;S++)v[S]-=2*b[S]}}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(t,n){var r=numeric.toUpperHessenberg(t),i=numeric.QRFrancis(r.H,n),s=numeric.T,o=t.length,u,a,f=!1,l=i.B,c=numeric.dot(i.Q,numeric.dot(r.H,numeric.transpose(i.Q))),h=new s(numeric.dot(i.Q,r.Q)),p,d=l.length,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=Math.sqrt;for(a=0;a<d;a++){u=l[a][0];if(u!==l[a][1]){v=u+1,m=c[u][u],g=c[u][v],y=c[v][u],b=c[v][v];if(g===0&&y===0)continue;w=-m-b,E=m*b-g*y,S=w*w-4*E,S>=0?(w<0?x=-0.5*(w-A(S)):x=-0.5*(w+A(S)),k=(m-x)*(m-x)+g*g,L=y*y+(b-x)*(b-x),k>L?(k=A(k),N=(m-x)/k,C=g/k):(L=A(L),N=y/L,C=(b-x)/L),p=new s([[C,-N],[N,C]]),h.setRows(u,v,p.dot(h.getRows(u,v)))):(x=-0.5*w,T=.5*A(-S),k=(m-x)*(m-x)+g*g,L=y*y+(b-x)*(b-x),k>L?(k=A(k+T*T),N=(m-x)/k,C=g/k,x=0,T/=k):(L=A(L+T*T),N=y/L,C=(b-x)/L,x=T/L,T=0),p=new s([[C,-N],[N,C]],[
[x,T],[T,-x]]),h.setRows(u,v,p.dot(h.getRows(u,v))))}}var O=h.dot(t).dot(h.transjugate()),o=t.length,M=numeric.T.identity(o);for(v=0;v<o;v++)if(v>0)for(a=v-1;a>=0;a--){var _=O.get([a,a]),D=O.get([v,v]);if(!numeric.neq(_.x,D.x)&&!numeric.neq(_.y,D.y)){M.setRow(v,M.getRow(a));continue}x=O.getRow(a).getBlock([a],[v-1]),T=M.getRow(v).getBlock([a],[v-1]),M.set([v,a],O.get([a,v]).neg().sub(x.dot(T)).div(_.sub(D)))}for(v=0;v<o;v++)x=M.getRow(v),M.setRow(v,x.div(x.norm2()));return M=M.transpose(),M=h.transjugate().dot(M),{lambda:O.getDiag(),E:M}},numeric.ccsSparse=function(t){var n=t.length,r,i,s,o,u=[];for(s=n-1;s!==-1;--s){i=t[s];for(o in i){o=parseInt(o);while(o>=u.length)u[u.length]=0;i[o]!==0&&u[o]++}}var r=u.length,a=Array(r+1);a[0]=0;for(s=0;s<r;++s)a[s+1]=a[s]+u[s];var f=Array(a[r]),l=Array(a[r]);for(s=n-1;s!==-1;--s){i=t[s];for(o in i)i[o]!==0&&(u[o]--,f[a[o]+u[o]]=s,l[a[o]+u[o]]=i[o])}return[a,f,l]},numeric.ccsFull=function(t){var n=t[0],r=t[1],i=t[2],s=numeric.ccsDim(t),o=s[0],u=s[1],a,f,l,c,h,p=numeric.rep([o,u],0);for(a=0;a<u;a++){l=n[a],c=n[a+1];for(f=l;f<c;++f)p[r[f]][a]=i[f]}return p},numeric.ccsTSolve=function(t,n,r,i,s){function h(e){var t;if(r[e]!==0)return;r[e]=1;for(t=o[e];t<o[e+1];++t)h(u[t]);s[c]=e,++c}var o=t[0],u=t[1],a=t[2],f=o.length-1,l=Math.max,c=0;typeof i=="undefined"&&(r=numeric.rep([f],0)),typeof i=="undefined"&&(i=numeric.linspace(0,r.length-1)),typeof s=="undefined"&&(s=[]);var p,d,v,m,g,y,b,w,E;for(p=i.length-1;p!==-1;--p)h(i[p]);s.length=c;for(p=s.length-1;p!==-1;--p)r[s[p]]=0;for(p=i.length-1;p!==-1;--p)d=i[p],r[d]=n[d];for(p=s.length-1;p!==-1;--p){d=s[p],v=o[d],m=l(o[d+1],v);for(g=v;g!==m;++g)if(u[g]===d){r[d]/=a[g];break}E=r[d];for(g=v;g!==m;++g)y=u[g],y!==d&&(r[y]-=E*a[g])}return r},numeric.ccsDFS=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS.prototype.dfs=function(t,n,r,i,s,o){var u=0,a,f=s.length,l=this.k,c=this.k1,h=this.j,p,d;if(i[t]!==0)return;i[t]=1,h[0]=t,l[0]=p=n[t],c[0]=d=n[t+1];for(;;)if(p>=d){s[f]=h[u];if(u===0)return;++f,--u,p=l[u],d=c[u]}else a=o[r[p]],i[a]===0?(i[a]=1,l[u]=p,++u,h[u]=a,p=n[a],c[u]=d=n[a+1]):++p},numeric.ccsLPSolve=function(t,n,r,i,s,o,u){var a=t[0],f=t[1],l=t[2],c=a.length-1,h=0,p=n[0],d=n[1],v=n[2],m,g,y,b,w,E,S,x,T,N,C,k;g=p[s],y=p[s+1],i.length=0;for(m=g;m<y;++m)u.dfs(o[d[m]],a,f,r,i,o);for(m=i.length-1;m!==-1;--m)r[i[m]]=0;for(m=g;m!==y;++m)b=o[d[m]],r[b]=v[m];for(m=i.length-1;m!==-1;--m){b=i[m],E=a[b],S=a[b+1];for(x=E;x<S;++x)if(o[f[x]]===b){r[b]/=l[x];break}k=r[b];for(x=E;x<S;++x)T=o[f[x]],T!==b&&(r[T]-=k*l[x])}return r},numeric.ccsLUP1=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],s=[numeric.rep([r+1],0),[],[]],o=i[0],u=i[1],a=i[2],f=s[0],l=s[1],c=s[2],h=numeric.rep([r],0),p=numeric.rep([r],0),d,v,m,g,y,b,w,E,S,x,T=numeric.ccsLPSolve,N=Math.max,C=Math.abs,k=numeric.linspace(0,r-1),L=numeric.linspace(0,r-1),A=new numeric.ccsDFS(r);typeof n=="undefined"&&(n=1);for(d=0;d<r;++d){T(i,t,h,p,d,L,A),b=-1,w=-1;for(v=p.length-1;v!==-1;--v){m=p[v];if(m<=d)continue;E=C(h[m]),E>b&&(w=m,b=E)}C(h[d])<n*b&&(v=k[d],b=k[w],k[d]=b,L[b]=d,k[w]=v,L[v]=w,b=h[d],h[d]=h[w],h[w]=b),b=o[d],w=f[d],S=h[d],u[b]=k[d],a[b]=1,++b;for(v=p.length-1;v!==-1;--v)m=p[v],E=h[m],p[v]=0,h[m]=0,m<=d?(l[w]=m,c[w]=E,++w):(u[b]=k[m],a[b]=E/S,++b);o[d+1]=b,f[d+1]=w}for(v=u.length-1;v!==-1;--v)u[v]=L[u[v]];return{L:i,U:s,P:k,Pinv:L}},numeric.ccsDFS0=function(t){this.k=Array(t),this.k1=Array(t),this.j=Array(t)},numeric.ccsDFS0.prototype.dfs=function(t,n,r,i,s,o,u){var a=0,f,l=s.length,c=this.k,h=this.k1,p=this.j,d,v;if(i[t]!==0)return;i[t]=1,p[0]=t,c[0]=d=n[o[t]],h[0]=v=n[o[t]+1];for(;;){if(isNaN(d))throw new Error("Ow!");if(d>=v){s[l]=o[p[a]];if(a===0)return;++l,--a,d=c[a],v=h[a]}else f=r[d],i[f]===0?(i[f]=1,c[a]=d,++a,p[a]=f,f=o[f],d=n[f],h[a]=v=n[f+1]):++d}},numeric.ccsLPSolve0=function(t,n,r,i,s,o,u,a){var f=t[0],l=t[1],c=t[2],h=f.length-1,p=0,d=n[0],v=n[1],m=n[2],g,y,b,w,E,S,x,T,N,C,k,L;y=d[s],b=d[s+1],i.length=0;for(g=y;g<b;++g)a.dfs(v[g],f,l,r,i,o,u);for(g=i.length-1;g!==-1;--g)w=i[g],r[u[w]]=0;for(g=y;g!==b;++g)w=v[g],r[w]=m[g];for(g=i.length-1;g!==-1;--g){w=i[g],N=u[w],S=f[w],x=f[w+1];for(T=S;T<x;++T)if(l[T]===N){r[N]/=c[T];break}L=r[N];for(T=S;T<x;++T)r[l[T]]-=L*c[T];r[N]=L}},numeric.ccsLUP0=function(t,n){var r=t[0].length-1,i=[numeric.rep([r+1],0),[],[]],s=[numeric.rep([r+1],0),[],[]],o=i[0],u=i[1],a=i[2],f=s[0],l=s[1],c=s[2],h=numeric.rep([r],0),p=numeric.rep([r],0),d,v,m,g,y,b,w,E,S,x,T=numeric.ccsLPSolve0,N=Math.max,C=Math.abs,k=numeric.linspace(0,r-1),L=numeric.linspace(0,r-1),A=new numeric.ccsDFS0(r);typeof n=="undefined"&&(n=1);for(d=0;d<r;++d){T(i,t,h,p,d,L,k,A),b=-1,w=-1;for(v=p.length-1;v!==-1;--v){m=p[v];if(m<=d)continue;E=C(h[k[m]]),E>b&&(w=m,b=E)}C(h[k[d]])<n*b&&(v=k[d],b=k[w],k[d]=b,L[b]=d,k[w]=v,L[v]=w),b=o[d],w=f[d],S=h[k[d]],u[b]=k[d],a[b]=1,++b;for(v=p.length-1;v!==-1;--v)m=p[v],E=h[k[m]],p[v]=0,h[k[m]]=0,m<=d?(l[w]=m,c[w]=E,++w):(u[b]=k[m],a[b]=E/S,++b);o[d+1]=b,f[d+1]=w}for(v=u.length-1;v!==-1;--v)u[v]=L[u[v]];return{L:i,U:s,P:k,Pinv:L}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(t){return[numeric.sup(t[1])+1,t[0].length-1]},numeric.ccsGetBlock=function(t,n,r){var i=numeric.ccsDim(t),s=i[0],o=i[1];typeof n=="undefined"?n=numeric.linspace(0,s-1):typeof n=="number"&&(n=[n]),typeof r=="undefined"?r=numeric.linspace(0,o-1):typeof r=="number"&&(r=[r]);var u,a,f,l=n.length,c,h=r.length,p,d,v,m=numeric.rep([o],0),g=[],y=[],b=[m,g,y],w=t[0],E=t[1],S=t[2],x=numeric.rep([s],0),T=0,N=numeric.rep([s],0);for(c=0;c<h;++c){d=r[c];var C=w[d],k=w[d+1];for(u=C;u<k;++u)p=E[u],N[p]=1,x[p]=S[u];for(u=0;u<l;++u)v=n[u],N[v]&&(g[T]=u,y[T]=x[n[u]],++T);for(u=C;u<k;++u)p=E[u],N[p]=0;m[c+1]=T}return b},numeric.ccsDot=function(t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=numeric.ccsDim(t),l=numeric.ccsDim(n),c=f[0],h=f[1],p=l[1],d=numeric.rep([c],0),v=numeric.rep([c],0),m=Array(c),g=numeric.rep([p],0),y=[],b=[],w=[g,y,b],E,S,x,T,N,C,k,L,A,O,M;for(x=0;x!==p;++x){T=o[x],N=o[x+1],A=0;for(S=T;S<N;++S){O=u[S],M=a[S],C=r[O],k=r[O+1];for(E=C;E<k;++E)L=i[E],v[L]===0&&(m[A]=L,v[L]=1,A+=1),d[L]=d[L]+s[E]*M}T=g[x],N=T+A,g[x+1]=N;for(S=A-1;S!==-1;--S)M=T+S,E=m[S],y[M]=E,b[M]=d[E],v[E]=0,d[E]=0;g[x+1]=g[x]+A}return w},numeric.ccsLUPSolve=function(t,n){var r=t.L,i=t.U,s=t.P,o=n[0],u=!1;typeof o!="object"&&(n=[[0,n.length],numeric.linspace(0,n.length-1),n],o=n[0],u=!0);var a=n[1],f=n[2],l=r[0].length-1,c=o.length-1,h=numeric.rep([l],0),p=Array(l),d=numeric.rep([l],0),v=Array(l),m=numeric.rep([c+1],0),g=[],y=[],b=numeric.ccsTSolve,w,E,S,x,T,N,C=0;for(w=0;w<c;++w){T=0,S=o[w],x=o[w+1];for(E=S;E<x;++E)N=t.Pinv[a[E]],v[T]=N,d[N]=f[E],++T;v.length=T,b(r,d,h,v,p);for(E=v.length-1;E!==-1;--E)d[v[E]]=0;b(i,h,d,p,v);if(u)return d;for(E=p.length-1;E!==-1;--E)h[p[E]]=0;for(E=v.length-1;E!==-1;--E)N=v[E],g[C]=N,y[C]=d[N],d[N]=0,++C;m[w+1]=C}return[m,g,y]},numeric.ccsbinop=function(t,n){return typeof n=="undefined"&&(n=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+n+"for(i=0;i<n;++i) {\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Xj[j];\n"+"    x[k] = 1;\n"+"    Zj[p] = k;\n"+"    ++p;\n"+"  }\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Yj[j];\n"+"    y[k] = Yv[j];\n"+"    if(x[k] === 0) {\n"+"      Zj[p] = k;\n"+"      ++p;\n"+"    }\n"+"  }\n"+"  Zi[i+1] = p;\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n"+"  j0 = Zi[i]; j1 = Zi[i+1];\n"+"  for(j=j0;j!==j1;++j) {\n"+"    k = Zj[j];\n"+"    xk = x[k];\n"+"    yk = y[k];\n"+t+"\n"+"    Zv[j] = zk;\n"+"  }\n"+"  j0 = Xi[i]; j1 = Xi[i+1];\n"+"  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n"+"  j0 = Yi[i]; j1 = Yi[i+1];\n"+"  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n"+"}\n"+"return [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)isFinite(eval("1"+numeric.ops2[k]+"0"))?A="[Y[0],Y[1],numeric."+k+"(X,Y[2])]":A="NaN",isFinite(eval("0"+numeric.ops2[k]+"1"))?B="[X[0],X[1],numeric."+k+"(X[2],Y)]":B="NaN",isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?C="numeric.ccs"+k+"MM(X,Y)":C="NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+";\n"+'if(typeof Y === "number") return '+B+";\n"+"return "+C+";\n")}(),numeric.ccsScatter=function(t){var n=t[0],r=t[1],i=t[2],s=numeric.sup(r)+1,o=n.length,u=numeric.rep([s],0),a=Array(o),f=Array(o),l=numeric.rep([s],0),c;for(c=0;c<o;++c)l[r[c]]++;for(c=0;c<s;++c)u[c+1]=u[c]+l[c];var h=u.slice(0),p,d;for(c=0;c<o;++c)d=r[c],p=h[d],a[p]=n[c],f[p]=i[c],h[d]=h[d]+1;return[u,a,f]},numeric.ccsGather=function(t){var n=t[0],r=t[1],i=t[2],s=n.length-1,o=r.length,u=Array(o),a=Array(o),f=Array(o),l,c,h,p,d;d=0;for(l=0;l<s;++l){h=n[l],p=n[l+1];for(c=h;c!==p;++c)a[d]=l,u[d]=r[c],f[d]=i[c],++d}return[u,a,f]},numeric.sdim=function dim(e,t,n){typeof t=="undefined"&&(t=[]);if(typeof e!="object")return t;typeof n=="undefined"&&(n=0),n in t||(t[n]=0),e.length>t[n]&&(t[n]=e.length);var r;for(r in e)e.hasOwnProperty(r)&&dim(e[r],t,n+1);return t},numeric.sclone=function clone(e,t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=numeric.sdim(e).length);var r,i=Array(e.length);if(t===n-1){for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i}for(r in e)e.hasOwnProperty(r)&&(i[r]=clone(e[r],t+1,n));return i},numeric.sdiag=function(t){var n=t.length,r,i=Array(n),s,o,u;for(r=n-1;r>=1;r-=2)s=r-1,i[r]=[],i[r][r]=t[r],i[s]=[],i[s][s]=t[s];return r===0&&(i[0]=[],i[0][0]=t[r]),i},numeric.sidentity=function(t){return numeric.sdiag(numeric.rep([t],1))},numeric.stranspose=function(t){var n=[],r=t.length,i,s,o;for(i in t){if(!t.hasOwnProperty(i))continue;o=t[i];for(s in o){if(!o.hasOwnProperty(s))continue;typeof n[s]!="object"&&(n[s]=[]),n[s][i]=o[s]}}return n},numeric.sLUP=function(t,n){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(t,n){var r=t.length,i=n.length,s=numeric.stranspose(n),o=s.length,u,a,f,l,c,h,p=Array(r),d;for(f=r-1;f>=0;f--){d=[],u=t[f];for(c=o-1;c>=0;c--){h=0,a=s[c];for(l in u){if(!u.hasOwnProperty(l))continue;l in a&&(h+=u[l]*a[l])}h&&(d[c]=h)}p[f]=d}return p},numeric.sdotMV=function(t,n){var r=t.length,i,s,o,u=Array(r),a;for(s=r-1;s>=0;s--){i=t[s],a=0;for(o in i){if(!i.hasOwnProperty(o))continue;n[o]&&(a+=i[o]*n[o])}a&&(u[s]=a)}return u},numeric.sdotVM=function(t,n){var r,i,s,o,u=[],a;for(r in t){if(!t.hasOwnProperty(r))continue;s=n[r],o=t[r];for(i in s){if(!s.hasOwnProperty(i))continue;u[i]||(u[i]=0),u[i]+=o*s[i]}}return u},numeric.sdotVV=function(t,n){var r,i=0;for(r in t)t[r]&&n[r]&&(i+=t[r]*n[r]);return i},numeric.sdot=function(t,n){var r=numeric.sdim(t).length,i=numeric.sdim(n).length,s=r*1e3+i;switch(s){case 0:return t*n;case 1001:return numeric.sdotVV(t,n);case 2001:return numeric.sdotMV(t,n);case 1002:return numeric.sdotVM(t,n);case 2002:return numeric.sdotMM(t,n);default:throw new Error("numeric.sdot not implemented for tensors of order "+r+" and "+i)}},numeric.sscatter=function(t){var n=t[0].length,r,i,s,o=t.length,u=[],a;for(i=n-1;i>=0;--i){if(!t[o-1][i])continue;a=u;for(s=0;s<o-2;s++)r=t[s][i],a[r]||(a[r]=[]),a=a[r];a[t[s][i]]=t[s+1][i]}return u},numeric.sgather=function gather(e,t,n){typeof t=="undefined"&&(t=[]),typeof n=="undefined"&&(n=[]);var r,i,s;r=n.length;for(i in e)if(e.hasOwnProperty(i)){n[r]=parseInt(i),s=e[i];if(typeof s=="number"){if(s){if(t.length===0)for(i=r+1;i>=0;--i)t[i]=[];for(i=r;i>=0;--i)t[i].push(n[i]);t[r+1].push(s)}}else gather(s,t,n)}return n.length>r&&n.pop(),t},numeric.cLU=function(t){var n=t[0],r=t[1],i=t[2],s=n.length,o=0,u,a,f,l,c,h;for(u=0;u<s;u++)n[u]>o&&(o=n[u]);o++;var p=Array(o),d=Array(o),v=numeric.rep([o],Infinity),m=numeric.rep([o],-Infinity),g,y,b;for(f=0;f<s;f++)u=n[f],a=r[f],a<v[u]&&(v[u]=a),a>m[u]&&(m[u]=a);for(u=0;u<o-1;u++)m[u]>m[u+1]&&(m[u+1]=m[u]);for(u=o-1;u>=1;u--)v[u]<v[u-1]&&(v[u-1]=v[u]);var w=0,E=0;for(u=0;u<o;u++)d[u]=numeric.rep([m[u]-v[u]+1],0),p[u]=numeric.rep([u-v[u]],0),w+=u-v[u]+1,E+=m[u]-u+1;for(f=0;f<s;f++)u=n[f],d[u][r[f]-v[u]]=i[f];for(u=0;u<o-1;u++){l=u-v[u],g=d[u];for(a=u+1;v[a]<=u&&a<o;a++){c=u-v[a],h=m[u]-u,y=d[a],b=y[c]/g[l];if(b){for(f=1;f<=h;f++)y[f+c]-=b*g[f+l];p[a][u-v[a]]=b}}}var g=[],y=[],S=[],x=[],T=[],N=[],s,C,k;s=0,C=0;for(u=0;u<o;u++){l=v[u],c=m[u],k=d[u];for(a=u;a<=c;a++)k[a-l]&&(g[s]=u,y[s]=a,S[s]=k[a-l],s++);k=p[u];for(a=l;a<u;a++)k[a-l]&&(x[C]=u,T[C]=a,N[C]=k[a-l],C++);x[C]=u,T[C]=u,N[C]=1,C++}return{U:[g,y,S],L:[x,T,N]}},numeric.cLUsolve=function(t,n){var r=t.L,i=t.U,s=numeric.clone(n),o=r[0],u=r[1],a=r[2],f=i[0],l=i[1],c=i[2],h=f.length,p=o.length,d=s.length,v,m,g;g=0;for(v=0;v<d;v++){while(u[g]<v)s[v]-=a[g]*s[u[g]],g++;g++}g=h-1;for(v=d-1;v>=0;v--){while(l[g]>v)s[v]-=c[g]*s[l[g]],g--;s[v]/=c[g],g--}return s},numeric.cgrid=function(t,n){typeof t=="number"&&(t=[t,t]);var r=numeric.rep(t,-1),i,s,o;if(typeof n!="function")switch(n){case"L":n=function(e,n){return e>=t[0]/2||n<t[1]/2};break;default:n=function(e,t){return!0}}o=0;for(i=1;i<t[0]-1;i++)for(s=1;s<t[1]-1;s++)n(i,s)&&(r[i][s]=o,o++);return r},numeric.cdelsq=function(t){var n=[[-1,0],[0,-1],[0,1],[1,0]],r=numeric.dim(t),i=r[0],s=r[1],o,u,a,f,l,c=[],h=[],p=[];for(o=1;o<i-1;o++)for(u=1;u<s-1;u++){if(t[o][u]<0)continue;for(a=0;a<4;a++){f=o+n[a][0],l=u+n[a][1];if(t[f][l]<0)continue;c.push(t[o][u]),h.push(t[f][l]),p.push(-1)}c.push(t[o][u]),h.push(t[o][u]),p.push(4)}return[c,h,p]},numeric.cdotMV=function(t,n){var r,i=t[0],s=t[1],o=t[2],u,a=i.length,f;f=0;for(u=0;u<a;u++)i[u]>f&&(f=i[u]);f++,r=numeric.rep([f],0);for(u=0;u<a;u++)r[i[u]]+=o[u]*n[s[u]];return r},numeric.Spline=function(t,n,r,i,s){this.x=t,this.yl=n,this.yr=r,this.kl=i,this.kr=s},numeric.Spline.prototype._at=function(t,n){var r=this.x,i=this.yl,s=this.yr,o=this.kl,u=this.kr,t,a,f,l,c=numeric.add,h=numeric.sub,p=numeric.mul;a=h(p(o[n],r[n+1]-r[n]),h(s[n+1],i[n])),f=c(p(u[n+1],r[n]-r[n+1]),h(s[n+1],i[n])),l=(t-r[n])/(r[n+1]-r[n]);var d=l*(1-l);return c(c(c(p(1-l,i[n]),p(l,s[n+1])),p(a,d*(1-l))),p(f,d*l))},numeric.Spline.prototype.at=function(t){if(typeof t=="number"){var n=this.x,r=n.length,i,s,o,u=Math.floor,a,f,l;i=0,s=r-1;while(s-i>1)o=u((i+s)/2),n[o]<=t?i=o:s=o;return this._at(t,i)}var r=t.length,c,h=Array(r);for(c=r-1;c!==-1;--c)h[c]=this.at(t[c]);return h},numeric.Spline.prototype.diff=function(){var t=this.x,n=this.yl,r=this.yr,i=this.kl,s=this.kr,o=n.length,u,a,f,l=i,c=s,h=Array(o),p=Array(o),d=numeric.add,v=numeric.mul,m=numeric.div,g=numeric.sub;for(u=o-1;u!==-1;--u)a=t[u+1]-t[u],f=g(r[u+1],n[u]),h[u]=m(d(v(f,6),v(i[u],-4*a),v(s[u+1],-2*a)),a*a),p[u+1]=m(d(v(f,-6),v(i[u],2*a),v(s[u+1],4*a)),a*a);return new numeric.Spline(t,l,c,h,p)},numeric.Spline.prototype.roots=function(){function t(e){return e*e}function n(e,t,n,r,i){var s=n*2-(t-e),o=-r*2+(t-e),u=(i+1)*.5,a=u*(1-u);return(1-u)*e+u*t+s*a*(1-u)+o*a*u}var r=[],i=this.x,s=this.yl,o=this.yr,u=this.kl,a=this.kr;typeof s[0]=="number"&&(s=[s],o=[o],u=[u],a=[a]);var f=s.length,l=i.length-1,c,h,p,d,v,m,g,y,b,w,r=Array(f),E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=Math.sqrt;for(c=0;c!==f;++c){g=s[c],y=o[c],b=u[c],w=a[c],E=[];for(h=0;h!==l;h++){h>0&&y[h]*g[h]<0&&E.push(i[h]),A=i[h+1]-i[h],O=i[h],T=g[h],N=y[h+1],S=b[h]/A,x=w[h+1]/A,L=t(S-x+3*(T-N))+12*x*T,C=x+3*T+2*S-3*N,k=3*(x+S+2*(T-N)),L<=0?(_=C/k,_>i[h]&&_<i[h+1]?M=[i[h],_,i[h+1]]:M=[i[h],i[h+1]]):(_=(C-F(L))/k,D=(C+F(L))/k,M=[i[h]],_>i[h]&&_<i[h+1]&&M.push(_),D>i[h]&&D<i[h+1]&&M.push(D),M.push(i[h+1])),H=M[0],_=this._at(H,h);for(p=0;p<M.length-1;p++){B=M[p+1],D=this._at(B,h);if(_===0){E.push(H),H=B,_=D;continue}if(D===0||_*D>0){H=B,_=D;continue}var I=0;for(;;){j=(_*B-D*H)/(_-D);if(j<=H||j>=B)break;P=this._at(j,h);if(P*D>0)B=j,D=P,I===-1&&(_*=.5),I=-1;else{if(!(P*_>0))break;H=j,_=P,I===1&&(D*=.5),I=1}}E.push(j),H=M[p+1],_=this._at(H,h)}D===0&&E.push(B)}r[c]=E}return typeof this.yl[0]=="number"?r[0]:r},numeric.spline=function(t,n,r,i){var s=t.length,o=[],u=[],a=[],f,l=numeric.sub,c=numeric.mul,h=numeric.add;for(f=s-2;f>=0;f--)u[f]=t[f+1]-t[f],a[f]=l(n[f+1],n[f]);if(typeof r=="string"||typeof i=="string")r=i="periodic";var p=[[],[],[]];switch(typeof r){case"undefined":o[0]=c(3/(u[0]*u[0]),a[0]),p[0].push(0,0),p[1].push(0,1),p[2].push(2/u[0],1/u[0]);break;case"string":o[0]=h(c(3/(u[s-2]*u[s-2]),a[s-2]),c(3/(u[0]*u[0]),a[0])),p[0].push(0,0,0),p[1].push(s-2,0,1),p[2].push(1/u[s-2],2/u[s-2]+2/u[0],1/u[0]);break;default:o[0]=r,p[0].push(0),p[1].push(0),p[2].push(1)}for(f=1;f<s-1;f++)o[f]=h(c(3/(u[f-1]*u[f-1]),a[f-1]),c(3/(u[f]*u[f]),a[f])),p[0].push(f,f,f),p[1].push(f-1,f,f+1),p[2].push(1/u[f-1],2/u[f-1]+2/u[f],1/u[f]);switch(typeof i){case"undefined":o[s-1]=c(3/(u[s-2]*u[s-2]),a[s-2]),p[0].push(s-1,s-1),p[1].push(s-2,s-1),p[2].push(1/u[s-2],2/u[s-2]);break;case"string":p[1][p[1].length-1]=0;break;default:o[s-1]=i,p[0].push(s-1),p[1].push(s-1),p[2].push(1)}typeof o[0]!="number"?o=numeric.transpose(o):o=[o];var d=Array(o.length);if(typeof r=="string")for(f=d.length-1;f!==-1;--f)d[f]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(p)),o[f]),d[f][s-1]=d[f][0];else for(f=d.length-1;f!==-1;--f)d[f]=numeric.cLUsolve(numeric.cLU(p),o[f]);return typeof n[0]=="number"?d=d[0]:d=numeric.transpose(d),new numeric.Spline(t,n,n,d,d)},numeric.fftpow2=function fftpow2(e,t){var n=e.length;if(n===1)return;var r=Math.cos,i=Math.sin,s,o,u=Array(n/2),a=Array(n/2),f=Array(n/2),l=Array(n/2);o=n/2;for(s=n-1;s!==-1;--s)--o,f[o]=e[s],l[o]=t[s],--s,u[o]=e[s],a[o]=t[s];fftpow2(u,a),fftpow2(f,l),o=n/2;var c,h=-6.283185307179586/n,p,d;for(s=n-1;s!==-1;--s)--o,o===-1&&(o=n/2-1),c=h*s,p=r(c),d=i(c),e[s]=u[o]+p*f[o]-d*l[o],t[s]=a[o]+p*l[o]+d*f[o]},numeric._ifftpow2=function _ifftpow2(e,t){var n=e.length;if(n===1)return;var r=Math.cos,i=Math.sin,s,o,u=Array(n/2),a=Array(n/2),f=Array(n/2),l=Array(n/2);o=n/2;for(s=n-1;s!==-1;--s)--o,f[o]=e[s],l[o]=t[s],--s,u[o]=e[s],a[o]=t[s];_ifftpow2(u,a),_ifftpow2(f,l),o=n/2;var c,h=6.283185307179586/n,p,d;for(s=n-1;s!==-1;--s)--o,o===-1&&(o=n/2-1),c=h*s,p=r(c),d=i(c),e[s]=u[o]+p*f[o]-d*l[o],t[s]=a[o]+p*l[o]+d*f[o]},numeric.ifftpow2=function(t,n){numeric._ifftpow2(t,n),numeric.diveq(t,t.length),numeric.diveq(n,n.length)},numeric.convpow2=function(t,n,r,i){numeric.fftpow2(t,n),numeric.fftpow2(r,i);var s,o=t.length,u,a,f,l;for(s=o-1;s!==-1;--s)u=t[s],f=n[s],a=r[s],l=i[s],t[s]=u*a-f*l,n[s]=u*l+f*a;numeric.ifftpow2(t,n)},numeric.T.prototype.fft=function(){var t=this.x,n=this.y,r=t.length,i=Math.log,s=i(2),o=Math.ceil(i(2*r-1)/s),u=Math.pow(2,o),a=numeric.rep([u],0),f=numeric.rep([u],0),l=Math.cos,c=Math.sin,h,p=-3.141592653589793/r,d,v=numeric.rep([u],0),m=numeric.rep([u],0),g=Math.floor(r/2);for(h=0;h<r;h++)v[h]=t[h];if(typeof n!="undefined")for(h=0;h<r;h++)m[h]=n[h];a[0]=1;for(h=1;h<=u/2;h++)d=p*h*h,a[h]=l(d),f[h]=c(d),a[u-h]=l(d),f[u-h]=c(d);var y=new numeric.T(v,m),b=new numeric.T(a,f);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),y=y.mul(b),y.x.length=r,y.y.length=r,y},numeric.T.prototype.ifft=function(){var t=this.x,n=this.y,r=t.length,i=Math.log,s=i(2),o=Math.ceil(i(2*r-1)/s),u=Math.pow(2,o),a=numeric.rep([u],0),f=numeric.rep([u],0),l=Math.cos,c=Math.sin,h,p=3.141592653589793/r,d,v=numeric.rep([u],0),m=numeric.rep([u],0),g=Math.floor(r/2);for(h=0;h<r;h++)v[h]=t[h];if(typeof n!="undefined")for(h=0;h<r;h++)m[h]=n[h];a[0]=1;for(h=1;h<=u/2;h++)d=p*h*h,a[h]=l(d),f[h]=c(d),a[u-h]=l(d),f[u-h]=c(d);var y=new numeric.T(v,m),b=new numeric.T(a,f);return y=y.mul(b),numeric.convpow2(y.x,y.y,numeric.clone(b.x),numeric.neg(b.y)),y=y.mul(b),y.x.length=r,y.y.length=r,y.div(r)},numeric.gradient=function(t,n){var r=n.length,i=t(n);if(isNaN(i))throw new Error("gradient: f(x) is a NaN!");var s=Math.max,o,u=numeric.clone(n),a,f,l=Array(r),c=numeric.div,h=numeric.sub,p,d,s=Math.max,v=.001,m=Math.abs,g=Math.min,y,b,w,E=0,S,x,T;for(o=0;o<r;o++){var N=s(1e-6*i,1e-8);for(;;){++E;if(E>20)throw new Error("Numerical gradient fails");u[o]=n[o]+N,a=t(u),u[o]=n[o]-N,f=t(u),u[o]=n[o];if(isNaN(a)||isNaN(f)){N/=16;continue}l[o]=(a-f)/(2*N),y=n[o]-N,b=n[o],w=n[o]+N,S=(a-i)/N,x=(i-f)/N,T=s(m(l[o]),m(i),m(a),m(f),m(y),m(b),m(w),1e-8),p=g(s(m(S-l[o]),m(x-l[o]),m(S-x))/T,N/T);if(!(p>v))break;N/=16}}return l},numeric.uncmin=function(t,n,r,i,s,o,u){var a=numeric.gradient;typeof u=="undefined"&&(u={}),typeof r=="undefined"&&(r=1e-8),typeof i=="undefined"&&(i=function(e){return a(t,e)}),typeof s=="undefined"&&(s=1e3),n=numeric.clone(n);var f=n.length,l=t(n),c,h;if(isNaN(l))throw new Error("uncmin: f(x0) is a NaN!");var p=Math.max,d=numeric.norm2;r=p(r,numeric.epsilon);var v,m,g,y=u.Hinv||numeric.identity(f),b=numeric.dot,w=numeric.inv,E=numeric.sub,S=numeric.add,x=numeric.tensor,T=numeric.div,N=numeric.mul,C=numeric.all,k=numeric.isFinite,L=numeric.neg,A=0,O,M,_,D,P,H,B,j,F,I,q,R,U="";m=i(n);while(A<s){if(typeof o=="function"&&o(A,n,l,m,y)){U="Callback returned true";break}if(!C(k(m))){U="Gradient has Infinity or NaN";break}v=L(b(y,m));if(!C(k(v))){U="Search direction has Infinity or NaN";break}I=d(v);if(I<r){U="Newton step smaller than tol";break}F=1,h=b(m,v),_=n;while(A<s){if(F*I<r)break;M=N(v,F),_=S(n,M),c=t(_);if(c-l>=.1*F*h||isNaN(c)){F*=.5,++A;continue}break}if(F*I<r){U="Line search step size smaller than tol";break}if(A===s){U="maxit reached during line search";break}g=i(_),D=E(g,m),B=b(D,M),P=b(y,D),y=E(S(y,N((B+b(D,P))/(B*B),x(M,M))),T(S(x(P,M),x(M,P)),B)),n=_,l=c,m=g,++A}return{solution:n,f:l,gradient:m,invHessian:y,iterations:A,message:U}},numeric.Dopri=function(t,n,r,i,s,o,u){this.x=t,this.y=n,this.f=r,this.ymid=i,this.iterations=s,this.events=u,this.message=o},numeric.Dopri.prototype._at=function(t,n){function r(e){return e*e}var i=this,s=i.x,o=i.y,u=i.f,a=i.ymid,f=s.length,l,c,h,p,d,v,t,m=Math.floor,g,y=.5,b=numeric.add,w=numeric.mul,E=numeric.sub,S,x,T;return l=s[n],c=s[n+1],p=o[n],d=o[n+1],g=c-l,h=l+y*g,v=a[n],S=E(u[n],w(p,1/(l-h)+2/(l-c))),x=E(u[n+1],w(d,1/(c-h)+2/(c-l))),T=[r(t-c)*(t-h)/r(l-c)/(l-h),r(t-l)*r(t-c)/r(l-h)/r(c-h),r(t-l)*(t-h)/r(c-l)/(c-h),(t-l)*r(t-c)*(t-h)/r(l-c)/(l-h),(t-c)*r(t-l)*(t-h)/r(l-c)/(c-h)],b(b(b(b(w(p,T[0]),w(v,T[1])),w(d,T[2])),w(S,T[3])),w(x,T[4]))},numeric.Dopri.prototype.at=function(t){var n,r,i,s=Math.floor;if(typeof t!="number"){var o=t.length,u=Array(o);for(n=o-1;n!==-1;--n)u[n]=this.at(t[n]);return u}var a=this.x;n=0,r=a.length-1;while(r-n>1)i=s(.5*(n+r)),a[i]<=t?n=i:r=i;return this._at(t,n)},numeric.dopri=function(t,n,r,i,s,o,u){typeof s=="undefined"&&(s=1e-6),typeof o=="undefined"&&(o=1e3);var a=[t],f=[r],l=[i(t,r)],c,h,p,d,v,m,g=[],y=.2,b=[.075,.225],w=[44/45,-56/15,32/9],E=[19372/6561,-25360/2187,64448/6561,-212/729],S=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],x=[35/384,0,500/1113,125/192,-2187/6784,11/84],T=[.10013431883002395,0,.3918321794184259,-0.02982460176594817,.05893268337240795,-0.04497888809104361,.023904308236133973],N=[.2,.3,.8,8/9,1,1],C=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,.025],k=0,L,A,O=(n-t)/10,M=0,_=numeric.add,D=numeric.mul,P,H,B=Math.max,j=Math.min,F=Math.abs,I=numeric.norminf,q=Math.pow,R=numeric.any,U=numeric.lt,z=numeric.and,W=numeric.sub,X,V,$,J=new numeric.Dopri(a,f,l,g,-1,"");typeof u=="function"&&(X=u(t,r));while(t<n&&M<o){++M,t+O>n&&(O=n-t),c=i(t+N[0]*O,_(r,D(y*O,l[k]))),h=i(t+N[1]*O,_(_(r,D(b[0]*O,l[k])),D(b[1]*O,c))),p=i(t+N[2]*O,_(_(_(r,D(w[0]*O,l[k])),D(w[1]*O,c)),D(w[2]*O,h))),d=i(t+N[3]*O,_(_(_(_(r,D(E[0]*O,l[k])),D(E[1]*O,c)),D(E[2]*O,h)),D(E[3]*O,p))),v=i(t+N[4]*O,_(_(_(_(_(r,D(S[0]*O,l[k])),D(S[1]*O,c)),D(S[2]*O,h)),D(S[3]*O,p)),D(S[4]*O,d))),P=_(_(_(_(_(r,D(l[k],O*x[0])),D(h,O*x[2])),D(p,O*x[3])),D(d,O*x[4])),D(v,O*x[5])),m=i(t+O,P),L=_(_(_(_(_(D(l[k],O*C[0]),D(h,O*C[2])),D(p,O*C[3])),D(d,O*C[4])),D(v,O*C[5])),D(m,O*C[6])),typeof L=="number"?H=F(L):H=I(L);if(H>s){O=.2*O*q(s/H,.25);if(t+O===t){J.msg="Step size became too small";break}continue}g[k]=_(_(_(_(_(_(r,D(l[k],O*T[0])),D(h,O*T[2])),D(p,O*T[3])),D(d,O*T[4])),D(v,O*T[5])),D(m,O*T[6])),++k,a[k]=t+O,f[k]=P,l[k]=m;if(typeof u=="function"){var K,Q=t,G=t+.5*O,Y;V=u(G,g[k-1]),$=z(U(X,0),U(0,V)),R($)||(Q=G,G=t+O,X=V,V=u(G,P),$=z(U(X,0),U(0,V)));if(R($)){var Z,et,tt,nt,rt=0,it=1,st=1;for(;;){if(typeof X=="number")Y=(st*V*Q-it*X*G)/(st*V-it*X);else{Y=G;for(A=X.length-1;A!==-1;--A)X[A]<0&&V[A]>0&&(Y=j(Y,(st*V[A]*Q-it*X[A]*G)/(st*V[A]-it*X[A])))}if(Y<=Q||Y>=G)break;K=J._at(Y,k-1),nt=u(Y,K),tt=z(U(X,0),U(0,nt)),R(tt)?(G=Y,V=nt,$=tt,st=1,rt===-1?it*=.5:it=1,rt=-1):(Q=Y,X=nt,it=1,rt===1?st*=.5:st=1,rt=1)}return P=J._at(.5*(t+Y),k-1),J.f[k]=i(Y,K),J.x[k]=Y,J.y[k]=K,J.ymid[k-1]=P,J.events=$,J.iterations=M,J}}t+=O,r=P,X=V,O=j(.8*O*q(s/H,.25),4*O)}return J.iterations=M,J},numeric.LU=function(e,t){t=t||!1;var n=Math.abs,r,i,s,o,u,a,f,l,c,h=e.length,p=h-1,d=new Array(h);t||(e=numeric.clone(e));for(s=0;s<h;++s){f=s,a=e[s],c=n(a[s]);for(i=s+1;i<h;++i)o=n(e[i][s]),c<o&&(c=o,f=i);d[s]=f,f!=s&&(e[s]=e[f],e[f]=a,a=e[s]),u=a[s];for(r=s+1;r<h;++r)e[r][s]/=u;for(r=s+1;r<h;++r){l=e[r];for(i=s+1;i<p;++i)l[i]-=l[s]*a[i],++i,l[i]-=l[s]*a[i];i===p&&(l[i]-=l[s]*a[i])}}return{LU:e,P:d}},numeric.LUsolve=function(t,n){var r,i,s=t.LU,o=s.length,u=numeric.clone(n),a=t.P,f,l,c,h;for(r=o-1;r!==-1;--r)u[r]=n[r];for(r=0;r<o;++r){f=a[r],a[r]!==r&&(h=u[r],u[r]=u[f],u[f]=h),l=s[r];for(i=0;i<r;++i)u[r]-=u[i]*l[i]}for(r=o-1;r>=0;--r){l=s[r];for(i=r+1;i<o;++i)u[r]-=u[i]*l[i];u[r]/=l[r]}return u},numeric.solve=function(t,n,r){return numeric.LUsolve(numeric.LU(t,r),n)},numeric.echelonize=function(t){var n=numeric.dim(t),r=n[0],i=n[1],s=numeric.identity(r),o=Array(r),u,a,f,l,c,h,p,d,v=Math.abs,m=numeric.diveq;t=numeric.clone(t);for(u=0;u<r;++u){f=0,c=t[u],h=s[u];for(a=1;a<i;++a)v(c[f])<v(c[a])&&(f=a);o[u]=f,m(h,c[f]),m(c,c[f]);for(a=0;a<r;++a)if(a!==u){p=t[a],d=p[f];for(l=i-1;l!==-1;--l)p[l]-=c[l]*d;p=s[a];for(l=r-1;l!==-1;--l)p[l]-=h[l]*d}}return{I:s,A:t,P:o}},numeric.__solveLP=function(t,n,r,i,s,o,u){var a=numeric.sum,f=numeric.log,l=numeric.mul,c=numeric.sub,h=numeric.dot,p=numeric.div,d=numeric.add,v=t.length,m=r.length,g,y=!1,b,w=0,E=1,S,x,T=numeric.transpose(n),N=numeric.svd,C=numeric.transpose,k=numeric.leq,L=Math.sqrt,A=Math.abs,O=numeric.muleq,M=numeric.norminf,_=numeric.any,D=Math.min,P=numeric.all,H=numeric.gt,B=Array(v),j=Array(m),F=numeric.rep([m],1),I,q=numeric.solve,R=c(r,h(n,o)),U,z=h(t,t),W;for(U=w;U<s;++U){var X,V,$;for(X=m-1;X!==-1;--X)j[X]=p(n[X],R[X]);var J=C(j);for(X=v-1;X!==-1;--X)B[X]=a(J[X]);E=.25*A(z/h(t,B));var K=100*L(z/h(B,B));if(!isFinite(E)||E>K)E=K;W=d(t,l(E,B)),I=h(J,j);for(X=v-1;X!==-1;--X)I[X][X]+=1;$=q(I,p(W,E),!0);var Q=p(R,h(n,$)),G=1;for(X=m-1;X!==-1;--X)Q[X]<0&&(G=D(G,-0.999*Q[X]));g=c(o,l($,G)),R=c(r,h(n,g));if(!P(H(R,0)))return{solution:o,message:"",iterations:U};o=g;if(E<i)return{solution:g,message:"",iterations:U};if(u){var Y=h(t,W),Z=h(n,W);y=!0;for(X=m-1;X!==-1;--X)if(Y*Z[X]<0){y=!1;break}}else o[v-1]>=0?y=!1:y=!0;if(y)return{solution:g,message:"Unbounded",iterations:U}}return{solution:o,message:"maximum iteration count exceeded",iterations:U}},numeric._solveLP=function(t,n,r,i,s){var o=t.length,u=r.length,a,f=numeric.sum,l=numeric.log,c=numeric.mul,h=numeric.sub,p=numeric.dot,d=numeric.div,v=numeric.add,m=numeric.rep([o],0).concat([1]),g=numeric.rep([u,1],-1),y=numeric.blockMatrix([[n,g]]),b=r,a=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(r)))+1),w=numeric.__solveLP(m,y,b,i,s,a,!1),E=numeric.clone(w.solution);E.length=o;var S=numeric.inf(h(r,p(n,E)));if(S<0)return{solution:NaN,message:"Infeasible",iterations:w.iterations};var x=numeric.__solveLP(t,n,r,i,s-w.iterations,E,!0);return x.iterations+=w.iterations,x},numeric.solveLP=function(t,n,r,i,s,o,u){typeof u=="undefined"&&(u=1e3),typeof o=="undefined"&&(o=numeric.epsilon);if(typeof i=="undefined")return numeric._solveLP(t,n,r,o,u);var a=i.length,f=i[0].length,l=n.length,c=numeric.echelonize(i),h=numeric.rep([f],0),p=c.P,d=[],v;for(v=p.length-1;v!==-1;--v)h[p[v]]=1;for(v=f-1;v!==-1;--v)h[v]===0&&d.push(v);var m=numeric.getRange,g=numeric.linspace(0,a-1),y=numeric.linspace(0,l-1),b=m(i,g,d),w=m(n,y,p),E=m(n,y,d),S=numeric.dot,x=numeric.sub,T=S(w,c.I),N=x(E,S(T,b)),C=x(r,S(T,s)),k=Array(p.length),L=Array(d.length);for(v=p.length-1;v!==-1;--v)k[v]=t[p[v]];for(v=d.length-1;v!==-1;--v)L[v]=t[d[v]];var A=x(L,S(k,S(c.I,b))),O=numeric._solveLP(A,N,C,o,u),M=O.solution;if(M!==M)return O;var _=S(c.I,x(s,S(b,M))),D=Array(t.length);for(v=p.length-1;v!==-1;--v)D[p[v]]=_[v];for(v=d.length-1;v!==-1;--v)D[d[v]]=M[v];return{solution:D,message:O.message,iterations:O.iterations}},numeric.MPStoLP=function(t){function y(e){throw new Error("MPStoLP: "+e+"\nLine "+s+": "+t[s]+"\nCurrent state: "+r[n]+"\n")}t instanceof String&&t.split("\n");var n=0,r=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],i=t.length,s,o,u,a=0,f={},l=[],c=0,h={},p=0,d,v=[],m=[],g=[];for(s=0;s<i;++s){u=t[s];var b=u.match(/\S*/g),w=[];for(o=0;o<b.length;++o)b[o]!==""&&w.push(b[o]);if(w.length===0)continue;for(o=0;o<r.length;++o)if(u.substr(0,r[o].length)===r[o])break;if(o<r.length){n=o,o===1&&(d=w[1]);if(o===6)return{name:d,c:v,A:numeric.transpose(m),b:g,rows:f,vars:h};continue}switch(n){case 0:case 1:y("Unexpected line");case 2:switch(w[0]){case"N":a===0?a=w[1]:y("Two or more N rows");break;case"L":f[w[1]]=c,l[c]=1,g[c]=0,++c;break;case"G":f[w[1]]=c,l[c]=-1,g[c]=0,++c;break;case"E":f[w[1]]=c,l[c]=0,g[c]=0,++c;break;default:y("Parse error "+numeric.prettyPrint(w))}break;case 3:h.hasOwnProperty(w[0])||(h[w[0]]=p,v[p]=0,m[p]=numeric.rep([c],0),++p);var E=h[w[0]];for(o=1;o<w.length;o+=2){if(w[o]===a){v[E]=parseFloat(w[o+1]);continue}var S=f[w[o]];m[E][S]=(l[S]<0?-1:1)*parseFloat(w[o+1])}break;case 4:for(o=1;o<w.length;o+=2)g[f[w[o]]]=(l[f[w[o]]]<0?-1:1)*parseFloat(w[o+1]);break;case 5:break;case 6:y("Internal error")}}y("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,i,s,o){function u(e){var t,r,i=this,s=e.length,o=0,u=i.i=i.j=i.m=0;i.S=[],i.c=[],s||(e=[s++]);while(o<n)i.S[o]=o++;for(o=0;o<n;o++)t=i.S[o],u=l(u+t+e[o%s]),r=i.S[u],i.S[o]=r,i.S[u]=t;i.g=function(t){var r=i.S,s=l(i.i+1),o=r[s],u=l(i.j+o),a=r[u];r[s]=a,r[u]=o;var f=r[l(o+a)];while(--t)s=l(s+1),o=r[s],u=l(u+o),a=r[u],r[s]=a,r[u]=o,f=f*n+r[l(o+a)];return i.i=s,i.j=u,f},i.g(n)}function a(e,t,n,r,i){n=[],i=typeof e;if(t&&i=="object")for(r in e)if(r.indexOf("S")<5)try{n.push(a(e[r],t-1))}catch(s){}return n.length?n:e+(i!="string"?"\0":"")}function f(e,t,n,r){e+="",n=0;for(r=0;r<e.length;r++)t[l(r)]=l((n^=t[l(r)]*19)+e.charCodeAt(r));e="";for(r in t)e+=String.fromCharCode(t[r]);return e}function l(e){return e&n-1}t.seedrandom=function(c,h){var p=[],d;return c=f(a(h?[c,e]:arguments.length?c:[(new Date).getTime(),e,window],3),p),d=new u(p),f(d.S,e),t.random=function(){var t=d.g(r),u=o,a=0;while(t<i)t=(t+a)*n,u*=n,a=d.g(1);while(t>=s)t/=2,u/=2,a>>>=1;return(t+a)/u},c},o=t.pow(n,r),i=t.pow(2,i),s=i*2,f(t.random(),e)}([],numeric.seedrandom,256,6,52),function(e){function t(e){if(typeof e!="object")return e;var n=[],r,i=e.length;for(r=0;r<i;r++)n[r+1]=t(e[r]);return n}function n(e){if(typeof e!="object")return e;var t=[],r,i=e.length;for(r=1;r<i;r++)t[r-1]=n(e[r]);return t}function r(e,t,n){var r,i,s,o,u;for(s=1;s<=n;s+=1){e[s][s]=1/e[s][s],u=-e[s][s];for(r=1;r<s;r+=1)e[r][s]=u*e[r][s];o=s+1;if(n<o)break;for(i=o;i<=n;i+=1){u=e[s][i],e[s][i]=0;for(r=1;r<=s;r+=1)e[r][i]=e[r][i]+u*e[r][s]}}}function i(e,t,n,r){var i,s,o,u;for(s=1;s<=n;s+=1){u=0;for(i=1;i<s;i+=1)u+=e[i][s]*r[i];r[s]=(r[s]-u)/e[s][s]}for(o=1;o<=n;o+=1){s=n+1-o,r[s]=r[s]/e[s][s],u=-r[s];for(i=1;i<s;i+=1)r[i]=r[i]+u*e[i][s]}}function s(e,t,n,r){var i,s,o,u,a,f;for(s=1;s<=n;s+=1){r[1]=s,f=0,o=s-1;if(o<1){f=e[s][s]-f;if(f<=0)break;e[s][s]=Math.sqrt(f)}else{for(u=1;u<=o;u+=1){a=e[u][s];for(i=1;i<u;i+=1)a-=e[i][s]*e[i][u];a/=e[u][u],e[u][s]=a,f+=a*a}f=e[s][s]-f;if(f<=0)break;e[s][s]=Math.sqrt(f)}r[1]=0}}function o(e,t,n,o,u,a,f,l,c,h,p,d,v,m,g,y){function V(){m[1]=m[1]+1,E=L;for(b=1;b<=h;b+=1){E+=1,P=-l[b];for(w=1;w<=o;w+=1)P+=f[w][b]*u[w];Math.abs(P)<U&&(P=0);if(b>p)g[E]=P;else{g[E]=-Math.abs(P);if(P>0){for(w=1;w<=o;w+=1)f[w][b]=-f[w][b];l[b]=-l[b]}}}for(b=1;b<=v;b+=1)g[L+d[b]]=0;O=0,D=0;for(b=1;b<=h;b+=1)g[L+b]<D*g[_+b]&&(O=b,D=g[L+b]/g[_+b]);return O===0?999:0}function $(){for(b=1;b<=o;b+=1){P=0;for(w=1;w<=o;w+=1)P+=e[w][b]*f[w][O];g[b]=P}S=N;for(b=1;b<=o;b+=1)g[S+b]=0;for(w=v+1;w<=o;w+=1)for(b=1;b<=o;b+=1)g[S+b]=g[S+b]+e[b][w]*g[w];q=!0;for(b=v;b>=1;b-=1){P=g[b],E=k+b*(b+3)/2,S=E-b;for(w=b+1;w<=v;w+=1)P-=g[E]*g[C+w],E+=w;P/=g[S],g[C+b]=P;if(d[b]<p)break;if(P<0)break;q=!1,T=b}if(!q){H=g[A+T]/g[C+T];for(b=1;b<=v;b+=1){if(d[b]<p)break;if(g[C+b]<0)break;D=g[A+b]/g[C+b]
,D<H&&(H=D,T=b)}}P=0;for(b=N+1;b<=N+o;b+=1)P+=g[b]*g[b];if(Math.abs(P)<=U){if(q)return y[1]=1,999;for(b=1;b<=v;b+=1)g[A+b]=g[A+b]-H*g[C+b];return g[A+v+1]=g[A+v+1]+H,700}P=0;for(b=1;b<=o;b+=1)P+=g[N+b]*f[b][O];B=-g[L+O]/P,R=!0,q||H<B&&(B=H,R=!1);for(b=1;b<=o;b+=1)u[b]=u[b]+B*g[N+b],Math.abs(u[b])<U&&(u[b]=0);a[1]=a[1]+B*P*(B/2+g[A+v+1]);for(b=1;b<=v;b+=1)g[A+b]=g[A+b]-B*g[C+b];g[A+v+1]=g[A+v+1]+B;if(!R){P=-l[O];for(w=1;w<=o;w+=1)P+=u[w]*f[w][O];if(O>p)g[L+O]=P;else{g[L+O]=-Math.abs(P);if(P>0){for(w=1;w<=o;w+=1)f[w][O]=-f[w][O];l[O]=-l[O]}}return 700}v+=1,d[v]=O,E=k+(v-1)*v/2+1;for(b=1;b<=v-1;b+=1)g[E]=g[b],E+=1;if(v===o)g[E]=g[o];else{for(b=o;b>=v+1;b-=1){if(g[b]===0)break;j=Math.max(Math.abs(g[b-1]),Math.abs(g[b])),F=Math.min(Math.abs(g[b-1]),Math.abs(g[b])),g[b-1]>=0?D=Math.abs(j*Math.sqrt(1+F*F/(j*j))):D=-Math.abs(j*Math.sqrt(1+F*F/(j*j))),j=g[b-1]/D,F=g[b]/D;if(j===1)break;if(j===0){g[b-1]=F*D;for(w=1;w<=o;w+=1)D=e[w][b-1],e[w][b-1]=e[w][b],e[w][b]=D}else{g[b-1]=D,I=F/(1+j);for(w=1;w<=o;w+=1)D=j*e[w][b-1]+F*e[w][b],e[w][b]=I*(e[w][b-1]+D)-e[w][b],e[w][b-1]=D}}g[E]=g[v]}return 0}function J(){E=k+T*(T+1)/2+1,S=E+T;if(g[S]===0)return 798;j=Math.max(Math.abs(g[S-1]),Math.abs(g[S])),F=Math.min(Math.abs(g[S-1]),Math.abs(g[S])),g[S-1]>=0?D=Math.abs(j*Math.sqrt(1+F*F/(j*j))):D=-Math.abs(j*Math.sqrt(1+F*F/(j*j))),j=g[S-1]/D,F=g[S]/D;if(j===1)return 798;if(j===0){for(b=T+1;b<=v;b+=1)D=g[S-1],g[S-1]=g[S],g[S]=D,S+=b;for(b=1;b<=o;b+=1)D=e[b][T],e[b][T]=e[b][T+1],e[b][T+1]=D}else{I=F/(1+j);for(b=T+1;b<=v;b+=1)D=j*g[S-1]+F*g[S],g[S]=I*(g[S-1]+D)-g[S],g[S-1]=D,S+=b;for(b=1;b<=o;b+=1)D=j*e[b][T]+F*e[b][T+1],e[b][T+1]=I*(e[b][T]+D)-e[b][T+1],e[b][T]=D}return 0}function K(){S=E-T;for(b=1;b<=T;b+=1)g[S]=g[E],E+=1,S+=1;return g[A+T]=g[A+T+1],d[T]=d[T+1],T+=1,T<v?797:0}function Q(){return g[A+v]=g[A+v+1],g[A+v+1]=0,d[v]=0,v-=1,m[2]=m[2]+1,0}var b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X;M=Math.min(o,h),E=2*o+M*(M+5)/2+2*h+1,U=1e-60;do U+=U,z=1+.1*U,W=1+.2*U;while(z<=1||W<=1);for(b=1;b<=o;b+=1)g[b]=t[b];for(b=o+1;b<=E;b+=1)g[b]=0;for(b=1;b<=h;b+=1)d[b]=0;x=[];if(y[1]===0){s(e,n,o,x);if(x[1]!==0){y[1]=2;return}i(e,n,o,t),r(e,n,o)}else{for(w=1;w<=o;w+=1){u[w]=0;for(b=1;b<=w;b+=1)u[w]=u[w]+e[b][w]*t[b]}for(w=1;w<=o;w+=1){t[w]=0;for(b=w;b<=o;b+=1)t[w]=t[w]+e[w][b]*u[b]}}a[1]=0;for(w=1;w<=o;w+=1){u[w]=t[w],a[1]=a[1]+g[w]*u[w],g[w]=0;for(b=w+1;b<=o;b+=1)e[b][w]=0}a[1]=-a[1]/2,y[1]=0,N=o,C=N+o,A=C+M,k=A+M+1,L=k+M*(M+1)/2,_=L+h;for(b=1;b<=h;b+=1){P=0;for(w=1;w<=o;w+=1)P+=f[w][b]*f[w][b];g[_+b]=Math.sqrt(P)}v=0,m[1]=0,m[2]=0,X=0;for(;;){X=V();if(X===999)return;for(;;){X=$();if(X===0)break;if(X===999)return;if(X===700)if(T===v)Q();else{for(;;){J(),X=K();if(X!==797)break}Q()}}}}function u(e,r,i,s,u,a){e=t(e),r=t(r),i=t(i);var f,l,c,h,p,d=[],v=[],m=[],g=[],y=[],b;u=u||0,a=a?t(a):[undefined,0],s=s?t(s):[],l=e.length-1,c=i[1].length-1;if(!s)for(f=1;f<=c;f+=1)s[f]=0;for(f=1;f<=c;f+=1)v[f]=0;h=0,p=Math.min(l,c);for(f=1;f<=l;f+=1)m[f]=0;d[1]=0;for(f=1;f<=2*l+p*(p+5)/2+2*c+1;f+=1)g[f]=0;for(f=1;f<=2;f+=1)y[f]=0;return o(e,r,l,l,m,d,i,s,l,c,u,v,h,y,g,a),b="",a[1]===1&&(b="constraints are inconsistent, no solution!"),a[1]===2&&(b="matrix D in quadratic function is not positive definite!"),{solution:n(m),value:n(d),unconstrained_solution:n(r),iterations:n(y),iact:n(v),message:b}}e.solveQP=u}(numeric),numeric.svd=function(t){function g(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):t==0?e:t*Math.sqrt(1+e*e/t/t)}var n,r=numeric.epsilon,i=1e-64/r,s=50,o=0,u=0,a=0,f=0,l=0,c=numeric.clone(t),h=c.length,p=c[0].length;if(h<p)throw"Need more rows than columns";var d=new Array(p),v=new Array(p);for(u=0;u<p;u++)d[u]=v[u]=0;var m=numeric.rep([p,p],0),y=0,b=0,w=0,E=0,S=0,x=0,T=0;for(u=0;u<p;u++){d[u]=b,T=0,l=u+1;for(a=u;a<h;a++)T+=c[a][u]*c[a][u];if(T<=i)b=0;else{y=c[u][u],b=Math.sqrt(T),y>=0&&(b=-b),w=y*b-T,c[u][u]=y-b;for(a=l;a<p;a++){T=0;for(f=u;f<h;f++)T+=c[f][u]*c[f][a];y=T/w;for(f=u;f<h;f++)c[f][a]+=y*c[f][u]}}v[u]=b,T=0;for(a=l;a<p;a++)T+=c[u][a]*c[u][a];if(T<=i)b=0;else{y=c[u][u+1],b=Math.sqrt(T),y>=0&&(b=-b),w=y*b-T,c[u][u+1]=y-b;for(a=l;a<p;a++)d[a]=c[u][a]/w;for(a=l;a<h;a++){T=0;for(f=l;f<p;f++)T+=c[a][f]*c[u][f];for(f=l;f<p;f++)c[a][f]+=T*d[f]}}S=Math.abs(v[u])+Math.abs(d[u]),S>E&&(E=S)}for(u=p-1;u!=-1;u+=-1){if(b!=0){w=b*c[u][u+1];for(a=l;a<p;a++)m[a][u]=c[u][a]/w;for(a=l;a<p;a++){T=0;for(f=l;f<p;f++)T+=c[u][f]*m[f][a];for(f=l;f<p;f++)m[f][a]+=T*m[f][u]}}for(a=l;a<p;a++)m[u][a]=0,m[a][u]=0;m[u][u]=1,b=d[u],l=u}for(u=p-1;u!=-1;u+=-1){l=u+1,b=v[u];for(a=l;a<p;a++)c[u][a]=0;if(b!=0){w=c[u][u]*b;for(a=l;a<p;a++){T=0;for(f=l;f<h;f++)T+=c[f][u]*c[f][a];y=T/w;for(f=u;f<h;f++)c[f][a]+=y*c[f][u]}for(a=u;a<h;a++)c[a][u]=c[a][u]/b}else for(a=u;a<h;a++)c[a][u]=0;c[u][u]+=1}r*=E;for(f=p-1;f!=-1;f+=-1)for(var N=0;N<s;N++){var C=!1;for(l=f;l!=-1;l+=-1){if(Math.abs(d[l])<=r){C=!0;break}if(Math.abs(v[l-1])<=r)break}if(!C){o=0,T=1;var k=l-1;for(u=l;u<f+1;u++){y=T*d[u],d[u]=o*d[u];if(Math.abs(y)<=r)break;b=v[u],w=g(y,b),v[u]=w,o=b/w,T=-y/w;for(a=0;a<h;a++)S=c[a][k],x=c[a][u],c[a][k]=S*o+x*T,c[a][u]=-S*T+x*o}}x=v[f];if(l==f){if(x<0){v[f]=-x;for(a=0;a<p;a++)m[a][f]=-m[a][f]}break}if(N>=s-1)throw"Error: no convergence.";E=v[l],S=v[f-1],b=d[f-1],w=d[f],y=((S-x)*(S+x)+(b-w)*(b+w))/(2*w*S),b=g(y,1),y<0?y=((E-x)*(E+x)+w*(S/(y-b)-w))/E:y=((E-x)*(E+x)+w*(S/(y+b)-w))/E,o=1,T=1;for(u=l+1;u<f+1;u++){b=d[u],S=v[u],w=T*b,b=o*b,x=g(y,w),d[u-1]=x,o=y/x,T=w/x,y=E*o+b*T,b=-E*T+b*o,w=S*T,S*=o;for(a=0;a<p;a++)E=m[a][u-1],x=m[a][u],m[a][u-1]=E*o+x*T,m[a][u]=-E*T+x*o;x=g(y,w),v[u-1]=x,o=y/x,T=w/x,y=o*b+T*S,E=-T*b+o*S;for(a=0;a<h;a++)S=c[a][u-1],x=c[a][u],c[a][u-1]=S*o+x*T,c[a][u]=-S*T+x*o}d[l]=0,d[f]=y,v[f]=E}for(u=0;u<v.length;u++)v[u]<r&&(v[u]=0);for(u=0;u<p;u++)for(a=u-1;a>=0;a--)if(v[a]<v[u]){o=v[a],v[a]=v[u],v[u]=o;for(f=0;f<c.length;f++)n=c[f][u],c[f][u]=c[f][a],c[f][a]=n;for(f=0;f<m.length;f++)n=m[f][u],m[f][u]=m[f][a],m[f][a]=n;u=a}return{U:c,S:v,V:m}};