<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>StructureFinder</title>


    <link rel="stylesheet" href="http://127.0.0.1/w2ui/w2ui-1.4.min.css">
    <link rel="stylesheet" href="http://127.0.0.1/bootstrap3/css/bootstrap.min.css">
    <script src="http://127.0.0.1/jquery/jquery.min.js"></script>
    <script src="http://127.0.0.1/bootstrap3/js/bootstrap-3.2.0.min.js"></script>
    <script src="http://127.0.0.1/jsmol/JSmol_dk.nojq.lite.js"></script>
    <script src="http://127.0.0.1/w2ui/w2ui-1.4.min.js"></script>


<style type="text/css">

body {
    background-color: #ffffff;
    font-size: 12px;
    line-height: inherit;
}

#resitable1 tr td {
    line-height: 13px;
    height: 13px;
    overflow: auto;
}

#resitable2 tr td {
    line-height: 13px;
    height: 13px;
    overflow: auto;
}

#jsmolcolumn {
    width: 300px;
    height: 1px;
    border: thin hidden lightgray;
    border-radius: 5px;
}

</style>


<script>
    function copyToClipboard(element) {
        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val($(element).text()).select();
        document.execCommand("copy");
        $temp.remove();
    }

    // height of cif list to 35% of the screen height:
    $(document).ready(function(){
        //gets the window's height
        var b = $(window).height();
        var h = b * 0.35;
        $("#mygrid").css("height", h);

});

</script>

</head>


<body>


<div class="container">
<h2>StructureFinder</h2>


<div class="form-horizontal" id="foo">
    <div class="form-group row">
        <div class="col-sm-6">
            <div class="input-group input-group-sm">
                <input type="text" class="form-control" placeholder="Search Unit Cell" id="cellsrch" name="cell">
                    <div class="input-group-btn">
                    <button class="btn btn-default" type="submit" id="cellsrchbutton">
                        <i class="glyphicon glyphicon-search"></i>
                    </button>
                    </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="input-group input-group-sm">
                <input type="text" class="form-control" placeholder="Search Text" id="textsrch" name="text">
                    <div class="input-group-btn">
                    <button class="btn btn-default" type="submit" id="textsrchbutton">
                        <i class="glyphicon glyphicon-search"></i>
                    </button>
                    </div>
            </div>
        </div>
    </div>
</div>

<div id="mygrid" style="height: 450px"></div>


<div class="row">
    <div class="col-md-12">
        <h5><span class="invisible" id="cellrow" > </span>
        <span class="btn btn-default glyphicon glyphicon-copy invisible" id="cell_copy_btn"
              data-toggle="tooltip" title="Copy cell to clipboard."
              onclick="copyToClipboard('#hidden-cell')"></span></h5>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <span id="residualstable1"></span>
    </div>

    <div class="col-md-4">
        <span id="residualstable2"></span>
    </div>
    <div class="col-md-4" id="jsmolcolumn" data-toggle="tooltip" title="Asymmetric Unit">
        <span id="jsmoldiv"></span>
    </div>
</div>


<div class="row">
    <div class="col-sm-10">
        <span id="residuals"></span>
    </div>
    <div class="col-sm-2">

    </div>
</div>

<br>
<br>
<address>
  <strong>StructureFinder by Daniel Kratzert</strong><br>
  <a href="mailto:daniel.kratzert@ac.uni-freiburg.de">daniel.kratzert@ac.uni-freiburg.de</a>
</address>

<!-- The main container div: -->
</div>


</body>

<!-- Javascript functions start here: -->
<script>

jQuery(document).ready(function($) {

    $("#textsrchbutton").click(function(event) {
        var txt = document.getElementById("textsrch").value;
        txtsearch(txt);
    });
     $('#textsrch').keypress(function(e) {
        if (e.which === 13) {  // enter key
            var txt = document.getElementById("textsrch").value;
            txtsearch(txt);
            //console.log(cell);
        }
    });

    $("#cellsrchbutton").click(function(event) {
        var cell = document.getElementById("cellsrch").value;
        cellsearch(cell);
    });
    $('#cellsrch').keypress(function(e) {
        if (e.which === 13) {  // enter key
            var cell = document.getElementById("cellsrch").value;
            cellsearch(cell);
            //console.log(cell);
        }
    });


    $('#mygrid').w2grid({
        name: 'mygrid',
        header: 'StructureFinder',
        url: 'http://127.0.0.1/cgi-bin/strflog.cgi',
        method: 'GET',
        show: {
            toolbar: false,
            footer: true,
        },
        columns: [
            {field: 'recid', caption: 'ID', size: '45px', sortable: true, attr: 'align=center'},
            {field: 'filename', caption: 'filename', size: '20%', sortable: true, resizable: true},
            {field: 'dataname', caption: 'dataname', size: '15%', sortable: true, resizable: true},
            {field: 'path', caption: 'directory', size: '65%', sortable: true, resizable: true}
        ],
        searches: [
            {field: 'filename', caption: 'filename', type: 'text'},
            {field: 'dataname', caption: 'dataname', type: 'text'},
            {field: 'path', caption: 'directory', type: 'text'}
        ],
        //sortData: [{field: 'dataname', direction: 'ASC'}],
        onSelect:function(event) {
            showprop(event.recid);
            //console.log(record);
        }
    });


    // some options for JSmol:
    var bgcolor = $(this.body).css("background-color");
    var Info;
    Info = {
        width: 275,
        height: 292,
        color: bgcolor,
        //color: "0xf0f0f0",
        shadeAtoms: false,
        addSelectionOptions: false,
        use: "HTML5",
        readyFunction: null,
        defaultModel: "",
        bondWidth: 2,
        zoomScaling: 5,
        pinchScaling: 5.0,
        mouseDragFactor: 0.9,
        touchDragFactor: 0.9,
        multipleBondSpacing: 0,
        spinRateX: -0.08,
        spinRateY: 0.05,
        spinFPS: 20,
        spin: true,
        debug: false,
        j2sPath: ""
    };


    function cellsearch(cell) {
        w2ui['mygrid'].request('get-records', params={cell: cell}, url=w2ui['mygrid'].url,
            function(result) {
                console.log(result);
            }
        );
    }

    function txtsearch(text) {
        w2ui['mygrid'].request('get-records', params={text: text}, url=w2ui['mygrid'].url,
            function(result) {
                console.log(result);
            }
        );
    }

    function showprop(idstr) {
        // Get molecule data and display the molecule:
        $.post(url = "strflog.cgi", data = {id: idstr, molecule: true}, function (result) {
            Jmol._document = null;
            Jmol.getTMApplet("jmol", Info);
            $("#jsmoldiv").html(jmol._code);
            jmol.__loadModel(result);
            $("#jsmolcolumn").css("border-style", "solid").css("height", 300);
        });

        // Get unit cell row:
        $.post(url = "strflog.cgi", data = {id: idstr, unitcell: true}, function (result) {
            $("#cellrow").removeClass('invisible');
            $("#cell_copy_btn").removeClass('invisible');
            document.getElementById("cellrow").innerHTML = result;
        });

        // display the big cif data table:
        $.post(url = "strflog.cgi", data = {id: idstr}, function (result) {
            document.getElementById("residuals").innerHTML = result;
        });

        // Get residuals table 1:
        $.post(url = "strflog.cgi", data = {id: idstr, residuals1: true}, function (result) {
            document.getElementById("residualstable1").innerHTML = result;
        });

        // Get residuals table 2:
        $.post(url = "strflog.cgi", data = {id: idstr, residuals2: true}, function (result) {
            document.getElementById("residualstable2").innerHTML = result;
        });
    }
});

</script>



</html>
